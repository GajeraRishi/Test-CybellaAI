var yk=Object.defineProperty;var Ig=e=>{throw TypeError(e)};var xk=(e,t,n)=>t in e?yk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var wk=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var fo=(e,t,n)=>xk(e,typeof t!="symbol"?t+"":t,n),tf=(e,t,n)=>t.has(e)||Ig("Cannot "+n);var K=(e,t,n)=>(tf(e,t,"read from private field"),n?n.call(e):t.get(e)),Me=(e,t,n)=>t.has(e)?Ig("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),be=(e,t,n,r)=>(tf(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Pt=(e,t,n)=>(tf(e,t,"access private method"),n);var Zu=(e,t,n,r)=>({set _(o){be(e,t,o,n)},get _(){return K(e,t,r)}});var RW=wk((jW,vk)=>{function bk(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in e)){const i=Object.getOwnPropertyDescriptor(r,o);i&&Object.defineProperty(e,o,i.get?i:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function H1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var G1={exports:{}},nd={},q1={exports:{}},ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nu=Symbol.for("react.element"),Ck=Symbol.for("react.portal"),Ek=Symbol.for("react.fragment"),Sk=Symbol.for("react.strict_mode"),kk=Symbol.for("react.profiler"),_k=Symbol.for("react.provider"),Rk=Symbol.for("react.context"),Nk=Symbol.for("react.forward_ref"),Ik=Symbol.for("react.suspense"),Tk=Symbol.for("react.memo"),Ak=Symbol.for("react.lazy"),Tg=Symbol.iterator;function Pk(e){return e===null||typeof e!="object"?null:(e=Tg&&e[Tg]||e["@@iterator"],typeof e=="function"?e:null)}var K1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X1=Object.assign,Y1={};function rs(e,t,n){this.props=e,this.context=t,this.refs=Y1,this.updater=n||K1}rs.prototype.isReactComponent={};rs.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};rs.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Q1(){}Q1.prototype=rs.prototype;function nv(e,t,n){this.props=e,this.context=t,this.refs=Y1,this.updater=n||K1}var rv=nv.prototype=new Q1;rv.constructor=nv;X1(rv,rs.prototype);rv.isPureReactComponent=!0;var Ag=Array.isArray,J1=Object.prototype.hasOwnProperty,ov={current:null},Z1={key:!0,ref:!0,__self:!0,__source:!0};function ex(e,t,n){var r,o={},i=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(i=""+t.key),t)J1.call(t,r)&&!Z1.hasOwnProperty(r)&&(o[r]=t[r]);var s=arguments.length-2;if(s===1)o.children=n;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(r in s=e.defaultProps,s)o[r]===void 0&&(o[r]=s[r]);return{$$typeof:Nu,type:e,key:i,ref:a,props:o,_owner:ov.current}}function Dk(e,t){return{$$typeof:Nu,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function iv(e){return typeof e=="object"&&e!==null&&e.$$typeof===Nu}function Mk(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Pg=/\/+/g;function nf(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Mk(""+e.key):t.toString(36)}function zl(e,t,n,r,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Nu:case Ck:a=!0}}if(a)return a=e,o=o(a),e=r===""?"."+nf(a,0):r,Ag(o)?(n="",e!=null&&(n=e.replace(Pg,"$&/")+"/"),zl(o,t,n,"",function(l){return l})):o!=null&&(iv(o)&&(o=Dk(o,n+(!o.key||a&&a.key===o.key?"":(""+o.key).replace(Pg,"$&/")+"/")+e)),t.push(o)),1;if(a=0,r=r===""?".":r+":",Ag(e))for(var s=0;s<e.length;s++){i=e[s];var u=r+nf(i,s);a+=zl(i,t,n,u,o)}else if(u=Pk(e),typeof u=="function")for(e=u.call(e),s=0;!(i=e.next()).done;)i=i.value,u=r+nf(i,s++),a+=zl(i,t,n,u,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function el(e,t,n){if(e==null)return e;var r=[],o=0;return zl(e,r,"","",function(i){return t.call(n,i,o++)}),r}function Fk(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Xt={current:null},Wl={transition:null},Ok={ReactCurrentDispatcher:Xt,ReactCurrentBatchConfig:Wl,ReactCurrentOwner:ov};function tx(){throw Error("act(...) is not supported in production builds of React.")}ke.Children={map:el,forEach:function(e,t,n){el(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return el(e,function(){t++}),t},toArray:function(e){return el(e,function(t){return t})||[]},only:function(e){if(!iv(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ke.Component=rs;ke.Fragment=Ek;ke.Profiler=kk;ke.PureComponent=nv;ke.StrictMode=Sk;ke.Suspense=Ik;ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ok;ke.act=tx;ke.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=X1({},e.props),o=e.key,i=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,a=ov.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)J1.call(t,u)&&!Z1.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&s!==void 0?s[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:Nu,type:e.type,key:o,ref:i,props:r,_owner:a}};ke.createContext=function(e){return e={$$typeof:Rk,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:_k,_context:e},e.Consumer=e};ke.createElement=ex;ke.createFactory=function(e){var t=ex.bind(null,e);return t.type=e,t};ke.createRef=function(){return{current:null}};ke.forwardRef=function(e){return{$$typeof:Nk,render:e}};ke.isValidElement=iv;ke.lazy=function(e){return{$$typeof:Ak,_payload:{_status:-1,_result:e},_init:Fk}};ke.memo=function(e,t){return{$$typeof:Tk,type:e,compare:t===void 0?null:t}};ke.startTransition=function(e){var t=Wl.transition;Wl.transition={};try{e()}finally{Wl.transition=t}};ke.unstable_act=tx;ke.useCallback=function(e,t){return Xt.current.useCallback(e,t)};ke.useContext=function(e){return Xt.current.useContext(e)};ke.useDebugValue=function(){};ke.useDeferredValue=function(e){return Xt.current.useDeferredValue(e)};ke.useEffect=function(e,t){return Xt.current.useEffect(e,t)};ke.useId=function(){return Xt.current.useId()};ke.useImperativeHandle=function(e,t,n){return Xt.current.useImperativeHandle(e,t,n)};ke.useInsertionEffect=function(e,t){return Xt.current.useInsertionEffect(e,t)};ke.useLayoutEffect=function(e,t){return Xt.current.useLayoutEffect(e,t)};ke.useMemo=function(e,t){return Xt.current.useMemo(e,t)};ke.useReducer=function(e,t,n){return Xt.current.useReducer(e,t,n)};ke.useRef=function(e){return Xt.current.useRef(e)};ke.useState=function(e){return Xt.current.useState(e)};ke.useSyncExternalStore=function(e,t,n){return Xt.current.useSyncExternalStore(e,t,n)};ke.useTransition=function(){return Xt.current.useTransition()};ke.version="18.3.1";q1.exports=ke;var C=q1.exports;const J=H1(C),nx=bk({__proto__:null,default:J},[C]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lk=C,Bk=Symbol.for("react.element"),jk=Symbol.for("react.fragment"),zk=Object.prototype.hasOwnProperty,Wk=Lk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$k={key:!0,ref:!0,__self:!0,__source:!0};function rx(e,t,n){var r,o={},i=null,a=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)zk.call(t,r)&&!$k.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:Bk,type:e,key:i,ref:a,props:o,_owner:Wk.current}}nd.Fragment=jk;nd.jsx=rx;nd.jsxs=rx;G1.exports=nd;var S=G1.exports,ox={exports:{}},An={},ix={exports:{}},ax={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(P,L){var W=P.length;P.push(L);e:for(;0<W;){var H=W-1>>>1,q=P[H];if(0<o(q,L))P[H]=L,P[W]=q,W=H;else break e}}function n(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var L=P[0],W=P.pop();if(W!==L){P[0]=W;e:for(var H=0,q=P.length,Q=q>>>1;H<Q;){var re=2*(H+1)-1,ce=P[re],ee=re+1,de=P[ee];if(0>o(ce,W))ee<q&&0>o(de,ce)?(P[H]=de,P[ee]=W,H=ee):(P[H]=ce,P[re]=W,H=re);else if(ee<q&&0>o(de,W))P[H]=de,P[ee]=W,H=ee;else break e}}return L}function o(P,L){var W=P.sortIndex-L.sortIndex;return W!==0?W:P.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,d=null,f=3,h=!1,p=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(P){for(var L=n(l);L!==null;){if(L.callback===null)r(l);else if(L.startTime<=P)r(l),L.sortIndex=L.expirationTime,t(u,L);else break;L=n(l)}}function w(P){if(v=!1,x(P),!p)if(n(u)!==null)p=!0,B(b);else{var L=n(l);L!==null&&$(w,L.startTime-P)}}function b(P,L){p=!1,v&&(v=!1,m(_),_=-1),h=!0;var W=f;try{for(x(L),d=n(u);d!==null&&(!(d.expirationTime>L)||P&&!D());){var H=d.callback;if(typeof H=="function"){d.callback=null,f=d.priorityLevel;var q=H(d.expirationTime<=L);L=e.unstable_now(),typeof q=="function"?d.callback=q:d===n(u)&&r(u),x(L)}else r(u);d=n(u)}if(d!==null)var Q=!0;else{var re=n(l);re!==null&&$(w,re.startTime-L),Q=!1}return Q}finally{d=null,f=W,h=!1}}var E=!1,k=null,_=-1,R=5,N=-1;function D(){return!(e.unstable_now()-N<R)}function A(){if(k!==null){var P=e.unstable_now();N=P;var L=!0;try{L=k(!0,P)}finally{L?j():(E=!1,k=null)}}else E=!1}var j;if(typeof y=="function")j=function(){y(A)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,z=F.port2;F.port1.onmessage=A,j=function(){z.postMessage(null)}}else j=function(){g(A,0)};function B(P){k=P,E||(E=!0,j())}function $(P,L){_=g(function(){P(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_continueExecution=function(){p||h||(p=!0,B(b))},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(P){switch(f){case 1:case 2:case 3:var L=3;break;default:L=f}var W=f;f=L;try{return P()}finally{f=W}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(P,L){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var W=f;f=P;try{return L()}finally{f=W}},e.unstable_scheduleCallback=function(P,L,W){var H=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?H+W:H):W=H,P){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=W+q,P={id:c++,callback:L,priorityLevel:P,startTime:W,expirationTime:q,sortIndex:-1},W>H?(P.sortIndex=W,t(l,P),n(u)===null&&P===n(l)&&(v?(m(_),_=-1):v=!0,$(w,W-H))):(P.sortIndex=q,t(u,P),p||h||(p=!0,B(b))),P},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(P){var L=f;return function(){var W=f;f=L;try{return P.apply(this,arguments)}finally{f=W}}}})(ax);ix.exports=ax;var Uk=ix.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vk=C,Nn=Uk;function Y(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sx=new Set,Gs={};function Bi(e,t){Ua(e,t),Ua(e+"Capture",t)}function Ua(e,t){for(Gs[e]=t,e=0;e<t.length;e++)sx.add(t[e])}var Xr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wh=Object.prototype.hasOwnProperty,Hk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Dg={},Mg={};function Gk(e){return wh.call(Mg,e)?!0:wh.call(Dg,e)?!1:Hk.test(e)?Mg[e]=!0:(Dg[e]=!0,!1)}function qk(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Kk(e,t,n,r){if(t===null||typeof t>"u"||qk(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Yt(e,t,n,r,o,i,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=a}var At={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){At[e]=new Yt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];At[t]=new Yt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){At[e]=new Yt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){At[e]=new Yt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){At[e]=new Yt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){At[e]=new Yt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){At[e]=new Yt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){At[e]=new Yt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){At[e]=new Yt(e,5,!1,e.toLowerCase(),null,!1,!1)});var av=/[\-:]([a-z])/g;function sv(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(av,sv);At[t]=new Yt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(av,sv);At[t]=new Yt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(av,sv);At[t]=new Yt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){At[e]=new Yt(e,1,!1,e.toLowerCase(),null,!1,!1)});At.xlinkHref=new Yt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){At[e]=new Yt(e,1,!1,e.toLowerCase(),null,!0,!0)});function uv(e,t,n,r){var o=At.hasOwnProperty(t)?At[t]:null;(o!==null?o.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Kk(t,n,o,r)&&(n=null),r||o===null?Gk(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=n===null?o.type===3?!1:"":n:(t=o.attributeName,r=o.attributeNamespace,n===null?e.removeAttribute(t):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var no=Vk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tl=Symbol.for("react.element"),aa=Symbol.for("react.portal"),sa=Symbol.for("react.fragment"),lv=Symbol.for("react.strict_mode"),bh=Symbol.for("react.profiler"),ux=Symbol.for("react.provider"),lx=Symbol.for("react.context"),cv=Symbol.for("react.forward_ref"),Ch=Symbol.for("react.suspense"),Eh=Symbol.for("react.suspense_list"),dv=Symbol.for("react.memo"),wo=Symbol.for("react.lazy"),cx=Symbol.for("react.offscreen"),Fg=Symbol.iterator;function vs(e){return e===null||typeof e!="object"?null:(e=Fg&&e[Fg]||e["@@iterator"],typeof e=="function"?e:null)}var tt=Object.assign,rf;function Is(e){if(rf===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);rf=t&&t[1]||""}return`
`+rf+e}var of=!1;function af(e,t){if(!e||of)return"";of=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var o=l.stack.split(`
`),i=r.stack.split(`
`),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(a!==1||s!==1)do if(a--,s--,0>s||o[a]!==i[s]){var u=`
`+o[a].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}while(1<=a&&0<=s);break}}}finally{of=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Is(e):""}function Xk(e){switch(e.tag){case 5:return Is(e.type);case 16:return Is("Lazy");case 13:return Is("Suspense");case 19:return Is("SuspenseList");case 0:case 2:case 15:return e=af(e.type,!1),e;case 11:return e=af(e.type.render,!1),e;case 1:return e=af(e.type,!0),e;default:return""}}function Sh(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case sa:return"Fragment";case aa:return"Portal";case bh:return"Profiler";case lv:return"StrictMode";case Ch:return"Suspense";case Eh:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case lx:return(e.displayName||"Context")+".Consumer";case ux:return(e._context.displayName||"Context")+".Provider";case cv:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case dv:return t=e.displayName||null,t!==null?t:Sh(e.type)||"Memo";case wo:t=e._payload,e=e._init;try{return Sh(e(t))}catch{}}return null}function Yk(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Sh(t);case 8:return t===lv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function qo(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function dx(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Qk(e){var t=dx(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function nl(e){e._valueTracker||(e._valueTracker=Qk(e))}function fx(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=dx(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function nc(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function kh(e,t){var n=t.checked;return tt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Og(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=qo(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function hx(e,t){t=t.checked,t!=null&&uv(e,"checked",t,!1)}function _h(e,t){hx(e,t);var n=qo(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Rh(e,t.type,n):t.hasOwnProperty("defaultValue")&&Rh(e,t.type,qo(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Lg(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Rh(e,t,n){(t!=="number"||nc(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Ts=Array.isArray;function ya(e,t,n,r){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&r&&(e[n].defaultSelected=!0)}else{for(n=""+qo(n),t=null,o=0;o<e.length;o++){if(e[o].value===n){e[o].selected=!0,r&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function Nh(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Y(91));return tt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Bg(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Y(92));if(Ts(n)){if(1<n.length)throw Error(Y(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:qo(n)}}function px(e,t){var n=qo(t.value),r=qo(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function jg(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function vx(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ih(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?vx(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var rl,mx=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(rl=rl||document.createElement("div"),rl.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=rl.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function qs(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ds={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Jk=["Webkit","ms","Moz","O"];Object.keys(Ds).forEach(function(e){Jk.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ds[t]=Ds[e]})});function gx(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ds.hasOwnProperty(e)&&Ds[e]?(""+t).trim():t+"px"}function yx(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,o=gx(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,o):e[n]=o}}var Zk=tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Th(e,t){if(t){if(Zk[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Y(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Y(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Y(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Y(62))}}function Ah(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ph=null;function fv(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Dh=null,xa=null,wa=null;function zg(e){if(e=Au(e)){if(typeof Dh!="function")throw Error(Y(280));var t=e.stateNode;t&&(t=sd(t),Dh(e.stateNode,e.type,t))}}function xx(e){xa?wa?wa.push(e):wa=[e]:xa=e}function wx(){if(xa){var e=xa,t=wa;if(wa=xa=null,zg(e),t)for(e=0;e<t.length;e++)zg(t[e])}}function bx(e,t){return e(t)}function Cx(){}var sf=!1;function Ex(e,t,n){if(sf)return e(t,n);sf=!0;try{return bx(e,t,n)}finally{sf=!1,(xa!==null||wa!==null)&&(Cx(),wx())}}function Ks(e,t){var n=e.stateNode;if(n===null)return null;var r=sd(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Y(231,t,typeof n));return n}var Mh=!1;if(Xr)try{var ms={};Object.defineProperty(ms,"passive",{get:function(){Mh=!0}}),window.addEventListener("test",ms,ms),window.removeEventListener("test",ms,ms)}catch{Mh=!1}function e_(e,t,n,r,o,i,a,s,u){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Ms=!1,rc=null,oc=!1,Fh=null,t_={onError:function(e){Ms=!0,rc=e}};function n_(e,t,n,r,o,i,a,s,u){Ms=!1,rc=null,e_.apply(t_,arguments)}function r_(e,t,n,r,o,i,a,s,u){if(n_.apply(this,arguments),Ms){if(Ms){var l=rc;Ms=!1,rc=null}else throw Error(Y(198));oc||(oc=!0,Fh=l)}}function ji(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Sx(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Wg(e){if(ji(e)!==e)throw Error(Y(188))}function o_(e){var t=e.alternate;if(!t){if(t=ji(e),t===null)throw Error(Y(188));return t!==e?null:e}for(var n=e,r=t;;){var o=n.return;if(o===null)break;var i=o.alternate;if(i===null){if(r=o.return,r!==null){n=r;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===n)return Wg(o),e;if(i===r)return Wg(o),t;i=i.sibling}throw Error(Y(188))}if(n.return!==r.return)n=o,r=i;else{for(var a=!1,s=o.child;s;){if(s===n){a=!0,n=o,r=i;break}if(s===r){a=!0,r=o,n=i;break}s=s.sibling}if(!a){for(s=i.child;s;){if(s===n){a=!0,n=i,r=o;break}if(s===r){a=!0,r=i,n=o;break}s=s.sibling}if(!a)throw Error(Y(189))}}if(n.alternate!==r)throw Error(Y(190))}if(n.tag!==3)throw Error(Y(188));return n.stateNode.current===n?e:t}function kx(e){return e=o_(e),e!==null?_x(e):null}function _x(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=_x(e);if(t!==null)return t;e=e.sibling}return null}var Rx=Nn.unstable_scheduleCallback,$g=Nn.unstable_cancelCallback,i_=Nn.unstable_shouldYield,a_=Nn.unstable_requestPaint,st=Nn.unstable_now,s_=Nn.unstable_getCurrentPriorityLevel,hv=Nn.unstable_ImmediatePriority,Nx=Nn.unstable_UserBlockingPriority,ic=Nn.unstable_NormalPriority,u_=Nn.unstable_LowPriority,Ix=Nn.unstable_IdlePriority,rd=null,_r=null;function l_(e){if(_r&&typeof _r.onCommitFiberRoot=="function")try{_r.onCommitFiberRoot(rd,e,void 0,(e.current.flags&128)===128)}catch{}}var er=Math.clz32?Math.clz32:f_,c_=Math.log,d_=Math.LN2;function f_(e){return e>>>=0,e===0?32:31-(c_(e)/d_|0)|0}var ol=64,il=4194304;function As(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ac(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,o=e.suspendedLanes,i=e.pingedLanes,a=n&268435455;if(a!==0){var s=a&~o;s!==0?r=As(s):(i&=a,i!==0&&(r=As(i)))}else a=n&~o,a!==0?r=As(a):i!==0&&(r=As(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&o)&&(o=r&-r,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-er(t),o=1<<n,r|=e[n],t&=~o;return r}function h_(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function p_(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var a=31-er(i),s=1<<a,u=o[a];u===-1?(!(s&n)||s&r)&&(o[a]=h_(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}function Oh(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Tx(){var e=ol;return ol<<=1,!(ol&4194240)&&(ol=64),e}function uf(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Iu(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-er(t),e[t]=n}function v_(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var o=31-er(n),i=1<<o;t[o]=0,r[o]=-1,e[o]=-1,n&=~i}}function pv(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-er(n),o=1<<r;o&t|e[r]&t&&(e[r]|=t),n&=~o}}var Oe=0;function Ax(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Px,vv,Dx,Mx,Fx,Lh=!1,al=[],Fo=null,Oo=null,Lo=null,Xs=new Map,Ys=new Map,Co=[],m_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ug(e,t){switch(e){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":Oo=null;break;case"mouseover":case"mouseout":Lo=null;break;case"pointerover":case"pointerout":Xs.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ys.delete(t.pointerId)}}function gs(e,t,n,r,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},t!==null&&(t=Au(t),t!==null&&vv(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function g_(e,t,n,r,o){switch(t){case"focusin":return Fo=gs(Fo,e,t,n,r,o),!0;case"dragenter":return Oo=gs(Oo,e,t,n,r,o),!0;case"mouseover":return Lo=gs(Lo,e,t,n,r,o),!0;case"pointerover":var i=o.pointerId;return Xs.set(i,gs(Xs.get(i)||null,e,t,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,Ys.set(i,gs(Ys.get(i)||null,e,t,n,r,o)),!0}return!1}function Ox(e){var t=gi(e.target);if(t!==null){var n=ji(t);if(n!==null){if(t=n.tag,t===13){if(t=Sx(n),t!==null){e.blockedOn=t,Fx(e.priority,function(){Dx(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function $l(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Bh(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Ph=r,n.target.dispatchEvent(r),Ph=null}else return t=Au(n),t!==null&&vv(t),e.blockedOn=n,!1;t.shift()}return!0}function Vg(e,t,n){$l(e)&&n.delete(t)}function y_(){Lh=!1,Fo!==null&&$l(Fo)&&(Fo=null),Oo!==null&&$l(Oo)&&(Oo=null),Lo!==null&&$l(Lo)&&(Lo=null),Xs.forEach(Vg),Ys.forEach(Vg)}function ys(e,t){e.blockedOn===t&&(e.blockedOn=null,Lh||(Lh=!0,Nn.unstable_scheduleCallback(Nn.unstable_NormalPriority,y_)))}function Qs(e){function t(o){return ys(o,e)}if(0<al.length){ys(al[0],e);for(var n=1;n<al.length;n++){var r=al[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Fo!==null&&ys(Fo,e),Oo!==null&&ys(Oo,e),Lo!==null&&ys(Lo,e),Xs.forEach(t),Ys.forEach(t),n=0;n<Co.length;n++)r=Co[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Co.length&&(n=Co[0],n.blockedOn===null);)Ox(n),n.blockedOn===null&&Co.shift()}var ba=no.ReactCurrentBatchConfig,sc=!0;function x_(e,t,n,r){var o=Oe,i=ba.transition;ba.transition=null;try{Oe=1,mv(e,t,n,r)}finally{Oe=o,ba.transition=i}}function w_(e,t,n,r){var o=Oe,i=ba.transition;ba.transition=null;try{Oe=4,mv(e,t,n,r)}finally{Oe=o,ba.transition=i}}function mv(e,t,n,r){if(sc){var o=Bh(e,t,n,r);if(o===null)yf(e,t,r,uc,n),Ug(e,r);else if(g_(o,e,t,n,r))r.stopPropagation();else if(Ug(e,r),t&4&&-1<m_.indexOf(e)){for(;o!==null;){var i=Au(o);if(i!==null&&Px(i),i=Bh(e,t,n,r),i===null&&yf(e,t,r,uc,n),i===o)break;o=i}o!==null&&r.stopPropagation()}else yf(e,t,r,null,n)}}var uc=null;function Bh(e,t,n,r){if(uc=null,e=fv(r),e=gi(e),e!==null)if(t=ji(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Sx(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return uc=e,null}function Lx(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(s_()){case hv:return 1;case Nx:return 4;case ic:case u_:return 16;case Ix:return 536870912;default:return 16}default:return 16}}var Io=null,gv=null,Ul=null;function Bx(){if(Ul)return Ul;var e,t=gv,n=t.length,r,o="value"in Io?Io.value:Io.textContent,i=o.length;for(e=0;e<n&&t[e]===o[e];e++);var a=n-e;for(r=1;r<=a&&t[n-r]===o[i-r];r++);return Ul=o.slice(e,1<r?1-r:void 0)}function Vl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function sl(){return!0}function Hg(){return!1}function Pn(e){function t(n,r,o,i,a){this._reactName=n,this._targetInst=o,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(n=e[s],this[s]=n?n(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?sl:Hg,this.isPropagationStopped=Hg,this}return tt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=sl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=sl)},persist:function(){},isPersistent:sl}),t}var os={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yv=Pn(os),Tu=tt({},os,{view:0,detail:0}),b_=Pn(Tu),lf,cf,xs,od=tt({},Tu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xv,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==xs&&(xs&&e.type==="mousemove"?(lf=e.screenX-xs.screenX,cf=e.screenY-xs.screenY):cf=lf=0,xs=e),lf)},movementY:function(e){return"movementY"in e?e.movementY:cf}}),Gg=Pn(od),C_=tt({},od,{dataTransfer:0}),E_=Pn(C_),S_=tt({},Tu,{relatedTarget:0}),df=Pn(S_),k_=tt({},os,{animationName:0,elapsedTime:0,pseudoElement:0}),__=Pn(k_),R_=tt({},os,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),N_=Pn(R_),I_=tt({},os,{data:0}),qg=Pn(I_),T_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},A_={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},P_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function D_(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=P_[e])?!!t[e]:!1}function xv(){return D_}var M_=tt({},Tu,{key:function(e){if(e.key){var t=T_[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Vl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?A_[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xv,charCode:function(e){return e.type==="keypress"?Vl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Vl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),F_=Pn(M_),O_=tt({},od,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Kg=Pn(O_),L_=tt({},Tu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xv}),B_=Pn(L_),j_=tt({},os,{propertyName:0,elapsedTime:0,pseudoElement:0}),z_=Pn(j_),W_=tt({},od,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),$_=Pn(W_),U_=[9,13,27,32],wv=Xr&&"CompositionEvent"in window,Fs=null;Xr&&"documentMode"in document&&(Fs=document.documentMode);var V_=Xr&&"TextEvent"in window&&!Fs,jx=Xr&&(!wv||Fs&&8<Fs&&11>=Fs),Xg=" ",Yg=!1;function zx(e,t){switch(e){case"keyup":return U_.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wx(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ua=!1;function H_(e,t){switch(e){case"compositionend":return Wx(t);case"keypress":return t.which!==32?null:(Yg=!0,Xg);case"textInput":return e=t.data,e===Xg&&Yg?null:e;default:return null}}function G_(e,t){if(ua)return e==="compositionend"||!wv&&zx(e,t)?(e=Bx(),Ul=gv=Io=null,ua=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jx&&t.locale!=="ko"?null:t.data;default:return null}}var q_={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Qg(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!q_[e.type]:t==="textarea"}function $x(e,t,n,r){xx(r),t=lc(t,"onChange"),0<t.length&&(n=new yv("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Os=null,Js=null;function K_(e){Zx(e,0)}function id(e){var t=da(e);if(fx(t))return e}function X_(e,t){if(e==="change")return t}var Ux=!1;if(Xr){var ff;if(Xr){var hf="oninput"in document;if(!hf){var Jg=document.createElement("div");Jg.setAttribute("oninput","return;"),hf=typeof Jg.oninput=="function"}ff=hf}else ff=!1;Ux=ff&&(!document.documentMode||9<document.documentMode)}function Zg(){Os&&(Os.detachEvent("onpropertychange",Vx),Js=Os=null)}function Vx(e){if(e.propertyName==="value"&&id(Js)){var t=[];$x(t,Js,e,fv(e)),Ex(K_,t)}}function Y_(e,t,n){e==="focusin"?(Zg(),Os=t,Js=n,Os.attachEvent("onpropertychange",Vx)):e==="focusout"&&Zg()}function Q_(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return id(Js)}function J_(e,t){if(e==="click")return id(t)}function Z_(e,t){if(e==="input"||e==="change")return id(t)}function eR(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var rr=typeof Object.is=="function"?Object.is:eR;function Zs(e,t){if(rr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!wh.call(t,o)||!rr(e[o],t[o]))return!1}return!0}function e0(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function t0(e,t){var n=e0(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=e0(n)}}function Hx(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Hx(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Gx(){for(var e=window,t=nc();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=nc(e.document)}return t}function bv(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function tR(e){var t=Gx(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Hx(n.ownerDocument.documentElement,n)){if(r!==null&&bv(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=r.end===void 0?i:Math.min(r.end,o),!e.extend&&i>r&&(o=r,r=i,i=o),o=t0(n,i);var a=t0(n,r);o&&a&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var nR=Xr&&"documentMode"in document&&11>=document.documentMode,la=null,jh=null,Ls=null,zh=!1;function n0(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;zh||la==null||la!==nc(r)||(r=la,"selectionStart"in r&&bv(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ls&&Zs(Ls,r)||(Ls=r,r=lc(jh,"onSelect"),0<r.length&&(t=new yv("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=la)))}function ul(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ca={animationend:ul("Animation","AnimationEnd"),animationiteration:ul("Animation","AnimationIteration"),animationstart:ul("Animation","AnimationStart"),transitionend:ul("Transition","TransitionEnd")},pf={},qx={};Xr&&(qx=document.createElement("div").style,"AnimationEvent"in window||(delete ca.animationend.animation,delete ca.animationiteration.animation,delete ca.animationstart.animation),"TransitionEvent"in window||delete ca.transitionend.transition);function ad(e){if(pf[e])return pf[e];if(!ca[e])return e;var t=ca[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in qx)return pf[e]=t[n];return e}var Kx=ad("animationend"),Xx=ad("animationiteration"),Yx=ad("animationstart"),Qx=ad("transitionend"),Jx=new Map,r0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ei(e,t){Jx.set(e,t),Bi(t,[e])}for(var vf=0;vf<r0.length;vf++){var mf=r0[vf],rR=mf.toLowerCase(),oR=mf[0].toUpperCase()+mf.slice(1);ei(rR,"on"+oR)}ei(Kx,"onAnimationEnd");ei(Xx,"onAnimationIteration");ei(Yx,"onAnimationStart");ei("dblclick","onDoubleClick");ei("focusin","onFocus");ei("focusout","onBlur");ei(Qx,"onTransitionEnd");Ua("onMouseEnter",["mouseout","mouseover"]);Ua("onMouseLeave",["mouseout","mouseover"]);Ua("onPointerEnter",["pointerout","pointerover"]);Ua("onPointerLeave",["pointerout","pointerover"]);Bi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Bi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Bi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Bi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Bi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Bi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ps="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),iR=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ps));function o0(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,r_(r,t,void 0,e),e.currentTarget=null}function Zx(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],o=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==i&&o.isPropagationStopped())break e;o0(o,s,l),i=u}else for(a=0;a<r.length;a++){if(s=r[a],u=s.instance,l=s.currentTarget,s=s.listener,u!==i&&o.isPropagationStopped())break e;o0(o,s,l),i=u}}}if(oc)throw e=Fh,oc=!1,Fh=null,e}function qe(e,t){var n=t[Hh];n===void 0&&(n=t[Hh]=new Set);var r=e+"__bubble";n.has(r)||(ew(t,e,2,!1),n.add(r))}function gf(e,t,n){var r=0;t&&(r|=4),ew(n,e,r,t)}var ll="_reactListening"+Math.random().toString(36).slice(2);function eu(e){if(!e[ll]){e[ll]=!0,sx.forEach(function(n){n!=="selectionchange"&&(iR.has(n)||gf(n,!1,e),gf(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ll]||(t[ll]=!0,gf("selectionchange",!1,t))}}function ew(e,t,n,r){switch(Lx(t)){case 1:var o=x_;break;case 4:o=w_;break;default:o=mv}n=o.bind(null,t,n,e),o=void 0,!Mh||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),r?o!==void 0?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):o!==void 0?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function yf(e,t,n,r,o){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===o||s.nodeType===8&&s.parentNode===o)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===o||u.nodeType===8&&u.parentNode===o))return;a=a.return}for(;s!==null;){if(a=gi(s),a===null)return;if(u=a.tag,u===5||u===6){r=i=a;continue e}s=s.parentNode}}r=r.return}Ex(function(){var l=i,c=fv(n),d=[];e:{var f=Jx.get(e);if(f!==void 0){var h=yv,p=e;switch(e){case"keypress":if(Vl(n)===0)break e;case"keydown":case"keyup":h=F_;break;case"focusin":p="focus",h=df;break;case"focusout":p="blur",h=df;break;case"beforeblur":case"afterblur":h=df;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Gg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=E_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=B_;break;case Kx:case Xx:case Yx:h=__;break;case Qx:h=z_;break;case"scroll":h=b_;break;case"wheel":h=$_;break;case"copy":case"cut":case"paste":h=N_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Kg}var v=(t&4)!==0,g=!v&&e==="scroll",m=v?f!==null?f+"Capture":null:f;v=[];for(var y=l,x;y!==null;){x=y;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,m!==null&&(w=Ks(y,m),w!=null&&v.push(tu(y,w,x)))),g)break;y=y.return}0<v.length&&(f=new h(f,p,null,n,c),d.push({event:f,listeners:v}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",h=e==="mouseout"||e==="pointerout",f&&n!==Ph&&(p=n.relatedTarget||n.fromElement)&&(gi(p)||p[Yr]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(p=n.relatedTarget||n.toElement,h=l,p=p?gi(p):null,p!==null&&(g=ji(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=l),h!==p)){if(v=Gg,w="onMouseLeave",m="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(v=Kg,w="onPointerLeave",m="onPointerEnter",y="pointer"),g=h==null?f:da(h),x=p==null?f:da(p),f=new v(w,y+"leave",h,n,c),f.target=g,f.relatedTarget=x,w=null,gi(c)===l&&(v=new v(m,y+"enter",p,n,c),v.target=x,v.relatedTarget=g,w=v),g=w,h&&p)t:{for(v=h,m=p,y=0,x=v;x;x=Ki(x))y++;for(x=0,w=m;w;w=Ki(w))x++;for(;0<y-x;)v=Ki(v),y--;for(;0<x-y;)m=Ki(m),x--;for(;y--;){if(v===m||m!==null&&v===m.alternate)break t;v=Ki(v),m=Ki(m)}v=null}else v=null;h!==null&&i0(d,f,h,v,!1),p!==null&&g!==null&&i0(d,g,p,v,!0)}}e:{if(f=l?da(l):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var b=X_;else if(Qg(f))if(Ux)b=Z_;else{b=Q_;var E=Y_}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=J_);if(b&&(b=b(e,l))){$x(d,b,n,c);break e}E&&E(e,f,l),e==="focusout"&&(E=f._wrapperState)&&E.controlled&&f.type==="number"&&Rh(f,"number",f.value)}switch(E=l?da(l):window,e){case"focusin":(Qg(E)||E.contentEditable==="true")&&(la=E,jh=l,Ls=null);break;case"focusout":Ls=jh=la=null;break;case"mousedown":zh=!0;break;case"contextmenu":case"mouseup":case"dragend":zh=!1,n0(d,n,c);break;case"selectionchange":if(nR)break;case"keydown":case"keyup":n0(d,n,c)}var k;if(wv)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else ua?zx(e,n)&&(_="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(jx&&n.locale!=="ko"&&(ua||_!=="onCompositionStart"?_==="onCompositionEnd"&&ua&&(k=Bx()):(Io=c,gv="value"in Io?Io.value:Io.textContent,ua=!0)),E=lc(l,_),0<E.length&&(_=new qg(_,e,null,n,c),d.push({event:_,listeners:E}),k?_.data=k:(k=Wx(n),k!==null&&(_.data=k)))),(k=V_?H_(e,n):G_(e,n))&&(l=lc(l,"onBeforeInput"),0<l.length&&(c=new qg("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:l}),c.data=k))}Zx(d,t)})}function tu(e,t,n){return{instance:e,listener:t,currentTarget:n}}function lc(e,t){for(var n=t+"Capture",r=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=Ks(e,n),i!=null&&r.unshift(tu(e,i,o)),i=Ks(e,t),i!=null&&r.push(tu(e,i,o))),e=e.return}return r}function Ki(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function i0(e,t,n,r,o){for(var i=t._reactName,a=[];n!==null&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&l!==null&&(s=l,o?(u=Ks(n,i),u!=null&&a.unshift(tu(n,u,s))):o||(u=Ks(n,i),u!=null&&a.push(tu(n,u,s)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var aR=/\r\n?/g,sR=/\u0000|\uFFFD/g;function a0(e){return(typeof e=="string"?e:""+e).replace(aR,`
`).replace(sR,"")}function cl(e,t,n){if(t=a0(t),a0(e)!==t&&n)throw Error(Y(425))}function cc(){}var Wh=null,$h=null;function Uh(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Vh=typeof setTimeout=="function"?setTimeout:void 0,uR=typeof clearTimeout=="function"?clearTimeout:void 0,s0=typeof Promise=="function"?Promise:void 0,lR=typeof queueMicrotask=="function"?queueMicrotask:typeof s0<"u"?function(e){return s0.resolve(null).then(e).catch(cR)}:Vh;function cR(e){setTimeout(function(){throw e})}function xf(e,t){var n=t,r=0;do{var o=n.nextSibling;if(e.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(r===0){e.removeChild(o),Qs(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=o}while(n);Qs(t)}function Bo(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function u0(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var is=Math.random().toString(36).slice(2),br="__reactFiber$"+is,nu="__reactProps$"+is,Yr="__reactContainer$"+is,Hh="__reactEvents$"+is,dR="__reactListeners$"+is,fR="__reactHandles$"+is;function gi(e){var t=e[br];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Yr]||n[br]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=u0(e);e!==null;){if(n=e[br])return n;e=u0(e)}return t}e=n,n=e.parentNode}return null}function Au(e){return e=e[br]||e[Yr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function da(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Y(33))}function sd(e){return e[nu]||null}var Gh=[],fa=-1;function ti(e){return{current:e}}function Xe(e){0>fa||(e.current=Gh[fa],Gh[fa]=null,fa--)}function $e(e,t){fa++,Gh[fa]=e.current,e.current=t}var Ko={},Ut=ti(Ko),an=ti(!1),Ti=Ko;function Va(e,t){var n=e.type.contextTypes;if(!n)return Ko;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in n)o[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function sn(e){return e=e.childContextTypes,e!=null}function dc(){Xe(an),Xe(Ut)}function l0(e,t,n){if(Ut.current!==Ko)throw Error(Y(168));$e(Ut,t),$e(an,n)}function tw(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var o in r)if(!(o in t))throw Error(Y(108,Yk(e)||"Unknown",o));return tt({},n,r)}function fc(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ko,Ti=Ut.current,$e(Ut,e),$e(an,an.current),!0}function c0(e,t,n){var r=e.stateNode;if(!r)throw Error(Y(169));n?(e=tw(e,t,Ti),r.__reactInternalMemoizedMergedChildContext=e,Xe(an),Xe(Ut),$e(Ut,e)):Xe(an),$e(an,n)}var Vr=null,ud=!1,wf=!1;function nw(e){Vr===null?Vr=[e]:Vr.push(e)}function hR(e){ud=!0,nw(e)}function ni(){if(!wf&&Vr!==null){wf=!0;var e=0,t=Oe;try{var n=Vr;for(Oe=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Vr=null,ud=!1}catch(o){throw Vr!==null&&(Vr=Vr.slice(e+1)),Rx(hv,ni),o}finally{Oe=t,wf=!1}}return null}var ha=[],pa=0,hc=null,pc=0,Fn=[],On=0,Ai=null,Gr=1,qr="";function li(e,t){ha[pa++]=pc,ha[pa++]=hc,hc=e,pc=t}function rw(e,t,n){Fn[On++]=Gr,Fn[On++]=qr,Fn[On++]=Ai,Ai=e;var r=Gr;e=qr;var o=32-er(r)-1;r&=~(1<<o),n+=1;var i=32-er(t)+o;if(30<i){var a=o-o%5;i=(r&(1<<a)-1).toString(32),r>>=a,o-=a,Gr=1<<32-er(t)+o|n<<o|r,qr=i+e}else Gr=1<<i|n<<o|r,qr=e}function Cv(e){e.return!==null&&(li(e,1),rw(e,1,0))}function Ev(e){for(;e===hc;)hc=ha[--pa],ha[pa]=null,pc=ha[--pa],ha[pa]=null;for(;e===Ai;)Ai=Fn[--On],Fn[On]=null,qr=Fn[--On],Fn[On]=null,Gr=Fn[--On],Fn[On]=null}var kn=null,bn=null,Ye=!1,Qn=null;function ow(e,t){var n=jn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function d0(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,kn=e,bn=Bo(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,kn=e,bn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Ai!==null?{id:Gr,overflow:qr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=jn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,kn=e,bn=null,!0):!1;default:return!1}}function qh(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Kh(e){if(Ye){var t=bn;if(t){var n=t;if(!d0(e,t)){if(qh(e))throw Error(Y(418));t=Bo(n.nextSibling);var r=kn;t&&d0(e,t)?ow(r,n):(e.flags=e.flags&-4097|2,Ye=!1,kn=e)}}else{if(qh(e))throw Error(Y(418));e.flags=e.flags&-4097|2,Ye=!1,kn=e}}}function f0(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;kn=e}function dl(e){if(e!==kn)return!1;if(!Ye)return f0(e),Ye=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Uh(e.type,e.memoizedProps)),t&&(t=bn)){if(qh(e))throw iw(),Error(Y(418));for(;t;)ow(e,t),t=Bo(t.nextSibling)}if(f0(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Y(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){bn=Bo(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}bn=null}}else bn=kn?Bo(e.stateNode.nextSibling):null;return!0}function iw(){for(var e=bn;e;)e=Bo(e.nextSibling)}function Ha(){bn=kn=null,Ye=!1}function Sv(e){Qn===null?Qn=[e]:Qn.push(e)}var pR=no.ReactCurrentBatchConfig;function ws(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Y(309));var r=n.stateNode}if(!r)throw Error(Y(147,e));var o=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(a){var s=o.refs;a===null?delete s[i]:s[i]=a},t._stringRef=i,t)}if(typeof e!="string")throw Error(Y(284));if(!n._owner)throw Error(Y(290,e))}return e}function fl(e,t){throw e=Object.prototype.toString.call(t),Error(Y(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function h0(e){var t=e._init;return t(e._payload)}function aw(e){function t(m,y){if(e){var x=m.deletions;x===null?(m.deletions=[y],m.flags|=16):x.push(y)}}function n(m,y){if(!e)return null;for(;y!==null;)t(m,y),y=y.sibling;return null}function r(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function o(m,y){return m=$o(m,y),m.index=0,m.sibling=null,m}function i(m,y,x){return m.index=x,e?(x=m.alternate,x!==null?(x=x.index,x<y?(m.flags|=2,y):x):(m.flags|=2,y)):(m.flags|=1048576,y)}function a(m){return e&&m.alternate===null&&(m.flags|=2),m}function s(m,y,x,w){return y===null||y.tag!==6?(y=Rf(x,m.mode,w),y.return=m,y):(y=o(y,x),y.return=m,y)}function u(m,y,x,w){var b=x.type;return b===sa?c(m,y,x.props.children,w,x.key):y!==null&&(y.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===wo&&h0(b)===y.type)?(w=o(y,x.props),w.ref=ws(m,y,x),w.return=m,w):(w=Ql(x.type,x.key,x.props,null,m.mode,w),w.ref=ws(m,y,x),w.return=m,w)}function l(m,y,x,w){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=Nf(x,m.mode,w),y.return=m,y):(y=o(y,x.children||[]),y.return=m,y)}function c(m,y,x,w,b){return y===null||y.tag!==7?(y=Ri(x,m.mode,w,b),y.return=m,y):(y=o(y,x),y.return=m,y)}function d(m,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Rf(""+y,m.mode,x),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case tl:return x=Ql(y.type,y.key,y.props,null,m.mode,x),x.ref=ws(m,null,y),x.return=m,x;case aa:return y=Nf(y,m.mode,x),y.return=m,y;case wo:var w=y._init;return d(m,w(y._payload),x)}if(Ts(y)||vs(y))return y=Ri(y,m.mode,x,null),y.return=m,y;fl(m,y)}return null}function f(m,y,x,w){var b=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return b!==null?null:s(m,y,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case tl:return x.key===b?u(m,y,x,w):null;case aa:return x.key===b?l(m,y,x,w):null;case wo:return b=x._init,f(m,y,b(x._payload),w)}if(Ts(x)||vs(x))return b!==null?null:c(m,y,x,w,null);fl(m,x)}return null}function h(m,y,x,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return m=m.get(x)||null,s(y,m,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case tl:return m=m.get(w.key===null?x:w.key)||null,u(y,m,w,b);case aa:return m=m.get(w.key===null?x:w.key)||null,l(y,m,w,b);case wo:var E=w._init;return h(m,y,x,E(w._payload),b)}if(Ts(w)||vs(w))return m=m.get(x)||null,c(y,m,w,b,null);fl(y,w)}return null}function p(m,y,x,w){for(var b=null,E=null,k=y,_=y=0,R=null;k!==null&&_<x.length;_++){k.index>_?(R=k,k=null):R=k.sibling;var N=f(m,k,x[_],w);if(N===null){k===null&&(k=R);break}e&&k&&N.alternate===null&&t(m,k),y=i(N,y,_),E===null?b=N:E.sibling=N,E=N,k=R}if(_===x.length)return n(m,k),Ye&&li(m,_),b;if(k===null){for(;_<x.length;_++)k=d(m,x[_],w),k!==null&&(y=i(k,y,_),E===null?b=k:E.sibling=k,E=k);return Ye&&li(m,_),b}for(k=r(m,k);_<x.length;_++)R=h(k,m,_,x[_],w),R!==null&&(e&&R.alternate!==null&&k.delete(R.key===null?_:R.key),y=i(R,y,_),E===null?b=R:E.sibling=R,E=R);return e&&k.forEach(function(D){return t(m,D)}),Ye&&li(m,_),b}function v(m,y,x,w){var b=vs(x);if(typeof b!="function")throw Error(Y(150));if(x=b.call(x),x==null)throw Error(Y(151));for(var E=b=null,k=y,_=y=0,R=null,N=x.next();k!==null&&!N.done;_++,N=x.next()){k.index>_?(R=k,k=null):R=k.sibling;var D=f(m,k,N.value,w);if(D===null){k===null&&(k=R);break}e&&k&&D.alternate===null&&t(m,k),y=i(D,y,_),E===null?b=D:E.sibling=D,E=D,k=R}if(N.done)return n(m,k),Ye&&li(m,_),b;if(k===null){for(;!N.done;_++,N=x.next())N=d(m,N.value,w),N!==null&&(y=i(N,y,_),E===null?b=N:E.sibling=N,E=N);return Ye&&li(m,_),b}for(k=r(m,k);!N.done;_++,N=x.next())N=h(k,m,_,N.value,w),N!==null&&(e&&N.alternate!==null&&k.delete(N.key===null?_:N.key),y=i(N,y,_),E===null?b=N:E.sibling=N,E=N);return e&&k.forEach(function(A){return t(m,A)}),Ye&&li(m,_),b}function g(m,y,x,w){if(typeof x=="object"&&x!==null&&x.type===sa&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case tl:e:{for(var b=x.key,E=y;E!==null;){if(E.key===b){if(b=x.type,b===sa){if(E.tag===7){n(m,E.sibling),y=o(E,x.props.children),y.return=m,m=y;break e}}else if(E.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===wo&&h0(b)===E.type){n(m,E.sibling),y=o(E,x.props),y.ref=ws(m,E,x),y.return=m,m=y;break e}n(m,E);break}else t(m,E);E=E.sibling}x.type===sa?(y=Ri(x.props.children,m.mode,w,x.key),y.return=m,m=y):(w=Ql(x.type,x.key,x.props,null,m.mode,w),w.ref=ws(m,y,x),w.return=m,m=w)}return a(m);case aa:e:{for(E=x.key;y!==null;){if(y.key===E)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){n(m,y.sibling),y=o(y,x.children||[]),y.return=m,m=y;break e}else{n(m,y);break}else t(m,y);y=y.sibling}y=Nf(x,m.mode,w),y.return=m,m=y}return a(m);case wo:return E=x._init,g(m,y,E(x._payload),w)}if(Ts(x))return p(m,y,x,w);if(vs(x))return v(m,y,x,w);fl(m,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(n(m,y.sibling),y=o(y,x),y.return=m,m=y):(n(m,y),y=Rf(x,m.mode,w),y.return=m,m=y),a(m)):n(m,y)}return g}var Ga=aw(!0),sw=aw(!1),vc=ti(null),mc=null,va=null,kv=null;function _v(){kv=va=mc=null}function Rv(e){var t=vc.current;Xe(vc),e._currentValue=t}function Xh(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ca(e,t){mc=e,kv=va=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(on=!0),e.firstContext=null)}function $n(e){var t=e._currentValue;if(kv!==e)if(e={context:e,memoizedValue:t,next:null},va===null){if(mc===null)throw Error(Y(308));va=e,mc.dependencies={lanes:0,firstContext:e}}else va=va.next=e;return t}var yi=null;function Nv(e){yi===null?yi=[e]:yi.push(e)}function uw(e,t,n,r){var o=t.interleaved;return o===null?(n.next=n,Nv(t)):(n.next=o.next,o.next=n),t.interleaved=n,Qr(e,r)}function Qr(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var bo=!1;function Iv(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lw(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Kr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function jo(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ne&2){var o=r.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),r.pending=t,Qr(e,n)}return o=r.interleaved,o===null?(t.next=t,Nv(r)):(t.next=o.next,o.next=t),r.interleaved=t,Qr(e,n)}function Hl(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,pv(e,n)}}function p0(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var o=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?o=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?o=i=t:i=i.next=t}else o=i=t;n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function gc(e,t,n,r){var o=e.updateQueue;bo=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(s!==null){o.shared.pending=null;var u=s,l=u.next;u.next=null,a===null?i=l:a.next=l,a=u;var c=e.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(i!==null){var d=o.baseState;a=0,c=l=u=null,s=i;do{var f=s.lane,h=s.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(f=t,h=n,v.tag){case 1:if(p=v.payload,typeof p=="function"){d=p.call(h,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=v.payload,f=typeof p=="function"?p.call(h,d,f):p,f==null)break e;d=tt({},d,f);break e;case 2:bo=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,f=o.effects,f===null?o.effects=[s]:f.push(s))}else h={eventTime:h,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=h,u=d):c=c.next=h,a|=f;if(s=s.next,s===null){if(s=o.shared.pending,s===null)break;f=s,s=f.next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}while(!0);if(c===null&&(u=d),o.baseState=u,o.firstBaseUpdate=l,o.lastBaseUpdate=c,t=o.shared.interleaved,t!==null){o=t;do a|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);Di|=a,e.lanes=a,e.memoizedState=d}}function v0(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],o=r.callback;if(o!==null){if(r.callback=null,r=n,typeof o!="function")throw Error(Y(191,o));o.call(r)}}}var Pu={},Rr=ti(Pu),ru=ti(Pu),ou=ti(Pu);function xi(e){if(e===Pu)throw Error(Y(174));return e}function Tv(e,t){switch($e(ou,t),$e(ru,e),$e(Rr,Pu),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ih(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ih(t,e)}Xe(Rr),$e(Rr,t)}function qa(){Xe(Rr),Xe(ru),Xe(ou)}function cw(e){xi(ou.current);var t=xi(Rr.current),n=Ih(t,e.type);t!==n&&($e(ru,e),$e(Rr,n))}function Av(e){ru.current===e&&(Xe(Rr),Xe(ru))}var Qe=ti(0);function yc(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var bf=[];function Pv(){for(var e=0;e<bf.length;e++)bf[e]._workInProgressVersionPrimary=null;bf.length=0}var Gl=no.ReactCurrentDispatcher,Cf=no.ReactCurrentBatchConfig,Pi=0,et=null,pt=null,Ct=null,xc=!1,Bs=!1,iu=0,vR=0;function Dt(){throw Error(Y(321))}function Dv(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!rr(e[n],t[n]))return!1;return!0}function Mv(e,t,n,r,o,i){if(Pi=i,et=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Gl.current=e===null||e.memoizedState===null?xR:wR,e=n(r,o),Bs){i=0;do{if(Bs=!1,iu=0,25<=i)throw Error(Y(301));i+=1,Ct=pt=null,t.updateQueue=null,Gl.current=bR,e=n(r,o)}while(Bs)}if(Gl.current=wc,t=pt!==null&&pt.next!==null,Pi=0,Ct=pt=et=null,xc=!1,t)throw Error(Y(300));return e}function Fv(){var e=iu!==0;return iu=0,e}function vr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?et.memoizedState=Ct=e:Ct=Ct.next=e,Ct}function Un(){if(pt===null){var e=et.alternate;e=e!==null?e.memoizedState:null}else e=pt.next;var t=Ct===null?et.memoizedState:Ct.next;if(t!==null)Ct=t,pt=e;else{if(e===null)throw Error(Y(310));pt=e,e={memoizedState:pt.memoizedState,baseState:pt.baseState,baseQueue:pt.baseQueue,queue:pt.queue,next:null},Ct===null?et.memoizedState=Ct=e:Ct=Ct.next=e}return Ct}function au(e,t){return typeof t=="function"?t(e):t}function Ef(e){var t=Un(),n=t.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=e;var r=pt,o=r.baseQueue,i=n.pending;if(i!==null){if(o!==null){var a=o.next;o.next=i.next,i.next=a}r.baseQueue=o=i,n.pending=null}if(o!==null){i=o.next,r=r.baseState;var s=a=null,u=null,l=i;do{var c=l.lane;if((Pi&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,a=r):u=u.next=d,et.lanes|=c,Di|=c}l=l.next}while(l!==null&&l!==i);u===null?a=r:u.next=s,rr(r,t.memoizedState)||(on=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}if(e=n.interleaved,e!==null){o=e;do i=o.lane,et.lanes|=i,Di|=i,o=o.next;while(o!==e)}else o===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Sf(e){var t=Un(),n=t.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=e;var r=n.dispatch,o=n.pending,i=t.memoizedState;if(o!==null){n.pending=null;var a=o=o.next;do i=e(i,a.action),a=a.next;while(a!==o);rr(i,t.memoizedState)||(on=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function dw(){}function fw(e,t){var n=et,r=Un(),o=t(),i=!rr(r.memoizedState,o);if(i&&(r.memoizedState=o,on=!0),r=r.queue,Ov(vw.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||Ct!==null&&Ct.memoizedState.tag&1){if(n.flags|=2048,su(9,pw.bind(null,n,r,o,t),void 0,null),Et===null)throw Error(Y(349));Pi&30||hw(n,t,o)}return o}function hw(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=et.updateQueue,t===null?(t={lastEffect:null,stores:null},et.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function pw(e,t,n,r){t.value=n,t.getSnapshot=r,mw(t)&&gw(e)}function vw(e,t,n){return n(function(){mw(t)&&gw(e)})}function mw(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!rr(e,n)}catch{return!0}}function gw(e){var t=Qr(e,1);t!==null&&tr(t,e,1,-1)}function m0(e){var t=vr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:au,lastRenderedState:e},t.queue=e,e=e.dispatch=yR.bind(null,et,e),[t.memoizedState,e]}function su(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=et.updateQueue,t===null?(t={lastEffect:null,stores:null},et.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function yw(){return Un().memoizedState}function ql(e,t,n,r){var o=vr();et.flags|=e,o.memoizedState=su(1|t,n,void 0,r===void 0?null:r)}function ld(e,t,n,r){var o=Un();r=r===void 0?null:r;var i=void 0;if(pt!==null){var a=pt.memoizedState;if(i=a.destroy,r!==null&&Dv(r,a.deps)){o.memoizedState=su(t,n,i,r);return}}et.flags|=e,o.memoizedState=su(1|t,n,i,r)}function g0(e,t){return ql(8390656,8,e,t)}function Ov(e,t){return ld(2048,8,e,t)}function xw(e,t){return ld(4,2,e,t)}function ww(e,t){return ld(4,4,e,t)}function bw(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Cw(e,t,n){return n=n!=null?n.concat([e]):null,ld(4,4,bw.bind(null,t,e),n)}function Lv(){}function Ew(e,t){var n=Un();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Dv(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Sw(e,t){var n=Un();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Dv(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function kw(e,t,n){return Pi&21?(rr(n,t)||(n=Tx(),et.lanes|=n,Di|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,on=!0),e.memoizedState=n)}function mR(e,t){var n=Oe;Oe=n!==0&&4>n?n:4,e(!0);var r=Cf.transition;Cf.transition={};try{e(!1),t()}finally{Oe=n,Cf.transition=r}}function _w(){return Un().memoizedState}function gR(e,t,n){var r=Wo(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Rw(e))Nw(t,n);else if(n=uw(e,t,n,r),n!==null){var o=Kt();tr(n,e,r,o),Iw(n,t,r)}}function yR(e,t,n){var r=Wo(e),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Rw(e))Nw(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var a=t.lastRenderedState,s=i(a,n);if(o.hasEagerState=!0,o.eagerState=s,rr(s,a)){var u=t.interleaved;u===null?(o.next=o,Nv(t)):(o.next=u.next,u.next=o),t.interleaved=o;return}}catch{}finally{}n=uw(e,t,o,r),n!==null&&(o=Kt(),tr(n,e,r,o),Iw(n,t,r))}}function Rw(e){var t=e.alternate;return e===et||t!==null&&t===et}function Nw(e,t){Bs=xc=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Iw(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,pv(e,n)}}var wc={readContext:$n,useCallback:Dt,useContext:Dt,useEffect:Dt,useImperativeHandle:Dt,useInsertionEffect:Dt,useLayoutEffect:Dt,useMemo:Dt,useReducer:Dt,useRef:Dt,useState:Dt,useDebugValue:Dt,useDeferredValue:Dt,useTransition:Dt,useMutableSource:Dt,useSyncExternalStore:Dt,useId:Dt,unstable_isNewReconciler:!1},xR={readContext:$n,useCallback:function(e,t){return vr().memoizedState=[e,t===void 0?null:t],e},useContext:$n,useEffect:g0,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,ql(4194308,4,bw.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ql(4194308,4,e,t)},useInsertionEffect:function(e,t){return ql(4,2,e,t)},useMemo:function(e,t){var n=vr();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=vr();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=gR.bind(null,et,e),[r.memoizedState,e]},useRef:function(e){var t=vr();return e={current:e},t.memoizedState=e},useState:m0,useDebugValue:Lv,useDeferredValue:function(e){return vr().memoizedState=e},useTransition:function(){var e=m0(!1),t=e[0];return e=mR.bind(null,e[1]),vr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=et,o=vr();if(Ye){if(n===void 0)throw Error(Y(407));n=n()}else{if(n=t(),Et===null)throw Error(Y(349));Pi&30||hw(r,t,n)}o.memoizedState=n;var i={value:n,getSnapshot:t};return o.queue=i,g0(vw.bind(null,r,i,e),[e]),r.flags|=2048,su(9,pw.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=vr(),t=Et.identifierPrefix;if(Ye){var n=qr,r=Gr;n=(r&~(1<<32-er(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=iu++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=vR++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},wR={readContext:$n,useCallback:Ew,useContext:$n,useEffect:Ov,useImperativeHandle:Cw,useInsertionEffect:xw,useLayoutEffect:ww,useMemo:Sw,useReducer:Ef,useRef:yw,useState:function(){return Ef(au)},useDebugValue:Lv,useDeferredValue:function(e){var t=Un();return kw(t,pt.memoizedState,e)},useTransition:function(){var e=Ef(au)[0],t=Un().memoizedState;return[e,t]},useMutableSource:dw,useSyncExternalStore:fw,useId:_w,unstable_isNewReconciler:!1},bR={readContext:$n,useCallback:Ew,useContext:$n,useEffect:Ov,useImperativeHandle:Cw,useInsertionEffect:xw,useLayoutEffect:ww,useMemo:Sw,useReducer:Sf,useRef:yw,useState:function(){return Sf(au)},useDebugValue:Lv,useDeferredValue:function(e){var t=Un();return pt===null?t.memoizedState=e:kw(t,pt.memoizedState,e)},useTransition:function(){var e=Sf(au)[0],t=Un().memoizedState;return[e,t]},useMutableSource:dw,useSyncExternalStore:fw,useId:_w,unstable_isNewReconciler:!1};function qn(e,t){if(e&&e.defaultProps){t=tt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Yh(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:tt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var cd={isMounted:function(e){return(e=e._reactInternals)?ji(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Kt(),o=Wo(e),i=Kr(r,o);i.payload=t,n!=null&&(i.callback=n),t=jo(e,i,o),t!==null&&(tr(t,e,o,r),Hl(t,e,o))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Kt(),o=Wo(e),i=Kr(r,o);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=jo(e,i,o),t!==null&&(tr(t,e,o,r),Hl(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Kt(),r=Wo(e),o=Kr(n,r);o.tag=2,t!=null&&(o.callback=t),t=jo(e,o,r),t!==null&&(tr(t,e,r,n),Hl(t,e,r))}};function y0(e,t,n,r,o,i,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,a):t.prototype&&t.prototype.isPureReactComponent?!Zs(n,r)||!Zs(o,i):!0}function Tw(e,t,n){var r=!1,o=Ko,i=t.contextType;return typeof i=="object"&&i!==null?i=$n(i):(o=sn(t)?Ti:Ut.current,r=t.contextTypes,i=(r=r!=null)?Va(e,o):Ko),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=cd,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function x0(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&cd.enqueueReplaceState(t,t.state,null)}function Qh(e,t,n,r){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs={},Iv(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=$n(i):(i=sn(t)?Ti:Ut.current,o.context=Va(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Yh(e,t,i,n),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&cd.enqueueReplaceState(o,o.state,null),gc(e,n,o,r),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function Ka(e,t){try{var n="",r=t;do n+=Xk(r),r=r.return;while(r);var o=n}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function kf(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Jh(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var CR=typeof WeakMap=="function"?WeakMap:Map;function Aw(e,t,n){n=Kr(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Cc||(Cc=!0,up=r),Jh(e,t)},n}function Pw(e,t,n){n=Kr(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var o=t.value;n.payload=function(){return r(o)},n.callback=function(){Jh(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Jh(e,t),typeof r!="function"&&(zo===null?zo=new Set([this]):zo.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function w0(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new CR;var o=new Set;r.set(t,o)}else o=r.get(t),o===void 0&&(o=new Set,r.set(t,o));o.has(n)||(o.add(n),e=OR.bind(null,e,t,n),t.then(e,e))}function b0(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function C0(e,t,n,r,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Kr(-1,1),t.tag=2,jo(n,t,1))),n.lanes|=1),e)}var ER=no.ReactCurrentOwner,on=!1;function Gt(e,t,n,r){t.child=e===null?sw(t,null,n,r):Ga(t,e.child,n,r)}function E0(e,t,n,r,o){n=n.render;var i=t.ref;return Ca(t,o),r=Mv(e,t,n,r,i,o),n=Fv(),e!==null&&!on?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Jr(e,t,o)):(Ye&&n&&Cv(t),t.flags|=1,Gt(e,t,r,o),t.child)}function S0(e,t,n,r,o){if(e===null){var i=n.type;return typeof i=="function"&&!Hv(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Dw(e,t,i,r,o)):(e=Ql(n.type,null,r,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Zs,n(a,r)&&e.ref===t.ref)return Jr(e,t,o)}return t.flags|=1,e=$o(i,r),e.ref=t.ref,e.return=t,t.child=e}function Dw(e,t,n,r,o){if(e!==null){var i=e.memoizedProps;if(Zs(i,r)&&e.ref===t.ref)if(on=!1,t.pendingProps=r=i,(e.lanes&o)!==0)e.flags&131072&&(on=!0);else return t.lanes=e.lanes,Jr(e,t,o)}return Zh(e,t,n,r,o)}function Mw(e,t,n){var r=t.pendingProps,o=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},$e(ga,gn),gn|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,$e(ga,gn),gn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,$e(ga,gn),gn|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,$e(ga,gn),gn|=r;return Gt(e,t,o,n),t.child}function Fw(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Zh(e,t,n,r,o){var i=sn(n)?Ti:Ut.current;return i=Va(t,i),Ca(t,o),n=Mv(e,t,n,r,i,o),r=Fv(),e!==null&&!on?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,Jr(e,t,o)):(Ye&&r&&Cv(t),t.flags|=1,Gt(e,t,n,o),t.child)}function k0(e,t,n,r,o){if(sn(n)){var i=!0;fc(t)}else i=!1;if(Ca(t,o),t.stateNode===null)Kl(e,t),Tw(t,n,r),Qh(t,n,r,o),r=!0;else if(e===null){var a=t.stateNode,s=t.memoizedProps;a.props=s;var u=a.context,l=n.contextType;typeof l=="object"&&l!==null?l=$n(l):(l=sn(n)?Ti:Ut.current,l=Va(t,l));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||u!==l)&&x0(t,a,r,l),bo=!1;var f=t.memoizedState;a.state=f,gc(t,r,a,o),u=t.memoizedState,s!==r||f!==u||an.current||bo?(typeof c=="function"&&(Yh(t,n,c,r),u=t.memoizedState),(s=bo||y0(t,n,s,r,f,u,l))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),a.props=r,a.state=u,a.context=l,r=s):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,lw(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:qn(t.type,s),a.props=l,d=t.pendingProps,f=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=$n(u):(u=sn(n)?Ti:Ut.current,u=Va(t,u));var h=n.getDerivedStateFromProps;(c=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==d||f!==u)&&x0(t,a,r,u),bo=!1,f=t.memoizedState,a.state=f,gc(t,r,a,o);var p=t.memoizedState;s!==d||f!==p||an.current||bo?(typeof h=="function"&&(Yh(t,n,h,r),p=t.memoizedState),(l=bo||y0(t,n,l,r,f,p,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,u)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=u,r=l):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return ep(e,t,n,r,i,o)}function ep(e,t,n,r,o,i){Fw(e,t);var a=(t.flags&128)!==0;if(!r&&!a)return o&&c0(t,n,!1),Jr(e,t,i);r=t.stateNode,ER.current=t;var s=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&a?(t.child=Ga(t,e.child,null,i),t.child=Ga(t,null,s,i)):Gt(e,t,s,i),t.memoizedState=r.state,o&&c0(t,n,!0),t.child}function Ow(e){var t=e.stateNode;t.pendingContext?l0(e,t.pendingContext,t.pendingContext!==t.context):t.context&&l0(e,t.context,!1),Tv(e,t.containerInfo)}function _0(e,t,n,r,o){return Ha(),Sv(o),t.flags|=256,Gt(e,t,n,r),t.child}var tp={dehydrated:null,treeContext:null,retryLane:0};function np(e){return{baseLanes:e,cachePool:null,transitions:null}}function Lw(e,t,n){var r=t.pendingProps,o=Qe.current,i=!1,a=(t.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(o&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),$e(Qe,o&1),e===null)return Kh(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=r.children,e=r.fallback,i?(r=t.mode,i=t.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=hd(a,r,0,null),e=Ri(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=np(n),t.memoizedState=tp,e):Bv(t,a));if(o=e.memoizedState,o!==null&&(s=o.dehydrated,s!==null))return SR(e,t,a,r,s,o,n);if(i){i=r.fallback,a=t.mode,o=e.child,s=o.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&t.child!==o?(r=t.child,r.childLanes=0,r.pendingProps=u,t.deletions=null):(r=$o(o,u),r.subtreeFlags=o.subtreeFlags&14680064),s!==null?i=$o(s,i):(i=Ri(i,a,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,a=e.child.memoizedState,a=a===null?np(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=e.childLanes&~n,t.memoizedState=tp,r}return i=e.child,e=i.sibling,r=$o(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Bv(e,t){return t=hd({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function hl(e,t,n,r){return r!==null&&Sv(r),Ga(t,e.child,null,n),e=Bv(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function SR(e,t,n,r,o,i,a){if(n)return t.flags&256?(t.flags&=-257,r=kf(Error(Y(422))),hl(e,t,a,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,o=t.mode,r=hd({mode:"visible",children:r.children},o,0,null),i=Ri(i,o,a,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&Ga(t,e.child,null,a),t.child.memoizedState=np(a),t.memoizedState=tp,i);if(!(t.mode&1))return hl(e,t,a,null);if(o.data==="$!"){if(r=o.nextSibling&&o.nextSibling.dataset,r)var s=r.dgst;return r=s,i=Error(Y(419)),r=kf(i,r,void 0),hl(e,t,a,r)}if(s=(a&e.childLanes)!==0,on||s){if(r=Et,r!==null){switch(a&-a){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(r.suspendedLanes|a)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,Qr(e,o),tr(r,e,o,-1))}return Vv(),r=kf(Error(Y(421))),hl(e,t,a,r)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=LR.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,bn=Bo(o.nextSibling),kn=t,Ye=!0,Qn=null,e!==null&&(Fn[On++]=Gr,Fn[On++]=qr,Fn[On++]=Ai,Gr=e.id,qr=e.overflow,Ai=t),t=Bv(t,r.children),t.flags|=4096,t)}function R0(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Xh(e.return,t,n)}function _f(e,t,n,r,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function Bw(e,t,n){var r=t.pendingProps,o=r.revealOrder,i=r.tail;if(Gt(e,t,r.children,n),r=Qe.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&R0(e,n,t);else if(e.tag===19)R0(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if($e(Qe,r),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;n!==null;)e=n.alternate,e!==null&&yc(e)===null&&(o=n),n=n.sibling;n=o,n===null?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),_f(t,!1,o,n,i);break;case"backwards":for(n=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&yc(e)===null){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}_f(t,!0,n,null,i);break;case"together":_f(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Kl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Jr(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Di|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Y(153));if(t.child!==null){for(e=t.child,n=$o(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=$o(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function kR(e,t,n){switch(t.tag){case 3:Ow(t),Ha();break;case 5:cw(t);break;case 1:sn(t.type)&&fc(t);break;case 4:Tv(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,o=t.memoizedProps.value;$e(vc,r._currentValue),r._currentValue=o;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?($e(Qe,Qe.current&1),t.flags|=128,null):n&t.child.childLanes?Lw(e,t,n):($e(Qe,Qe.current&1),e=Jr(e,t,n),e!==null?e.sibling:null);$e(Qe,Qe.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Bw(e,t,n);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),$e(Qe,Qe.current),r)break;return null;case 22:case 23:return t.lanes=0,Mw(e,t,n)}return Jr(e,t,n)}var jw,rp,zw,Ww;jw=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};rp=function(){};zw=function(e,t,n,r){var o=e.memoizedProps;if(o!==r){e=t.stateNode,xi(Rr.current);var i=null;switch(n){case"input":o=kh(e,o),r=kh(e,r),i=[];break;case"select":o=tt({},o,{value:void 0}),r=tt({},r,{value:void 0}),i=[];break;case"textarea":o=Nh(e,o),r=Nh(e,r),i=[];break;default:typeof o.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=cc)}Th(n,r);var a;n=null;for(l in o)if(!r.hasOwnProperty(l)&&o.hasOwnProperty(l)&&o[l]!=null)if(l==="style"){var s=o[l];for(a in s)s.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Gs.hasOwnProperty(l)?i||(i=[]):(i=i||[]).push(l,null));for(l in r){var u=r[l];if(s=o!=null?o[l]:void 0,r.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&s[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(i||(i=[]),i.push(l,n)),n=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(i=i||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(i=i||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Gs.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&qe("scroll",e),i||s===u||(i=[])):(i=i||[]).push(l,u))}n&&(i=i||[]).push("style",n);var l=i;(t.updateQueue=l)&&(t.flags|=4)}};Ww=function(e,t,n,r){n!==r&&(t.flags|=4)};function bs(e,t){if(!Ye)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Mt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags&14680064,r|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function _R(e,t,n){var r=t.pendingProps;switch(Ev(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mt(t),null;case 1:return sn(t.type)&&dc(),Mt(t),null;case 3:return r=t.stateNode,qa(),Xe(an),Xe(Ut),Pv(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(dl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Qn!==null&&(dp(Qn),Qn=null))),rp(e,t),Mt(t),null;case 5:Av(t);var o=xi(ou.current);if(n=t.type,e!==null&&t.stateNode!=null)zw(e,t,n,r,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Y(166));return Mt(t),null}if(e=xi(Rr.current),dl(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[br]=t,r[nu]=i,e=(t.mode&1)!==0,n){case"dialog":qe("cancel",r),qe("close",r);break;case"iframe":case"object":case"embed":qe("load",r);break;case"video":case"audio":for(o=0;o<Ps.length;o++)qe(Ps[o],r);break;case"source":qe("error",r);break;case"img":case"image":case"link":qe("error",r),qe("load",r);break;case"details":qe("toggle",r);break;case"input":Og(r,i),qe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},qe("invalid",r);break;case"textarea":Bg(r,i),qe("invalid",r)}Th(n,i),o=null;for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];a==="children"?typeof s=="string"?r.textContent!==s&&(i.suppressHydrationWarning!==!0&&cl(r.textContent,s,e),o=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&cl(r.textContent,s,e),o=["children",""+s]):Gs.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&qe("scroll",r)}switch(n){case"input":nl(r),Lg(r,i,!0);break;case"textarea":nl(r),jg(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=cc)}r=o,t.updateQueue=r,r!==null&&(t.flags|=4)}else{a=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=vx(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(n,{is:r.is}):(e=a.createElement(n),n==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,n),e[br]=t,e[nu]=r,jw(e,t,!1,!1),t.stateNode=e;e:{switch(a=Ah(n,r),n){case"dialog":qe("cancel",e),qe("close",e),o=r;break;case"iframe":case"object":case"embed":qe("load",e),o=r;break;case"video":case"audio":for(o=0;o<Ps.length;o++)qe(Ps[o],e);o=r;break;case"source":qe("error",e),o=r;break;case"img":case"image":case"link":qe("error",e),qe("load",e),o=r;break;case"details":qe("toggle",e),o=r;break;case"input":Og(e,r),o=kh(e,r),qe("invalid",e);break;case"option":o=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},o=tt({},r,{value:void 0}),qe("invalid",e);break;case"textarea":Bg(e,r),o=Nh(e,r),qe("invalid",e);break;default:o=r}Th(n,o),s=o;for(i in s)if(s.hasOwnProperty(i)){var u=s[i];i==="style"?yx(e,u):i==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&mx(e,u)):i==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&qs(e,u):typeof u=="number"&&qs(e,""+u):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Gs.hasOwnProperty(i)?u!=null&&i==="onScroll"&&qe("scroll",e):u!=null&&uv(e,i,u,a))}switch(n){case"input":nl(e),Lg(e,r,!1);break;case"textarea":nl(e),jg(e);break;case"option":r.value!=null&&e.setAttribute("value",""+qo(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?ya(e,!!r.multiple,i,!1):r.defaultValue!=null&&ya(e,!!r.multiple,r.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=cc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Mt(t),null;case 6:if(e&&t.stateNode!=null)Ww(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Y(166));if(n=xi(ou.current),xi(Rr.current),dl(t)){if(r=t.stateNode,n=t.memoizedProps,r[br]=t,(i=r.nodeValue!==n)&&(e=kn,e!==null))switch(e.tag){case 3:cl(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&cl(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[br]=t,t.stateNode=r}return Mt(t),null;case 13:if(Xe(Qe),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ye&&bn!==null&&t.mode&1&&!(t.flags&128))iw(),Ha(),t.flags|=98560,i=!1;else if(i=dl(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(Y(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));i[br]=t}else Ha(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Mt(t),i=!1}else Qn!==null&&(dp(Qn),Qn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Qe.current&1?vt===0&&(vt=3):Vv())),t.updateQueue!==null&&(t.flags|=4),Mt(t),null);case 4:return qa(),rp(e,t),e===null&&eu(t.stateNode.containerInfo),Mt(t),null;case 10:return Rv(t.type._context),Mt(t),null;case 17:return sn(t.type)&&dc(),Mt(t),null;case 19:if(Xe(Qe),i=t.memoizedState,i===null)return Mt(t),null;if(r=(t.flags&128)!==0,a=i.rendering,a===null)if(r)bs(i,!1);else{if(vt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=yc(e),a!==null){for(t.flags|=128,bs(i,!1),r=a.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,e=a.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return $e(Qe,Qe.current&1|2),t.child}e=e.sibling}i.tail!==null&&st()>Xa&&(t.flags|=128,r=!0,bs(i,!1),t.lanes=4194304)}else{if(!r)if(e=yc(a),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),bs(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Ye)return Mt(t),null}else 2*st()-i.renderingStartTime>Xa&&n!==1073741824&&(t.flags|=128,r=!0,bs(i,!1),t.lanes=4194304);i.isBackwards?(a.sibling=t.child,t.child=a):(n=i.last,n!==null?n.sibling=a:t.child=a,i.last=a)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=st(),t.sibling=null,n=Qe.current,$e(Qe,r?n&1|2:n&1),t):(Mt(t),null);case 22:case 23:return Uv(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?gn&1073741824&&(Mt(t),t.subtreeFlags&6&&(t.flags|=8192)):Mt(t),null;case 24:return null;case 25:return null}throw Error(Y(156,t.tag))}function RR(e,t){switch(Ev(t),t.tag){case 1:return sn(t.type)&&dc(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return qa(),Xe(an),Xe(Ut),Pv(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Av(t),null;case 13:if(Xe(Qe),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Y(340));Ha()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Xe(Qe),null;case 4:return qa(),null;case 10:return Rv(t.type._context),null;case 22:case 23:return Uv(),null;case 24:return null;default:return null}}var pl=!1,Lt=!1,NR=typeof WeakSet=="function"?WeakSet:Set,ne=null;function ma(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){it(e,t,r)}else n.current=null}function op(e,t,n){try{n()}catch(r){it(e,t,r)}}var N0=!1;function IR(e,t){if(Wh=sc,e=Gx(),bv(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var o=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,s=-1,u=-1,l=0,c=0,d=e,f=null;t:for(;;){for(var h;d!==n||o!==0&&d.nodeType!==3||(s=a+o),d!==i||r!==0&&d.nodeType!==3||(u=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===e)break t;if(f===n&&++l===o&&(s=a),f===i&&++c===r&&(u=a),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=s===-1||u===-1?null:{start:s,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for($h={focusedElem:e,selectionRange:n},sc=!1,ne=t;ne!==null;)if(t=ne,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ne=e;else for(;ne!==null;){t=ne;try{var p=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,g=p.memoizedState,m=t.stateNode,y=m.getSnapshotBeforeUpdate(t.elementType===t.type?v:qn(t.type,v),g);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(w){it(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,ne=e;break}ne=t.return}return p=N0,N0=!1,p}function js(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var o=r=r.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&op(t,n,i)}o=o.next}while(o!==r)}}function dd(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ip(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function $w(e){var t=e.alternate;t!==null&&(e.alternate=null,$w(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[br],delete t[nu],delete t[Hh],delete t[dR],delete t[fR])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Uw(e){return e.tag===5||e.tag===3||e.tag===4}function I0(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Uw(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ap(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=cc));else if(r!==4&&(e=e.child,e!==null))for(ap(e,t,n),e=e.sibling;e!==null;)ap(e,t,n),e=e.sibling}function sp(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(sp(e,t,n),e=e.sibling;e!==null;)sp(e,t,n),e=e.sibling}var _t=null,Yn=!1;function ho(e,t,n){for(n=n.child;n!==null;)Vw(e,t,n),n=n.sibling}function Vw(e,t,n){if(_r&&typeof _r.onCommitFiberUnmount=="function")try{_r.onCommitFiberUnmount(rd,n)}catch{}switch(n.tag){case 5:Lt||ma(n,t);case 6:var r=_t,o=Yn;_t=null,ho(e,t,n),_t=r,Yn=o,_t!==null&&(Yn?(e=_t,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):_t.removeChild(n.stateNode));break;case 18:_t!==null&&(Yn?(e=_t,n=n.stateNode,e.nodeType===8?xf(e.parentNode,n):e.nodeType===1&&xf(e,n),Qs(e)):xf(_t,n.stateNode));break;case 4:r=_t,o=Yn,_t=n.stateNode.containerInfo,Yn=!0,ho(e,t,n),_t=r,Yn=o;break;case 0:case 11:case 14:case 15:if(!Lt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){o=r=r.next;do{var i=o,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&op(n,t,a),o=o.next}while(o!==r)}ho(e,t,n);break;case 1:if(!Lt&&(ma(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){it(n,t,s)}ho(e,t,n);break;case 21:ho(e,t,n);break;case 22:n.mode&1?(Lt=(r=Lt)||n.memoizedState!==null,ho(e,t,n),Lt=r):ho(e,t,n);break;default:ho(e,t,n)}}function T0(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new NR),t.forEach(function(r){var o=BR.bind(null,e,r);n.has(r)||(n.add(r),r.then(o,o))})}}function Gn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var o=n[r];try{var i=e,a=t,s=a;e:for(;s!==null;){switch(s.tag){case 5:_t=s.stateNode,Yn=!1;break e;case 3:_t=s.stateNode.containerInfo,Yn=!0;break e;case 4:_t=s.stateNode.containerInfo,Yn=!0;break e}s=s.return}if(_t===null)throw Error(Y(160));Vw(i,a,o),_t=null,Yn=!1;var u=o.alternate;u!==null&&(u.return=null),o.return=null}catch(l){it(o,t,l)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Hw(t,e),t=t.sibling}function Hw(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Gn(t,e),hr(e),r&4){try{js(3,e,e.return),dd(3,e)}catch(v){it(e,e.return,v)}try{js(5,e,e.return)}catch(v){it(e,e.return,v)}}break;case 1:Gn(t,e),hr(e),r&512&&n!==null&&ma(n,n.return);break;case 5:if(Gn(t,e),hr(e),r&512&&n!==null&&ma(n,n.return),e.flags&32){var o=e.stateNode;try{qs(o,"")}catch(v){it(e,e.return,v)}}if(r&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,a=n!==null?n.memoizedProps:i,s=e.type,u=e.updateQueue;if(e.updateQueue=null,u!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&hx(o,i),Ah(s,a);var l=Ah(s,i);for(a=0;a<u.length;a+=2){var c=u[a],d=u[a+1];c==="style"?yx(o,d):c==="dangerouslySetInnerHTML"?mx(o,d):c==="children"?qs(o,d):uv(o,c,d,l)}switch(s){case"input":_h(o,i);break;case"textarea":px(o,i);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var h=i.value;h!=null?ya(o,!!i.multiple,h,!1):f!==!!i.multiple&&(i.defaultValue!=null?ya(o,!!i.multiple,i.defaultValue,!0):ya(o,!!i.multiple,i.multiple?[]:"",!1))}o[nu]=i}catch(v){it(e,e.return,v)}}break;case 6:if(Gn(t,e),hr(e),r&4){if(e.stateNode===null)throw Error(Y(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(v){it(e,e.return,v)}}break;case 3:if(Gn(t,e),hr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Qs(t.containerInfo)}catch(v){it(e,e.return,v)}break;case 4:Gn(t,e),hr(e);break;case 13:Gn(t,e),hr(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(Wv=st())),r&4&&T0(e);break;case 22:if(c=n!==null&&n.memoizedState!==null,e.mode&1?(Lt=(l=Lt)||c,Gn(t,e),Lt=l):Gn(t,e),hr(e),r&8192){if(l=e.memoizedState!==null,(e.stateNode.isHidden=l)&&!c&&e.mode&1)for(ne=e,c=e.child;c!==null;){for(d=ne=c;ne!==null;){switch(f=ne,h=f.child,f.tag){case 0:case 11:case 14:case 15:js(4,f,f.return);break;case 1:ma(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,n=f.return;try{t=r,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(v){it(r,n,v)}}break;case 5:ma(f,f.return);break;case 22:if(f.memoizedState!==null){P0(d);continue}}h!==null?(h.return=f,ne=h):P0(d)}c=c.sibling}e:for(c=null,d=e;;){if(d.tag===5){if(c===null){c=d;try{o=d.stateNode,l?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=d.stateNode,u=d.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=gx("display",a))}catch(v){it(e,e.return,v)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(v){it(e,e.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Gn(t,e),hr(e),r&4&&T0(e);break;case 21:break;default:Gn(t,e),hr(e)}}function hr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Uw(n)){var r=n;break e}n=n.return}throw Error(Y(160))}switch(r.tag){case 5:var o=r.stateNode;r.flags&32&&(qs(o,""),r.flags&=-33);var i=I0(e);sp(e,i,o);break;case 3:case 4:var a=r.stateNode.containerInfo,s=I0(e);ap(e,s,a);break;default:throw Error(Y(161))}}catch(u){it(e,e.return,u)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function TR(e,t,n){ne=e,Gw(e)}function Gw(e,t,n){for(var r=(e.mode&1)!==0;ne!==null;){var o=ne,i=o.child;if(o.tag===22&&r){var a=o.memoizedState!==null||pl;if(!a){var s=o.alternate,u=s!==null&&s.memoizedState!==null||Lt;s=pl;var l=Lt;if(pl=a,(Lt=u)&&!l)for(ne=o;ne!==null;)a=ne,u=a.child,a.tag===22&&a.memoizedState!==null?D0(o):u!==null?(u.return=a,ne=u):D0(o);for(;i!==null;)ne=i,Gw(i),i=i.sibling;ne=o,pl=s,Lt=l}A0(e)}else o.subtreeFlags&8772&&i!==null?(i.return=o,ne=i):A0(e)}}function A0(e){for(;ne!==null;){var t=ne;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Lt||dd(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Lt)if(n===null)r.componentDidMount();else{var o=t.elementType===t.type?n.memoizedProps:qn(t.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&v0(t,i,r);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}v0(t,a,n)}break;case 5:var s=t.stateNode;if(n===null&&t.flags&4){n=s;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var l=t.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Qs(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}Lt||t.flags&512&&ip(t)}catch(f){it(t,t.return,f)}}if(t===e){ne=null;break}if(n=t.sibling,n!==null){n.return=t.return,ne=n;break}ne=t.return}}function P0(e){for(;ne!==null;){var t=ne;if(t===e){ne=null;break}var n=t.sibling;if(n!==null){n.return=t.return,ne=n;break}ne=t.return}}function D0(e){for(;ne!==null;){var t=ne;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{dd(4,t)}catch(u){it(t,n,u)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var o=t.return;try{r.componentDidMount()}catch(u){it(t,o,u)}}var i=t.return;try{ip(t)}catch(u){it(t,i,u)}break;case 5:var a=t.return;try{ip(t)}catch(u){it(t,a,u)}}}catch(u){it(t,t.return,u)}if(t===e){ne=null;break}var s=t.sibling;if(s!==null){s.return=t.return,ne=s;break}ne=t.return}}var AR=Math.ceil,bc=no.ReactCurrentDispatcher,jv=no.ReactCurrentOwner,Wn=no.ReactCurrentBatchConfig,Ne=0,Et=null,lt=null,Tt=0,gn=0,ga=ti(0),vt=0,uu=null,Di=0,fd=0,zv=0,zs=null,en=null,Wv=0,Xa=1/0,Ur=null,Cc=!1,up=null,zo=null,vl=!1,To=null,Ec=0,Ws=0,lp=null,Xl=-1,Yl=0;function Kt(){return Ne&6?st():Xl!==-1?Xl:Xl=st()}function Wo(e){return e.mode&1?Ne&2&&Tt!==0?Tt&-Tt:pR.transition!==null?(Yl===0&&(Yl=Tx()),Yl):(e=Oe,e!==0||(e=window.event,e=e===void 0?16:Lx(e.type)),e):1}function tr(e,t,n,r){if(50<Ws)throw Ws=0,lp=null,Error(Y(185));Iu(e,n,r),(!(Ne&2)||e!==Et)&&(e===Et&&(!(Ne&2)&&(fd|=n),vt===4&&Eo(e,Tt)),un(e,r),n===1&&Ne===0&&!(t.mode&1)&&(Xa=st()+500,ud&&ni()))}function un(e,t){var n=e.callbackNode;p_(e,t);var r=ac(e,e===Et?Tt:0);if(r===0)n!==null&&$g(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&$g(n),t===1)e.tag===0?hR(M0.bind(null,e)):nw(M0.bind(null,e)),lR(function(){!(Ne&6)&&ni()}),n=null;else{switch(Ax(r)){case 1:n=hv;break;case 4:n=Nx;break;case 16:n=ic;break;case 536870912:n=Ix;break;default:n=ic}n=eb(n,qw.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function qw(e,t){if(Xl=-1,Yl=0,Ne&6)throw Error(Y(327));var n=e.callbackNode;if(Ea()&&e.callbackNode!==n)return null;var r=ac(e,e===Et?Tt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Sc(e,r);else{t=r;var o=Ne;Ne|=2;var i=Xw();(Et!==e||Tt!==t)&&(Ur=null,Xa=st()+500,_i(e,t));do try{MR();break}catch(s){Kw(e,s)}while(!0);_v(),bc.current=i,Ne=o,lt!==null?t=0:(Et=null,Tt=0,t=vt)}if(t!==0){if(t===2&&(o=Oh(e),o!==0&&(r=o,t=cp(e,o))),t===1)throw n=uu,_i(e,0),Eo(e,r),un(e,st()),n;if(t===6)Eo(e,r);else{if(o=e.current.alternate,!(r&30)&&!PR(o)&&(t=Sc(e,r),t===2&&(i=Oh(e),i!==0&&(r=i,t=cp(e,i))),t===1))throw n=uu,_i(e,0),Eo(e,r),un(e,st()),n;switch(e.finishedWork=o,e.finishedLanes=r,t){case 0:case 1:throw Error(Y(345));case 2:ci(e,en,Ur);break;case 3:if(Eo(e,r),(r&130023424)===r&&(t=Wv+500-st(),10<t)){if(ac(e,0)!==0)break;if(o=e.suspendedLanes,(o&r)!==r){Kt(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Vh(ci.bind(null,e,en,Ur),t);break}ci(e,en,Ur);break;case 4:if(Eo(e,r),(r&4194240)===r)break;for(t=e.eventTimes,o=-1;0<r;){var a=31-er(r);i=1<<a,a=t[a],a>o&&(o=a),r&=~i}if(r=o,r=st()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*AR(r/1960))-r,10<r){e.timeoutHandle=Vh(ci.bind(null,e,en,Ur),r);break}ci(e,en,Ur);break;case 5:ci(e,en,Ur);break;default:throw Error(Y(329))}}}return un(e,st()),e.callbackNode===n?qw.bind(null,e):null}function cp(e,t){var n=zs;return e.current.memoizedState.isDehydrated&&(_i(e,t).flags|=256),e=Sc(e,t),e!==2&&(t=en,en=n,t!==null&&dp(t)),e}function dp(e){en===null?en=e:en.push.apply(en,e)}function PR(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!rr(i(),o))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Eo(e,t){for(t&=~zv,t&=~fd,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-er(t),r=1<<n;e[n]=-1,t&=~r}}function M0(e){if(Ne&6)throw Error(Y(327));Ea();var t=ac(e,0);if(!(t&1))return un(e,st()),null;var n=Sc(e,t);if(e.tag!==0&&n===2){var r=Oh(e);r!==0&&(t=r,n=cp(e,r))}if(n===1)throw n=uu,_i(e,0),Eo(e,t),un(e,st()),n;if(n===6)throw Error(Y(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ci(e,en,Ur),un(e,st()),null}function $v(e,t){var n=Ne;Ne|=1;try{return e(t)}finally{Ne=n,Ne===0&&(Xa=st()+500,ud&&ni())}}function Mi(e){To!==null&&To.tag===0&&!(Ne&6)&&Ea();var t=Ne;Ne|=1;var n=Wn.transition,r=Oe;try{if(Wn.transition=null,Oe=1,e)return e()}finally{Oe=r,Wn.transition=n,Ne=t,!(Ne&6)&&ni()}}function Uv(){gn=ga.current,Xe(ga)}function _i(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,uR(n)),lt!==null)for(n=lt.return;n!==null;){var r=n;switch(Ev(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&dc();break;case 3:qa(),Xe(an),Xe(Ut),Pv();break;case 5:Av(r);break;case 4:qa();break;case 13:Xe(Qe);break;case 19:Xe(Qe);break;case 10:Rv(r.type._context);break;case 22:case 23:Uv()}n=n.return}if(Et=e,lt=e=$o(e.current,null),Tt=gn=t,vt=0,uu=null,zv=fd=Di=0,en=zs=null,yi!==null){for(t=0;t<yi.length;t++)if(n=yi[t],r=n.interleaved,r!==null){n.interleaved=null;var o=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=o,r.next=a}n.pending=r}yi=null}return e}function Kw(e,t){do{var n=lt;try{if(_v(),Gl.current=wc,xc){for(var r=et.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}xc=!1}if(Pi=0,Ct=pt=et=null,Bs=!1,iu=0,jv.current=null,n===null||n.return===null){vt=1,uu=t,lt=null;break}e:{var i=e,a=n.return,s=n,u=t;if(t=Tt,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=b0(a);if(h!==null){h.flags&=-257,C0(h,a,s,i,t),h.mode&1&&w0(i,l,t),t=h,u=l;var p=t.updateQueue;if(p===null){var v=new Set;v.add(u),t.updateQueue=v}else p.add(u);break e}else{if(!(t&1)){w0(i,l,t),Vv();break e}u=Error(Y(426))}}else if(Ye&&s.mode&1){var g=b0(a);if(g!==null){!(g.flags&65536)&&(g.flags|=256),C0(g,a,s,i,t),Sv(Ka(u,s));break e}}i=u=Ka(u,s),vt!==4&&(vt=2),zs===null?zs=[i]:zs.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var m=Aw(i,u,t);p0(i,m);break e;case 1:s=u;var y=i.type,x=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(zo===null||!zo.has(x)))){i.flags|=65536,t&=-t,i.lanes|=t;var w=Pw(i,s,t);p0(i,w);break e}}i=i.return}while(i!==null)}Qw(n)}catch(b){t=b,lt===n&&n!==null&&(lt=n=n.return);continue}break}while(!0)}function Xw(){var e=bc.current;return bc.current=wc,e===null?wc:e}function Vv(){(vt===0||vt===3||vt===2)&&(vt=4),Et===null||!(Di&268435455)&&!(fd&268435455)||Eo(Et,Tt)}function Sc(e,t){var n=Ne;Ne|=2;var r=Xw();(Et!==e||Tt!==t)&&(Ur=null,_i(e,t));do try{DR();break}catch(o){Kw(e,o)}while(!0);if(_v(),Ne=n,bc.current=r,lt!==null)throw Error(Y(261));return Et=null,Tt=0,vt}function DR(){for(;lt!==null;)Yw(lt)}function MR(){for(;lt!==null&&!i_();)Yw(lt)}function Yw(e){var t=Zw(e.alternate,e,gn);e.memoizedProps=e.pendingProps,t===null?Qw(e):lt=t,jv.current=null}function Qw(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=RR(n,t),n!==null){n.flags&=32767,lt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{vt=6,lt=null;return}}else if(n=_R(n,t,gn),n!==null){lt=n;return}if(t=t.sibling,t!==null){lt=t;return}lt=t=e}while(t!==null);vt===0&&(vt=5)}function ci(e,t,n){var r=Oe,o=Wn.transition;try{Wn.transition=null,Oe=1,FR(e,t,n,r)}finally{Wn.transition=o,Oe=r}return null}function FR(e,t,n,r){do Ea();while(To!==null);if(Ne&6)throw Error(Y(327));n=e.finishedWork;var o=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Y(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(v_(e,i),e===Et&&(lt=Et=null,Tt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vl||(vl=!0,eb(ic,function(){return Ea(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Wn.transition,Wn.transition=null;var a=Oe;Oe=1;var s=Ne;Ne|=4,jv.current=null,IR(e,n),Hw(n,e),tR($h),sc=!!Wh,$h=Wh=null,e.current=n,TR(n),a_(),Ne=s,Oe=a,Wn.transition=i}else e.current=n;if(vl&&(vl=!1,To=e,Ec=o),i=e.pendingLanes,i===0&&(zo=null),l_(n.stateNode),un(e,st()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)o=t[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Cc)throw Cc=!1,e=up,up=null,e;return Ec&1&&e.tag!==0&&Ea(),i=e.pendingLanes,i&1?e===lp?Ws++:(Ws=0,lp=e):Ws=0,ni(),null}function Ea(){if(To!==null){var e=Ax(Ec),t=Wn.transition,n=Oe;try{if(Wn.transition=null,Oe=16>e?16:e,To===null)var r=!1;else{if(e=To,To=null,Ec=0,Ne&6)throw Error(Y(331));var o=Ne;for(Ne|=4,ne=e.current;ne!==null;){var i=ne,a=i.child;if(ne.flags&16){var s=i.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(ne=l;ne!==null;){var c=ne;switch(c.tag){case 0:case 11:case 15:js(8,c,i)}var d=c.child;if(d!==null)d.return=c,ne=d;else for(;ne!==null;){c=ne;var f=c.sibling,h=c.return;if($w(c),c===l){ne=null;break}if(f!==null){f.return=h,ne=f;break}ne=h}}}var p=i.alternate;if(p!==null){var v=p.child;if(v!==null){p.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(v!==null)}}ne=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ne=a;else e:for(;ne!==null;){if(i=ne,i.flags&2048)switch(i.tag){case 0:case 11:case 15:js(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,ne=m;break e}ne=i.return}}var y=e.current;for(ne=y;ne!==null;){a=ne;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,ne=x;else e:for(a=y;ne!==null;){if(s=ne,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:dd(9,s)}}catch(b){it(s,s.return,b)}if(s===a){ne=null;break e}var w=s.sibling;if(w!==null){w.return=s.return,ne=w;break e}ne=s.return}}if(Ne=o,ni(),_r&&typeof _r.onPostCommitFiberRoot=="function")try{_r.onPostCommitFiberRoot(rd,e)}catch{}r=!0}return r}finally{Oe=n,Wn.transition=t}}return!1}function F0(e,t,n){t=Ka(n,t),t=Aw(e,t,1),e=jo(e,t,1),t=Kt(),e!==null&&(Iu(e,1,t),un(e,t))}function it(e,t,n){if(e.tag===3)F0(e,e,n);else for(;t!==null;){if(t.tag===3){F0(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(zo===null||!zo.has(r))){e=Ka(n,e),e=Pw(t,e,1),t=jo(t,e,1),e=Kt(),t!==null&&(Iu(t,1,e),un(t,e));break}}t=t.return}}function OR(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Kt(),e.pingedLanes|=e.suspendedLanes&n,Et===e&&(Tt&n)===n&&(vt===4||vt===3&&(Tt&130023424)===Tt&&500>st()-Wv?_i(e,0):zv|=n),un(e,t)}function Jw(e,t){t===0&&(e.mode&1?(t=il,il<<=1,!(il&130023424)&&(il=4194304)):t=1);var n=Kt();e=Qr(e,t),e!==null&&(Iu(e,t,n),un(e,n))}function LR(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Jw(e,n)}function BR(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,o=e.memoizedState;o!==null&&(n=o.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Y(314))}r!==null&&r.delete(t),Jw(e,n)}var Zw;Zw=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||an.current)on=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return on=!1,kR(e,t,n);on=!!(e.flags&131072)}else on=!1,Ye&&t.flags&1048576&&rw(t,pc,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Kl(e,t),e=t.pendingProps;var o=Va(t,Ut.current);Ca(t,n),o=Mv(null,t,r,e,o,n);var i=Fv();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,sn(r)?(i=!0,fc(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Iv(t),o.updater=cd,t.stateNode=o,o._reactInternals=t,Qh(t,r,e,n),t=ep(null,t,r,!0,i,n)):(t.tag=0,Ye&&i&&Cv(t),Gt(null,t,o,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Kl(e,t),e=t.pendingProps,o=r._init,r=o(r._payload),t.type=r,o=t.tag=zR(r),e=qn(r,e),o){case 0:t=Zh(null,t,r,e,n);break e;case 1:t=k0(null,t,r,e,n);break e;case 11:t=E0(null,t,r,e,n);break e;case 14:t=S0(null,t,r,qn(r.type,e),n);break e}throw Error(Y(306,r,""))}return t;case 0:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:qn(r,o),Zh(e,t,r,o,n);case 1:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:qn(r,o),k0(e,t,r,o,n);case 3:e:{if(Ow(t),e===null)throw Error(Y(387));r=t.pendingProps,i=t.memoizedState,o=i.element,lw(e,t),gc(t,r,null,n);var a=t.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=Ka(Error(Y(423)),t),t=_0(e,t,r,n,o);break e}else if(r!==o){o=Ka(Error(Y(424)),t),t=_0(e,t,r,n,o);break e}else for(bn=Bo(t.stateNode.containerInfo.firstChild),kn=t,Ye=!0,Qn=null,n=sw(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ha(),r===o){t=Jr(e,t,n);break e}Gt(e,t,r,n)}t=t.child}return t;case 5:return cw(t),e===null&&Kh(t),r=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,a=o.children,Uh(r,o)?a=null:i!==null&&Uh(r,i)&&(t.flags|=32),Fw(e,t),Gt(e,t,a,n),t.child;case 6:return e===null&&Kh(t),null;case 13:return Lw(e,t,n);case 4:return Tv(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Ga(t,null,r,n):Gt(e,t,r,n),t.child;case 11:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:qn(r,o),E0(e,t,r,o,n);case 7:return Gt(e,t,t.pendingProps,n),t.child;case 8:return Gt(e,t,t.pendingProps.children,n),t.child;case 12:return Gt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,o=t.pendingProps,i=t.memoizedProps,a=o.value,$e(vc,r._currentValue),r._currentValue=a,i!==null)if(rr(i.value,a)){if(i.children===o.children&&!an.current){t=Jr(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){a=i.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(i.tag===1){u=Kr(-1,n&-n),u.tag=2;var l=i.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}i.lanes|=n,u=i.alternate,u!==null&&(u.lanes|=n),Xh(i.return,n,t),s.lanes|=n;break}u=u.next}}else if(i.tag===10)a=i.type===t.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Y(341));a.lanes|=n,s=a.alternate,s!==null&&(s.lanes|=n),Xh(a,n,t),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Gt(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,r=t.pendingProps.children,Ca(t,n),o=$n(o),r=r(o),t.flags|=1,Gt(e,t,r,n),t.child;case 14:return r=t.type,o=qn(r,t.pendingProps),o=qn(r.type,o),S0(e,t,r,o,n);case 15:return Dw(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,o=t.pendingProps,o=t.elementType===r?o:qn(r,o),Kl(e,t),t.tag=1,sn(r)?(e=!0,fc(t)):e=!1,Ca(t,n),Tw(t,r,o),Qh(t,r,o,n),ep(null,t,r,!0,e,n);case 19:return Bw(e,t,n);case 22:return Mw(e,t,n)}throw Error(Y(156,t.tag))};function eb(e,t){return Rx(e,t)}function jR(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jn(e,t,n,r){return new jR(e,t,n,r)}function Hv(e){return e=e.prototype,!(!e||!e.isReactComponent)}function zR(e){if(typeof e=="function")return Hv(e)?1:0;if(e!=null){if(e=e.$$typeof,e===cv)return 11;if(e===dv)return 14}return 2}function $o(e,t){var n=e.alternate;return n===null?(n=jn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ql(e,t,n,r,o,i){var a=2;if(r=e,typeof e=="function")Hv(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case sa:return Ri(n.children,o,i,t);case lv:a=8,o|=8;break;case bh:return e=jn(12,n,t,o|2),e.elementType=bh,e.lanes=i,e;case Ch:return e=jn(13,n,t,o),e.elementType=Ch,e.lanes=i,e;case Eh:return e=jn(19,n,t,o),e.elementType=Eh,e.lanes=i,e;case cx:return hd(n,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ux:a=10;break e;case lx:a=9;break e;case cv:a=11;break e;case dv:a=14;break e;case wo:a=16,r=null;break e}throw Error(Y(130,e==null?e:typeof e,""))}return t=jn(a,n,t,o),t.elementType=e,t.type=r,t.lanes=i,t}function Ri(e,t,n,r){return e=jn(7,e,r,t),e.lanes=n,e}function hd(e,t,n,r){return e=jn(22,e,r,t),e.elementType=cx,e.lanes=n,e.stateNode={isHidden:!1},e}function Rf(e,t,n){return e=jn(6,e,null,t),e.lanes=n,e}function Nf(e,t,n){return t=jn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function WR(e,t,n,r,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uf(0),this.expirationTimes=uf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uf(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Gv(e,t,n,r,o,i,a,s,u){return e=new WR(e,t,n,s,u),t===1?(t=1,i===!0&&(t|=8)):t=0,i=jn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Iv(i),e}function $R(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:aa,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function tb(e){if(!e)return Ko;e=e._reactInternals;e:{if(ji(e)!==e||e.tag!==1)throw Error(Y(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(sn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Y(171))}if(e.tag===1){var n=e.type;if(sn(n))return tw(e,n,t)}return t}function nb(e,t,n,r,o,i,a,s,u){return e=Gv(n,r,!0,e,o,i,a,s,u),e.context=tb(null),n=e.current,r=Kt(),o=Wo(n),i=Kr(r,o),i.callback=t??null,jo(n,i,o),e.current.lanes=o,Iu(e,o,r),un(e,r),e}function pd(e,t,n,r){var o=t.current,i=Kt(),a=Wo(o);return n=tb(n),t.context===null?t.context=n:t.pendingContext=n,t=Kr(i,a),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=jo(o,t,a),e!==null&&(tr(e,o,a,i),Hl(e,o,a)),a}function kc(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function O0(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function qv(e,t){O0(e,t),(e=e.alternate)&&O0(e,t)}function UR(){return null}var rb=typeof reportError=="function"?reportError:function(e){console.error(e)};function Kv(e){this._internalRoot=e}vd.prototype.render=Kv.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Y(409));pd(e,t,null,null)};vd.prototype.unmount=Kv.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Mi(function(){pd(null,e,null,null)}),t[Yr]=null}};function vd(e){this._internalRoot=e}vd.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mx();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Co.length&&t!==0&&t<Co[n].priority;n++);Co.splice(n,0,e),n===0&&Ox(e)}};function Xv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function md(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function L0(){}function VR(e,t,n,r,o){if(o){if(typeof r=="function"){var i=r;r=function(){var l=kc(a);i.call(l)}}var a=nb(t,r,e,0,null,!1,!1,"",L0);return e._reactRootContainer=a,e[Yr]=a.current,eu(e.nodeType===8?e.parentNode:e),Mi(),a}for(;o=e.lastChild;)e.removeChild(o);if(typeof r=="function"){var s=r;r=function(){var l=kc(u);s.call(l)}}var u=Gv(e,0,!1,null,null,!1,!1,"",L0);return e._reactRootContainer=u,e[Yr]=u.current,eu(e.nodeType===8?e.parentNode:e),Mi(function(){pd(t,u,n,r)}),u}function gd(e,t,n,r,o){var i=n._reactRootContainer;if(i){var a=i;if(typeof o=="function"){var s=o;o=function(){var u=kc(a);s.call(u)}}pd(t,a,e,o)}else a=VR(n,t,e,o,r);return kc(a)}Px=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=As(t.pendingLanes);n!==0&&(pv(t,n|1),un(t,st()),!(Ne&6)&&(Xa=st()+500,ni()))}break;case 13:Mi(function(){var r=Qr(e,1);if(r!==null){var o=Kt();tr(r,e,1,o)}}),qv(e,1)}};vv=function(e){if(e.tag===13){var t=Qr(e,134217728);if(t!==null){var n=Kt();tr(t,e,134217728,n)}qv(e,134217728)}};Dx=function(e){if(e.tag===13){var t=Wo(e),n=Qr(e,t);if(n!==null){var r=Kt();tr(n,e,t,r)}qv(e,t)}};Mx=function(){return Oe};Fx=function(e,t){var n=Oe;try{return Oe=e,t()}finally{Oe=n}};Dh=function(e,t,n){switch(t){case"input":if(_h(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var o=sd(r);if(!o)throw Error(Y(90));fx(r),_h(r,o)}}}break;case"textarea":px(e,n);break;case"select":t=n.value,t!=null&&ya(e,!!n.multiple,t,!1)}};bx=$v;Cx=Mi;var HR={usingClientEntryPoint:!1,Events:[Au,da,sd,xx,wx,$v]},Cs={findFiberByHostInstance:gi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},GR={bundleType:Cs.bundleType,version:Cs.version,rendererPackageName:Cs.rendererPackageName,rendererConfig:Cs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:no.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=kx(e),e===null?null:e.stateNode},findFiberByHostInstance:Cs.findFiberByHostInstance||UR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ml=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ml.isDisabled&&ml.supportsFiber)try{rd=ml.inject(GR),_r=ml}catch{}}An.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HR;An.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Xv(t))throw Error(Y(200));return $R(e,t,null,n)};An.createRoot=function(e,t){if(!Xv(e))throw Error(Y(299));var n=!1,r="",o=rb;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=Gv(e,1,!1,null,null,n,!1,r,o),e[Yr]=t.current,eu(e.nodeType===8?e.parentNode:e),new Kv(t)};An.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Y(188)):(e=Object.keys(e).join(","),Error(Y(268,e)));return e=kx(t),e=e===null?null:e.stateNode,e};An.flushSync=function(e){return Mi(e)};An.hydrate=function(e,t,n){if(!md(t))throw Error(Y(200));return gd(null,e,t,!0,n)};An.hydrateRoot=function(e,t,n){if(!Xv(e))throw Error(Y(405));var r=n!=null&&n.hydratedSources||null,o=!1,i="",a=rb;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=nb(t,null,e,1,n??null,o,!1,i,a),e[Yr]=t.current,eu(e),r)for(e=0;e<r.length;e++)n=r[e],o=n._getVersion,o=o(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,o]:t.mutableSourceEagerHydrationData.push(n,o);return new vd(t)};An.render=function(e,t,n){if(!md(t))throw Error(Y(200));return gd(null,e,t,!1,n)};An.unmountComponentAtNode=function(e){if(!md(e))throw Error(Y(40));return e._reactRootContainer?(Mi(function(){gd(null,null,e,!1,function(){e._reactRootContainer=null,e[Yr]=null})}),!0):!1};An.unstable_batchedUpdates=$v;An.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!md(n))throw Error(Y(200));if(e==null||e._reactInternals===void 0)throw Error(Y(38));return gd(e,t,n,!1,r)};An.version="18.3.1-next-f1338f8080-20240426";function ob(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ob)}catch(e){console.error(e)}}ob(),ox.exports=An;var Du=ox.exports;const ib=H1(Du);var ab,B0=Du;ab=B0.createRoot,B0.hydrateRoot;function Pe(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e==null||e(o),n===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function qR(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function sb(...e){return t=>e.forEach(n=>qR(n,t))}function ft(...e){return C.useCallback(sb(...e),e)}function KR(e,t=[]){let n=[];function r(i,a){const s=C.createContext(a),u=n.length;n=[...n,a];function l(d){const{scope:f,children:h,...p}=d,v=(f==null?void 0:f[e][u])||s,g=C.useMemo(()=>p,Object.values(p));return S.jsx(v.Provider,{value:g,children:h})}function c(d,f){const h=(f==null?void 0:f[e][u])||s,p=C.useContext(h);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${i}\``)}return l.displayName=i+"Provider",[l,c]}const o=()=>{const i=n.map(a=>C.createContext(a));return function(s){const u=(s==null?void 0:s[e])||i;return C.useMemo(()=>({[`__scope${e}`]:{...s,[e]:u}}),[s,u])}};return o.scopeName=e,[r,XR(o,...t)]}function XR(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const a=r.reduce((s,{useScope:u,scopeName:l})=>{const d=u(i)[`__scope${l}`];return{...s,...d}},{});return C.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}var Ya=C.forwardRef((e,t)=>{const{children:n,...r}=e,o=C.Children.toArray(n),i=o.find(YR);if(i){const a=i.props.children,s=o.map(u=>u===i?C.Children.count(a)>1?C.Children.only(null):C.isValidElement(a)?a.props.children:null:u);return S.jsx(fp,{...r,ref:t,children:C.isValidElement(a)?C.cloneElement(a,void 0,s):null})}return S.jsx(fp,{...r,ref:t,children:n})});Ya.displayName="Slot";var fp=C.forwardRef((e,t)=>{const{children:n,...r}=e;if(C.isValidElement(n)){const o=JR(n);return C.cloneElement(n,{...QR(r,n.props),ref:t?sb(t,o):o})}return C.Children.count(n)>1?C.Children.only(null):null});fp.displayName="SlotClone";var ub=({children:e})=>S.jsx(S.Fragment,{children:e});function YR(e){return C.isValidElement(e)&&e.type===ub}function QR(e,t){const n={...t};for(const r in t){const o=e[r],i=t[r];/^on[A-Z]/.test(r)?o&&i?n[r]=(...s)=>{i(...s),o(...s)}:o&&(n[r]=o):r==="style"?n[r]={...o,...i}:r==="className"&&(n[r]=[o,i].filter(Boolean).join(" "))}return{...e,...n}}function JR(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function lb(e){const t=e+"CollectionProvider",[n,r]=KR(t),[o,i]=n(t,{collectionRef:{current:null},itemMap:new Map}),a=h=>{const{scope:p,children:v}=h,g=J.useRef(null),m=J.useRef(new Map).current;return S.jsx(o,{scope:p,itemMap:m,collectionRef:g,children:v})};a.displayName=t;const s=e+"CollectionSlot",u=J.forwardRef((h,p)=>{const{scope:v,children:g}=h,m=i(s,v),y=ft(p,m.collectionRef);return S.jsx(Ya,{ref:y,children:g})});u.displayName=s;const l=e+"CollectionItemSlot",c="data-radix-collection-item",d=J.forwardRef((h,p)=>{const{scope:v,children:g,...m}=h,y=J.useRef(null),x=ft(p,y),w=i(l,v);return J.useEffect(()=>(w.itemMap.set(y,{ref:y,...m}),()=>void w.itemMap.delete(y))),S.jsx(Ya,{[c]:"",ref:x,children:g})});d.displayName=l;function f(h){const p=i(e+"CollectionConsumer",h);return J.useCallback(()=>{const g=p.collectionRef.current;if(!g)return[];const m=Array.from(g.querySelectorAll(`[${c}]`));return Array.from(p.itemMap.values()).sort((w,b)=>m.indexOf(w.ref.current)-m.indexOf(b.ref.current))},[p.collectionRef,p.itemMap])}return[{Provider:a,Slot:u,ItemSlot:d},f,r]}function ZR(e,t){const n=C.createContext(t),r=i=>{const{children:a,...s}=i,u=C.useMemo(()=>s,Object.values(s));return S.jsx(n.Provider,{value:u,children:a})};r.displayName=e+"Provider";function o(i){const a=C.useContext(n);if(a)return a;if(t!==void 0)return t;throw new Error(`\`${i}\` must be used within \`${e}\``)}return[r,o]}function Mu(e,t=[]){let n=[];function r(i,a){const s=C.createContext(a),u=n.length;n=[...n,a];const l=d=>{var m;const{scope:f,children:h,...p}=d,v=((m=f==null?void 0:f[e])==null?void 0:m[u])||s,g=C.useMemo(()=>p,Object.values(p));return S.jsx(v.Provider,{value:g,children:h})};l.displayName=i+"Provider";function c(d,f){var v;const h=((v=f==null?void 0:f[e])==null?void 0:v[u])||s,p=C.useContext(h);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${i}\``)}return[l,c]}const o=()=>{const i=n.map(a=>C.createContext(a));return function(s){const u=(s==null?void 0:s[e])||i;return C.useMemo(()=>({[`__scope${e}`]:{...s,[e]:u}}),[s,u])}};return o.scopeName=e,[r,eN(o,...t)]}function eN(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const a=r.reduce((s,{useScope:u,scopeName:l})=>{const d=u(i)[`__scope${l}`];return{...s,...d}},{});return C.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}var tN=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],je=tN.reduce((e,t)=>{const n=C.forwardRef((r,o)=>{const{asChild:i,...a}=r,s=i?Ya:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(s,{...a,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function cb(e,t){e&&Du.flushSync(()=>e.dispatchEvent(t))}function In(e){const t=C.useRef(e);return C.useEffect(()=>{t.current=e}),C.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function nN(e,t=globalThis==null?void 0:globalThis.document){const n=In(e);C.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var rN="DismissableLayer",hp="dismissableLayer.update",oN="dismissableLayer.pointerDownOutside",iN="dismissableLayer.focusOutside",j0,db=C.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),yd=C.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:a,onDismiss:s,...u}=e,l=C.useContext(db),[c,d]=C.useState(null),f=(c==null?void 0:c.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,h]=C.useState({}),p=ft(t,k=>d(k)),v=Array.from(l.layers),[g]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),m=v.indexOf(g),y=c?v.indexOf(c):-1,x=l.layersWithOutsidePointerEventsDisabled.size>0,w=y>=m,b=sN(k=>{const _=k.target,R=[...l.branches].some(N=>N.contains(_));!w||R||(o==null||o(k),a==null||a(k),k.defaultPrevented||s==null||s())},f),E=uN(k=>{const _=k.target;[...l.branches].some(N=>N.contains(_))||(i==null||i(k),a==null||a(k),k.defaultPrevented||s==null||s())},f);return nN(k=>{y===l.layers.size-1&&(r==null||r(k),!k.defaultPrevented&&s&&(k.preventDefault(),s()))},f),C.useEffect(()=>{if(c)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(j0=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(c)),l.layers.add(c),z0(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=j0)}},[c,f,n,l]),C.useEffect(()=>()=>{c&&(l.layers.delete(c),l.layersWithOutsidePointerEventsDisabled.delete(c),z0())},[c,l]),C.useEffect(()=>{const k=()=>h({});return document.addEventListener(hp,k),()=>document.removeEventListener(hp,k)},[]),S.jsx(je.div,{...u,ref:p,style:{pointerEvents:x?w?"auto":"none":void 0,...e.style},onFocusCapture:Pe(e.onFocusCapture,E.onFocusCapture),onBlurCapture:Pe(e.onBlurCapture,E.onBlurCapture),onPointerDownCapture:Pe(e.onPointerDownCapture,b.onPointerDownCapture)})});yd.displayName=rN;var aN="DismissableLayerBranch",fb=C.forwardRef((e,t)=>{const n=C.useContext(db),r=C.useRef(null),o=ft(t,r);return C.useEffect(()=>{const i=r.current;if(i)return n.branches.add(i),()=>{n.branches.delete(i)}},[n.branches]),S.jsx(je.div,{...e,ref:o})});fb.displayName=aN;function sN(e,t=globalThis==null?void 0:globalThis.document){const n=In(e),r=C.useRef(!1),o=C.useRef(()=>{});return C.useEffect(()=>{const i=s=>{if(s.target&&!r.current){let u=function(){hb(oN,n,l,{discrete:!0})};const l={originalEvent:s};s.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=u,t.addEventListener("click",o.current,{once:!0})):u()}else t.removeEventListener("click",o.current);r.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",i)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",i),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function uN(e,t=globalThis==null?void 0:globalThis.document){const n=In(e),r=C.useRef(!1);return C.useEffect(()=>{const o=i=>{i.target&&!r.current&&hb(iN,n,{originalEvent:i},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function z0(){const e=new CustomEvent(hp);document.dispatchEvent(e)}function hb(e,t,n,{discrete:r}){const o=n.originalEvent.target,i=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?cb(o,i):o.dispatchEvent(i)}var lN=yd,cN=fb,Ar=globalThis!=null&&globalThis.document?C.useLayoutEffect:()=>{},dN="Portal",Yv=C.forwardRef((e,t)=>{var s;const{container:n,...r}=e,[o,i]=C.useState(!1);Ar(()=>i(!0),[]);const a=n||o&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return a?ib.createPortal(S.jsx(je.div,{...r,ref:t}),a):null});Yv.displayName=dN;function fN(e,t){return C.useReducer((n,r)=>t[n][r]??n,e)}var as=e=>{const{present:t,children:n}=e,r=hN(t),o=typeof n=="function"?n({present:r.isPresent}):C.Children.only(n),i=ft(r.ref,pN(o));return typeof n=="function"||r.isPresent?C.cloneElement(o,{ref:i}):null};as.displayName="Presence";function hN(e){const[t,n]=C.useState(),r=C.useRef({}),o=C.useRef(e),i=C.useRef("none"),a=e?"mounted":"unmounted",[s,u]=fN(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return C.useEffect(()=>{const l=gl(r.current);i.current=s==="mounted"?l:"none"},[s]),Ar(()=>{const l=r.current,c=o.current;if(c!==e){const f=i.current,h=gl(l);e?u("MOUNT"):h==="none"||(l==null?void 0:l.display)==="none"?u("UNMOUNT"):u(c&&f!==h?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,u]),Ar(()=>{if(t){let l;const c=t.ownerDocument.defaultView??window,d=h=>{const v=gl(r.current).includes(h.animationName);if(h.target===t&&v&&(u("ANIMATION_END"),!o.current)){const g=t.style.animationFillMode;t.style.animationFillMode="forwards",l=c.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=g)})}},f=h=>{h.target===t&&(i.current=gl(r.current))};return t.addEventListener("animationstart",f),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{c.clearTimeout(l),t.removeEventListener("animationstart",f),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else u("ANIMATION_END")},[t,u]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:C.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function gl(e){return(e==null?void 0:e.animationName)||"none"}function pN(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function xd({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,o]=vN({defaultProp:t,onChange:n}),i=e!==void 0,a=i?e:r,s=In(n),u=C.useCallback(l=>{if(i){const d=typeof l=="function"?l(e):l;d!==e&&s(d)}else o(l)},[i,e,o,s]);return[a,u]}function vN({defaultProp:e,onChange:t}){const n=C.useState(e),[r]=n,o=C.useRef(r),i=In(t);return C.useEffect(()=>{o.current!==r&&(i(r),o.current=r)},[r,o,i]),n}var mN="VisuallyHidden",wd=C.forwardRef((e,t)=>S.jsx(je.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}));wd.displayName=mN;var gN=wd,Qv="ToastProvider",[Jv,yN,xN]=lb("Toast"),[pb,IW]=Mu("Toast",[xN]),[wN,bd]=pb(Qv),vb=e=>{const{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:o="right",swipeThreshold:i=50,children:a}=e,[s,u]=C.useState(null),[l,c]=C.useState(0),d=C.useRef(!1),f=C.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${Qv}\`. Expected non-empty \`string\`.`),S.jsx(Jv.Provider,{scope:t,children:S.jsx(wN,{scope:t,label:n,duration:r,swipeDirection:o,swipeThreshold:i,toastCount:l,viewport:s,onViewportChange:u,onToastAdd:C.useCallback(()=>c(h=>h+1),[]),onToastRemove:C.useCallback(()=>c(h=>h-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:f,children:a})})};vb.displayName=Qv;var mb="ToastViewport",bN=["F8"],pp="toast.viewportPause",vp="toast.viewportResume",gb=C.forwardRef((e,t)=>{const{__scopeToast:n,hotkey:r=bN,label:o="Notifications ({hotkey})",...i}=e,a=bd(mb,n),s=yN(n),u=C.useRef(null),l=C.useRef(null),c=C.useRef(null),d=C.useRef(null),f=ft(t,d,a.onViewportChange),h=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=a.toastCount>0;C.useEffect(()=>{const g=m=>{var x;r.length!==0&&r.every(w=>m[w]||m.code===w)&&((x=d.current)==null||x.focus())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[r]),C.useEffect(()=>{const g=u.current,m=d.current;if(p&&g&&m){const y=()=>{if(!a.isClosePausedRef.current){const E=new CustomEvent(pp);m.dispatchEvent(E),a.isClosePausedRef.current=!0}},x=()=>{if(a.isClosePausedRef.current){const E=new CustomEvent(vp);m.dispatchEvent(E),a.isClosePausedRef.current=!1}},w=E=>{!g.contains(E.relatedTarget)&&x()},b=()=>{g.contains(document.activeElement)||x()};return g.addEventListener("focusin",y),g.addEventListener("focusout",w),g.addEventListener("pointermove",y),g.addEventListener("pointerleave",b),window.addEventListener("blur",y),window.addEventListener("focus",x),()=>{g.removeEventListener("focusin",y),g.removeEventListener("focusout",w),g.removeEventListener("pointermove",y),g.removeEventListener("pointerleave",b),window.removeEventListener("blur",y),window.removeEventListener("focus",x)}}},[p,a.isClosePausedRef]);const v=C.useCallback(({tabbingDirection:g})=>{const y=s().map(x=>{const w=x.ref.current,b=[w,...MN(w)];return g==="forwards"?b:b.reverse()});return(g==="forwards"?y.reverse():y).flat()},[s]);return C.useEffect(()=>{const g=d.current;if(g){const m=y=>{var b,E,k;const x=y.altKey||y.ctrlKey||y.metaKey;if(y.key==="Tab"&&!x){const _=document.activeElement,R=y.shiftKey;if(y.target===g&&R){(b=l.current)==null||b.focus();return}const A=v({tabbingDirection:R?"backwards":"forwards"}),j=A.findIndex(F=>F===_);If(A.slice(j+1))?y.preventDefault():R?(E=l.current)==null||E.focus():(k=c.current)==null||k.focus()}};return g.addEventListener("keydown",m),()=>g.removeEventListener("keydown",m)}},[s,v]),S.jsxs(cN,{ref:u,role:"region","aria-label":o.replace("{hotkey}",h),tabIndex:-1,style:{pointerEvents:p?void 0:"none"},children:[p&&S.jsx(mp,{ref:l,onFocusFromOutsideViewport:()=>{const g=v({tabbingDirection:"forwards"});If(g)}}),S.jsx(Jv.Slot,{scope:n,children:S.jsx(je.ol,{tabIndex:-1,...i,ref:f})}),p&&S.jsx(mp,{ref:c,onFocusFromOutsideViewport:()=>{const g=v({tabbingDirection:"backwards"});If(g)}})]})});gb.displayName=mb;var yb="ToastFocusProxy",mp=C.forwardRef((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...o}=e,i=bd(yb,n);return S.jsx(wd,{"aria-hidden":!0,tabIndex:0,...o,ref:t,style:{position:"fixed"},onFocus:a=>{var l;const s=a.relatedTarget;!((l=i.viewport)!=null&&l.contains(s))&&r()}})});mp.displayName=yb;var Cd="Toast",CN="toast.swipeStart",EN="toast.swipeMove",SN="toast.swipeCancel",kN="toast.swipeEnd",xb=C.forwardRef((e,t)=>{const{forceMount:n,open:r,defaultOpen:o,onOpenChange:i,...a}=e,[s=!0,u]=xd({prop:r,defaultProp:o,onChange:i});return S.jsx(as,{present:n||s,children:S.jsx(NN,{open:s,...a,ref:t,onClose:()=>u(!1),onPause:In(e.onPause),onResume:In(e.onResume),onSwipeStart:Pe(e.onSwipeStart,l=>{l.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Pe(e.onSwipeMove,l=>{const{x:c,y:d}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","move"),l.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${c}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:Pe(e.onSwipeCancel,l=>{l.currentTarget.setAttribute("data-swipe","cancel"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Pe(e.onSwipeEnd,l=>{const{x:c,y:d}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","end"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${c}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),u(!1)})})})});xb.displayName=Cd;var[_N,RN]=pb(Cd,{onClose(){}}),NN=C.forwardRef((e,t)=>{const{__scopeToast:n,type:r="foreground",duration:o,open:i,onClose:a,onEscapeKeyDown:s,onPause:u,onResume:l,onSwipeStart:c,onSwipeMove:d,onSwipeCancel:f,onSwipeEnd:h,...p}=e,v=bd(Cd,n),[g,m]=C.useState(null),y=ft(t,F=>m(F)),x=C.useRef(null),w=C.useRef(null),b=o||v.duration,E=C.useRef(0),k=C.useRef(b),_=C.useRef(0),{onToastAdd:R,onToastRemove:N}=v,D=In(()=>{var z;(g==null?void 0:g.contains(document.activeElement))&&((z=v.viewport)==null||z.focus()),a()}),A=C.useCallback(F=>{!F||F===1/0||(window.clearTimeout(_.current),E.current=new Date().getTime(),_.current=window.setTimeout(D,F))},[D]);C.useEffect(()=>{const F=v.viewport;if(F){const z=()=>{A(k.current),l==null||l()},B=()=>{const $=new Date().getTime()-E.current;k.current=k.current-$,window.clearTimeout(_.current),u==null||u()};return F.addEventListener(pp,B),F.addEventListener(vp,z),()=>{F.removeEventListener(pp,B),F.removeEventListener(vp,z)}}},[v.viewport,b,u,l,A]),C.useEffect(()=>{i&&!v.isClosePausedRef.current&&A(b)},[i,b,v.isClosePausedRef,A]),C.useEffect(()=>(R(),()=>N()),[R,N]);const j=C.useMemo(()=>g?_b(g):null,[g]);return v.viewport?S.jsxs(S.Fragment,{children:[j&&S.jsx(IN,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:j}),S.jsx(_N,{scope:n,onClose:D,children:Du.createPortal(S.jsx(Jv.ItemSlot,{scope:n,children:S.jsx(lN,{asChild:!0,onEscapeKeyDown:Pe(s,()=>{v.isFocusedToastEscapeKeyDownRef.current||D(),v.isFocusedToastEscapeKeyDownRef.current=!1}),children:S.jsx(je.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":v.swipeDirection,...p,ref:y,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Pe(e.onKeyDown,F=>{F.key==="Escape"&&(s==null||s(F.nativeEvent),F.nativeEvent.defaultPrevented||(v.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:Pe(e.onPointerDown,F=>{F.button===0&&(x.current={x:F.clientX,y:F.clientY})}),onPointerMove:Pe(e.onPointerMove,F=>{if(!x.current)return;const z=F.clientX-x.current.x,B=F.clientY-x.current.y,$=!!w.current,P=["left","right"].includes(v.swipeDirection),L=["left","up"].includes(v.swipeDirection)?Math.min:Math.max,W=P?L(0,z):0,H=P?0:L(0,B),q=F.pointerType==="touch"?10:2,Q={x:W,y:H},re={originalEvent:F,delta:Q};$?(w.current=Q,yl(EN,d,re,{discrete:!1})):W0(Q,v.swipeDirection,q)?(w.current=Q,yl(CN,c,re,{discrete:!1}),F.target.setPointerCapture(F.pointerId)):(Math.abs(z)>q||Math.abs(B)>q)&&(x.current=null)}),onPointerUp:Pe(e.onPointerUp,F=>{const z=w.current,B=F.target;if(B.hasPointerCapture(F.pointerId)&&B.releasePointerCapture(F.pointerId),w.current=null,x.current=null,z){const $=F.currentTarget,P={originalEvent:F,delta:z};W0(z,v.swipeDirection,v.swipeThreshold)?yl(kN,h,P,{discrete:!0}):yl(SN,f,P,{discrete:!0}),$.addEventListener("click",L=>L.preventDefault(),{once:!0})}})})})}),v.viewport)})]}):null}),IN=e=>{const{__scopeToast:t,children:n,...r}=e,o=bd(Cd,t),[i,a]=C.useState(!1),[s,u]=C.useState(!1);return PN(()=>a(!0)),C.useEffect(()=>{const l=window.setTimeout(()=>u(!0),1e3);return()=>window.clearTimeout(l)},[]),s?null:S.jsx(Yv,{asChild:!0,children:S.jsx(wd,{...r,children:i&&S.jsxs(S.Fragment,{children:[o.label," ",n]})})})},TN="ToastTitle",wb=C.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e;return S.jsx(je.div,{...r,ref:t})});wb.displayName=TN;var AN="ToastDescription",bb=C.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e;return S.jsx(je.div,{...r,ref:t})});bb.displayName=AN;var Cb="ToastAction",Eb=C.forwardRef((e,t)=>{const{altText:n,...r}=e;return n.trim()?S.jsx(kb,{altText:n,asChild:!0,children:S.jsx(Zv,{...r,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${Cb}\`. Expected non-empty \`string\`.`),null)});Eb.displayName=Cb;var Sb="ToastClose",Zv=C.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e,o=RN(Sb,n);return S.jsx(kb,{asChild:!0,children:S.jsx(je.button,{type:"button",...r,ref:t,onClick:Pe(e.onClick,o.onClose)})})});Zv.displayName=Sb;var kb=C.forwardRef((e,t)=>{const{__scopeToast:n,altText:r,...o}=e;return S.jsx(je.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...o,ref:t})});function _b(e){const t=[];return Array.from(e.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&t.push(r.textContent),DN(r)){const o=r.ariaHidden||r.hidden||r.style.display==="none",i=r.dataset.radixToastAnnounceExclude==="";if(!o)if(i){const a=r.dataset.radixToastAnnounceAlt;a&&t.push(a)}else t.push(..._b(r))}}),t}function yl(e,t,n,{discrete:r}){const o=n.originalEvent.currentTarget,i=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?cb(o,i):o.dispatchEvent(i)}var W0=(e,t,n=0)=>{const r=Math.abs(e.x),o=Math.abs(e.y),i=r>o;return t==="left"||t==="right"?i&&r>n:!i&&o>n};function PN(e=()=>{}){const t=In(e);Ar(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[t])}function DN(e){return e.nodeType===e.ELEMENT_NODE}function MN(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function If(e){const t=document.activeElement;return e.some(n=>n===t?!0:(n.focus(),document.activeElement!==t))}var FN=vb,Rb=gb,Nb=xb,Ib=wb,Tb=bb,Ab=Eb,Pb=Zv;function Db(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=Db(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function Mb(){for(var e,t,n=0,r="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=Db(e))&&(r&&(r+=" "),r+=t);return r}const $0=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,U0=Mb,Fu=(e,t)=>n=>{var r;if((t==null?void 0:t.variants)==null)return U0(e,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:o,defaultVariants:i}=t,a=Object.keys(o).map(l=>{const c=n==null?void 0:n[l],d=i==null?void 0:i[l];if(c===null)return null;const f=$0(c)||$0(d);return o[l][f]}),s=n&&Object.entries(n).reduce((l,c)=>{let[d,f]=c;return f===void 0||(l[d]=f),l},{}),u=t==null||(r=t.compoundVariants)===null||r===void 0?void 0:r.reduce((l,c)=>{let{class:d,className:f,...h}=c;return Object.entries(h).every(p=>{let[v,g]=p;return Array.isArray(g)?g.includes({...i,...s}[v]):{...i,...s}[v]===g})?[...l,d,f]:l},[]);return U0(e,a,u,n==null?void 0:n.class,n==null?void 0:n.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ON=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Fb=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var LN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BN=C.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:o="",children:i,iconNode:a,...s},u)=>C.createElement("svg",{ref:u,...LN,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:Fb("lucide",o),...s},[...a.map(([l,c])=>C.createElement(l,c)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=(e,t)=>{const n=C.forwardRef(({className:r,...o},i)=>C.createElement(BN,{ref:i,iconNode:t,className:Fb(`lucide-${ON(e)}`,r),...o}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jN=at("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zN=at("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WN=at("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $N=at("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=at("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V0=at("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=at("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gp=at("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=at("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GN=at("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=at("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ob=at("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G0=at("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lb=at("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0=at("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qN=at("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KN=at("Volume1",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bb=at("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jb=at("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XN=at("Volume",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ed=at("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sd=at("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),em="-",YN=e=>{const t=JN(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:a=>{const s=a.split(em);return s[0]===""&&s.length!==1&&s.shift(),zb(s,t)||QN(a)},getConflictingClassGroupIds:(a,s)=>{const u=n[a]||[];return s&&r[a]?[...u,...r[a]]:u}}},zb=(e,t)=>{var a;if(e.length===0)return t.classGroupId;const n=e[0],r=t.nextPart.get(n),o=r?zb(e.slice(1),r):void 0;if(o)return o;if(t.validators.length===0)return;const i=e.join(em);return(a=t.validators.find(({validator:s})=>s(i)))==null?void 0:a.classGroupId},K0=/^\[(.+)\]$/,QN=e=>{if(K0.test(e)){const t=K0.exec(e)[1],n=t==null?void 0:t.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},JN=e=>{const{theme:t,prefix:n}=e,r={nextPart:new Map,validators:[]};return eI(Object.entries(e.classGroups),n).forEach(([i,a])=>{yp(a,r,i,t)}),r},yp=(e,t,n,r)=>{e.forEach(o=>{if(typeof o=="string"){const i=o===""?t:X0(t,o);i.classGroupId=n;return}if(typeof o=="function"){if(ZN(o)){yp(o(r),t,n,r);return}t.validators.push({validator:o,classGroupId:n});return}Object.entries(o).forEach(([i,a])=>{yp(a,X0(t,i),n,r)})})},X0=(e,t)=>{let n=e;return t.split(em).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},ZN=e=>e.isThemeGetter,eI=(e,t)=>t?e.map(([n,r])=>{const o=r.map(i=>typeof i=="string"?t+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([a,s])=>[t+a,s])):i);return[n,o]}):e,tI=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,r=new Map;const o=(i,a)=>{n.set(i,a),t++,t>e&&(t=0,r=n,n=new Map)};return{get(i){let a=n.get(i);if(a!==void 0)return a;if((a=r.get(i))!==void 0)return o(i,a),a},set(i,a){n.has(i)?n.set(i,a):o(i,a)}}},Wb="!",nI=e=>{const{separator:t,experimentalParseClassName:n}=e,r=t.length===1,o=t[0],i=t.length,a=s=>{const u=[];let l=0,c=0,d;for(let g=0;g<s.length;g++){let m=s[g];if(l===0){if(m===o&&(r||s.slice(g,g+i)===t)){u.push(s.slice(c,g)),c=g+i;continue}if(m==="/"){d=g;continue}}m==="["?l++:m==="]"&&l--}const f=u.length===0?s:s.substring(c),h=f.startsWith(Wb),p=h?f.substring(1):f,v=d&&d>c?d-c:void 0;return{modifiers:u,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:v}};return n?s=>n({className:s,parseClassName:a}):a},rI=e=>{if(e.length<=1)return e;const t=[];let n=[];return e.forEach(r=>{r[0]==="["?(t.push(...n.sort(),r),n=[]):n.push(r)}),t.push(...n.sort()),t},oI=e=>({cache:tI(e.cacheSize),parseClassName:nI(e),...YN(e)}),iI=/\s+/,aI=(e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:o}=t,i=[],a=e.trim().split(iI);let s="";for(let u=a.length-1;u>=0;u-=1){const l=a[u],{modifiers:c,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:h}=n(l);let p=!!h,v=r(p?f.substring(0,h):f);if(!v){if(!p){s=l+(s.length>0?" "+s:s);continue}if(v=r(f),!v){s=l+(s.length>0?" "+s:s);continue}p=!1}const g=rI(c).join(":"),m=d?g+Wb:g,y=m+v;if(i.includes(y))continue;i.push(y);const x=o(v,p);for(let w=0;w<x.length;++w){const b=x[w];i.push(m+b)}s=l+(s.length>0?" "+s:s)}return s};function sI(){let e=0,t,n,r="";for(;e<arguments.length;)(t=arguments[e++])&&(n=$b(t))&&(r&&(r+=" "),r+=n);return r}const $b=e=>{if(typeof e=="string")return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=$b(e[r]))&&(n&&(n+=" "),n+=t);return n};function uI(e,...t){let n,r,o,i=a;function a(u){const l=t.reduce((c,d)=>d(c),e());return n=oI(l),r=n.cache.get,o=n.cache.set,i=s,s(u)}function s(u){const l=r(u);if(l)return l;const c=aI(u,n);return o(u,c),c}return function(){return i(sI.apply(null,arguments))}}const Ge=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},Ub=/^\[(?:([a-z-]+):)?(.+)\]$/i,lI=/^\d+\/\d+$/,cI=new Set(["px","full","screen"]),dI=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,fI=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,hI=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,pI=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,vI=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,jr=e=>Sa(e)||cI.has(e)||lI.test(e),po=e=>ss(e,"length",EI),Sa=e=>!!e&&!Number.isNaN(Number(e)),Tf=e=>ss(e,"number",Sa),Es=e=>!!e&&Number.isInteger(Number(e)),mI=e=>e.endsWith("%")&&Sa(e.slice(0,-1)),ye=e=>Ub.test(e),vo=e=>dI.test(e),gI=new Set(["length","size","percentage"]),yI=e=>ss(e,gI,Vb),xI=e=>ss(e,"position",Vb),wI=new Set(["image","url"]),bI=e=>ss(e,wI,kI),CI=e=>ss(e,"",SI),Ss=()=>!0,ss=(e,t,n)=>{const r=Ub.exec(e);return r?r[1]?typeof t=="string"?r[1]===t:t.has(r[1]):n(r[2]):!1},EI=e=>fI.test(e)&&!hI.test(e),Vb=()=>!1,SI=e=>pI.test(e),kI=e=>vI.test(e),_I=()=>{const e=Ge("colors"),t=Ge("spacing"),n=Ge("blur"),r=Ge("brightness"),o=Ge("borderColor"),i=Ge("borderRadius"),a=Ge("borderSpacing"),s=Ge("borderWidth"),u=Ge("contrast"),l=Ge("grayscale"),c=Ge("hueRotate"),d=Ge("invert"),f=Ge("gap"),h=Ge("gradientColorStops"),p=Ge("gradientColorStopPositions"),v=Ge("inset"),g=Ge("margin"),m=Ge("opacity"),y=Ge("padding"),x=Ge("saturate"),w=Ge("scale"),b=Ge("sepia"),E=Ge("skew"),k=Ge("space"),_=Ge("translate"),R=()=>["auto","contain","none"],N=()=>["auto","hidden","clip","visible","scroll"],D=()=>["auto",ye,t],A=()=>[ye,t],j=()=>["",jr,po],F=()=>["auto",Sa,ye],z=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],B=()=>["solid","dashed","dotted","double","none"],$=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],P=()=>["start","end","center","between","around","evenly","stretch"],L=()=>["","0",ye],W=()=>["auto","avoid","all","avoid-page","page","left","right","column"],H=()=>[Sa,ye];return{cacheSize:500,separator:":",theme:{colors:[Ss],spacing:[jr,po],blur:["none","",vo,ye],brightness:H(),borderColor:[e],borderRadius:["none","","full",vo,ye],borderSpacing:A(),borderWidth:j(),contrast:H(),grayscale:L(),hueRotate:H(),invert:L(),gap:A(),gradientColorStops:[e],gradientColorStopPositions:[mI,po],inset:D(),margin:D(),opacity:H(),padding:A(),saturate:H(),scale:H(),sepia:L(),skew:H(),space:A(),translate:A()},classGroups:{aspect:[{aspect:["auto","square","video",ye]}],container:["container"],columns:[{columns:[vo]}],"break-after":[{"break-after":W()}],"break-before":[{"break-before":W()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...z(),ye]}],overflow:[{overflow:N()}],"overflow-x":[{"overflow-x":N()}],"overflow-y":[{"overflow-y":N()}],overscroll:[{overscroll:R()}],"overscroll-x":[{"overscroll-x":R()}],"overscroll-y":[{"overscroll-y":R()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[v]}],"inset-x":[{"inset-x":[v]}],"inset-y":[{"inset-y":[v]}],start:[{start:[v]}],end:[{end:[v]}],top:[{top:[v]}],right:[{right:[v]}],bottom:[{bottom:[v]}],left:[{left:[v]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Es,ye]}],basis:[{basis:D()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ye]}],grow:[{grow:L()}],shrink:[{shrink:L()}],order:[{order:["first","last","none",Es,ye]}],"grid-cols":[{"grid-cols":[Ss]}],"col-start-end":[{col:["auto",{span:["full",Es,ye]},ye]}],"col-start":[{"col-start":F()}],"col-end":[{"col-end":F()}],"grid-rows":[{"grid-rows":[Ss]}],"row-start-end":[{row:["auto",{span:[Es,ye]},ye]}],"row-start":[{"row-start":F()}],"row-end":[{"row-end":F()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ye]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ye]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...P()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...P(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...P(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[g]}],mx:[{mx:[g]}],my:[{my:[g]}],ms:[{ms:[g]}],me:[{me:[g]}],mt:[{mt:[g]}],mr:[{mr:[g]}],mb:[{mb:[g]}],ml:[{ml:[g]}],"space-x":[{"space-x":[k]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[k]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ye,t]}],"min-w":[{"min-w":[ye,t,"min","max","fit"]}],"max-w":[{"max-w":[ye,t,"none","full","min","max","fit","prose",{screen:[vo]},vo]}],h:[{h:[ye,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ye,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ye,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ye,t,"auto","min","max","fit"]}],"font-size":[{text:["base",vo,po]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Tf]}],"font-family":[{font:[Ss]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ye]}],"line-clamp":[{"line-clamp":["none",Sa,Tf]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",jr,ye]}],"list-image":[{"list-image":["none",ye]}],"list-style-type":[{list:["none","disc","decimal",ye]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[m]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[m]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...B(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",jr,po]}],"underline-offset":[{"underline-offset":["auto",jr,ye]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:A()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ye]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ye]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[m]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...z(),xI]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",yI]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},bI]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[p]}],"gradient-via-pos":[{via:[p]}],"gradient-to-pos":[{to:[p]}],"gradient-from":[{from:[h]}],"gradient-via":[{via:[h]}],"gradient-to":[{to:[h]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[s]}],"border-w-x":[{"border-x":[s]}],"border-w-y":[{"border-y":[s]}],"border-w-s":[{"border-s":[s]}],"border-w-e":[{"border-e":[s]}],"border-w-t":[{"border-t":[s]}],"border-w-r":[{"border-r":[s]}],"border-w-b":[{"border-b":[s]}],"border-w-l":[{"border-l":[s]}],"border-opacity":[{"border-opacity":[m]}],"border-style":[{border:[...B(),"hidden"]}],"divide-x":[{"divide-x":[s]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[s]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[m]}],"divide-style":[{divide:B()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...B()]}],"outline-offset":[{"outline-offset":[jr,ye]}],"outline-w":[{outline:[jr,po]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:j()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[m]}],"ring-offset-w":[{"ring-offset":[jr,po]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",vo,CI]}],"shadow-color":[{shadow:[Ss]}],opacity:[{opacity:[m]}],"mix-blend":[{"mix-blend":[...$(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":$()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",vo,ye]}],grayscale:[{grayscale:[l]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[d]}],saturate:[{saturate:[x]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[l]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[m]}],"backdrop-saturate":[{"backdrop-saturate":[x]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ye]}],duration:[{duration:H()}],ease:[{ease:["linear","in","out","in-out",ye]}],delay:[{delay:H()}],animate:[{animate:["none","spin","ping","pulse","bounce",ye]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Es,ye]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[E]}],"skew-y":[{"skew-y":[E]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ye]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ye]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":A()}],"scroll-mx":[{"scroll-mx":A()}],"scroll-my":[{"scroll-my":A()}],"scroll-ms":[{"scroll-ms":A()}],"scroll-me":[{"scroll-me":A()}],"scroll-mt":[{"scroll-mt":A()}],"scroll-mr":[{"scroll-mr":A()}],"scroll-mb":[{"scroll-mb":A()}],"scroll-ml":[{"scroll-ml":A()}],"scroll-p":[{"scroll-p":A()}],"scroll-px":[{"scroll-px":A()}],"scroll-py":[{"scroll-py":A()}],"scroll-ps":[{"scroll-ps":A()}],"scroll-pe":[{"scroll-pe":A()}],"scroll-pt":[{"scroll-pt":A()}],"scroll-pr":[{"scroll-pr":A()}],"scroll-pb":[{"scroll-pb":A()}],"scroll-pl":[{"scroll-pl":A()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ye]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[jr,po,Tf]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},RI=uI(_I);function Ve(...e){return RI(Mb(e))}var Y0=["light","dark"],NI="(prefers-color-scheme: dark)",II=C.createContext(void 0),TI={setTheme:e=>{},themes:[]},AI=()=>{var e;return(e=C.useContext(II))!=null?e:TI};C.memo(({forcedTheme:e,storageKey:t,attribute:n,enableSystem:r,enableColorScheme:o,defaultTheme:i,value:a,attrs:s,nonce:u})=>{let l=i==="system",c=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${s.map(p=>`'${p}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,d=o?Y0.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",f=(p,v=!1,g=!0)=>{let m=a?a[p]:p,y=v?p+"|| ''":`'${m}'`,x="";return o&&g&&!v&&Y0.includes(p)&&(x+=`d.style.colorScheme = '${p}';`),n==="class"?v||m?x+=`c.add(${y})`:x+="null":m&&(x+=`d[s](n,${y})`),x},h=e?`!function(){${c}${f(e)}}()`:r?`!function(){try{${c}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${l})){var t='${NI}',m=window.matchMedia(t);if(m.media!==t||m.matches){${f("dark")}}else{${f("light")}}}else if(e){${a?`var x=${JSON.stringify(a)};`:""}${f(a?"x[e]":"e",!0)}}${l?"":"else{"+f(i,!1,!1)+"}"}${d}}catch(e){}}()`:`!function(){try{${c}var e=localStorage.getItem('${t}');if(e){${a?`var x=${JSON.stringify(a)};`:""}${f(a?"x[e]":"e",!0)}}else{${f(i,!1,!1)};}${d}}catch(t){}}();`;return C.createElement("script",{nonce:u,dangerouslySetInnerHTML:{__html:h}})});var PI=e=>{switch(e){case"success":return FI;case"info":return LI;case"warning":return OI;case"error":return BI;default:return null}},DI=Array(12).fill(0),MI=({visible:e})=>J.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},J.createElement("div",{className:"sonner-spinner"},DI.map((t,n)=>J.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),FI=J.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},J.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),OI=J.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},J.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),LI=J.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},J.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),BI=J.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},J.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),jI=()=>{let[e,t]=J.useState(document.hidden);return J.useEffect(()=>{let n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e},xp=1,zI=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let n=this.subscribers.indexOf(t);this.subscribers.splice(n,1)}),this.publish=t=>{this.subscribers.forEach(n=>n(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var n;let{message:r,...o}=t,i=typeof(t==null?void 0:t.id)=="number"||((n=t.id)==null?void 0:n.length)>0?t.id:xp++,a=this.toasts.find(u=>u.id===i),s=t.dismissible===void 0?!0:t.dismissible;return a?this.toasts=this.toasts.map(u=>u.id===i?(this.publish({...u,...t,id:i,title:r}),{...u,...t,id:i,dismissible:s,title:r}):u):this.addToast({title:r,...o,dismissible:s,id:i}),i},this.dismiss=t=>(t||this.toasts.forEach(n=>{this.subscribers.forEach(r=>r({id:n.id,dismiss:!0}))}),this.subscribers.forEach(n=>n({id:t,dismiss:!0})),t),this.message=(t,n)=>this.create({...n,message:t}),this.error=(t,n)=>this.create({...n,message:t,type:"error"}),this.success=(t,n)=>this.create({...n,type:"success",message:t}),this.info=(t,n)=>this.create({...n,type:"info",message:t}),this.warning=(t,n)=>this.create({...n,type:"warning",message:t}),this.loading=(t,n)=>this.create({...n,type:"loading",message:t}),this.promise=(t,n)=>{if(!n)return;let r;n.loading!==void 0&&(r=this.create({...n,promise:t,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));let o=t instanceof Promise?t:t(),i=r!==void 0;return o.then(async a=>{if($I(a)&&!a.ok){i=!1;let s=typeof n.error=="function"?await n.error(`HTTP error! status: ${a.status}`):n.error,u=typeof n.description=="function"?await n.description(`HTTP error! status: ${a.status}`):n.description;this.create({id:r,type:"error",message:s,description:u})}else if(n.success!==void 0){i=!1;let s=typeof n.success=="function"?await n.success(a):n.success,u=typeof n.description=="function"?await n.description(a):n.description;this.create({id:r,type:"success",message:s,description:u})}}).catch(async a=>{if(n.error!==void 0){i=!1;let s=typeof n.error=="function"?await n.error(a):n.error,u=typeof n.description=="function"?await n.description(a):n.description;this.create({id:r,type:"error",message:s,description:u})}}).finally(()=>{var a;i&&(this.dismiss(r),r=void 0),(a=n.finally)==null||a.call(n)}),r},this.custom=(t,n)=>{let r=(n==null?void 0:n.id)||xp++;return this.create({jsx:t(r),id:r,...n}),r},this.subscribers=[],this.toasts=[]}},mn=new zI,WI=(e,t)=>{let n=(t==null?void 0:t.id)||xp++;return mn.addToast({title:e,...t,id:n}),n},$I=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",UI=WI,VI=()=>mn.toasts,HI=Object.assign(UI,{success:mn.success,info:mn.info,warning:mn.warning,error:mn.error,custom:mn.custom,message:mn.message,promise:mn.promise,dismiss:mn.dismiss,loading:mn.loading},{getHistory:VI});function GI(e,{insertAt:t}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}GI(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function xl(e){return e.label!==void 0}var qI=3,KI="32px",XI=4e3,YI=356,QI=14,JI=20,ZI=200;function eT(...e){return e.filter(Boolean).join(" ")}var tT=e=>{var t,n,r,o,i,a,s,u,l,c;let{invert:d,toast:f,unstyled:h,interacting:p,setHeights:v,visibleToasts:g,heights:m,index:y,toasts:x,expanded:w,removeToast:b,defaultRichColors:E,closeButton:k,style:_,cancelButtonStyle:R,actionButtonStyle:N,className:D="",descriptionClassName:A="",duration:j,position:F,gap:z,loadingIcon:B,expandByDefault:$,classNames:P,icons:L,closeButtonAriaLabel:W="Close toast",pauseWhenPageIsHidden:H,cn:q}=e,[Q,re]=J.useState(!1),[ce,ee]=J.useState(!1),[de,pe]=J.useState(!1),[me,De]=J.useState(!1),[we,_e]=J.useState(0),[Ce,Le]=J.useState(0),Be=J.useRef(null),Ie=J.useRef(null),Qt=y===0,Jt=y+1<=g,Ae=f.type,fn=f.dismissible!==!1,Hn=f.className||"",lr=f.descriptionClassName||"",Zt=J.useMemo(()=>m.findIndex(ge=>ge.toastId===f.id)||0,[m,f.id]),lo=J.useMemo(()=>{var ge;return(ge=f.closeButton)!=null?ge:k},[f.closeButton,k]),Dn=J.useMemo(()=>f.duration||j||XI,[f.duration,j]),ai=J.useRef(0),hn=J.useRef(0),pn=J.useRef(0),cr=J.useRef(null),[Yu,ef]=F.split("-"),Qu=J.useMemo(()=>m.reduce((ge,He,We)=>We>=Zt?ge:ge+He.height,0),[m,Zt]),qi=jI(),ps=f.invert||d,si=Ae==="loading";hn.current=J.useMemo(()=>Zt*z+Qu,[Zt,Qu]),J.useEffect(()=>{re(!0)},[]),J.useLayoutEffect(()=>{if(!Q)return;let ge=Ie.current,He=ge.style.height;ge.style.height="auto";let We=ge.getBoundingClientRect().height;ge.style.height=He,Le(We),v(dr=>dr.find(fr=>fr.toastId===f.id)?dr.map(fr=>fr.toastId===f.id?{...fr,height:We}:fr):[{toastId:f.id,height:We,position:f.position},...dr])},[Q,f.title,f.description,v,f.id]);let co=J.useCallback(()=>{ee(!0),_e(hn.current),v(ge=>ge.filter(He=>He.toastId!==f.id)),setTimeout(()=>{b(f)},ZI)},[f,b,v,hn]);J.useEffect(()=>{if(f.promise&&Ae==="loading"||f.duration===1/0||f.type==="loading")return;let ge,He=Dn;return w||p||H&&qi?(()=>{if(pn.current<ai.current){let We=new Date().getTime()-ai.current;He=He-We}pn.current=new Date().getTime()})():He!==1/0&&(ai.current=new Date().getTime(),ge=setTimeout(()=>{var We;(We=f.onAutoClose)==null||We.call(f,f),co()},He)),()=>clearTimeout(ge)},[w,p,$,f,Dn,co,f.promise,Ae,H,qi]),J.useEffect(()=>{let ge=Ie.current;if(ge){let He=ge.getBoundingClientRect().height;return Le(He),v(We=>[{toastId:f.id,height:He,position:f.position},...We]),()=>v(We=>We.filter(dr=>dr.toastId!==f.id))}},[v,f.id]),J.useEffect(()=>{f.delete&&co()},[co,f.delete]);function mk(){return L!=null&&L.loading?J.createElement("div",{className:"sonner-loader","data-visible":Ae==="loading"},L.loading):B?J.createElement("div",{className:"sonner-loader","data-visible":Ae==="loading"},B):J.createElement(MI,{visible:Ae==="loading"})}return J.createElement("li",{"aria-live":f.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:Ie,className:q(D,Hn,P==null?void 0:P.toast,(t=f==null?void 0:f.classNames)==null?void 0:t.toast,P==null?void 0:P.default,P==null?void 0:P[Ae],(n=f==null?void 0:f.classNames)==null?void 0:n[Ae]),"data-sonner-toast":"","data-rich-colors":(r=f.richColors)!=null?r:E,"data-styled":!(f.jsx||f.unstyled||h),"data-mounted":Q,"data-promise":!!f.promise,"data-removed":ce,"data-visible":Jt,"data-y-position":Yu,"data-x-position":ef,"data-index":y,"data-front":Qt,"data-swiping":de,"data-dismissible":fn,"data-type":Ae,"data-invert":ps,"data-swipe-out":me,"data-expanded":!!(w||$&&Q),style:{"--index":y,"--toasts-before":y,"--z-index":x.length-y,"--offset":`${ce?we:hn.current}px`,"--initial-height":$?"auto":`${Ce}px`,..._,...f.style},onPointerDown:ge=>{si||!fn||(Be.current=new Date,_e(hn.current),ge.target.setPointerCapture(ge.pointerId),ge.target.tagName!=="BUTTON"&&(pe(!0),cr.current={x:ge.clientX,y:ge.clientY}))},onPointerUp:()=>{var ge,He,We,dr;if(me||!fn)return;cr.current=null;let fr=Number(((ge=Ie.current)==null?void 0:ge.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Ju=new Date().getTime()-((He=Be.current)==null?void 0:He.getTime()),gk=Math.abs(fr)/Ju;if(Math.abs(fr)>=JI||gk>.11){_e(hn.current),(We=f.onDismiss)==null||We.call(f,f),co(),De(!0);return}(dr=Ie.current)==null||dr.style.setProperty("--swipe-amount","0px"),pe(!1)},onPointerMove:ge=>{var He;if(!cr.current||!fn)return;let We=ge.clientY-cr.current.y,dr=ge.clientX-cr.current.x,fr=(Yu==="top"?Math.min:Math.max)(0,We),Ju=ge.pointerType==="touch"?10:2;Math.abs(fr)>Ju?(He=Ie.current)==null||He.style.setProperty("--swipe-amount",`${We}px`):Math.abs(dr)>Ju&&(cr.current=null)}},lo&&!f.jsx?J.createElement("button",{"aria-label":W,"data-disabled":si,"data-close-button":!0,onClick:si||!fn?()=>{}:()=>{var ge;co(),(ge=f.onDismiss)==null||ge.call(f,f)},className:q(P==null?void 0:P.closeButton,(o=f==null?void 0:f.classNames)==null?void 0:o.closeButton)},J.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},J.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),J.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,f.jsx||J.isValidElement(f.title)?f.jsx||f.title:J.createElement(J.Fragment,null,Ae||f.icon||f.promise?J.createElement("div",{"data-icon":"",className:q(P==null?void 0:P.icon,(i=f==null?void 0:f.classNames)==null?void 0:i.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||mk():null,f.type!=="loading"?f.icon||(L==null?void 0:L[Ae])||PI(Ae):null):null,J.createElement("div",{"data-content":"",className:q(P==null?void 0:P.content,(a=f==null?void 0:f.classNames)==null?void 0:a.content)},J.createElement("div",{"data-title":"",className:q(P==null?void 0:P.title,(s=f==null?void 0:f.classNames)==null?void 0:s.title)},f.title),f.description?J.createElement("div",{"data-description":"",className:q(A,lr,P==null?void 0:P.description,(u=f==null?void 0:f.classNames)==null?void 0:u.description)},f.description):null),J.isValidElement(f.cancel)?f.cancel:f.cancel&&xl(f.cancel)?J.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||R,onClick:ge=>{var He,We;xl(f.cancel)&&fn&&((We=(He=f.cancel).onClick)==null||We.call(He,ge),co())},className:q(P==null?void 0:P.cancelButton,(l=f==null?void 0:f.classNames)==null?void 0:l.cancelButton)},f.cancel.label):null,J.isValidElement(f.action)?f.action:f.action&&xl(f.action)?J.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||N,onClick:ge=>{var He,We;xl(f.action)&&(ge.defaultPrevented||((We=(He=f.action).onClick)==null||We.call(He,ge),co()))},className:q(P==null?void 0:P.actionButton,(c=f==null?void 0:f.classNames)==null?void 0:c.actionButton)},f.action.label):null))};function Q0(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}var nT=e=>{let{invert:t,position:n="bottom-right",hotkey:r=["altKey","KeyT"],expand:o,closeButton:i,className:a,offset:s,theme:u="light",richColors:l,duration:c,style:d,visibleToasts:f=qI,toastOptions:h,dir:p=Q0(),gap:v=QI,loadingIcon:g,icons:m,containerAriaLabel:y="Notifications",pauseWhenPageIsHidden:x,cn:w=eT}=e,[b,E]=J.useState([]),k=J.useMemo(()=>Array.from(new Set([n].concat(b.filter(H=>H.position).map(H=>H.position)))),[b,n]),[_,R]=J.useState([]),[N,D]=J.useState(!1),[A,j]=J.useState(!1),[F,z]=J.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),B=J.useRef(null),$=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),P=J.useRef(null),L=J.useRef(!1),W=J.useCallback(H=>{var q;(q=b.find(Q=>Q.id===H.id))!=null&&q.delete||mn.dismiss(H.id),E(Q=>Q.filter(({id:re})=>re!==H.id))},[b]);return J.useEffect(()=>mn.subscribe(H=>{if(H.dismiss){E(q=>q.map(Q=>Q.id===H.id?{...Q,delete:!0}:Q));return}setTimeout(()=>{ib.flushSync(()=>{E(q=>{let Q=q.findIndex(re=>re.id===H.id);return Q!==-1?[...q.slice(0,Q),{...q[Q],...H},...q.slice(Q+1)]:[H,...q]})})})}),[]),J.useEffect(()=>{if(u!=="system"){z(u);return}u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?z("dark"):z("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:H})=>{z(H?"dark":"light")})},[u]),J.useEffect(()=>{b.length<=1&&D(!1)},[b]),J.useEffect(()=>{let H=q=>{var Q,re;r.every(ce=>q[ce]||q.code===ce)&&(D(!0),(Q=B.current)==null||Q.focus()),q.code==="Escape"&&(document.activeElement===B.current||(re=B.current)!=null&&re.contains(document.activeElement))&&D(!1)};return document.addEventListener("keydown",H),()=>document.removeEventListener("keydown",H)},[r]),J.useEffect(()=>{if(B.current)return()=>{P.current&&(P.current.focus({preventScroll:!0}),P.current=null,L.current=!1)}},[B.current]),b.length?J.createElement("section",{"aria-label":`${y} ${$}`,tabIndex:-1},k.map((H,q)=>{var Q;let[re,ce]=H.split("-");return J.createElement("ol",{key:H,dir:p==="auto"?Q0():p,tabIndex:-1,ref:B,className:a,"data-sonner-toaster":!0,"data-theme":F,"data-y-position":re,"data-x-position":ce,style:{"--front-toast-height":`${((Q=_[0])==null?void 0:Q.height)||0}px`,"--offset":typeof s=="number"?`${s}px`:s||KI,"--width":`${YI}px`,"--gap":`${v}px`,...d},onBlur:ee=>{L.current&&!ee.currentTarget.contains(ee.relatedTarget)&&(L.current=!1,P.current&&(P.current.focus({preventScroll:!0}),P.current=null))},onFocus:ee=>{ee.target instanceof HTMLElement&&ee.target.dataset.dismissible==="false"||L.current||(L.current=!0,P.current=ee.relatedTarget)},onMouseEnter:()=>D(!0),onMouseMove:()=>D(!0),onMouseLeave:()=>{A||D(!1)},onPointerDown:ee=>{ee.target instanceof HTMLElement&&ee.target.dataset.dismissible==="false"||j(!0)},onPointerUp:()=>j(!1)},b.filter(ee=>!ee.position&&q===0||ee.position===H).map((ee,de)=>{var pe,me;return J.createElement(tT,{key:ee.id,icons:m,index:de,toast:ee,defaultRichColors:l,duration:(pe=h==null?void 0:h.duration)!=null?pe:c,className:h==null?void 0:h.className,descriptionClassName:h==null?void 0:h.descriptionClassName,invert:t,visibleToasts:f,closeButton:(me=h==null?void 0:h.closeButton)!=null?me:i,interacting:A,position:H,style:h==null?void 0:h.style,unstyled:h==null?void 0:h.unstyled,classNames:h==null?void 0:h.classNames,cancelButtonStyle:h==null?void 0:h.cancelButtonStyle,actionButtonStyle:h==null?void 0:h.actionButtonStyle,removeToast:W,toasts:b.filter(De=>De.position==ee.position),heights:_.filter(De=>De.position==ee.position),setHeights:R,expandByDefault:o,gap:v,loadingIcon:g,expanded:N,pauseWhenPageIsHidden:x,cn:w})}))})):null};const rT=FN,oT=C.forwardRef(({className:e,...t},n)=>S.jsx(Rb,{ref:n,className:Ve("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:right-0 sm:top-0 sm:flex-col md:max-w-[420px]",e),...t}));oT.displayName=Rb.displayName;const iT=Fu("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),aT=C.forwardRef(({className:e,variant:t,...n},r)=>S.jsx(Nb,{ref:r,className:Ve(iT({variant:t}),e),...n}));aT.displayName=Nb.displayName;const sT=C.forwardRef(({className:e,...t},n)=>S.jsx(Ab,{ref:n,className:Ve("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));sT.displayName=Ab.displayName;const uT=C.forwardRef(({className:e,...t},n)=>S.jsx(Pb,{ref:n,className:Ve("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:S.jsx(Sd,{className:"h-4 w-4"})}));uT.displayName=Pb.displayName;const lT=C.forwardRef(({className:e,...t},n)=>S.jsx(Ib,{ref:n,className:Ve("text-sm font-semibold",e),...t}));lT.displayName=Ib.displayName;const cT=C.forwardRef(({className:e,...t},n)=>S.jsx(Tb,{ref:n,className:Ve("text-sm opacity-90",e),...t}));cT.displayName=Tb.displayName;function dT({...e}){const{theme:t="system"}=AI();return S.jsx(nT,{theme:t,className:"toaster group",position:"top-right",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})}var fT=nx.useId||(()=>{}),hT=0;function Af(e){const[t,n]=C.useState(fT());return Ar(()=>{e||n(r=>r??String(hT++))},[e]),e||(t?`radix-${t}`:"")}const pT=["top","right","bottom","left"],Xo=Math.min,xn=Math.max,_c=Math.round,wl=Math.floor,Yo=e=>({x:e,y:e}),vT={left:"right",right:"left",bottom:"top",top:"bottom"},mT={start:"end",end:"start"};function wp(e,t,n){return xn(e,Xo(t,n))}function Zr(e,t){return typeof e=="function"?e(t):e}function eo(e){return e.split("-")[0]}function us(e){return e.split("-")[1]}function tm(e){return e==="x"?"y":"x"}function nm(e){return e==="y"?"height":"width"}function Qo(e){return["top","bottom"].includes(eo(e))?"y":"x"}function rm(e){return tm(Qo(e))}function gT(e,t,n){n===void 0&&(n=!1);const r=us(e),o=rm(e),i=nm(o);let a=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(a=Rc(a)),[a,Rc(a)]}function yT(e){const t=Rc(e);return[bp(e),t,bp(t)]}function bp(e){return e.replace(/start|end/g,t=>mT[t])}function xT(e,t,n){const r=["left","right"],o=["right","left"],i=["top","bottom"],a=["bottom","top"];switch(e){case"top":case"bottom":return n?t?o:r:t?r:o;case"left":case"right":return t?i:a;default:return[]}}function wT(e,t,n,r){const o=us(e);let i=xT(eo(e),n==="start",r);return o&&(i=i.map(a=>a+"-"+o),t&&(i=i.concat(i.map(bp)))),i}function Rc(e){return e.replace(/left|right|bottom|top/g,t=>vT[t])}function bT(e){return{top:0,right:0,bottom:0,left:0,...e}}function Hb(e){return typeof e!="number"?bT(e):{top:e,right:e,bottom:e,left:e}}function Nc(e){const{x:t,y:n,width:r,height:o}=e;return{width:r,height:o,top:n,left:t,right:t+r,bottom:n+o,x:t,y:n}}function J0(e,t,n){let{reference:r,floating:o}=e;const i=Qo(t),a=rm(t),s=nm(a),u=eo(t),l=i==="y",c=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,f=r[s]/2-o[s]/2;let h;switch(u){case"top":h={x:c,y:r.y-o.height};break;case"bottom":h={x:c,y:r.y+r.height};break;case"right":h={x:r.x+r.width,y:d};break;case"left":h={x:r.x-o.width,y:d};break;default:h={x:r.x,y:r.y}}switch(us(t)){case"start":h[a]-=f*(n&&l?-1:1);break;case"end":h[a]+=f*(n&&l?-1:1);break}return h}const CT=async(e,t,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:a}=n,s=i.filter(Boolean),u=await(a.isRTL==null?void 0:a.isRTL(t));let l=await a.getElementRects({reference:e,floating:t,strategy:o}),{x:c,y:d}=J0(l,r,u),f=r,h={},p=0;for(let v=0;v<s.length;v++){const{name:g,fn:m}=s[v],{x:y,y:x,data:w,reset:b}=await m({x:c,y:d,initialPlacement:r,placement:f,strategy:o,middlewareData:h,rects:l,platform:a,elements:{reference:e,floating:t}});c=y??c,d=x??d,h={...h,[g]:{...h[g],...w}},b&&p<=50&&(p++,typeof b=="object"&&(b.placement&&(f=b.placement),b.rects&&(l=b.rects===!0?await a.getElementRects({reference:e,floating:t,strategy:o}):b.rects),{x:c,y:d}=J0(l,f,u)),v=-1)}return{x:c,y:d,placement:f,strategy:o,middlewareData:h}};async function lu(e,t){var n;t===void 0&&(t={});const{x:r,y:o,platform:i,rects:a,elements:s,strategy:u}=e,{boundary:l="clippingAncestors",rootBoundary:c="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=Zr(t,e),p=Hb(h),g=s[f?d==="floating"?"reference":"floating":d],m=Nc(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(g)))==null||n?g:g.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(s.floating)),boundary:l,rootBoundary:c,strategy:u})),y=d==="floating"?{x:r,y:o,width:a.floating.width,height:a.floating.height}:a.reference,x=await(i.getOffsetParent==null?void 0:i.getOffsetParent(s.floating)),w=await(i.isElement==null?void 0:i.isElement(x))?await(i.getScale==null?void 0:i.getScale(x))||{x:1,y:1}:{x:1,y:1},b=Nc(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:y,offsetParent:x,strategy:u}):y);return{top:(m.top-b.top+p.top)/w.y,bottom:(b.bottom-m.bottom+p.bottom)/w.y,left:(m.left-b.left+p.left)/w.x,right:(b.right-m.right+p.right)/w.x}}const ET=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:o,rects:i,platform:a,elements:s,middlewareData:u}=t,{element:l,padding:c=0}=Zr(e,t)||{};if(l==null)return{};const d=Hb(c),f={x:n,y:r},h=rm(o),p=nm(h),v=await a.getDimensions(l),g=h==="y",m=g?"top":"left",y=g?"bottom":"right",x=g?"clientHeight":"clientWidth",w=i.reference[p]+i.reference[h]-f[h]-i.floating[p],b=f[h]-i.reference[h],E=await(a.getOffsetParent==null?void 0:a.getOffsetParent(l));let k=E?E[x]:0;(!k||!await(a.isElement==null?void 0:a.isElement(E)))&&(k=s.floating[x]||i.floating[p]);const _=w/2-b/2,R=k/2-v[p]/2-1,N=Xo(d[m],R),D=Xo(d[y],R),A=N,j=k-v[p]-D,F=k/2-v[p]/2+_,z=wp(A,F,j),B=!u.arrow&&us(o)!=null&&F!==z&&i.reference[p]/2-(F<A?N:D)-v[p]/2<0,$=B?F<A?F-A:F-j:0;return{[h]:f[h]+$,data:{[h]:z,centerOffset:F-z-$,...B&&{alignmentOffset:$}},reset:B}}}),ST=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;const{placement:o,middlewareData:i,rects:a,initialPlacement:s,platform:u,elements:l}=t,{mainAxis:c=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:v=!0,...g}=Zr(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};const m=eo(o),y=Qo(s),x=eo(s)===s,w=await(u.isRTL==null?void 0:u.isRTL(l.floating)),b=f||(x||!v?[Rc(s)]:yT(s)),E=p!=="none";!f&&E&&b.push(...wT(s,v,p,w));const k=[s,...b],_=await lu(t,g),R=[];let N=((r=i.flip)==null?void 0:r.overflows)||[];if(c&&R.push(_[m]),d){const F=gT(o,a,w);R.push(_[F[0]],_[F[1]])}if(N=[...N,{placement:o,overflows:R}],!R.every(F=>F<=0)){var D,A;const F=(((D=i.flip)==null?void 0:D.index)||0)+1,z=k[F];if(z)return{data:{index:F,overflows:N},reset:{placement:z}};let B=(A=N.filter($=>$.overflows[0]<=0).sort(($,P)=>$.overflows[1]-P.overflows[1])[0])==null?void 0:A.placement;if(!B)switch(h){case"bestFit":{var j;const $=(j=N.filter(P=>{if(E){const L=Qo(P.placement);return L===y||L==="y"}return!0}).map(P=>[P.placement,P.overflows.filter(L=>L>0).reduce((L,W)=>L+W,0)]).sort((P,L)=>P[1]-L[1])[0])==null?void 0:j[0];$&&(B=$);break}case"initialPlacement":B=s;break}if(o!==B)return{reset:{placement:B}}}return{}}}};function Z0(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function ey(e){return pT.some(t=>e[t]>=0)}const kT=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...o}=Zr(e,t);switch(r){case"referenceHidden":{const i=await lu(t,{...o,elementContext:"reference"}),a=Z0(i,n.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:ey(a)}}}case"escaped":{const i=await lu(t,{...o,altBoundary:!0}),a=Z0(i,n.floating);return{data:{escapedOffsets:a,escaped:ey(a)}}}default:return{}}}}};async function _T(e,t){const{placement:n,platform:r,elements:o}=e,i=await(r.isRTL==null?void 0:r.isRTL(o.floating)),a=eo(n),s=us(n),u=Qo(n)==="y",l=["left","top"].includes(a)?-1:1,c=i&&u?-1:1,d=Zr(t,e);let{mainAxis:f,crossAxis:h,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return s&&typeof p=="number"&&(h=s==="end"?p*-1:p),u?{x:h*c,y:f*l}:{x:f*l,y:h*c}}const RT=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var n,r;const{x:o,y:i,placement:a,middlewareData:s}=t,u=await _T(t,e);return a===((n=s.offset)==null?void 0:n.placement)&&(r=s.arrow)!=null&&r.alignmentOffset?{}:{x:o+u.x,y:i+u.y,data:{...u,placement:a}}}}},NT=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:o}=t,{mainAxis:i=!0,crossAxis:a=!1,limiter:s={fn:g=>{let{x:m,y}=g;return{x:m,y}}},...u}=Zr(e,t),l={x:n,y:r},c=await lu(t,u),d=Qo(eo(o)),f=tm(d);let h=l[f],p=l[d];if(i){const g=f==="y"?"top":"left",m=f==="y"?"bottom":"right",y=h+c[g],x=h-c[m];h=wp(y,h,x)}if(a){const g=d==="y"?"top":"left",m=d==="y"?"bottom":"right",y=p+c[g],x=p-c[m];p=wp(y,p,x)}const v=s.fn({...t,[f]:h,[d]:p});return{...v,data:{x:v.x-n,y:v.y-r,enabled:{[f]:i,[d]:a}}}}}},IT=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:o,rects:i,middlewareData:a}=t,{offset:s=0,mainAxis:u=!0,crossAxis:l=!0}=Zr(e,t),c={x:n,y:r},d=Qo(o),f=tm(d);let h=c[f],p=c[d];const v=Zr(s,t),g=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(u){const x=f==="y"?"height":"width",w=i.reference[f]-i.floating[x]+g.mainAxis,b=i.reference[f]+i.reference[x]-g.mainAxis;h<w?h=w:h>b&&(h=b)}if(l){var m,y;const x=f==="y"?"width":"height",w=["top","left"].includes(eo(o)),b=i.reference[d]-i.floating[x]+(w&&((m=a.offset)==null?void 0:m[d])||0)+(w?0:g.crossAxis),E=i.reference[d]+i.reference[x]+(w?0:((y=a.offset)==null?void 0:y[d])||0)-(w?g.crossAxis:0);p<b?p=b:p>E&&(p=E)}return{[f]:h,[d]:p}}}},TT=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var n,r;const{placement:o,rects:i,platform:a,elements:s}=t,{apply:u=()=>{},...l}=Zr(e,t),c=await lu(t,l),d=eo(o),f=us(o),h=Qo(o)==="y",{width:p,height:v}=i.floating;let g,m;d==="top"||d==="bottom"?(g=d,m=f===(await(a.isRTL==null?void 0:a.isRTL(s.floating))?"start":"end")?"left":"right"):(m=d,g=f==="end"?"top":"bottom");const y=v-c.top-c.bottom,x=p-c.left-c.right,w=Xo(v-c[g],y),b=Xo(p-c[m],x),E=!t.middlewareData.shift;let k=w,_=b;if((n=t.middlewareData.shift)!=null&&n.enabled.x&&(_=x),(r=t.middlewareData.shift)!=null&&r.enabled.y&&(k=y),E&&!f){const N=xn(c.left,0),D=xn(c.right,0),A=xn(c.top,0),j=xn(c.bottom,0);h?_=p-2*(N!==0||D!==0?N+D:xn(c.left,c.right)):k=v-2*(A!==0||j!==0?A+j:xn(c.top,c.bottom))}await u({...t,availableWidth:_,availableHeight:k});const R=await a.getDimensions(s.floating);return p!==R.width||v!==R.height?{reset:{rects:!0}}:{}}}};function kd(){return typeof window<"u"}function ls(e){return Gb(e)?(e.nodeName||"").toLowerCase():"#document"}function _n(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Fr(e){var t;return(t=(Gb(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function Gb(e){return kd()?e instanceof Node||e instanceof _n(e).Node:!1}function or(e){return kd()?e instanceof Element||e instanceof _n(e).Element:!1}function Pr(e){return kd()?e instanceof HTMLElement||e instanceof _n(e).HTMLElement:!1}function ty(e){return!kd()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof _n(e).ShadowRoot}function Ou(e){const{overflow:t,overflowX:n,overflowY:r,display:o}=ir(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(o)}function AT(e){return["table","td","th"].includes(ls(e))}function _d(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function om(e){const t=im(),n=or(e)?ir(e):e;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function PT(e){let t=Jo(e);for(;Pr(t)&&!Qa(t);){if(om(t))return t;if(_d(t))return null;t=Jo(t)}return null}function im(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Qa(e){return["html","body","#document"].includes(ls(e))}function ir(e){return _n(e).getComputedStyle(e)}function Rd(e){return or(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Jo(e){if(ls(e)==="html")return e;const t=e.assignedSlot||e.parentNode||ty(e)&&e.host||Fr(e);return ty(t)?t.host:t}function qb(e){const t=Jo(e);return Qa(t)?e.ownerDocument?e.ownerDocument.body:e.body:Pr(t)&&Ou(t)?t:qb(t)}function cu(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);const o=qb(e),i=o===((r=e.ownerDocument)==null?void 0:r.body),a=_n(o);if(i){const s=Cp(a);return t.concat(a,a.visualViewport||[],Ou(o)?o:[],s&&n?cu(s):[])}return t.concat(o,cu(o,[],n))}function Cp(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Kb(e){const t=ir(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const o=Pr(e),i=o?e.offsetWidth:n,a=o?e.offsetHeight:r,s=_c(n)!==i||_c(r)!==a;return s&&(n=i,r=a),{width:n,height:r,$:s}}function am(e){return or(e)?e:e.contextElement}function ka(e){const t=am(e);if(!Pr(t))return Yo(1);const n=t.getBoundingClientRect(),{width:r,height:o,$:i}=Kb(t);let a=(i?_c(n.width):n.width)/r,s=(i?_c(n.height):n.height)/o;return(!a||!Number.isFinite(a))&&(a=1),(!s||!Number.isFinite(s))&&(s=1),{x:a,y:s}}const DT=Yo(0);function Xb(e){const t=_n(e);return!im()||!t.visualViewport?DT:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function MT(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==_n(e)?!1:t}function Fi(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const o=e.getBoundingClientRect(),i=am(e);let a=Yo(1);t&&(r?or(r)&&(a=ka(r)):a=ka(e));const s=MT(i,n,r)?Xb(i):Yo(0);let u=(o.left+s.x)/a.x,l=(o.top+s.y)/a.y,c=o.width/a.x,d=o.height/a.y;if(i){const f=_n(i),h=r&&or(r)?_n(r):r;let p=f,v=Cp(p);for(;v&&r&&h!==p;){const g=ka(v),m=v.getBoundingClientRect(),y=ir(v),x=m.left+(v.clientLeft+parseFloat(y.paddingLeft))*g.x,w=m.top+(v.clientTop+parseFloat(y.paddingTop))*g.y;u*=g.x,l*=g.y,c*=g.x,d*=g.y,u+=x,l+=w,p=_n(v),v=Cp(p)}}return Nc({width:c,height:d,x:u,y:l})}function FT(e){let{elements:t,rect:n,offsetParent:r,strategy:o}=e;const i=o==="fixed",a=Fr(r),s=t?_d(t.floating):!1;if(r===a||s&&i)return n;let u={scrollLeft:0,scrollTop:0},l=Yo(1);const c=Yo(0),d=Pr(r);if((d||!d&&!i)&&((ls(r)!=="body"||Ou(a))&&(u=Rd(r)),Pr(r))){const f=Fi(r);l=ka(r),c.x=f.x+r.clientLeft,c.y=f.y+r.clientTop}return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-u.scrollLeft*l.x+c.x,y:n.y*l.y-u.scrollTop*l.y+c.y}}function OT(e){return Array.from(e.getClientRects())}function Ep(e,t){const n=Rd(e).scrollLeft;return t?t.left+n:Fi(Fr(e)).left+n}function LT(e){const t=Fr(e),n=Rd(e),r=e.ownerDocument.body,o=xn(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),i=xn(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let a=-n.scrollLeft+Ep(e);const s=-n.scrollTop;return ir(r).direction==="rtl"&&(a+=xn(t.clientWidth,r.clientWidth)-o),{width:o,height:i,x:a,y:s}}function BT(e,t){const n=_n(e),r=Fr(e),o=n.visualViewport;let i=r.clientWidth,a=r.clientHeight,s=0,u=0;if(o){i=o.width,a=o.height;const l=im();(!l||l&&t==="fixed")&&(s=o.offsetLeft,u=o.offsetTop)}return{width:i,height:a,x:s,y:u}}function jT(e,t){const n=Fi(e,!0,t==="fixed"),r=n.top+e.clientTop,o=n.left+e.clientLeft,i=Pr(e)?ka(e):Yo(1),a=e.clientWidth*i.x,s=e.clientHeight*i.y,u=o*i.x,l=r*i.y;return{width:a,height:s,x:u,y:l}}function ny(e,t,n){let r;if(t==="viewport")r=BT(e,n);else if(t==="document")r=LT(Fr(e));else if(or(t))r=jT(t,n);else{const o=Xb(e);r={...t,x:t.x-o.x,y:t.y-o.y}}return Nc(r)}function Yb(e,t){const n=Jo(e);return n===t||!or(n)||Qa(n)?!1:ir(n).position==="fixed"||Yb(n,t)}function zT(e,t){const n=t.get(e);if(n)return n;let r=cu(e,[],!1).filter(s=>or(s)&&ls(s)!=="body"),o=null;const i=ir(e).position==="fixed";let a=i?Jo(e):e;for(;or(a)&&!Qa(a);){const s=ir(a),u=om(a);!u&&s.position==="fixed"&&(o=null),(i?!u&&!o:!u&&s.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||Ou(a)&&!u&&Yb(e,a))?r=r.filter(c=>c!==a):o=s,a=Jo(a)}return t.set(e,r),r}function WT(e){let{element:t,boundary:n,rootBoundary:r,strategy:o}=e;const a=[...n==="clippingAncestors"?_d(t)?[]:zT(t,this._c):[].concat(n),r],s=a[0],u=a.reduce((l,c)=>{const d=ny(t,c,o);return l.top=xn(d.top,l.top),l.right=Xo(d.right,l.right),l.bottom=Xo(d.bottom,l.bottom),l.left=xn(d.left,l.left),l},ny(t,s,o));return{width:u.right-u.left,height:u.bottom-u.top,x:u.left,y:u.top}}function $T(e){const{width:t,height:n}=Kb(e);return{width:t,height:n}}function UT(e,t,n){const r=Pr(t),o=Fr(t),i=n==="fixed",a=Fi(e,!0,i,t);let s={scrollLeft:0,scrollTop:0};const u=Yo(0);if(r||!r&&!i)if((ls(t)!=="body"||Ou(o))&&(s=Rd(t)),r){const h=Fi(t,!0,i,t);u.x=h.x+t.clientLeft,u.y=h.y+t.clientTop}else o&&(u.x=Ep(o));let l=0,c=0;if(o&&!r&&!i){const h=o.getBoundingClientRect();c=h.top+s.scrollTop,l=h.left+s.scrollLeft-Ep(o,h)}const d=a.left+s.scrollLeft-u.x-l,f=a.top+s.scrollTop-u.y-c;return{x:d,y:f,width:a.width,height:a.height}}function Pf(e){return ir(e).position==="static"}function ry(e,t){if(!Pr(e)||ir(e).position==="fixed")return null;if(t)return t(e);let n=e.offsetParent;return Fr(e)===n&&(n=n.ownerDocument.body),n}function Qb(e,t){const n=_n(e);if(_d(e))return n;if(!Pr(e)){let o=Jo(e);for(;o&&!Qa(o);){if(or(o)&&!Pf(o))return o;o=Jo(o)}return n}let r=ry(e,t);for(;r&&AT(r)&&Pf(r);)r=ry(r,t);return r&&Qa(r)&&Pf(r)&&!om(r)?n:r||PT(e)||n}const VT=async function(e){const t=this.getOffsetParent||Qb,n=this.getDimensions,r=await n(e.floating);return{reference:UT(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function HT(e){return ir(e).direction==="rtl"}const GT={convertOffsetParentRelativeRectToViewportRelativeRect:FT,getDocumentElement:Fr,getClippingRect:WT,getOffsetParent:Qb,getElementRects:VT,getClientRects:OT,getDimensions:$T,getScale:ka,isElement:or,isRTL:HT};function qT(e,t){let n=null,r;const o=Fr(e);function i(){var s;clearTimeout(r),(s=n)==null||s.disconnect(),n=null}function a(s,u){s===void 0&&(s=!1),u===void 0&&(u=1),i();const{left:l,top:c,width:d,height:f}=e.getBoundingClientRect();if(s||t(),!d||!f)return;const h=wl(c),p=wl(o.clientWidth-(l+d)),v=wl(o.clientHeight-(c+f)),g=wl(l),y={rootMargin:-h+"px "+-p+"px "+-v+"px "+-g+"px",threshold:xn(0,Xo(1,u))||1};let x=!0;function w(b){const E=b[0].intersectionRatio;if(E!==u){if(!x)return a();E?a(!1,E):r=setTimeout(()=>{a(!1,1e-7)},1e3)}x=!1}try{n=new IntersectionObserver(w,{...y,root:o.ownerDocument})}catch{n=new IntersectionObserver(w,y)}n.observe(e)}return a(!0),i}function KT(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:i=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:u=!1}=r,l=am(e),c=o||i?[...l?cu(l):[],...cu(t)]:[];c.forEach(m=>{o&&m.addEventListener("scroll",n,{passive:!0}),i&&m.addEventListener("resize",n)});const d=l&&s?qT(l,n):null;let f=-1,h=null;a&&(h=new ResizeObserver(m=>{let[y]=m;y&&y.target===l&&h&&(h.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var x;(x=h)==null||x.observe(t)})),n()}),l&&!u&&h.observe(l),h.observe(t));let p,v=u?Fi(e):null;u&&g();function g(){const m=Fi(e);v&&(m.x!==v.x||m.y!==v.y||m.width!==v.width||m.height!==v.height)&&n(),v=m,p=requestAnimationFrame(g)}return n(),()=>{var m;c.forEach(y=>{o&&y.removeEventListener("scroll",n),i&&y.removeEventListener("resize",n)}),d==null||d(),(m=h)==null||m.disconnect(),h=null,u&&cancelAnimationFrame(p)}}const XT=RT,YT=NT,QT=ST,JT=TT,ZT=kT,oy=ET,eA=IT,tA=(e,t,n)=>{const r=new Map,o={platform:GT,...n},i={...o.platform,_c:r};return CT(e,t,{...o,platform:i})};var Jl=typeof document<"u"?C.useLayoutEffect:C.useEffect;function Ic(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,o;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!==t.length)return!1;for(r=n;r--!==0;)if(!Ic(e[r],t[r]))return!1;return!0}if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,o[r]))return!1;for(r=n;r--!==0;){const i=o[r];if(!(i==="_owner"&&e.$$typeof)&&!Ic(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}function Jb(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function iy(e,t){const n=Jb(e);return Math.round(t*n)/n}function Df(e){const t=C.useRef(e);return Jl(()=>{t.current=e}),t}function nA(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:i,floating:a}={},transform:s=!0,whileElementsMounted:u,open:l}=e,[c,d]=C.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[f,h]=C.useState(r);Ic(f,r)||h(r);const[p,v]=C.useState(null),[g,m]=C.useState(null),y=C.useCallback(P=>{P!==E.current&&(E.current=P,v(P))},[]),x=C.useCallback(P=>{P!==k.current&&(k.current=P,m(P))},[]),w=i||p,b=a||g,E=C.useRef(null),k=C.useRef(null),_=C.useRef(c),R=u!=null,N=Df(u),D=Df(o),A=Df(l),j=C.useCallback(()=>{if(!E.current||!k.current)return;const P={placement:t,strategy:n,middleware:f};D.current&&(P.platform=D.current),tA(E.current,k.current,P).then(L=>{const W={...L,isPositioned:A.current!==!1};F.current&&!Ic(_.current,W)&&(_.current=W,Du.flushSync(()=>{d(W)}))})},[f,t,n,D,A]);Jl(()=>{l===!1&&_.current.isPositioned&&(_.current.isPositioned=!1,d(P=>({...P,isPositioned:!1})))},[l]);const F=C.useRef(!1);Jl(()=>(F.current=!0,()=>{F.current=!1}),[]),Jl(()=>{if(w&&(E.current=w),b&&(k.current=b),w&&b){if(N.current)return N.current(w,b,j);j()}},[w,b,j,N,R]);const z=C.useMemo(()=>({reference:E,floating:k,setReference:y,setFloating:x}),[y,x]),B=C.useMemo(()=>({reference:w,floating:b}),[w,b]),$=C.useMemo(()=>{const P={position:n,left:0,top:0};if(!B.floating)return P;const L=iy(B.floating,c.x),W=iy(B.floating,c.y);return s?{...P,transform:"translate("+L+"px, "+W+"px)",...Jb(B.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:L,top:W}},[n,s,B.floating,c.x,c.y]);return C.useMemo(()=>({...c,update:j,refs:z,elements:B,floatingStyles:$}),[c,j,z,B,$])}const rA=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:o}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?oy({element:r.current,padding:o}).fn(n):{}:r?oy({element:r,padding:o}).fn(n):{}}}},oA=(e,t)=>({...XT(e),options:[e,t]}),iA=(e,t)=>({...YT(e),options:[e,t]}),aA=(e,t)=>({...eA(e),options:[e,t]}),sA=(e,t)=>({...QT(e),options:[e,t]}),uA=(e,t)=>({...JT(e),options:[e,t]}),lA=(e,t)=>({...ZT(e),options:[e,t]}),cA=(e,t)=>({...rA(e),options:[e,t]});var dA="Arrow",Zb=C.forwardRef((e,t)=>{const{children:n,width:r=10,height:o=5,...i}=e;return S.jsx(je.svg,{...i,ref:t,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:S.jsx("polygon",{points:"0,0 30,0 15,10"})})});Zb.displayName=dA;var fA=Zb;function hA(e,t=[]){let n=[];function r(i,a){const s=C.createContext(a),u=n.length;n=[...n,a];function l(d){const{scope:f,children:h,...p}=d,v=(f==null?void 0:f[e][u])||s,g=C.useMemo(()=>p,Object.values(p));return S.jsx(v.Provider,{value:g,children:h})}function c(d,f){const h=(f==null?void 0:f[e][u])||s,p=C.useContext(h);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${i}\``)}return l.displayName=i+"Provider",[l,c]}const o=()=>{const i=n.map(a=>C.createContext(a));return function(s){const u=(s==null?void 0:s[e])||i;return C.useMemo(()=>({[`__scope${e}`]:{...s,[e]:u}}),[s,u])}};return o.scopeName=e,[r,pA(o,...t)]}function pA(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(i){const a=r.reduce((s,{useScope:u,scopeName:l})=>{const d=u(i)[`__scope${l}`];return{...s,...d}},{});return C.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}function e2(e){const[t,n]=C.useState(void 0);return Ar(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const i=o[0];let a,s;if("borderBoxSize"in i){const u=i.borderBoxSize,l=Array.isArray(u)?u[0]:u;a=l.inlineSize,s=l.blockSize}else a=e.offsetWidth,s=e.offsetHeight;n({width:a,height:s})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}var t2="Popper",[n2,r2]=hA(t2),[AW,o2]=n2(t2),i2="PopperAnchor",a2=C.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...o}=e,i=o2(i2,n),a=C.useRef(null),s=ft(t,a);return C.useEffect(()=>{i.onAnchorChange((r==null?void 0:r.current)||a.current)}),r?null:S.jsx(je.div,{...o,ref:s})});a2.displayName=i2;var sm="PopperContent",[vA,mA]=n2(sm),s2=C.forwardRef((e,t)=>{var de,pe,me,De,we,_e;const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:i="center",alignOffset:a=0,arrowPadding:s=0,avoidCollisions:u=!0,collisionBoundary:l=[],collisionPadding:c=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:h="optimized",onPlaced:p,...v}=e,g=o2(sm,n),[m,y]=C.useState(null),x=ft(t,Ce=>y(Ce)),[w,b]=C.useState(null),E=e2(w),k=(E==null?void 0:E.width)??0,_=(E==null?void 0:E.height)??0,R=r+(i!=="center"?"-"+i:""),N=typeof c=="number"?c:{top:0,right:0,bottom:0,left:0,...c},D=Array.isArray(l)?l:[l],A=D.length>0,j={padding:N,boundary:D.filter(yA),altBoundary:A},{refs:F,floatingStyles:z,placement:B,isPositioned:$,middlewareData:P}=nA({strategy:"fixed",placement:R,whileElementsMounted:(...Ce)=>KT(...Ce,{animationFrame:h==="always"}),elements:{reference:g.anchor},middleware:[oA({mainAxis:o+_,alignmentAxis:a}),u&&iA({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?aA():void 0,...j}),u&&sA({...j}),uA({...j,apply:({elements:Ce,rects:Le,availableWidth:Be,availableHeight:Ie})=>{const{width:Qt,height:Jt}=Le.reference,Ae=Ce.floating.style;Ae.setProperty("--radix-popper-available-width",`${Be}px`),Ae.setProperty("--radix-popper-available-height",`${Ie}px`),Ae.setProperty("--radix-popper-anchor-width",`${Qt}px`),Ae.setProperty("--radix-popper-anchor-height",`${Jt}px`)}}),w&&cA({element:w,padding:s}),xA({arrowWidth:k,arrowHeight:_}),f&&lA({strategy:"referenceHidden",...j})]}),[L,W]=c2(B),H=In(p);Ar(()=>{$&&(H==null||H())},[$,H]);const q=(de=P.arrow)==null?void 0:de.x,Q=(pe=P.arrow)==null?void 0:pe.y,re=((me=P.arrow)==null?void 0:me.centerOffset)!==0,[ce,ee]=C.useState();return Ar(()=>{m&&ee(window.getComputedStyle(m).zIndex)},[m]),S.jsx("div",{ref:F.setFloating,"data-radix-popper-content-wrapper":"",style:{...z,transform:$?z.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ce,"--radix-popper-transform-origin":[(De=P.transformOrigin)==null?void 0:De.x,(we=P.transformOrigin)==null?void 0:we.y].join(" "),...((_e=P.hide)==null?void 0:_e.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:S.jsx(vA,{scope:n,placedSide:L,onArrowChange:b,arrowX:q,arrowY:Q,shouldHideArrow:re,children:S.jsx(je.div,{"data-side":L,"data-align":W,...v,ref:x,style:{...v.style,animation:$?void 0:"none"}})})})});s2.displayName=sm;var u2="PopperArrow",gA={top:"bottom",right:"left",bottom:"top",left:"right"},l2=C.forwardRef(function(t,n){const{__scopePopper:r,...o}=t,i=mA(u2,r),a=gA[i.placedSide];return S.jsx("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:S.jsx(fA,{...o,ref:n,style:{...o.style,display:"block"}})})});l2.displayName=u2;function yA(e){return e!==null}var xA=e=>({name:"transformOrigin",options:e,fn(t){var g,m,y;const{placement:n,rects:r,middlewareData:o}=t,a=((g=o.arrow)==null?void 0:g.centerOffset)!==0,s=a?0:e.arrowWidth,u=a?0:e.arrowHeight,[l,c]=c2(n),d={start:"0%",center:"50%",end:"100%"}[c],f=(((m=o.arrow)==null?void 0:m.x)??0)+s/2,h=(((y=o.arrow)==null?void 0:y.y)??0)+u/2;let p="",v="";return l==="bottom"?(p=a?d:`${f}px`,v=`${-u}px`):l==="top"?(p=a?d:`${f}px`,v=`${r.floating.height+u}px`):l==="right"?(p=`${-u}px`,v=a?d:`${h}px`):l==="left"&&(p=`${r.floating.width+u}px`,v=a?d:`${h}px`),{data:{x:p,y:v}}}});function c2(e){const[t,n="center"]=e.split("-");return[t,n]}var wA=a2,bA=s2,CA=l2,[Nd,PW]=Mu("Tooltip",[r2]),um=r2(),d2="TooltipProvider",EA=700,ay="tooltip.open",[SA,f2]=Nd(d2),h2=e=>{const{__scopeTooltip:t,delayDuration:n=EA,skipDelayDuration:r=300,disableHoverableContent:o=!1,children:i}=e,[a,s]=C.useState(!0),u=C.useRef(!1),l=C.useRef(0);return C.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),S.jsx(SA,{scope:t,isOpenDelayed:a,delayDuration:n,onOpen:C.useCallback(()=>{window.clearTimeout(l.current),s(!1)},[]),onClose:C.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>s(!0),r)},[r]),isPointerInTransitRef:u,onPointerInTransitChange:C.useCallback(c=>{u.current=c},[]),disableHoverableContent:o,children:i})};h2.displayName=d2;var p2="Tooltip",[DW,Id]=Nd(p2),Sp="TooltipTrigger",kA=C.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,o=Id(Sp,n),i=f2(Sp,n),a=um(n),s=C.useRef(null),u=ft(t,s,o.onTriggerChange),l=C.useRef(!1),c=C.useRef(!1),d=C.useCallback(()=>l.current=!1,[]);return C.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),S.jsx(wA,{asChild:!0,...a,children:S.jsx(je.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...r,ref:u,onPointerMove:Pe(e.onPointerMove,f=>{f.pointerType!=="touch"&&!c.current&&!i.isPointerInTransitRef.current&&(o.onTriggerEnter(),c.current=!0)}),onPointerLeave:Pe(e.onPointerLeave,()=>{o.onTriggerLeave(),c.current=!1}),onPointerDown:Pe(e.onPointerDown,()=>{l.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Pe(e.onFocus,()=>{l.current||o.onOpen()}),onBlur:Pe(e.onBlur,o.onClose),onClick:Pe(e.onClick,o.onClose)})})});kA.displayName=Sp;var _A="TooltipPortal",[MW,RA]=Nd(_A,{forceMount:void 0}),Ja="TooltipContent",v2=C.forwardRef((e,t)=>{const n=RA(Ja,e.__scopeTooltip),{forceMount:r=n.forceMount,side:o="top",...i}=e,a=Id(Ja,e.__scopeTooltip);return S.jsx(as,{present:r||a.open,children:a.disableHoverableContent?S.jsx(m2,{side:o,...i,ref:t}):S.jsx(NA,{side:o,...i,ref:t})})}),NA=C.forwardRef((e,t)=>{const n=Id(Ja,e.__scopeTooltip),r=f2(Ja,e.__scopeTooltip),o=C.useRef(null),i=ft(t,o),[a,s]=C.useState(null),{trigger:u,onClose:l}=n,c=o.current,{onPointerInTransitChange:d}=r,f=C.useCallback(()=>{s(null),d(!1)},[d]),h=C.useCallback((p,v)=>{const g=p.currentTarget,m={x:p.clientX,y:p.clientY},y=PA(m,g.getBoundingClientRect()),x=DA(m,y),w=MA(v.getBoundingClientRect()),b=OA([...x,...w]);s(b),d(!0)},[d]);return C.useEffect(()=>()=>f(),[f]),C.useEffect(()=>{if(u&&c){const p=g=>h(g,c),v=g=>h(g,u);return u.addEventListener("pointerleave",p),c.addEventListener("pointerleave",v),()=>{u.removeEventListener("pointerleave",p),c.removeEventListener("pointerleave",v)}}},[u,c,h,f]),C.useEffect(()=>{if(a){const p=v=>{const g=v.target,m={x:v.clientX,y:v.clientY},y=(u==null?void 0:u.contains(g))||(c==null?void 0:c.contains(g)),x=!FA(m,a);y?f():x&&(f(),l())};return document.addEventListener("pointermove",p),()=>document.removeEventListener("pointermove",p)}},[u,c,a,l,f]),S.jsx(m2,{...e,ref:i})}),[IA,TA]=Nd(p2,{isInside:!1}),m2=C.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":o,onEscapeKeyDown:i,onPointerDownOutside:a,...s}=e,u=Id(Ja,n),l=um(n),{onClose:c}=u;return C.useEffect(()=>(document.addEventListener(ay,c),()=>document.removeEventListener(ay,c)),[c]),C.useEffect(()=>{if(u.trigger){const d=f=>{const h=f.target;h!=null&&h.contains(u.trigger)&&c()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[u.trigger,c]),S.jsx(yd,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:a,onFocusOutside:d=>d.preventDefault(),onDismiss:c,children:S.jsxs(bA,{"data-state":u.stateAttribute,...l,...s,ref:t,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[S.jsx(ub,{children:r}),S.jsx(IA,{scope:n,isInside:!0,children:S.jsx(gN,{id:u.contentId,role:"tooltip",children:o||r})})]})})});v2.displayName=Ja;var g2="TooltipArrow",AA=C.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,o=um(n);return TA(g2,n).isInside?null:S.jsx(CA,{...o,...r,ref:t})});AA.displayName=g2;function PA(e,t){const n=Math.abs(t.top-e.y),r=Math.abs(t.bottom-e.y),o=Math.abs(t.right-e.x),i=Math.abs(t.left-e.x);switch(Math.min(n,r,o,i)){case i:return"left";case o:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function DA(e,t,n=5){const r=[];switch(t){case"top":r.push({x:e.x-n,y:e.y+n},{x:e.x+n,y:e.y+n});break;case"bottom":r.push({x:e.x-n,y:e.y-n},{x:e.x+n,y:e.y-n});break;case"left":r.push({x:e.x+n,y:e.y-n},{x:e.x+n,y:e.y+n});break;case"right":r.push({x:e.x-n,y:e.y-n},{x:e.x-n,y:e.y+n});break}return r}function MA(e){const{top:t,right:n,bottom:r,left:o}=e;return[{x:o,y:t},{x:n,y:t},{x:n,y:r},{x:o,y:r}]}function FA(e,t){const{x:n,y:r}=e;let o=!1;for(let i=0,a=t.length-1;i<t.length;a=i++){const s=t[i].x,u=t[i].y,l=t[a].x,c=t[a].y;u>r!=c>r&&n<(l-s)*(r-u)/(c-u)+s&&(o=!o)}return o}function OA(e){const t=e.slice();return t.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),LA(t)}function LA(e){if(e.length<=1)return e.slice();const t=[];for(let r=0;r<e.length;r++){const o=e[r];for(;t.length>=2;){const i=t[t.length-1],a=t[t.length-2];if((i.x-a.x)*(o.y-a.y)>=(i.y-a.y)*(o.x-a.x))t.pop();else break}t.push(o)}t.pop();const n=[];for(let r=e.length-1;r>=0;r--){const o=e[r];for(;n.length>=2;){const i=n[n.length-1],a=n[n.length-2];if((i.x-a.x)*(o.y-a.y)>=(i.y-a.y)*(o.x-a.x))n.pop();else break}n.push(o)}return n.pop(),t.length===1&&n.length===1&&t[0].x===n[0].x&&t[0].y===n[0].y?t:t.concat(n)}var BA=h2,y2=v2;const jA=BA,zA=C.forwardRef(({className:e,sideOffset:t=4,...n},r)=>S.jsx(y2,{ref:r,sideOffset:t,className:Ve("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));zA.displayName=y2.displayName;var Td=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Ad=typeof window>"u"||"Deno"in globalThis;function Kn(){}function WA(e,t){return typeof e=="function"?e(t):e}function $A(e){return typeof e=="number"&&e>=0&&e!==1/0}function UA(e,t){return Math.max(e+(t||0)-Date.now(),0)}function sy(e,t){return typeof e=="function"?e(t):e}function VA(e,t){return typeof e=="function"?e(t):e}function uy(e,t){const{type:n="all",exact:r,fetchStatus:o,predicate:i,queryKey:a,stale:s}=e;if(a){if(r){if(t.queryHash!==lm(a,t.options))return!1}else if(!fu(t.queryKey,a))return!1}if(n!=="all"){const u=t.isActive();if(n==="active"&&!u||n==="inactive"&&u)return!1}return!(typeof s=="boolean"&&t.isStale()!==s||o&&o!==t.state.fetchStatus||i&&!i(t))}function ly(e,t){const{exact:n,status:r,predicate:o,mutationKey:i}=e;if(i){if(!t.options.mutationKey)return!1;if(n){if(du(t.options.mutationKey)!==du(i))return!1}else if(!fu(t.options.mutationKey,i))return!1}return!(r&&t.state.status!==r||o&&!o(t))}function lm(e,t){return((t==null?void 0:t.queryKeyHashFn)||du)(e)}function du(e){return JSON.stringify(e,(t,n)=>kp(n)?Object.keys(n).sort().reduce((r,o)=>(r[o]=n[o],r),{}):n)}function fu(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?!Object.keys(t).some(n=>!fu(e[n],t[n])):!1}function x2(e,t){if(e===t)return e;const n=cy(e)&&cy(t);if(n||kp(e)&&kp(t)){const r=n?e:Object.keys(e),o=r.length,i=n?t:Object.keys(t),a=i.length,s=n?[]:{};let u=0;for(let l=0;l<a;l++){const c=n?l:i[l];(!n&&r.includes(c)||n)&&e[c]===void 0&&t[c]===void 0?(s[c]=void 0,u++):(s[c]=x2(e[c],t[c]),s[c]===e[c]&&e[c]!==void 0&&u++)}return o===a&&u===o?e:s}return t}function cy(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function kp(e){if(!dy(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!dy(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function dy(e){return Object.prototype.toString.call(e)==="[object Object]"}function HA(e){return new Promise(t=>{setTimeout(t,e)})}function GA(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?x2(e,t):t}function qA(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function KA(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var cm=Symbol();function w2(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===cm?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var Ci,So,Ma,L1,XA=(L1=class extends Td{constructor(){super();Me(this,Ci);Me(this,So);Me(this,Ma);be(this,Ma,t=>{if(!Ad&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){K(this,So)||this.setEventListener(K(this,Ma))}onUnsubscribe(){var t;this.hasListeners()||((t=K(this,So))==null||t.call(this),be(this,So,void 0))}setEventListener(t){var n;be(this,Ma,t),(n=K(this,So))==null||n.call(this),be(this,So,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){K(this,Ci)!==t&&(be(this,Ci,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof K(this,Ci)=="boolean"?K(this,Ci):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Ci=new WeakMap,So=new WeakMap,Ma=new WeakMap,L1),b2=new XA,Fa,ko,Oa,B1,YA=(B1=class extends Td{constructor(){super();Me(this,Fa,!0);Me(this,ko);Me(this,Oa);be(this,Oa,t=>{if(!Ad&&window.addEventListener){const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){K(this,ko)||this.setEventListener(K(this,Oa))}onUnsubscribe(){var t;this.hasListeners()||((t=K(this,ko))==null||t.call(this),be(this,ko,void 0))}setEventListener(t){var n;be(this,Oa,t),(n=K(this,ko))==null||n.call(this),be(this,ko,t(this.setOnline.bind(this)))}setOnline(t){K(this,Fa)!==t&&(be(this,Fa,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return K(this,Fa)}},Fa=new WeakMap,ko=new WeakMap,Oa=new WeakMap,B1),Tc=new YA;function QA(){let e,t;const n=new Promise((o,i)=>{e=o,t=i});n.status="pending",n.catch(()=>{});function r(o){Object.assign(n,o),delete n.resolve,delete n.reject}return n.resolve=o=>{r({status:"fulfilled",value:o}),e(o)},n.reject=o=>{r({status:"rejected",reason:o}),t(o)},n}function JA(e){return Math.min(1e3*2**e,3e4)}function C2(e){return(e??"online")==="online"?Tc.isOnline():!0}var E2=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function Mf(e){return e instanceof E2}function S2(e){let t=!1,n=0,r=!1,o;const i=QA(),a=v=>{var g;r||(f(new E2(v)),(g=e.abort)==null||g.call(e))},s=()=>{t=!0},u=()=>{t=!1},l=()=>b2.isFocused()&&(e.networkMode==="always"||Tc.isOnline())&&e.canRun(),c=()=>C2(e.networkMode)&&e.canRun(),d=v=>{var g;r||(r=!0,(g=e.onSuccess)==null||g.call(e,v),o==null||o(),i.resolve(v))},f=v=>{var g;r||(r=!0,(g=e.onError)==null||g.call(e,v),o==null||o(),i.reject(v))},h=()=>new Promise(v=>{var g;o=m=>{(r||l())&&v(m)},(g=e.onPause)==null||g.call(e)}).then(()=>{var v;o=void 0,r||(v=e.onContinue)==null||v.call(e)}),p=()=>{if(r)return;let v;const g=n===0?e.initialPromise:void 0;try{v=g??e.fn()}catch(m){v=Promise.reject(m)}Promise.resolve(v).then(d).catch(m=>{var E;if(r)return;const y=e.retry??(Ad?0:3),x=e.retryDelay??JA,w=typeof x=="function"?x(n,m):x,b=y===!0||typeof y=="number"&&n<y||typeof y=="function"&&y(n,m);if(t||!b){f(m);return}n++,(E=e.onFail)==null||E.call(e,n,m),HA(w).then(()=>l()?void 0:h()).then(()=>{t?f(m):p()})})};return{promise:i,cancel:a,continue:()=>(o==null||o(),i),cancelRetry:s,continueRetry:u,canStart:c,start:()=>(c()?p():h().then(p),i)}}function ZA(){let e=[],t=0,n=s=>{s()},r=s=>{s()},o=s=>setTimeout(s,0);const i=s=>{t?e.push(s):o(()=>{n(s)})},a=()=>{const s=e;e=[],s.length&&o(()=>{r(()=>{s.forEach(u=>{n(u)})})})};return{batch:s=>{let u;t++;try{u=s()}finally{t--,t||a()}return u},batchCalls:s=>(...u)=>{i(()=>{s(...u)})},schedule:i,setNotifyFunction:s=>{n=s},setBatchNotifyFunction:s=>{r=s},setScheduler:s=>{o=s}}}var qt=ZA(),Ei,j1,k2=(j1=class{constructor(){Me(this,Ei)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),$A(this.gcTime)&&be(this,Ei,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(Ad?1/0:5*60*1e3))}clearGcTimeout(){K(this,Ei)&&(clearTimeout(K(this,Ei)),be(this,Ei,void 0))}},Ei=new WeakMap,j1),La,Ba,Mn,Ft,_u,Si,Xn,Wr,z1,eP=(z1=class extends k2{constructor(t){super();Me(this,Xn);Me(this,La);Me(this,Ba);Me(this,Mn);Me(this,Ft);Me(this,_u);Me(this,Si);be(this,Si,!1),be(this,_u,t.defaultOptions),this.setOptions(t.options),this.observers=[],be(this,Mn,t.cache),this.queryKey=t.queryKey,this.queryHash=t.queryHash,be(this,La,nP(this.options)),this.state=t.state??K(this,La),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=K(this,Ft))==null?void 0:t.promise}setOptions(t){this.options={...K(this,_u),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&K(this,Mn).remove(this)}setData(t,n){const r=GA(this.state.data,t,this.options);return Pt(this,Xn,Wr).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(t,n){Pt(this,Xn,Wr).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var r,o;const n=(r=K(this,Ft))==null?void 0:r.promise;return(o=K(this,Ft))==null||o.cancel(t),n?n.then(Kn).catch(Kn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(K(this,La))}isActive(){return this.observers.some(t=>VA(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===cm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!UA(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=K(this,Ft))==null||n.continue()}onOnline(){var n;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=K(this,Ft))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),K(this,Mn).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(K(this,Ft)&&(K(this,Si)?K(this,Ft).cancel({revert:!0}):K(this,Ft).cancelRetry()),this.scheduleGc()),K(this,Mn).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Pt(this,Xn,Wr).call(this,{type:"invalidate"})}fetch(t,n){var u,l,c;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(K(this,Ft))return K(this,Ft).continueRetry(),K(this,Ft).promise}if(t&&this.setOptions(t),!this.options.queryFn){const d=this.observers.find(f=>f.options.queryFn);d&&this.setOptions(d.options)}const r=new AbortController,o=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(be(this,Si,!0),r.signal)})},i=()=>{const d=w2(this.options,n),f={queryKey:this.queryKey,meta:this.meta};return o(f),be(this,Si,!1),this.options.persister?this.options.persister(d,f,this):d(f)},a={fetchOptions:n,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:i};o(a),(u=this.options.behavior)==null||u.onFetch(a,this),be(this,Ba,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((l=a.fetchOptions)==null?void 0:l.meta))&&Pt(this,Xn,Wr).call(this,{type:"fetch",meta:(c=a.fetchOptions)==null?void 0:c.meta});const s=d=>{var f,h,p,v;Mf(d)&&d.silent||Pt(this,Xn,Wr).call(this,{type:"error",error:d}),Mf(d)||((h=(f=K(this,Mn).config).onError)==null||h.call(f,d,this),(v=(p=K(this,Mn).config).onSettled)==null||v.call(p,this.state.data,d,this)),this.scheduleGc()};return be(this,Ft,S2({initialPromise:n==null?void 0:n.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onSuccess:d=>{var f,h,p,v;if(d===void 0){s(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(d)}catch(g){s(g);return}(h=(f=K(this,Mn).config).onSuccess)==null||h.call(f,d,this),(v=(p=K(this,Mn).config).onSettled)==null||v.call(p,d,this.state.error,this),this.scheduleGc()},onError:s,onFail:(d,f)=>{Pt(this,Xn,Wr).call(this,{type:"failed",failureCount:d,error:f})},onPause:()=>{Pt(this,Xn,Wr).call(this,{type:"pause"})},onContinue:()=>{Pt(this,Xn,Wr).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),K(this,Ft).start()}},La=new WeakMap,Ba=new WeakMap,Mn=new WeakMap,Ft=new WeakMap,_u=new WeakMap,Si=new WeakMap,Xn=new WeakSet,Wr=function(t){const n=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...tP(r.data,this.options),fetchMeta:t.meta??null};case"success":return{...r,data:t.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=t.error;return Mf(o)&&o.revert&&K(this,Ba)?{...K(this,Ba),fetchStatus:"idle"}:{...r,error:o,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=n(this.state),qt.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),K(this,Mn).notify({query:this,type:"updated",action:t})})},z1);function tP(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:C2(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function nP(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,r=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var gr,W1,rP=(W1=class extends Td{constructor(t={}){super();Me(this,gr);this.config=t,be(this,gr,new Map)}build(t,n,r){const o=n.queryKey,i=n.queryHash??lm(o,n);let a=this.get(i);return a||(a=new eP({cache:this,queryKey:o,queryHash:i,options:t.defaultQueryOptions(n),state:r,defaultOptions:t.getQueryDefaults(o)}),this.add(a)),a}add(t){K(this,gr).has(t.queryHash)||(K(this,gr).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=K(this,gr).get(t.queryHash);n&&(t.destroy(),n===t&&K(this,gr).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){qt.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return K(this,gr).get(t)}getAll(){return[...K(this,gr).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(r=>uy(n,r))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(r=>uy(t,r)):n}notify(t){qt.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){qt.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){qt.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},gr=new WeakMap,W1),yr,Ht,ki,xr,yo,$1,oP=($1=class extends k2{constructor(t){super();Me(this,xr);Me(this,yr);Me(this,Ht);Me(this,ki);this.mutationId=t.mutationId,be(this,Ht,t.mutationCache),be(this,yr,[]),this.state=t.state||iP(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){K(this,yr).includes(t)||(K(this,yr).push(t),this.clearGcTimeout(),K(this,Ht).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){be(this,yr,K(this,yr).filter(n=>n!==t)),this.scheduleGc(),K(this,Ht).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){K(this,yr).length||(this.state.status==="pending"?this.scheduleGc():K(this,Ht).remove(this))}continue(){var t;return((t=K(this,ki))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var o,i,a,s,u,l,c,d,f,h,p,v,g,m,y,x,w,b,E,k;be(this,ki,S2({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(_,R)=>{Pt(this,xr,yo).call(this,{type:"failed",failureCount:_,error:R})},onPause:()=>{Pt(this,xr,yo).call(this,{type:"pause"})},onContinue:()=>{Pt(this,xr,yo).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>K(this,Ht).canRun(this)}));const n=this.state.status==="pending",r=!K(this,ki).canStart();try{if(!n){Pt(this,xr,yo).call(this,{type:"pending",variables:t,isPaused:r}),await((i=(o=K(this,Ht).config).onMutate)==null?void 0:i.call(o,t,this));const R=await((s=(a=this.options).onMutate)==null?void 0:s.call(a,t));R!==this.state.context&&Pt(this,xr,yo).call(this,{type:"pending",context:R,variables:t,isPaused:r})}const _=await K(this,ki).start();return await((l=(u=K(this,Ht).config).onSuccess)==null?void 0:l.call(u,_,t,this.state.context,this)),await((d=(c=this.options).onSuccess)==null?void 0:d.call(c,_,t,this.state.context)),await((h=(f=K(this,Ht).config).onSettled)==null?void 0:h.call(f,_,null,this.state.variables,this.state.context,this)),await((v=(p=this.options).onSettled)==null?void 0:v.call(p,_,null,t,this.state.context)),Pt(this,xr,yo).call(this,{type:"success",data:_}),_}catch(_){try{throw await((m=(g=K(this,Ht).config).onError)==null?void 0:m.call(g,_,t,this.state.context,this)),await((x=(y=this.options).onError)==null?void 0:x.call(y,_,t,this.state.context)),await((b=(w=K(this,Ht).config).onSettled)==null?void 0:b.call(w,void 0,_,this.state.variables,this.state.context,this)),await((k=(E=this.options).onSettled)==null?void 0:k.call(E,void 0,_,t,this.state.context)),_}finally{Pt(this,xr,yo).call(this,{type:"error",error:_})}}finally{K(this,Ht).runNext(this)}}},yr=new WeakMap,Ht=new WeakMap,ki=new WeakMap,xr=new WeakSet,yo=function(t){const n=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),qt.batch(()=>{K(this,yr).forEach(r=>{r.onMutationUpdate(t)}),K(this,Ht).notify({mutation:this,type:"updated",action:t})})},$1);function iP(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var vn,Ru,U1,aP=(U1=class extends Td{constructor(t={}){super();Me(this,vn);Me(this,Ru);this.config=t,be(this,vn,new Map),be(this,Ru,Date.now())}build(t,n,r){const o=new oP({mutationCache:this,mutationId:++Zu(this,Ru)._,options:t.defaultMutationOptions(n),state:r});return this.add(o),o}add(t){const n=bl(t),r=K(this,vn).get(n)??[];r.push(t),K(this,vn).set(n,r),this.notify({type:"added",mutation:t})}remove(t){var r;const n=bl(t);if(K(this,vn).has(n)){const o=(r=K(this,vn).get(n))==null?void 0:r.filter(i=>i!==t);o&&(o.length===0?K(this,vn).delete(n):K(this,vn).set(n,o))}this.notify({type:"removed",mutation:t})}canRun(t){var r;const n=(r=K(this,vn).get(bl(t)))==null?void 0:r.find(o=>o.state.status==="pending");return!n||n===t}runNext(t){var r;const n=(r=K(this,vn).get(bl(t)))==null?void 0:r.find(o=>o!==t&&o.state.isPaused);return(n==null?void 0:n.continue())??Promise.resolve()}clear(){qt.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}getAll(){return[...K(this,vn).values()].flat()}find(t){const n={exact:!0,...t};return this.getAll().find(r=>ly(n,r))}findAll(t={}){return this.getAll().filter(n=>ly(t,n))}notify(t){qt.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return qt.batch(()=>Promise.all(t.map(n=>n.continue().catch(Kn))))}},vn=new WeakMap,Ru=new WeakMap,U1);function bl(e){var t;return((t=e.options.scope)==null?void 0:t.id)??String(e.mutationId)}function fy(e){return{onFetch:(t,n)=>{var c,d,f,h,p;const r=t.options,o=(f=(d=(c=t.fetchOptions)==null?void 0:c.meta)==null?void 0:d.fetchMore)==null?void 0:f.direction,i=((h=t.state.data)==null?void 0:h.pages)||[],a=((p=t.state.data)==null?void 0:p.pageParams)||[];let s={pages:[],pageParams:[]},u=0;const l=async()=>{let v=!1;const g=x=>{Object.defineProperty(x,"signal",{enumerable:!0,get:()=>(t.signal.aborted?v=!0:t.signal.addEventListener("abort",()=>{v=!0}),t.signal)})},m=w2(t.options,t.fetchOptions),y=async(x,w,b)=>{if(v)return Promise.reject();if(w==null&&x.pages.length)return Promise.resolve(x);const E={queryKey:t.queryKey,pageParam:w,direction:b?"backward":"forward",meta:t.options.meta};g(E);const k=await m(E),{maxPages:_}=t.options,R=b?KA:qA;return{pages:R(x.pages,k,_),pageParams:R(x.pageParams,w,_)}};if(o&&i.length){const x=o==="backward",w=x?sP:hy,b={pages:i,pageParams:a},E=w(r,b);s=await y(b,E,x)}else{const x=e??i.length;do{const w=u===0?a[0]??r.initialPageParam:hy(r,s);if(u>0&&w==null)break;s=await y(s,w),u++}while(u<x)}return s};t.options.persister?t.fetchFn=()=>{var v,g;return(g=(v=t.options).persister)==null?void 0:g.call(v,l,{queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=l}}}function hy(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function sP(e,{pages:t,pageParams:n}){var r;return t.length>0?(r=e.getPreviousPageParam)==null?void 0:r.call(e,t[0],t,n[0],n):void 0}var ot,_o,Ro,ja,za,No,Wa,$a,V1,uP=(V1=class{constructor(e={}){Me(this,ot);Me(this,_o);Me(this,Ro);Me(this,ja);Me(this,za);Me(this,No);Me(this,Wa);Me(this,$a);be(this,ot,e.queryCache||new rP),be(this,_o,e.mutationCache||new aP),be(this,Ro,e.defaultOptions||{}),be(this,ja,new Map),be(this,za,new Map),be(this,No,0)}mount(){Zu(this,No)._++,K(this,No)===1&&(be(this,Wa,b2.subscribe(async e=>{e&&(await this.resumePausedMutations(),K(this,ot).onFocus())})),be(this,$a,Tc.subscribe(async e=>{e&&(await this.resumePausedMutations(),K(this,ot).onOnline())})))}unmount(){var e,t;Zu(this,No)._--,K(this,No)===0&&((e=K(this,Wa))==null||e.call(this),be(this,Wa,void 0),(t=K(this,$a))==null||t.call(this),be(this,$a,void 0))}isFetching(e){return K(this,ot).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return K(this,_o).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=K(this,ot).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.getQueryData(e.queryKey);if(t===void 0)return this.fetchQuery(e);{const n=this.defaultQueryOptions(e),r=K(this,ot).build(this,n);return e.revalidateIfStale&&r.isStaleByTime(sy(n.staleTime,r))&&this.prefetchQuery(n),Promise.resolve(t)}}getQueriesData(e){return K(this,ot).findAll(e).map(({queryKey:t,state:n})=>{const r=n.data;return[t,r]})}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),o=K(this,ot).get(r.queryHash),i=o==null?void 0:o.state.data,a=WA(t,i);if(a!==void 0)return K(this,ot).build(this,r).setData(a,{...n,manual:!0})}setQueriesData(e,t,n){return qt.batch(()=>K(this,ot).findAll(e).map(({queryKey:r})=>[r,this.setQueryData(r,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=K(this,ot).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=K(this,ot);qt.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=K(this,ot),r={type:"active",...e};return qt.batch(()=>(n.findAll(e).forEach(o=>{o.reset()}),this.refetchQueries(r,t)))}cancelQueries(e={},t={}){const n={revert:!0,...t},r=qt.batch(()=>K(this,ot).findAll(e).map(o=>o.cancel(n)));return Promise.all(r).then(Kn).catch(Kn)}invalidateQueries(e={},t={}){return qt.batch(()=>{if(K(this,ot).findAll(e).forEach(r=>{r.invalidate()}),e.refetchType==="none")return Promise.resolve();const n={...e,type:e.refetchType??e.type??"active"};return this.refetchQueries(n,t)})}refetchQueries(e={},t){const n={...t,cancelRefetch:(t==null?void 0:t.cancelRefetch)??!0},r=qt.batch(()=>K(this,ot).findAll(e).filter(o=>!o.isDisabled()).map(o=>{let i=o.fetch(void 0,n);return n.throwOnError||(i=i.catch(Kn)),o.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(Kn)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=K(this,ot).build(this,t);return n.isStaleByTime(sy(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Kn).catch(Kn)}fetchInfiniteQuery(e){return e.behavior=fy(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Kn).catch(Kn)}ensureInfiniteQueryData(e){return e.behavior=fy(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Tc.isOnline()?K(this,_o).resumePausedMutations():Promise.resolve()}getQueryCache(){return K(this,ot)}getMutationCache(){return K(this,_o)}getDefaultOptions(){return K(this,Ro)}setDefaultOptions(e){be(this,Ro,e)}setQueryDefaults(e,t){K(this,ja).set(du(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...K(this,ja).values()];let n={};return t.forEach(r=>{fu(e,r.queryKey)&&(n={...n,...r.defaultOptions})}),n}setMutationDefaults(e,t){K(this,za).set(du(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...K(this,za).values()];let n={};return t.forEach(r=>{fu(e,r.mutationKey)&&(n={...n,...r.defaultOptions})}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...K(this,Ro).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=lm(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.enabled!==!0&&t.queryFn===cm&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...K(this,Ro).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){K(this,ot).clear(),K(this,_o).clear()}},ot=new WeakMap,_o=new WeakMap,Ro=new WeakMap,ja=new WeakMap,za=new WeakMap,No=new WeakMap,Wa=new WeakMap,$a=new WeakMap,V1),lP=C.createContext(void 0),cP=({client:e,children:t})=>(C.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),S.jsx(lP.Provider,{value:e,children:t}));/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function hu(){return hu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},hu.apply(this,arguments)}var Ao;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Ao||(Ao={}));const py="popstate";function dP(e){e===void 0&&(e={});function t(r,o){let{pathname:i,search:a,hash:s}=r.location;return _p("",{pathname:i,search:a,hash:s},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(r,o){return typeof o=="string"?o:Ac(o)}return hP(t,n,null,e)}function dt(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function _2(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function fP(){return Math.random().toString(36).substr(2,8)}function vy(e,t){return{usr:e.state,key:e.key,idx:t}}function _p(e,t,n,r){return n===void 0&&(n=null),hu({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?cs(t):t,{state:n,key:t&&t.key||r||fP()})}function Ac(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&n!=="?"&&(t+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function cs(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function hP(e,t,n,r){r===void 0&&(r={});let{window:o=document.defaultView,v5Compat:i=!1}=r,a=o.history,s=Ao.Pop,u=null,l=c();l==null&&(l=0,a.replaceState(hu({},a.state,{idx:l}),""));function c(){return(a.state||{idx:null}).idx}function d(){s=Ao.Pop;let g=c(),m=g==null?null:g-l;l=g,u&&u({action:s,location:v.location,delta:m})}function f(g,m){s=Ao.Push;let y=_p(v.location,g,m);l=c()+1;let x=vy(y,l),w=v.createHref(y);try{a.pushState(x,"",w)}catch(b){if(b instanceof DOMException&&b.name==="DataCloneError")throw b;o.location.assign(w)}i&&u&&u({action:s,location:v.location,delta:1})}function h(g,m){s=Ao.Replace;let y=_p(v.location,g,m);l=c();let x=vy(y,l),w=v.createHref(y);a.replaceState(x,"",w),i&&u&&u({action:s,location:v.location,delta:0})}function p(g){let m=o.location.origin!=="null"?o.location.origin:o.location.href,y=typeof g=="string"?g:Ac(g);return y=y.replace(/ $/,"%20"),dt(m,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,m)}let v={get action(){return s},get location(){return e(o,a)},listen(g){if(u)throw new Error("A history only accepts one active listener");return o.addEventListener(py,d),u=g,()=>{o.removeEventListener(py,d),u=null}},createHref(g){return t(o,g)},createURL:p,encodeLocation(g){let m=p(g);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:f,replace:h,go(g){return a.go(g)}};return v}var my;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(my||(my={}));function pP(e,t,n){return n===void 0&&(n="/"),vP(e,t,n,!1)}function vP(e,t,n,r){let o=typeof t=="string"?cs(t):t,i=dm(o.pathname||"/",n);if(i==null)return null;let a=R2(e);mP(a);let s=null;for(let u=0;s==null&&u<a.length;++u){let l=RP(i);s=kP(a[u],l,r)}return s}function R2(e,t,n,r){t===void 0&&(t=[]),n===void 0&&(n=[]),r===void 0&&(r="");let o=(i,a,s)=>{let u={relativePath:s===void 0?i.path||"":s,caseSensitive:i.caseSensitive===!0,childrenIndex:a,route:i};u.relativePath.startsWith("/")&&(dt(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let l=Uo([r,u.relativePath]),c=n.concat(u);i.children&&i.children.length>0&&(dt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),R2(i.children,t,c,l)),!(i.path==null&&!i.index)&&t.push({path:l,score:EP(l,i.index),routesMeta:c})};return e.forEach((i,a)=>{var s;if(i.path===""||!((s=i.path)!=null&&s.includes("?")))o(i,a);else for(let u of N2(i.path))o(i,a,u)}),t}function N2(e){let t=e.split("/");if(t.length===0)return[];let[n,...r]=t,o=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return o?[i,""]:[i];let a=N2(r.join("/")),s=[];return s.push(...a.map(u=>u===""?i:[i,u].join("/"))),o&&s.push(...a),s.map(u=>e.startsWith("/")&&u===""?"/":u)}function mP(e){e.sort((t,n)=>t.score!==n.score?n.score-t.score:SP(t.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const gP=/^:[\w-]+$/,yP=3,xP=2,wP=1,bP=10,CP=-2,gy=e=>e==="*";function EP(e,t){let n=e.split("/"),r=n.length;return n.some(gy)&&(r+=CP),t&&(r+=xP),n.filter(o=>!gy(o)).reduce((o,i)=>o+(gP.test(i)?yP:i===""?wP:bP),r)}function SP(e,t){return e.length===t.length&&e.slice(0,-1).every((r,o)=>r===t[o])?e[e.length-1]-t[t.length-1]:0}function kP(e,t,n){let{routesMeta:r}=e,o={},i="/",a=[];for(let s=0;s<r.length;++s){let u=r[s],l=s===r.length-1,c=i==="/"?t:t.slice(i.length)||"/",d=yy({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),f=u.route;if(!d&&l&&n&&!r[r.length-1].route.index&&(d=yy({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!d)return null;Object.assign(o,d.params),a.push({params:o,pathname:Uo([i,d.pathname]),pathnameBase:AP(Uo([i,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(i=Uo([i,d.pathnameBase]))}return a}function yy(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=_P(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let i=o[0],a=i.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((l,c,d)=>{let{paramName:f,isOptional:h}=c;if(f==="*"){let v=s[d]||"";a=i.slice(0,i.length-v.length).replace(/(.)\/+$/,"$1")}const p=s[d];return h&&!p?l[f]=void 0:l[f]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:i,pathnameBase:a,pattern:e}}function _P(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!0),_2(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,u)=>(r.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),r]}function RP(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return _2(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function dm(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&r!=="/"?null:e.slice(n)||"/"}function NP(e,t){t===void 0&&(t="/");let{pathname:n,search:r="",hash:o=""}=typeof e=="string"?cs(e):e;return{pathname:n?n.startsWith("/")?n:IP(n,t):t,search:PP(r),hash:DP(o)}}function IP(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?n.length>1&&n.pop():o!=="."&&n.push(o)}),n.length>1?n.join("/"):"/"}function Ff(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function TP(e){return e.filter((t,n)=>n===0||t.route.path&&t.route.path.length>0)}function I2(e,t){let n=TP(e);return t?n.map((r,o)=>o===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function T2(e,t,n,r){r===void 0&&(r=!1);let o;typeof e=="string"?o=cs(e):(o=hu({},e),dt(!o.pathname||!o.pathname.includes("?"),Ff("?","pathname","search",o)),dt(!o.pathname||!o.pathname.includes("#"),Ff("#","pathname","hash",o)),dt(!o.search||!o.search.includes("#"),Ff("#","search","hash",o)));let i=e===""||o.pathname==="",a=i?"/":o.pathname,s;if(a==null)s=n;else{let d=t.length-1;if(!r&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),d-=1;o.pathname=f.join("/")}s=d>=0?t[d]:"/"}let u=NP(o,s),l=a&&a!=="/"&&a.endsWith("/"),c=(i||a===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}const Uo=e=>e.join("/").replace(/\/\/+/g,"/"),AP=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),PP=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,DP=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function MP(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const A2=["post","put","patch","delete"];new Set(A2);const FP=["get",...A2];new Set(FP);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pu(){return pu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pu.apply(this,arguments)}const fm=C.createContext(null),OP=C.createContext(null),zi=C.createContext(null),Pd=C.createContext(null),Wi=C.createContext({outlet:null,matches:[],isDataRoute:!1}),P2=C.createContext(null);function LP(e,t){let{relative:n}=t===void 0?{}:t;Lu()||dt(!1);let{basename:r,navigator:o}=C.useContext(zi),{hash:i,pathname:a,search:s}=F2(e,{relative:n}),u=a;return r!=="/"&&(u=a==="/"?r:Uo([r,a])),o.createHref({pathname:u,search:s,hash:i})}function Lu(){return C.useContext(Pd)!=null}function Bu(){return Lu()||dt(!1),C.useContext(Pd).location}function D2(e){C.useContext(zi).static||C.useLayoutEffect(e)}function M2(){let{isDataRoute:e}=C.useContext(Wi);return e?YP():BP()}function BP(){Lu()||dt(!1);let e=C.useContext(fm),{basename:t,future:n,navigator:r}=C.useContext(zi),{matches:o}=C.useContext(Wi),{pathname:i}=Bu(),a=JSON.stringify(I2(o,n.v7_relativeSplatPath)),s=C.useRef(!1);return D2(()=>{s.current=!0}),C.useCallback(function(l,c){if(c===void 0&&(c={}),!s.current)return;if(typeof l=="number"){r.go(l);return}let d=T2(l,JSON.parse(a),i,c.relative==="path");e==null&&t!=="/"&&(d.pathname=d.pathname==="/"?t:Uo([t,d.pathname])),(c.replace?r.replace:r.push)(d,c.state,c)},[t,r,a,i,e])}function F2(e,t){let{relative:n}=t===void 0?{}:t,{future:r}=C.useContext(zi),{matches:o}=C.useContext(Wi),{pathname:i}=Bu(),a=JSON.stringify(I2(o,r.v7_relativeSplatPath));return C.useMemo(()=>T2(e,JSON.parse(a),i,n==="path"),[e,a,i,n])}function jP(e,t){return zP(e,t)}function zP(e,t,n,r){Lu()||dt(!1);let{navigator:o}=C.useContext(zi),{matches:i}=C.useContext(Wi),a=i[i.length-1],s=a?a.params:{};a&&a.pathname;let u=a?a.pathnameBase:"/";a&&a.route;let l=Bu(),c;if(t){var d;let g=typeof t=="string"?cs(t):t;u==="/"||(d=g.pathname)!=null&&d.startsWith(u)||dt(!1),c=g}else c=l;let f=c.pathname||"/",h=f;if(u!=="/"){let g=u.replace(/^\//,"").split("/");h="/"+f.replace(/^\//,"").split("/").slice(g.length).join("/")}let p=pP(e,{pathname:h}),v=HP(p&&p.map(g=>Object.assign({},g,{params:Object.assign({},s,g.params),pathname:Uo([u,o.encodeLocation?o.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?u:Uo([u,o.encodeLocation?o.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),i,n,r);return t&&v?C.createElement(Pd.Provider,{value:{location:pu({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:Ao.Pop}},v):v}function WP(){let e=XP(),t=MP(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},t),n?C.createElement("pre",{style:o},n):null,null)}const $P=C.createElement(WP,null);class UP extends C.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,n){return n.location!==t.location||n.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:n.error,location:n.location,revalidation:t.revalidation||n.revalidation}}componentDidCatch(t,n){console.error("React Router caught the following error during render",t,n)}render(){return this.state.error!==void 0?C.createElement(Wi.Provider,{value:this.props.routeContext},C.createElement(P2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function VP(e){let{routeContext:t,match:n,children:r}=e,o=C.useContext(fm);return o&&o.static&&o.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=n.route.id),C.createElement(Wi.Provider,{value:t},r)}function HP(e,t,n,r){var o;if(t===void 0&&(t=[]),n===void 0&&(n=null),r===void 0&&(r=null),e==null){var i;if(!n)return null;if(n.errors)e=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let a=e,s=(o=n)==null?void 0:o.errors;if(s!=null){let c=a.findIndex(d=>d.route.id&&(s==null?void 0:s[d.route.id])!==void 0);c>=0||dt(!1),a=a.slice(0,Math.min(a.length,c+1))}let u=!1,l=-1;if(n&&r&&r.v7_partialHydration)for(let c=0;c<a.length;c++){let d=a[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=c),d.route.id){let{loaderData:f,errors:h}=n,p=d.route.loader&&f[d.route.id]===void 0&&(!h||h[d.route.id]===void 0);if(d.route.lazy||p){u=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((c,d,f)=>{let h,p=!1,v=null,g=null;n&&(h=s&&d.route.id?s[d.route.id]:void 0,v=d.route.errorElement||$P,u&&(l<0&&f===0?(p=!0,g=null):l===f&&(p=!0,g=d.route.hydrateFallbackElement||null)));let m=t.concat(a.slice(0,f+1)),y=()=>{let x;return h?x=v:p?x=g:d.route.Component?x=C.createElement(d.route.Component,null):d.route.element?x=d.route.element:x=c,C.createElement(VP,{match:d,routeContext:{outlet:c,matches:m,isDataRoute:n!=null},children:x})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?C.createElement(UP,{location:n.location,revalidation:n.revalidation,component:v,error:h,children:y(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):y()},null)}var O2=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(O2||{}),Pc=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Pc||{});function GP(e){let t=C.useContext(fm);return t||dt(!1),t}function qP(e){let t=C.useContext(OP);return t||dt(!1),t}function KP(e){let t=C.useContext(Wi);return t||dt(!1),t}function L2(e){let t=KP(),n=t.matches[t.matches.length-1];return n.route.id||dt(!1),n.route.id}function XP(){var e;let t=C.useContext(P2),n=qP(Pc.UseRouteError),r=L2(Pc.UseRouteError);return t!==void 0?t:(e=n.errors)==null?void 0:e[r]}function YP(){let{router:e}=GP(O2.UseNavigateStable),t=L2(Pc.UseNavigateStable),n=C.useRef(!1);return D2(()=>{n.current=!0}),C.useCallback(function(o,i){i===void 0&&(i={}),n.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,pu({fromRouteId:t},i)))},[e,t])}function di(e){dt(!1)}function QP(e){let{basename:t="/",children:n=null,location:r,navigationType:o=Ao.Pop,navigator:i,static:a=!1,future:s}=e;Lu()&&dt(!1);let u=t.replace(/^\/*/,"/"),l=C.useMemo(()=>({basename:u,navigator:i,static:a,future:pu({v7_relativeSplatPath:!1},s)}),[u,s,i,a]);typeof r=="string"&&(r=cs(r));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:p="default"}=r,v=C.useMemo(()=>{let g=dm(c,u);return g==null?null:{location:{pathname:g,search:d,hash:f,state:h,key:p},navigationType:o}},[u,c,d,f,h,p,o]);return v==null?null:C.createElement(zi.Provider,{value:l},C.createElement(Pd.Provider,{children:n,value:v}))}function JP(e){let{children:t,location:n}=e;return jP(Rp(t),n)}new Promise(()=>{});function Rp(e,t){t===void 0&&(t=[]);let n=[];return C.Children.forEach(e,(r,o)=>{if(!C.isValidElement(r))return;let i=[...t,o];if(r.type===C.Fragment){n.push.apply(n,Rp(r.props.children,i));return}r.type!==di&&dt(!1),!r.props.index||!r.props.children||dt(!1);let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Rp(r.props.children,i)),n.push(a)}),n}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Np(){return Np=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Np.apply(this,arguments)}function ZP(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,i;for(i=0;i<r.length;i++)o=r[i],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function eD(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function tD(e,t){return e.button===0&&(!t||t==="_self")&&!eD(e)}const nD=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],rD="6";try{window.__reactRouterVersion=rD}catch{}const oD="startTransition",xy=nx[oD];function iD(e){let{basename:t,children:n,future:r,window:o}=e,i=C.useRef();i.current==null&&(i.current=dP({window:o,v5Compat:!0}));let a=i.current,[s,u]=C.useState({action:a.action,location:a.location}),{v7_startTransition:l}=r||{},c=C.useCallback(d=>{l&&xy?xy(()=>u(d)):u(d)},[u,l]);return C.useLayoutEffect(()=>a.listen(c),[a,c]),C.createElement(QP,{basename:t,children:n,location:s.location,navigationType:s.action,navigator:a,future:r})}const aD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",sD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Of=C.forwardRef(function(t,n){let{onClick:r,relative:o,reloadDocument:i,replace:a,state:s,target:u,to:l,preventScrollReset:c,viewTransition:d}=t,f=ZP(t,nD),{basename:h}=C.useContext(zi),p,v=!1;if(typeof l=="string"&&sD.test(l)&&(p=l,aD))try{let x=new URL(window.location.href),w=l.startsWith("//")?new URL(x.protocol+l):new URL(l),b=dm(w.pathname,h);w.origin===x.origin&&b!=null?l=b+w.search+w.hash:v=!0}catch{}let g=LP(l,{relative:o}),m=uD(l,{replace:a,state:s,target:u,preventScrollReset:c,relative:o,viewTransition:d});function y(x){r&&r(x),x.defaultPrevented||m(x)}return C.createElement("a",Np({},f,{href:p||g,onClick:v||i?r:y,ref:n,target:u}))});var wy;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(wy||(wy={}));var by;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(by||(by={}));function uD(e,t){let{target:n,replace:r,state:o,preventScrollReset:i,relative:a,viewTransition:s}=t===void 0?{}:t,u=M2(),l=Bu(),c=F2(e,{relative:a});return C.useCallback(d=>{if(tD(d,n)){d.preventDefault();let f=r!==void 0?r:Ac(l)===Ac(c);u(e,{replace:f,state:o,preventScrollReset:i,relative:a,viewTransition:s})}},[l,u,c,r,o,n,e,i,a,s])}const lD={hobbies:[],favoritePlaces:[],favoriteGames:[],bestFriends:[],favoriteFood:[]},cD=C.createContext(void 0),dD=({children:e})=>{const[t,n]=C.useState(()=>{const i=localStorage.getItem("userPreferences");return i?JSON.parse(i):lD});C.useEffect(()=>{localStorage.setItem("userPreferences",JSON.stringify(t))},[t]);const r=(i,a)=>{n(s=>({...s,[i]:a}))},o=(i,a)=>{n(s=>({...s,[i]:Array.isArray(s[i])?[...s[i],a]:[a]}))};return S.jsx(cD.Provider,{value:{preferences:t,updatePreference:r,addPreference:o},children:e})};function hm(){const[e,t]=C.useState(navigator.onLine),[n,r]=C.useState("good"),[o,i]=C.useState(!1),[a,s]=C.useState(new Date),u=C.useRef(0),l=2;C.useEffect(()=>{const d=()=>{t(!0),s(new Date),u.current=0},f=()=>{t(!1),s(new Date)};window.addEventListener("online",d),window.addEventListener("offline",f);const h=async()=>{if(!navigator.onLine){t(!1);return}try{const v=Date.now(),g=new Image;let m=!1,y=!1;const x=new Promise((E,k)=>{setTimeout(()=>{y=!0,k(new Error("Connection test timed out"))},8e3)}),w=new Promise(E=>{g.onload=()=>{m=!0,E()},g.onerror=()=>{m=!0,E()},g.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"});await Promise.race([w,x]);const b=Date.now()-v;y||b>2500?(u.current++,u.current>=l&&(r("poor"),i(!0))):(r("good"),i(!1),u.current=0),t(!0)}catch{u.current++,u.current>=l&&(r("poor"),i(!0)),navigator.onLine||t(!1)}};h();const p=setInterval(h,15e3);return()=>{window.removeEventListener("online",d),window.removeEventListener("offline",f),clearInterval(p)}},[]);const c=!e||n==="poor"&&u.current>=l;return{isOnline:e,connectionQuality:n,hasBuffering:o,lastConnectionChange:a,hasSignificantConnectionIssue:c}}const fD=Fu("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",warning:"border-amber-500/50 text-amber-500 dark:border-amber-500 [&>svg]:text-amber-500"}},defaultVariants:{variant:"default"}}),B2=C.forwardRef(({className:e,variant:t,...n},r)=>S.jsx("div",{ref:r,role:"alert",className:Ve(fD({variant:t}),e),...n}));B2.displayName="Alert";const j2=C.forwardRef(({className:e,...t},n)=>S.jsx("h5",{ref:n,className:Ve("mb-1 font-medium leading-none tracking-tight",e),...t}));j2.displayName="AlertTitle";const z2=C.forwardRef(({className:e,...t},n)=>S.jsx("div",{ref:n,className:Ve("text-sm [&_p]:leading-relaxed",e),...t}));z2.displayName="AlertDescription";const hD=Fu("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:shadow-primary/30 hover:scale-105 relative overflow-hidden before:absolute before:inset-0 before:bg-white/20 before:scale-x-0 hover:before:scale-x-100 before:origin-left before:transition-transform before:duration-500 before:opacity-0 hover:before:opacity-100",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 hover:shadow-lg hover:shadow-destructive/30 hover:-translate-y-0.5",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:shadow-md hover:-translate-y-0.5 hover:border-therapeutic-calm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-md hover:shadow-secondary/20 hover:-translate-y-0.5",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",therapeutic:"bg-therapeutic-calm text-white hover:bg-therapeutic-calm/90 hover:shadow-lg hover:shadow-therapeutic-calm/50 relative overflow-hidden before:absolute before:inset-0 before:bg-white/20 before:scale-x-0 hover:before:scale-x-100 before:origin-left before:transition-transform before:duration-500 hover:scale-[1.02] transition-all duration-300"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Bt=C.forwardRef(({className:e,variant:t,size:n,asChild:r=!1,...o},i)=>{const a=r?Ya:"button";return S.jsx(a,{className:Ve(hD({variant:t,size:n,className:e})),ref:i,...o})});Bt.displayName="Button";const pD=({onNetworkIssue:e})=>{const{isOnline:t,connectionQuality:n,hasBuffering:r,hasSignificantConnectionIssue:o}=hm(),[i,a]=C.useState(!1),[s,u]=C.useState(!1);return C.useEffect(()=>{if(o&&!i){const l=setTimeout(()=>{u(!0),e&&e(!0)},3e3);return()=>clearTimeout(l)}else u(!1),e&&e(!1)},[o,i,e]),C.useEffect(()=>{t&&n==="good"&&!r&&a(!1)},[t,n,r]),s?S.jsx(B2,{variant:"warning",className:"fixed top-4 right-4 max-w-md z-50 bg-white dark:bg-gray-900 shadow-lg animate-in fade-in duration-300",children:S.jsxs("div",{className:"flex justify-between items-start",children:[S.jsxs("div",{className:"flex-1",children:[S.jsx(Ed,{className:"h-4 w-4"}),S.jsx(j2,{children:"Network Connection Issue"}),S.jsx(z2,{children:t?n==="poor"?"Your connection seems unstable. This may affect video quality and facial recognition.":"Connection buffering detected. For the best experience, try moving to an area with better signal.":"Your device appears to be offline. Please check your internet connection."})]}),S.jsx(Bt,{variant:"ghost",size:"icon",className:"h-6 w-6 mt-1",onClick:()=>a(!0),children:S.jsx(Sd,{className:"h-4 w-4"})})]})}):null},Lf=768;function ju(){const[e,t]=C.useState(void 0);return C.useEffect(()=>{const n=window.matchMedia(`(max-width: ${Lf-1}px)`),r=()=>{t(window.innerWidth<Lf)};return n.addEventListener("change",r),t(window.innerWidth<Lf),()=>n.removeEventListener("change",r)},[]),!!e}var Bf="focusScope.autoFocusOnMount",jf="focusScope.autoFocusOnUnmount",Cy={bubbles:!1,cancelable:!0},vD="FocusScope",W2=C.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:i,...a}=e,[s,u]=C.useState(null),l=In(o),c=In(i),d=C.useRef(null),f=ft(t,v=>u(v)),h=C.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;C.useEffect(()=>{if(r){let v=function(x){if(h.paused||!s)return;const w=x.target;s.contains(w)?d.current=w:xo(d.current,{select:!0})},g=function(x){if(h.paused||!s)return;const w=x.relatedTarget;w!==null&&(s.contains(w)||xo(d.current,{select:!0}))},m=function(x){if(document.activeElement===document.body)for(const b of x)b.removedNodes.length>0&&xo(s)};document.addEventListener("focusin",v),document.addEventListener("focusout",g);const y=new MutationObserver(m);return s&&y.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",g),y.disconnect()}}},[r,s,h.paused]),C.useEffect(()=>{if(s){Sy.add(h);const v=document.activeElement;if(!s.contains(v)){const m=new CustomEvent(Bf,Cy);s.addEventListener(Bf,l),s.dispatchEvent(m),m.defaultPrevented||(mD(bD($2(s)),{select:!0}),document.activeElement===v&&xo(s))}return()=>{s.removeEventListener(Bf,l),setTimeout(()=>{const m=new CustomEvent(jf,Cy);s.addEventListener(jf,c),s.dispatchEvent(m),m.defaultPrevented||xo(v??document.body,{select:!0}),s.removeEventListener(jf,c),Sy.remove(h)},0)}}},[s,l,c,h]);const p=C.useCallback(v=>{if(!n&&!r||h.paused)return;const g=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,m=document.activeElement;if(g&&m){const y=v.currentTarget,[x,w]=gD(y);x&&w?!v.shiftKey&&m===w?(v.preventDefault(),n&&xo(x,{select:!0})):v.shiftKey&&m===x&&(v.preventDefault(),n&&xo(w,{select:!0})):m===y&&v.preventDefault()}},[n,r,h.paused]);return S.jsx(je.div,{tabIndex:-1,...a,ref:f,onKeyDown:p})});W2.displayName=vD;function mD(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(xo(r,{select:t}),document.activeElement!==n)return}function gD(e){const t=$2(e),n=Ey(t,e),r=Ey(t.reverse(),e);return[n,r]}function $2(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Ey(e,t){for(const n of e)if(!yD(n,{upTo:t}))return n}function yD(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function xD(e){return e instanceof HTMLInputElement&&"select"in e}function xo(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&xD(e)&&t&&e.select()}}var Sy=wD();function wD(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=ky(e,t),e.unshift(t)},remove(t){var n;e=ky(e,t),(n=e[0])==null||n.resume()}}}function ky(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function bD(e){return e.filter(t=>t.tagName!=="A")}var zf=0;function CD(){C.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??_y()),document.body.insertAdjacentElement("beforeend",e[1]??_y()),zf++,()=>{zf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),zf--}},[])}function _y(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Cr=function(){return Cr=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Cr.apply(this,arguments)};function U2(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n}function ED(e,t,n){if(n||arguments.length===2)for(var r=0,o=t.length,i;r<o;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}var Zl="right-scroll-bar-position",ec="width-before-scroll-bar",SD="with-scroll-bars-hidden",kD="--removed-body-scroll-bar-size";function Wf(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function _D(e,t){var n=C.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(r){var o=n.value;o!==r&&(n.value=r,n.callback(r,o))}}}})[0];return n.callback=t,n.facade}var RD=typeof window<"u"?C.useLayoutEffect:C.useEffect,Ry=new WeakMap;function ND(e,t){var n=_D(null,function(r){return e.forEach(function(o){return Wf(o,r)})});return RD(function(){var r=Ry.get(n);if(r){var o=new Set(r),i=new Set(e),a=n.current;o.forEach(function(s){i.has(s)||Wf(s,null)}),i.forEach(function(s){o.has(s)||Wf(s,a)})}Ry.set(n,e)},[e]),n}function ID(e){return e}function TD(e,t){t===void 0&&(t=ID);var n=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(i){var a=t(i,r);return n.push(a),function(){n=n.filter(function(s){return s!==a})}},assignSyncMedium:function(i){for(r=!0;n.length;){var a=n;n=[],a.forEach(i)}n={push:function(s){return i(s)},filter:function(){return n}}},assignMedium:function(i){r=!0;var a=[];if(n.length){var s=n;n=[],s.forEach(i),a=n}var u=function(){var c=a;a=[],c.forEach(i)},l=function(){return Promise.resolve().then(u)};l(),n={push:function(c){a.push(c),l()},filter:function(c){return a=a.filter(c),n}}}};return o}function AD(e){e===void 0&&(e={});var t=TD(null);return t.options=Cr({async:!0,ssr:!1},e),t}var V2=function(e){var t=e.sideCar,n=U2(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw new Error("Sidecar medium not found");return C.createElement(r,Cr({},n))};V2.isSideCarExport=!0;function PD(e,t){return e.useMedium(t),V2}var H2=AD(),$f=function(){},Dd=C.forwardRef(function(e,t){var n=C.useRef(null),r=C.useState({onScrollCapture:$f,onWheelCapture:$f,onTouchMoveCapture:$f}),o=r[0],i=r[1],a=e.forwardProps,s=e.children,u=e.className,l=e.removeScrollBar,c=e.enabled,d=e.shards,f=e.sideCar,h=e.noIsolation,p=e.inert,v=e.allowPinchZoom,g=e.as,m=g===void 0?"div":g,y=e.gapMode,x=U2(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),w=f,b=ND([n,t]),E=Cr(Cr({},x),o);return C.createElement(C.Fragment,null,c&&C.createElement(w,{sideCar:H2,removeScrollBar:l,shards:d,noIsolation:h,inert:p,setCallbacks:i,allowPinchZoom:!!v,lockRef:n,gapMode:y}),a?C.cloneElement(C.Children.only(s),Cr(Cr({},E),{ref:b})):C.createElement(m,Cr({},E,{className:u,ref:b}),s))});Dd.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Dd.classNames={fullWidth:ec,zeroRight:Zl};var DD=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function MD(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=DD();return t&&e.setAttribute("nonce",t),e}function FD(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function OD(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var LD=function(){var e=0,t=null;return{add:function(n){e==0&&(t=MD())&&(FD(t,n),OD(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},BD=function(){var e=LD();return function(t,n){C.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},G2=function(){var e=BD(),t=function(n){var r=n.styles,o=n.dynamic;return e(r,o),null};return t},jD={left:0,top:0,right:0,gap:0},Uf=function(e){return parseInt(e||"",10)||0},zD=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[Uf(n),Uf(r),Uf(o)]},WD=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return jD;var t=zD(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},$D=G2(),_a="data-scroll-locked",UD=function(e,t,n,r){var o=e.left,i=e.top,a=e.right,s=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(SD,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(s,"px ").concat(r,`;
  }
  body[`).concat(_a,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(i,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(s,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Zl,` {
    right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(ec,` {
    margin-right: `).concat(s,"px ").concat(r,`;
  }
  
  .`).concat(Zl," .").concat(Zl,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(ec," .").concat(ec,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(_a,`] {
    `).concat(kD,": ").concat(s,`px;
  }
`)},Ny=function(){var e=parseInt(document.body.getAttribute(_a)||"0",10);return isFinite(e)?e:0},VD=function(){C.useEffect(function(){return document.body.setAttribute(_a,(Ny()+1).toString()),function(){var e=Ny()-1;e<=0?document.body.removeAttribute(_a):document.body.setAttribute(_a,e.toString())}},[])},HD=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;VD();var i=C.useMemo(function(){return WD(o)},[o]);return C.createElement($D,{styles:UD(i,!t,o,n?"":"!important")})},Ip=!1;if(typeof window<"u")try{var Cl=Object.defineProperty({},"passive",{get:function(){return Ip=!0,!0}});window.addEventListener("test",Cl,Cl),window.removeEventListener("test",Cl,Cl)}catch{Ip=!1}var Xi=Ip?{passive:!1}:!1,GD=function(e){return e.tagName==="TEXTAREA"},q2=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!GD(e)&&n[t]==="visible")},qD=function(e){return q2(e,"overflowY")},KD=function(e){return q2(e,"overflowX")},Iy=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=K2(e,r);if(o){var i=X2(e,r),a=i[1],s=i[2];if(a>s)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},XD=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},YD=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},K2=function(e,t){return e==="v"?qD(t):KD(t)},X2=function(e,t){return e==="v"?XD(t):YD(t)},QD=function(e,t){return e==="h"&&t==="rtl"?-1:1},JD=function(e,t,n,r,o){var i=QD(e,window.getComputedStyle(t).direction),a=i*r,s=n.target,u=t.contains(s),l=!1,c=a>0,d=0,f=0;do{var h=X2(e,s),p=h[0],v=h[1],g=h[2],m=v-g-i*p;(p||m)&&K2(e,s)&&(d+=m,f+=p),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!u&&s!==document.body||u&&(t.contains(s)||t===s));return(c&&(Math.abs(d)<1||!o)||!c&&(Math.abs(f)<1||!o))&&(l=!0),l},El=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Ty=function(e){return[e.deltaX,e.deltaY]},Ay=function(e){return e&&"current"in e?e.current:e},ZD=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e3=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},t3=0,Yi=[];function n3(e){var t=C.useRef([]),n=C.useRef([0,0]),r=C.useRef(),o=C.useState(t3++)[0],i=C.useState(G2)[0],a=C.useRef(e);C.useEffect(function(){a.current=e},[e]),C.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var v=ED([e.lockRef.current],(e.shards||[]).map(Ay),!0).filter(Boolean);return v.forEach(function(g){return g.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),v.forEach(function(g){return g.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var s=C.useCallback(function(v,g){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!a.current.allowPinchZoom;var m=El(v),y=n.current,x="deltaX"in v?v.deltaX:y[0]-m[0],w="deltaY"in v?v.deltaY:y[1]-m[1],b,E=v.target,k=Math.abs(x)>Math.abs(w)?"h":"v";if("touches"in v&&k==="h"&&E.type==="range")return!1;var _=Iy(k,E);if(!_)return!0;if(_?b=k:(b=k==="v"?"h":"v",_=Iy(k,E)),!_)return!1;if(!r.current&&"changedTouches"in v&&(x||w)&&(r.current=b),!b)return!0;var R=r.current||b;return JD(R,g,v,R==="h"?x:w,!0)},[]),u=C.useCallback(function(v){var g=v;if(!(!Yi.length||Yi[Yi.length-1]!==i)){var m="deltaY"in g?Ty(g):El(g),y=t.current.filter(function(b){return b.name===g.type&&(b.target===g.target||g.target===b.shadowParent)&&ZD(b.delta,m)})[0];if(y&&y.should){g.cancelable&&g.preventDefault();return}if(!y){var x=(a.current.shards||[]).map(Ay).filter(Boolean).filter(function(b){return b.contains(g.target)}),w=x.length>0?s(g,x[0]):!a.current.noIsolation;w&&g.cancelable&&g.preventDefault()}}},[]),l=C.useCallback(function(v,g,m,y){var x={name:v,delta:g,target:m,should:y,shadowParent:r3(m)};t.current.push(x),setTimeout(function(){t.current=t.current.filter(function(w){return w!==x})},1)},[]),c=C.useCallback(function(v){n.current=El(v),r.current=void 0},[]),d=C.useCallback(function(v){l(v.type,Ty(v),v.target,s(v,e.lockRef.current))},[]),f=C.useCallback(function(v){l(v.type,El(v),v.target,s(v,e.lockRef.current))},[]);C.useEffect(function(){return Yi.push(i),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",u,Xi),document.addEventListener("touchmove",u,Xi),document.addEventListener("touchstart",c,Xi),function(){Yi=Yi.filter(function(v){return v!==i}),document.removeEventListener("wheel",u,Xi),document.removeEventListener("touchmove",u,Xi),document.removeEventListener("touchstart",c,Xi)}},[]);var h=e.removeScrollBar,p=e.inert;return C.createElement(C.Fragment,null,p?C.createElement(i,{styles:e3(o)}):null,h?C.createElement(HD,{gapMode:e.gapMode}):null)}function r3(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const o3=PD(H2,n3);var Y2=C.forwardRef(function(e,t){return C.createElement(Dd,Cr({},e,{ref:t,sideCar:o3}))});Y2.classNames=Dd.classNames;var i3=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Qi=new WeakMap,Sl=new WeakMap,kl={},Vf=0,Q2=function(e){return e&&(e.host||Q2(e.parentNode))},a3=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=Q2(n);return r&&e.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},s3=function(e,t,n,r){var o=a3(t,Array.isArray(e)?e:[e]);kl[n]||(kl[n]=new WeakMap);var i=kl[n],a=[],s=new Set,u=new Set(o),l=function(d){!d||s.has(d)||(s.add(d),l(d.parentNode))};o.forEach(l);var c=function(d){!d||u.has(d)||Array.prototype.forEach.call(d.children,function(f){if(s.has(f))c(f);else try{var h=f.getAttribute(r),p=h!==null&&h!=="false",v=(Qi.get(f)||0)+1,g=(i.get(f)||0)+1;Qi.set(f,v),i.set(f,g),a.push(f),v===1&&p&&Sl.set(f,!0),g===1&&f.setAttribute(n,"true"),p||f.setAttribute(r,"true")}catch(m){console.error("aria-hidden: cannot operate on ",f,m)}})};return c(t),s.clear(),Vf++,function(){a.forEach(function(d){var f=Qi.get(d)-1,h=i.get(d)-1;Qi.set(d,f),i.set(d,h),f||(Sl.has(d)||d.removeAttribute(r),Sl.delete(d)),h||d.removeAttribute(n)}),Vf--,Vf||(Qi=new WeakMap,Qi=new WeakMap,Sl=new WeakMap,kl={})}},u3=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),o=i3(e);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),s3(r,o,n,"aria-hidden")):function(){return null}},pm="Dialog",[J2,FW]=Mu(pm),[l3,ar]=J2(pm),Z2=e=>{const{__scopeDialog:t,children:n,open:r,defaultOpen:o,onOpenChange:i,modal:a=!0}=e,s=C.useRef(null),u=C.useRef(null),[l=!1,c]=xd({prop:r,defaultProp:o,onChange:i});return S.jsx(l3,{scope:t,triggerRef:s,contentRef:u,contentId:Af(),titleId:Af(),descriptionId:Af(),open:l,onOpenChange:c,onOpenToggle:C.useCallback(()=>c(d=>!d),[c]),modal:a,children:n})};Z2.displayName=pm;var eC="DialogTrigger",tC=C.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=ar(eC,n),i=ft(t,o.triggerRef);return S.jsx(je.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":gm(o.open),...r,ref:i,onClick:Pe(e.onClick,o.onOpenToggle)})});tC.displayName=eC;var vm="DialogPortal",[c3,nC]=J2(vm,{forceMount:void 0}),rC=e=>{const{__scopeDialog:t,forceMount:n,children:r,container:o}=e,i=ar(vm,t);return S.jsx(c3,{scope:t,forceMount:n,children:C.Children.map(r,a=>S.jsx(as,{present:n||i.open,children:S.jsx(Yv,{asChild:!0,container:o,children:a})}))})};rC.displayName=vm;var Dc="DialogOverlay",oC=C.forwardRef((e,t)=>{const n=nC(Dc,e.__scopeDialog),{forceMount:r=n.forceMount,...o}=e,i=ar(Dc,e.__scopeDialog);return i.modal?S.jsx(as,{present:r||i.open,children:S.jsx(d3,{...o,ref:t})}):null});oC.displayName=Dc;var d3=C.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=ar(Dc,n);return S.jsx(Y2,{as:Ya,allowPinchZoom:!0,shards:[o.contentRef],children:S.jsx(je.div,{"data-state":gm(o.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),Oi="DialogContent",iC=C.forwardRef((e,t)=>{const n=nC(Oi,e.__scopeDialog),{forceMount:r=n.forceMount,...o}=e,i=ar(Oi,e.__scopeDialog);return S.jsx(as,{present:r||i.open,children:i.modal?S.jsx(f3,{...o,ref:t}):S.jsx(h3,{...o,ref:t})})});iC.displayName=Oi;var f3=C.forwardRef((e,t)=>{const n=ar(Oi,e.__scopeDialog),r=C.useRef(null),o=ft(t,n.contentRef,r);return C.useEffect(()=>{const i=r.current;if(i)return u3(i)},[]),S.jsx(aC,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Pe(e.onCloseAutoFocus,i=>{var a;i.preventDefault(),(a=n.triggerRef.current)==null||a.focus()}),onPointerDownOutside:Pe(e.onPointerDownOutside,i=>{const a=i.detail.originalEvent,s=a.button===0&&a.ctrlKey===!0;(a.button===2||s)&&i.preventDefault()}),onFocusOutside:Pe(e.onFocusOutside,i=>i.preventDefault())})}),h3=C.forwardRef((e,t)=>{const n=ar(Oi,e.__scopeDialog),r=C.useRef(!1),o=C.useRef(!1);return S.jsx(aC,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var a,s;(a=e.onCloseAutoFocus)==null||a.call(e,i),i.defaultPrevented||(r.current||(s=n.triggerRef.current)==null||s.focus(),i.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:i=>{var u,l;(u=e.onInteractOutside)==null||u.call(e,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const a=i.target;((l=n.triggerRef.current)==null?void 0:l.contains(a))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}})}),aC=C.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:i,...a}=e,s=ar(Oi,n),u=C.useRef(null),l=ft(t,u);return CD(),S.jsxs(S.Fragment,{children:[S.jsx(W2,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:i,children:S.jsx(yd,{role:"dialog",id:s.contentId,"aria-describedby":s.descriptionId,"aria-labelledby":s.titleId,"data-state":gm(s.open),...a,ref:l,onDismiss:()=>s.onOpenChange(!1)})}),S.jsxs(S.Fragment,{children:[S.jsx(p3,{titleId:s.titleId}),S.jsx(m3,{contentRef:u,descriptionId:s.descriptionId})]})]})}),mm="DialogTitle",sC=C.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=ar(mm,n);return S.jsx(je.h2,{id:o.titleId,...r,ref:t})});sC.displayName=mm;var uC="DialogDescription",lC=C.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=ar(uC,n);return S.jsx(je.p,{id:o.descriptionId,...r,ref:t})});lC.displayName=uC;var cC="DialogClose",dC=C.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=ar(cC,n);return S.jsx(je.button,{type:"button",...r,ref:t,onClick:Pe(e.onClick,()=>o.onOpenChange(!1))})});dC.displayName=cC;function gm(e){return e?"open":"closed"}var fC="DialogTitleWarning",[OW,hC]=ZR(fC,{contentName:Oi,titleName:mm,docsSlug:"dialog"}),p3=({titleId:e})=>{const t=hC(fC),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return C.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},v3="DialogDescriptionWarning",m3=({contentRef:e,descriptionId:t})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${hC(v3).contentName}}.`;return C.useEffect(()=>{var i;const o=(i=e.current)==null?void 0:i.getAttribute("aria-describedby");t&&o&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null},g3=Z2,y3=tC,x3=rC,pC=oC,vC=iC,mC=sC,gC=lC,w3=dC;const b3=g3,Py=y3,C3=x3,yC=C.forwardRef(({className:e,...t},n)=>S.jsx(pC,{className:Ve("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));yC.displayName=pC.displayName;const E3=Fu("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),xC=C.forwardRef(({side:e="right",className:t,children:n,...r},o)=>S.jsxs(C3,{children:[S.jsx(yC,{}),S.jsxs(vC,{ref:o,className:Ve(E3({side:e}),t),...r,children:[n,S.jsxs(w3,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[S.jsx(Sd,{className:"h-4 w-4"}),S.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));xC.displayName=vC.displayName;const S3=C.forwardRef(({className:e,...t},n)=>S.jsx(mC,{ref:n,className:Ve("text-lg font-semibold text-foreground",e),...t}));S3.displayName=mC.displayName;const k3=C.forwardRef(({className:e,...t},n)=>S.jsx(gC,{ref:n,className:Ve("text-sm text-muted-foreground",e),...t}));k3.displayName=gC.displayName;var _3="Toggle",wC=C.forwardRef((e,t)=>{const{pressed:n,defaultPressed:r=!1,onPressedChange:o,...i}=e,[a=!1,s]=xd({prop:n,onChange:o,defaultProp:r});return S.jsx(je.button,{type:"button","aria-pressed":a,"data-state":a?"on":"off","data-disabled":e.disabled?"":void 0,...i,ref:t,onClick:Pe(e.onClick,()=>{e.disabled||s(!a)})})});wC.displayName=_3;var bC=wC;const R3=Fu("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),CC=C.forwardRef(({className:e,variant:t,size:n,...r},o)=>S.jsx(bC,{ref:o,className:Ve(R3({variant:t,size:n,className:e})),...r}));CC.displayName=bC.displayName;const ym=({onLoginClick:e})=>{const[t,n]=J.useState("light"),[r,o]=J.useState(!1),[i,a]=J.useState(!1),s=ju(),u=()=>{const d=t==="light"?"dark":"light";n(d),document.documentElement.classList.toggle("dark",d==="dark")},l=()=>{o(!r),e&&e()},c=[{icon:gp,label:"Chat",path:"/chat"},{icon:jN,label:"About",path:"/about"}];return S.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 px-4 py-3 bg-gradient-to-r from-[#9b87f5]/80 to-[#87CEEB]/80 backdrop-blur-lg border-b border-border/40",children:S.jsxs("div",{className:"container flex items-center justify-between",children:[S.jsx("div",{className:"flex items-center space-x-4",children:S.jsxs(Of,{to:"/",className:"flex items-center space-x-2",children:[S.jsx("div",{className:"h-8 w-8 rounded-full bg-white/90 flex items-center justify-center",children:S.jsx("span",{className:"text-lg font-bold text-primary",children:"C"})}),!s&&S.jsx("span",{className:"text-xl font-semibold text-white",children:"Cybella"})]})}),s?S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsxs(Bt,{variant:"ghost",size:"icon",onClick:u,className:"text-white",children:[t==="light"?S.jsx(H0,{size:20}):S.jsx(q0,{size:20}),S.jsx("span",{className:"sr-only",children:"Toggle theme"})]}),S.jsxs(b3,{open:i,onOpenChange:a,children:[S.jsx(Py,{asChild:!0,children:S.jsx(Bt,{variant:"ghost",size:"icon",className:"text-white h-8 w-8 p-0",children:S.jsx(VN,{size:24})})}),S.jsx(xC,{side:"right",className:"w-[260px] bg-gradient-to-b from-[#9b87f5]/95 to-[#87CEEB]/95 text-white backdrop-blur-lg",children:S.jsxs("div",{className:"flex flex-col gap-6 pt-6",children:[S.jsxs("div",{className:"flex items-center justify-between",children:[S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx("div",{className:"h-8 w-8 rounded-full bg-white/90 flex items-center justify-center",children:S.jsx("span",{className:"text-lg font-bold text-primary",children:"C"})}),S.jsx("span",{className:"text-xl font-semibold text-white",children:"Cybella"})]}),S.jsx(Py,{asChild:!0,children:S.jsx(Bt,{variant:"ghost",size:"icon",className:"text-white h-8 w-8 p-0",children:S.jsx(Sd,{size:20})})})]}),S.jsx("div",{className:"flex flex-col space-y-2",children:c.map(d=>S.jsxs(Of,{to:d.path,onClick:()=>a(!1),className:"flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/20 transition-colors",children:[S.jsx(d.icon,{size:20}),S.jsx("span",{children:d.label})]},d.label))}),S.jsx("div",{className:"mt-auto border-t border-white/20 pt-4",children:S.jsxs(Bt,{variant:"outline",onClick:l,className:"w-full bg-white/10 text-white border-white/30 hover:bg-white/20",children:[S.jsx(V0,{size:18,className:"mr-2"}),r?"Sign Out":"Sign In"]})})]})})]})]}):S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"flex-1 flex items-center justify-center",children:S.jsx("div",{className:"rounded-full bg-white/20 backdrop-blur-md p-1 flex items-center gap-1",children:c.map(d=>S.jsx(Of,{to:d.path,children:S.jsxs(CC,{className:"flex items-center gap-2 px-3 py-2 text-white hover:bg-white/20 rounded-full data-[state=on]:bg-white/30",children:[S.jsx(d.icon,{size:20}),S.jsx("span",{children:d.label})]})},d.label))})}),S.jsxs("div",{className:"flex items-center space-x-4",children:[S.jsxs(Bt,{variant:"outline",size:"sm",onClick:l,className:"flex items-center gap-1 bg-white/10 text-white border-white/30 hover:bg-white/20",children:[S.jsx(V0,{size:18}),S.jsx("span",{children:r?"Sign Out":"Sign In"})]}),S.jsxs(Bt,{variant:"ghost",size:"icon",onClick:u,className:"text-white hover:bg-white/20",children:[t==="light"?S.jsx(H0,{size:20}):S.jsx(q0,{size:20}),S.jsx("span",{className:"sr-only",children:"Toggle theme"})]})]})]})]})})},xm=()=>{const e=new Date().getFullYear();return S.jsx("footer",{className:"py-4 px-6 border-t bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:S.jsxs("div",{className:"container",children:[S.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[S.jsxs("p",{className:"text-sm text-muted-foreground",children:["© ",e," Cybella AI. All rights reserved."]}),S.jsxs("div",{className:"flex items-center space-x-4 mt-2 md:mt-0",children:[S.jsx("a",{href:"#",className:"text-sm text-muted-foreground hover:text-foreground",children:"Privacy"}),S.jsx("a",{href:"#",className:"text-sm text-muted-foreground hover:text-foreground",children:"Terms"}),S.jsx("a",{href:"#",className:"text-sm text-muted-foreground hover:text-foreground",children:"Contact"})]})]}),S.jsx("div",{className:"mt-4 text-xs text-center text-muted-foreground",children:"Cybella AI is designed for emotional support and does not replace professional therapy."})]})})},tn=C.forwardRef(({className:e,...t},n)=>S.jsx("div",{ref:n,className:Ve("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));tn.displayName="Card";const N3=C.forwardRef(({className:e,...t},n)=>S.jsx("div",{ref:n,className:Ve("flex flex-col space-y-1.5 p-6",e),...t}));N3.displayName="CardHeader";const I3=C.forwardRef(({className:e,...t},n)=>S.jsx("h3",{ref:n,className:Ve("text-2xl font-semibold leading-none tracking-tight",e),...t}));I3.displayName="CardTitle";const T3=C.forwardRef(({className:e,...t},n)=>S.jsx("p",{ref:n,className:Ve("text-sm text-muted-foreground",e),...t}));T3.displayName="CardDescription";const fi=C.forwardRef(({className:e,...t},n)=>S.jsx("div",{ref:n,className:Ve("p-6 pt-0",e),...t}));fi.displayName="CardContent";const A3=C.forwardRef(({className:e,...t},n)=>S.jsx("div",{ref:n,className:Ve("flex items-center p-6 pt-0",e),...t}));A3.displayName="CardFooter";const Hf=()=>{const e=M2();return S.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-[#1E90FF] to-[#87CEEB]",children:[S.jsx(ym,{}),S.jsx("section",{className:"relative flex flex-col items-center justify-center min-h-[60vh] px-4 py-20 pt-28",children:S.jsxs("div",{className:"container max-w-[1200px] mx-auto text-center space-y-8",children:[S.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-white animate-fade-in",children:"Your AI Therapy Companion"}),S.jsx("p",{className:"text-xl md:text-2xl max-w-[800px] mx-auto text-white opacity-90 animate-fade-in",style:{animationDelay:"0.2s"},children:"Experience emotional support through AI-powered voice therapy and facial recognition"}),S.jsx("div",{className:"mt-8 flex flex-col sm:flex-row justify-center gap-4 items-center",children:S.jsxs(Bt,{size:"lg",variant:"therapeutic",className:"text-lg px-8 py-6 rounded-full group animate-pulse-gentle",onClick:()=>e("/chat"),children:[S.jsxs("span",{className:"relative z-10 flex items-center",children:[S.jsx(gp,{className:"mr-2"}),"Start Conversation",S.jsx(zN,{className:"ml-2 transition-transform group-hover:translate-x-1"})]}),S.jsx("span",{className:"absolute inset-0 bg-white/10 transform scale-0 group-hover:scale-100 transition-transform duration-500 rounded-full"})]})})]})}),S.jsxs("main",{className:"flex-1 container py-16 px-4 mx-auto",children:[S.jsxs("div",{className:"max-w-[1200px] mx-auto grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[S.jsx(tn,{className:"bg-white/20 backdrop-blur-sm border-white/30 text-white hover:scale-105 transition-transform duration-300 animate-fade-in",style:{animationDelay:"0.3s"},children:S.jsxs(fi,{className:"p-6 space-y-4",children:[S.jsx(gp,{className:"w-12 h-12 text-white"}),S.jsx("h3",{className:"text-xl font-semibold",children:"Voice Interaction"}),S.jsx("p",{className:"text-white/90",children:"Natural conversation with AI that understands and responds to your emotional state."})]})}),S.jsx(tn,{className:"bg-white/20 backdrop-blur-sm border-white/30 text-white hover:scale-105 transition-transform duration-300 animate-fade-in",style:{animationDelay:"0.5s"},children:S.jsxs(fi,{className:"p-6 space-y-4",children:[S.jsx(qN,{className:"w-12 h-12 text-white"}),S.jsx("h3",{className:"text-xl font-semibold",children:"Emotion Recognition"}),S.jsx("p",{className:"text-white/90",children:"Real-time facial expression analysis to better understand your emotional journey."})]})}),S.jsx(tn,{className:"bg-white/20 backdrop-blur-sm border-white/30 text-white hover:scale-105 transition-transform duration-300 animate-fade-in",style:{animationDelay:"0.7s"},children:S.jsxs(fi,{className:"p-6 space-y-4",children:[S.jsx(UN,{className:"w-12 h-12 text-white"}),S.jsx("h3",{className:"text-xl font-semibold",children:"24/7 Support"}),S.jsx("p",{className:"text-white/90",children:"Access emotional support anytime, anywhere with our AI companion."})]})})]}),S.jsxs("div",{className:"mt-24 text-center text-white",children:[S.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-12",children:"Frequently asked questions"}),S.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-[1200px] mx-auto",children:[S.jsx(tn,{className:"bg-white/10 border-white/20 backdrop-blur-sm text-white hover:bg-white/20 transition-colors duration-300",children:S.jsxs(fi,{className:"p-6",children:[S.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Is Cybella safe to use?"}),S.jsx("p",{className:"text-white/80",children:"Yes, we prioritize your privacy and security. All conversations are private and encrypted."})]})}),S.jsx(tn,{className:"bg-white/10 border-white/20 backdrop-blur-sm text-white hover:bg-white/20 transition-colors duration-300",children:S.jsxs(fi,{className:"p-6",children:[S.jsx("h3",{className:"text-lg font-semibold mb-3",children:"How does it work?"}),S.jsx("p",{className:"text-white/80",children:"Cybella uses advanced AI to understand your emotions and provide meaningful support."})]})}),S.jsx(tn,{className:"bg-white/10 border-white/20 backdrop-blur-sm text-white hover:bg-white/20 transition-colors duration-300",children:S.jsxs(fi,{className:"p-6",children:[S.jsx("h3",{className:"text-lg font-semibold mb-3",children:"What can Cybella help with?"}),S.jsx("p",{className:"text-white/80",children:"From daily conversations to emotional support, Cybella is your AI companion."})]})})]})]})]}),S.jsx(xm,{})]})};var wm="Avatar",[P3,LW]=Mu(wm),[D3,EC]=P3(wm),SC=C.forwardRef((e,t)=>{const{__scopeAvatar:n,...r}=e,[o,i]=C.useState("idle");return S.jsx(D3,{scope:n,imageLoadingStatus:o,onImageLoadingStatusChange:i,children:S.jsx(je.span,{...r,ref:t})})});SC.displayName=wm;var kC="AvatarImage",_C=C.forwardRef((e,t)=>{const{__scopeAvatar:n,src:r,onLoadingStatusChange:o=()=>{},...i}=e,a=EC(kC,n),s=M3(r,i.referrerPolicy),u=In(l=>{o(l),a.onImageLoadingStatusChange(l)});return Ar(()=>{s!=="idle"&&u(s)},[s,u]),s==="loaded"?S.jsx(je.img,{...i,ref:t,src:r}):null});_C.displayName=kC;var RC="AvatarFallback",NC=C.forwardRef((e,t)=>{const{__scopeAvatar:n,delayMs:r,...o}=e,i=EC(RC,n),[a,s]=C.useState(r===void 0);return C.useEffect(()=>{if(r!==void 0){const u=window.setTimeout(()=>s(!0),r);return()=>window.clearTimeout(u)}},[r]),a&&i.imageLoadingStatus!=="loaded"?S.jsx(je.span,{...o,ref:t}):null});NC.displayName=RC;function M3(e,t){const[n,r]=C.useState("idle");return Ar(()=>{if(!e){r("error");return}let o=!0;const i=new window.Image,a=s=>()=>{o&&r(s)};return r("loading"),i.onload=a("loaded"),i.onerror=a("error"),i.src=e,t&&(i.referrerPolicy=t),()=>{o=!1}},[e,t]),n}var IC=SC,TC=_C,AC=NC;const Md=C.forwardRef(({className:e,...t},n)=>S.jsx(IC,{ref:n,className:Ve("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));Md.displayName=IC.displayName;const F3=C.forwardRef(({className:e,...t},n)=>S.jsx(TC,{ref:n,className:Ve("aspect-square h-full w-full",e),...t}));F3.displayName=TC.displayName;const Fd=C.forwardRef(({className:e,...t},n)=>S.jsx(AC,{ref:n,className:Ve("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Fd.displayName=AC.displayName;const O3=[{initials:"JW",name:"Joshua Watson",role:"Project Management"},{initials:"MA",name:"Muhammad Ahmed",role:"Business Analyst"},{initials:"RG",name:"Rishi Gajera",role:"Developer / Tester"},{initials:"MP",name:"Manthan Patel",role:"Developer / Tester"},{initials:"HS",name:"Hartono Susanto",role:"Developer"},{initials:"QN",name:"Quoc Nam Ngo",role:"Developer"}],L3=()=>S.jsxs("section",{className:"py-12",children:[S.jsx("h2",{className:"text-2xl font-bold mb-4 text-slate-800",children:"Our Team"}),S.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:O3.map(e=>S.jsxs(tn,{className:"p-6 flex flex-col items-center text-center bg-white/50 backdrop-blur-sm border border-slate-200",children:[S.jsx(Md,{className:"h-16 w-16 mb-4 bg-blue-100",children:S.jsx(Fd,{className:"text-blue-600",children:e.initials})}),S.jsx("h3",{className:"font-semibold text-slate-800 mb-1",children:e.name}),S.jsxs("div",{className:"flex items-center text-slate-600 text-sm",children:[S.jsx(WN,{className:"w-4 h-4 mr-1"}),e.role]})]},e.initials))})]}),B3=()=>S.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-[#1E90FF] to-[#87CEEB]",children:[S.jsx(ym,{}),S.jsx("main",{className:"flex-1 container py-20 px-4",children:S.jsxs("div",{className:"max-w-[800px] mx-auto space-y-12 mt-20",children:[S.jsxs("section",{className:"text-center space-y-6",children:[S.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white",children:"About Cybella"}),S.jsx("p",{className:"text-xl text-white/90",children:"Your AI companion for emotional support and personal growth"})]}),S.jsxs(tn,{className:"p-6 bg-white/20 backdrop-blur",children:[S.jsx("h2",{className:"text-2xl font-semibold mb-4 text-white",children:"Our Mission"}),S.jsx("p",{className:"text-white/90",children:"Cybella combines advanced AI technology with emotional intelligence to provide a safe space for emotional expression and support. Through voice interaction and facial recognition, we create a unique therapeutic experience that adapts to your emotional state."})]}),S.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[S.jsxs(tn,{className:"p-6 bg-white/20 backdrop-blur",children:[S.jsx("h3",{className:"text-xl font-semibold mb-3 text-white",children:"Voice Interaction"}),S.jsx("p",{className:"text-white/90",children:"Natural conversation with AI that understands and responds to your emotional state through voice analysis."})]}),S.jsxs(tn,{className:"p-6 bg-white/20 backdrop-blur",children:[S.jsx("h3",{className:"text-xl font-semibold mb-3 text-white",children:"Emotion Recognition"}),S.jsx("p",{className:"text-white/90",children:"Real-time facial expression analysis to better understand and support your emotional journey."})]})]}),S.jsx(L3,{})]})}),S.jsx(xm,{})]}),j3=({sessionActive:e,toggleSession:t,disabled:n=!1,isOnline:r=!0})=>{const[o,i]=J.useState(!1),a=C.useRef(e);C.useEffect(()=>{a.current=e},[e]);const s=()=>{if(o)return;i(!0);try{t()}catch(l){console.error("Error toggling session:",l)}setTimeout(()=>i(!1),e?300:600)};return S.jsx("div",{className:"mb-4 flex justify-center",children:S.jsx(Bt,{onClick:s,variant:e?"destructive":"default",className:"w-full md:w-auto",disabled:o||!e&&(n||!r),"data-state":o?"loading":"idle",children:e?S.jsxs(S.Fragment,{children:[S.jsx(Lb,{className:"mr-2",size:16}),"End Session"]}):S.jsxs(S.Fragment,{children:[!r||n?S.jsx(Ed,{className:"mr-2",size:16}):S.jsx(Ob,{className:"mr-2",size:16}),"Start Session"]})})})},z3=({transcription:e,interimTranscript:t,isListening:n,sessionActive:r})=>!r||!!!(e||t)?null:S.jsxs("div",{className:"flex items-start gap-3 justify-end",children:[S.jsx("div",{className:"bg-primary/90 text-primary-foreground rounded-lg rounded-tr-none p-3 max-w-[90%] shadow-sm",children:S.jsxs("p",{className:"text-sm",children:[e||t,n&&S.jsx("span",{className:"animate-pulse",children:"..."})]})}),S.jsx(Md,{className:"border border-primary/50 bg-background",children:S.jsx(Fd,{children:"You"})})]}),vu=({title:e,description:t,variant:n,action:r})=>{HI(e,{description:t,action:r,className:n})},W3=()=>({toast:vu});function $3({text:e,autoplay:t=!1}){const[n,r]=C.useState(!1),[o,i]=C.useState(!1),[a,s]=C.useState(.75),u=C.useRef(null);C.useEffect(()=>()=>{u.current&&window.speechSynthesis.cancel()},[]),C.useEffect(()=>{t&&e&&!o&&l()},[e,t,o]);const l=()=>{if(!e||o)return;window.speechSynthesis.cancel();const f=new SpeechSynthesisUtterance(e);f.volume=a,f.lang="en-US";const p=window.speechSynthesis.getVoices().find(v=>v.lang.startsWith("en-US"));p&&(f.voice=p),f.onstart=()=>r(!0),f.onend=()=>r(!1),f.onerror=()=>r(!1),u.current=f,window.speechSynthesis.speak(f)};return{isPlaying:n,isMuted:o,volume:a,handlePlay:l,toggleMute:()=>{n&&!o&&(window.speechSynthesis.cancel(),r(!1)),i(!o)},handleVolumeChange:f=>{s(f),u.current&&(u.current.volume=f)}}}function U3(e,t,n,r){t.current&&(t.current.getTracks().forEach(o=>{o.stop()}),t.current=null),e.current&&e.current.srcObject&&(e.current.srcObject.getTracks().forEach(i=>{i.stop()}),e.current.srcObject=null),n.current&&r(!1)}function Gf(e,t,n,r,o,i){if(e.current>=t){n.current&&(r("Camera connection lost. Please refresh the page and try again."),o(!1));return}e.current++,i&&i()}function Dy({videoRef:e,streamRef:t,isMountedRef:n,permission:r,initializingRef:o,reconnectAttemptsRef:i,MAX_RECONNECT_ATTEMPTS:a,setError:s,setPermission:u,initializeWebcam:l,heartbeatIntervalRef:c}){c.current&&clearInterval(c.current),c.current=setInterval(()=>{if(!n.current){clearInterval(c.current),c.current=null;return}if(e.current&&e.current.srcObject)if(e.current.readyState<2)if(t.current&&t.current.active){const d=t.current.getVideoTracks()[0];d&&d.readyState==="ended"?Gf(i,a,n,s,u,l):(e.current.srcObject=null,setTimeout(()=>{e.current&&t.current&&(e.current.srcObject=t.current,e.current.play().catch(()=>{}))},100))}else Gf(i,a,n,s,u,l);else i.current=0;else r&&!o.current&&Gf(i,a,n,s,u,l)},5e3)}function V3(e){if(!(e instanceof DOMException))return"Unable to access webcam. Please ensure your camera is connected and working properly.";switch(e.name){case"NotAllowedError":return"Camera access denied. Please grant camera permissions in your browser settings.";case"NotFoundError":return"No camera found. Please connect a camera and try again.";case"NotReadableError":case"AbortError":return"Camera is already in use or not available. Please close other applications that might be using your camera, refresh the page, and try again.";case"OverconstrainedError":return"Camera cannot satisfy the requested constraints. Please try with a different camera.";case"SecurityError":return"Camera access blocked due to security policy. Please check your browser settings.";case"TypeError":return"No camera available or constraints cannot be satisfied. Please check your camera connection.";default:return"Unable to access webcam. Please ensure your camera is connected and working properly."}}function H3({videoRef:e}){const[t,n]=C.useState(!1),[r,o]=C.useState(null),i=C.useRef(null),a=C.useRef(!0),s=C.useRef(!1),u=C.useRef(null),l=C.useRef(0),c=3;C.useEffect(()=>()=>{a.current=!1,d(),u.current&&(clearInterval(u.current),u.current=null)},[]);const d=C.useCallback(()=>{U3(e,i,a,n),u.current&&(clearInterval(u.current),u.current=null),s.current=!1,l.current=0},[e]),f=C.useCallback(async()=>{if(!s.current){s.current=!0;try{if(!a.current||(d(),a.current&&o(null),await new Promise(v=>setTimeout(v,500)),!a.current))return;const h={video:{width:{ideal:640},height:{ideal:480},facingMode:"user",frameRate:{ideal:30}}},p=await navigator.mediaDevices.getUserMedia(h);if(!a.current){p.getTracks().forEach(v=>v.stop());return}if(i.current=p,e.current){e.current.srcObject=p;try{await e.current.play(),Dy({videoRef:e,streamRef:i,isMountedRef:a,permission:t,initializingRef:s,reconnectAttemptsRef:l,MAX_RECONNECT_ATTEMPTS:c,setError:o,setPermission:n,initializeWebcam:f,heartbeatIntervalRef:u}),a.current&&(n(!0),o(null))}catch{e.current.onloadedmetadata=async()=>{try{e.current&&(await e.current.play(),a.current&&(n(!0),o(null),Dy({videoRef:e,streamRef:i,isMountedRef:a,permission:t,initializingRef:s,reconnectAttemptsRef:l,MAX_RECONNECT_ATTEMPTS:c,setError:o,setPermission:n,initializeWebcam:f,heartbeatIntervalRef:u})))}catch{a.current&&o("Camera autoplay blocked. Please reload the page and try again.")}}}}}catch(h){if(!a.current)return;a.current&&n(!1),a.current&&o(V3(h)),i.current&&(i.current.getTracks().forEach(p=>p.stop()),i.current=null)}finally{s.current=!1}}},[e,d,t]);return{permission:t,error:r,initializeWebcam:f,stopWebcam:d}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var PC=function(e,t){return(PC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])})(e,t)};function sr(e,t){function n(){this.constructor=e}PC(e,t),e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function oe(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(l){try{u(r.next(l))}catch(c){i(c)}}function s(l){try{u(r.throw(l))}catch(c){i(c)}}function u(l){l.done?o(l.value):new n(function(c){c(l.value)}).then(a,s)}u((r=r.apply(e,[])).next())})}function ie(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(c[0]===6&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(d){c=[6,d],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var G3=function(){function e(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(t,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=t,this.platform=n},e.prototype.registerFlag=function(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},e.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},e.prototype.getNumber=function(t){return this.get(t)},e.prototype.getBool=function(t){return this.get(t)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(t,n){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)},e.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},e.prototype.setFlags=function(t){this.flags=Object.assign({},t)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,o=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return q3(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0],u=a[1];t.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},e}();function q3(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function G(){return DC}var DC=null,Mc=new Map,Tp=new Map;function MC(e,t){var n=OC(e,t);return Mc.get(n)}function K3(e){return Tp.get(e)}function My(e){for(var t=Mc.entries(),n=[];;){var r=t.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===e&&n.push(s)}return n}function FC(e){var t=e.kernelName,n=e.backendName,r=OC(t,n);if(Mc.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");Mc.set(r,e)}function X3(e){var t=e.kernelName;Tp.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),Tp.set(t,e)}function OC(e,t){return t+"_"+e}function Ap(e,t,n){return Math.max(e,Math.min(t,n))}function LC(e){return e%2==0?e:e+1}function Y3(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function T(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Fe(e,t,n){n===void 0&&(n=""),T(St(e,t),function(){return n+" Shapes "+e+" and "+t+" must match"})}function ds(e){T(e!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Za(e,t,n){if(t===void 0&&(t=[]),n===void 0&&(n=!1),t==null&&(t=[]),Array.isArray(e)||Nr(e)&&!n)for(var r=0;r<e.length;++r)Za(e[r],t,n);else t.push(e);return t}function ae(e){if(e.length===0)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function St(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ut(e){return e%1==0}function Q3(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Pp(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Ra(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Fy(e,t,n){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(e())r();else{i++;var s=t(i);n!=null&&i>=n?o():setTimeout(a,s)}};a()})}function J3(e,t){for(var n=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)n*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(n===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var i=e.slice();return i[r]=t/n,i}function wt(e,t){var n=t.length;return T((e=e==null?t.map(function(r,o){return o}):[].concat(e)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e}),T(e.every(function(r){return ut(r)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(r){return r<0?n+r:r})}function vi(e,t){for(var n=[],r=[],o=t!=null&&Array.isArray(t)&&t.length===0,i=t==null||o?null:wt(t,e).sort(),a=0,s=0;s<e.length;++s){if(i!=null){if(i[a]===s&&e[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(i[a]==null||i[a]>s)&&e[s]===1&&(n.push(e[s]),r.push(s)),i[a]<=s&&a++}e[s]!==1&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function mu(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else{if(e!=="bool")throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Fc(e,t){var n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else{if(e!=="string")throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Z3(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function eM(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function tM(e,t){return t!=="complex64"&&(t!=="float32"||e==="complex64")&&(t!=="int32"||e==="float32"||e==="complex64")&&(t!=="bool"||e!=="bool")}function Nr(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function BC(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function nM(e){if(e==null)return 0;var t=0;return e.forEach(function(n){return t+=n.length}),t}function bm(e){return typeof e=="string"||e instanceof String}function rM(e){return typeof e=="boolean"}function oM(e){return typeof e=="number"}function zu(e){return Array.isArray(e)?zu(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":oM(e)?"float32":bm(e)?"string":rM(e)?"bool":"float32"}function Dp(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Mp(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Ir(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function jC(e,t,n){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Za(e)),n&&Z3(e,t),function(i,a){return i instanceof Float32Array&&a==="float32"||i instanceof Int32Array&&a==="int32"||i instanceof Uint8Array&&a==="bool"}(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function Oy(e,t){if(e.length===0)return t[0];var n=e.reduce(function(r,o){return r*o});if(n===0)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(i.length===1)for(var u=i[0],l=0;l<u;l++)s[l]=a[o+l];else{u=i[0];var c=i.slice(1),d=c.reduce(function(f,h){return f*h});for(l=0;l<u;l++)s[l]=r(o+l*d,c,a)}return s}(0,e,t)}function zC(e,t){for(var n=Wu(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Wu(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+t)}function wr(){return G().platform.now()}function WC(e){e.forEach(function(t){T(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function iM(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",G().platform.encode(e,t)}function Oc(e,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",G().platform.decode(e,t)}function Ly(e,t,n){if(t===0)return 0;if(t===1)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=n[o]*e[o];return r}function aM(e,t,n){if(t===0)return[];if(t===1)return[e];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(e/n[o]),e-=r[o]*n[o];return r[r.length-1]=e,r}var sM=function(){function e(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new uM)}return e.prototype.profileKernel=function(t,n,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(l,c,d){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var h=l[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,t),a.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),i.logger.logKernelProfile(t,s,u,l.kernelMs,n,c)})})}),o},e}(),uM=function(){function e(){}return e.prototype.logKernelProfile=function(t,n,r,o,i,a){var s=typeof o=="number"?Ra(o+"ms",9):o.error,u=Ra(t,25),l=n.rank,c=n.size,d=Ra(n.shape.toString(),14),f="";for(var h in i){var p=i[h].shape||n.shape,v=p.length;f+=h+": "+v+"D "+(v>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+d+"	%c"+c+"	%c"+f+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),By=20,ks=3,qf=7;function lM(e,t,n,r){var o=Ir(t),i=function(l,c,d,f){var h=ae(c),p=f[f.length-1],v=new Array(p).fill(0),g=c.length,m=d==="complex64"?Rs(l):l;if(g>1)for(var y=0;y<h/p;y++)for(var x=y*p,w=0;w<p;w++)v[w]=Math.max(v[w],_s(m[x+w],0,d).length);return v}(e,t,n,o),a=t.length,s=function l(c,d,f,h,p,v){v===void 0&&(v=!0);var g=f==="complex64"?2:1,m=d[0],y=d.length;if(y===0)return f==="complex64"?[_s(Rs(c)[0],0,f)]:f==="bool"?[$C(c[0])]:[c[0].toString()];if(y===1){if(m>By){var x=ks*g,w=Array.from(c.slice(0,x)),b=Array.from(c.slice((m-ks)*g,m*g));return f==="complex64"&&(w=Rs(w),b=Rs(b)),["["+w.map(function(z,B){return _s(z,p[B],f)}).join(", ")+", ..., "+b.map(function(z,B){return _s(z,p[m-ks+B],f)}).join(", ")+"]"]}return["["+(f==="complex64"?Rs(c):Array.from(c)).map(function(z,B){return _s(z,p[B],f)}).join(", ")+"]"]}var E=d.slice(1),k=h.slice(1),_=h[0]*g,R=[];if(m>By){for(var N=0;N<ks;N++){var D=(A=N*_)+_;R.push.apply(R,l(c.slice(A,D),E,f,k,p,!1))}for(R.push("..."),N=m-ks;N<m;N++)D=(A=N*_)+_,R.push.apply(R,l(c.slice(A,D),E,f,k,p,N===m-1))}else for(N=0;N<m;N++){var A;D=(A=N*_)+_,R.push.apply(R,l(c.slice(A,D),E,f,k,p,N===m-1))}var j=y===2?",":"";for(R[0]="["+R[0]+j,N=1;N<R.length-1;N++)R[N]=" "+R[N]+j;var F=`,
`;for(N=2;N<y;N++)F+=`
`;return R[R.length-1]=" "+R[R.length-1]+"]"+(v?"":F),R}(e,t,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function _s(e,t,n){return Ra(Array.isArray(e)?parseFloat(e[0].toFixed(qf))+" + "+parseFloat(e[1].toFixed(qf))+"j":bm(e)?"'"+e+"'":n==="bool"?$C(e):parseFloat(e.toFixed(qf)).toString(),t)}function $C(e){return e===0?"false":"true"}function Rs(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var gu=function(){function e(t,n,r){var o=this;if(this.dtype=n,this.shape=t.slice(),this.size=ae(t),r!=null){var i=r.length;T(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Fc(n,this.size),this.strides=Ir(t)}return e.prototype.set=function(t){for(var n=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),T(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var i=this.locToIndex(r);this.values[i]=t},e.prototype.get=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.length===0&&(t=[0]);for(var r=0,o=0,i=t;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},e.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n},e.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Er().makeTensor(this.values,this.shape,this.dtype)},e}(),Er=null,V=null,UC=null,Je=function(){function e(t,n,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=ae(t),this.strides=Ir(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),T(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(t,n){return this.throwIfDisposed(),this.reshape([t,n])},e.prototype.as3D=function(t,n,r){return this.throwIfDisposed(),this.reshape([t,n,r])},e.prototype.as4D=function(t,n,r,o){return this.throwIfDisposed(),this.reshape([t,n,r,o])},e.prototype.as5D=function(t,n,r,o,i){return this.throwIfDisposed(),this.reshape([t,n,r,o,i])},e.prototype.asType=function(t){return this.throwIfDisposed(),V.cast(this,t)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return oe(this,void 0,void 0,function(){var t;return ie(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,V.buffer(this.shape,this.dtype,t)]}})})},e.prototype.bufferSync=function(){return V.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return oe(this,void 0,void 0,function(){var t;return ie(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return t=n.sent(),[2,Oy(this.shape,t)]}})})},e.prototype.arraySync=function(){return Oy(this.shape,this.dataSync())},e.prototype.data=function(){return oe(this,void 0,void 0,function(){var t,n;return ie(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=Er().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:n=r.sent();try{return[2,n.map(function(o){return Oc(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var t=Er().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(n){return Oc(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},e.prototype.bytes=function(){return oe(this,void 0,void 0,function(){var t;return ie(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,Er().read(this.dataId)];case 1:return t=n.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(Er().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(t){return t===void 0&&(t=!1),V.print(this,t)},e.prototype.reshape=function(t){return this.throwIfDisposed(),V.reshape(this,t)},e.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},e.prototype.expandDims=function(t){return t===void 0&&(t=0),V.expandDims(this,t)},e.prototype.cumsum=function(t,n,r){return t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1),V.cumsum(this,t,n,r)},e.prototype.squeeze=function(t){return this.throwIfDisposed(),V.squeeze(this,t)},e.prototype.clone=function(){return this.throwIfDisposed(),V.clone(this)},e.prototype.oneHot=function(t,n,r){return this.throwIfDisposed(),V.oneHot(this,t,n,r)},e.prototype.toString=function(t){return t===void 0&&(t=!1),lM(this.dataSync(),this.shape,this.dtype,t)},e.prototype.tile=function(t){return this.throwIfDisposed(),V.tile(this,t)},e.prototype.gather=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),V.gather(this,t,n)},e.prototype.matMul=function(t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),V.matMul(this,t,n,r)},e.prototype.dot=function(t){return this.throwIfDisposed(),V.dot(this,t)},e.prototype.norm=function(t,n,r){return t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),V.norm(this,t,n,r)},e.prototype.slice=function(t,n){return this.throwIfDisposed(),V.slice(this,t,n)},e.prototype.reverse=function(t){return this.throwIfDisposed(),V.reverse(this,t)},e.prototype.concat=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),V.concat([this].concat(t),n)},e.prototype.split=function(t,n){return n===void 0&&(n=0),this.throwIfDisposed(),V.split(this,t,n)},e.prototype.stack=function(t,n){return n===void 0&&(n=0),V.stack([this,t],n)},e.prototype.unstack=function(t){return t===void 0&&(t=0),V.unstack(this,t)},e.prototype.pad=function(t,n){return n===void 0&&(n=0),V.pad(this,t,n)},e.prototype.batchNormalization=function(t,n,r,o,i){return r===void 0&&(r=.001),UC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,n,i,o,r)},e.prototype.batchNorm=function(t,n,r,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),V.batchNorm(this,t,n,r,o,i)},e.prototype.all=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.all(this,t,n)},e.prototype.any=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.any(this,t,n)},e.prototype.logSumExp=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.logSumExp(this,t,n)},e.prototype.sum=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.sum(this,t,n)},e.prototype.prod=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.prod(this,t,n)},e.prototype.mean=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.mean(this,t,n)},e.prototype.min=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.min(this,t,n)},e.prototype.max=function(t,n){return t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),V.max(this,t,n)},e.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),V.argMin(this,t)},e.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),V.argMax(this,t)},e.prototype.cast=function(t){return this.throwIfDisposed(),V.cast(this,t)},e.prototype.add=function(t){return this.throwIfDisposed(),V.add(this,t)},e.prototype.addStrict=function(t){return this.throwIfDisposed(),V.addStrict(this,t)},e.prototype.atan2=function(t){return this.throwIfDisposed(),V.atan2(this,t)},e.prototype.sub=function(t){return this.throwIfDisposed(),V.sub(this,t)},e.prototype.subStrict=function(t){return this.throwIfDisposed(),V.subStrict(this,t)},e.prototype.pow=function(t){return this.throwIfDisposed(),V.pow(this,t)},e.prototype.powStrict=function(t){return this.throwIfDisposed(),V.powStrict(this,t)},e.prototype.mul=function(t){return this.throwIfDisposed(),V.mul(this,t)},e.prototype.mulStrict=function(t){return this.throwIfDisposed(),V.mulStrict(this,t)},e.prototype.div=function(t){return this.throwIfDisposed(),V.div(this,t)},e.prototype.divNoNan=function(t){return this.throwIfDisposed(),V.divNoNan(this,t)},e.prototype.floorDiv=function(t){return this.throwIfDisposed(),V.floorDiv(this,t)},e.prototype.divStrict=function(t){return this.throwIfDisposed(),V.divStrict(this,t)},e.prototype.minimum=function(t){return this.throwIfDisposed(),V.minimum(this,t)},e.prototype.minimumStrict=function(t){return this.throwIfDisposed(),V.minimumStrict(this,t)},e.prototype.maximum=function(t){return this.throwIfDisposed(),V.maximum(this,t)},e.prototype.maximumStrict=function(t){return this.throwIfDisposed(),V.maximumStrict(this,t)},e.prototype.mod=function(t){return this.throwIfDisposed(),V.mod(this,t)},e.prototype.modStrict=function(t){return this.throwIfDisposed(),V.modStrict(this,t)},e.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),V.squaredDifferenceStrict(this,t)},e.prototype.transpose=function(t){return this.throwIfDisposed(),V.transpose(this,t)},e.prototype.notEqual=function(t){return this.throwIfDisposed(),V.notEqual(this,t)},e.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),V.notEqualStrict(this,t)},e.prototype.less=function(t){return this.throwIfDisposed(),V.less(this,t)},e.prototype.lessStrict=function(t){return this.throwIfDisposed(),V.lessStrict(this,t)},e.prototype.equal=function(t){return this.throwIfDisposed(),V.equal(this,t)},e.prototype.equalStrict=function(t){return this.throwIfDisposed(),V.equalStrict(this,t)},e.prototype.lessEqual=function(t){return this.throwIfDisposed(),V.lessEqual(this,t)},e.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),V.lessEqualStrict(this,t)},e.prototype.greater=function(t){return this.throwIfDisposed(),V.greater(this,t)},e.prototype.greaterStrict=function(t){return this.throwIfDisposed(),V.greaterStrict(this,t)},e.prototype.greaterEqual=function(t){return this.throwIfDisposed(),V.greaterEqual(this,t)},e.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),V.greaterEqualStrict(this,t)},e.prototype.logicalAnd=function(t){return this.throwIfDisposed(),V.logicalAnd(this,t)},e.prototype.logicalOr=function(t){return this.throwIfDisposed(),V.logicalOr(this,t)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),V.logicalNot(this)},e.prototype.logicalXor=function(t){return this.throwIfDisposed(),V.logicalXor(this,t)},e.prototype.where=function(t,n){return this.throwIfDisposed(),V.where(t,this,n)},e.prototype.neg=function(){return this.throwIfDisposed(),V.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),V.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),V.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),V.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),V.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),V.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),V.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),V.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),V.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),V.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),V.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),V.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),V.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),V.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),V.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),V.abs(this)},e.prototype.clipByValue=function(t,n){return this.throwIfDisposed(),V.clipByValue(this,t,n)},e.prototype.relu=function(){return this.throwIfDisposed(),V.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),V.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),V.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),V.selu(this)},e.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),V.leakyRelu(this,t)},e.prototype.prelu=function(t){return this.throwIfDisposed(),V.prelu(this,t)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),V.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),V.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),V.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),V.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),V.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),V.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),V.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),V.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),V.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),V.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),V.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),V.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),V.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),V.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),V.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),V.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),V.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),V.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),V.round(this)},e.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),V.step(this,t)},e.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),V.softmax(this,t)},e.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),V.logSoftmax(this,t)},e.prototype.resizeBilinear=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),V.image.resizeBilinear(this,t,n)},e.prototype.resizeNearestNeighbor=function(t,n){return n===void 0&&(n=!1),this.throwIfDisposed(),V.image.resizeNearestNeighbor(this,t,n)},e.prototype.conv1d=function(t,n,r,o,i,a){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),V.conv1d(this,t,n,r,o,i,a)},e.prototype.conv2d=function(t,n,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),V.conv2d(this,t,n,r,o,i,a)},e.prototype.conv2dTranspose=function(t,n,r,o,i){return this.throwIfDisposed(),V.conv2dTranspose(this,t,n,r,o,i)},e.prototype.depthwiseConv2D=function(t,n,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),V.depthwiseConv2d(this,t,n,r,o,i,a)},e.prototype.separableConv2d=function(t,n,r,o,i,a){return i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),V.separableConv2d(this,t,n,r,o,i,a)},e.prototype.avgPool=function(t,n,r,o){return this.throwIfDisposed(),V.avgPool(this,t,n,r,o)},e.prototype.maxPool=function(t,n,r,o){return this.throwIfDisposed(),V.maxPool(this,t,n,r,o)},e.prototype.localResponseNormalization=function(t,n,r,o){return t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5),V.localResponseNormalization(this,t,n,r,o)},e.prototype.pool=function(t,n,r,o,i){return this.throwIfDisposed(),V.pool(this,t,n,r,o,i)},e.prototype.variable=function(t,n,r){return t===void 0&&(t=!0),this.throwIfDisposed(),Er().makeVariable(this,t,n,r)},e.prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),V.unsortedSegmentSum(this,t,n)},e.prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),V.batchToSpaceND(this,t,n)},e.prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),V.spaceToBatchND(this,t,n)},e.prototype.topk=function(t,n){return t===void 0&&(t=1),n===void 0&&(n=!0),this.throwIfDisposed(),V.topk(this,t,n)},e.prototype.stridedSlice=function(t,n,r,o,i,a,s,u){return o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),V.stridedSlice(this,t,n,r,o,i,a,s,u)},e.prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),V.depthToSpace(this,t,n)},e.prototype.fft=function(){return this.throwIfDisposed(),V.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),V.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),V.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),V.spectral.irfft(this)},e}();Object.defineProperty(Je,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var jy,Fp,Op,Lp,Bp,es=function(e){function t(n,r,o,i){var a=e.call(this,n.shape,n.dtype,n.dataId,i)||this;return a.trainable=r,a.name=o,a}return sr(t,e),t.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!St(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");Er().disposeTensor(this),this.dataId=n.dataId,Er().incRef(this,null)},t.prototype.dispose=function(){Er().disposeVariable(this),this.isDisposedInternal=!0},t}(Je);Object.defineProperty(es,Symbol.hasInstance,{value:function(e){return e instanceof Je&&e.assign!=null&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(jy||(jy={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Fp||(Fp={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Op||(Op={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Lp||(Lp={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Bp||(Bp={}));var cM={float32:Lp,int32:Fp,bool:Op,complex64:Bp};function Nt(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error("Can not upcast "+e+" with "+t)}return cM[e][t]}function Kf(e){return Nt(e,"int32")}function nt(e,t){if(e.dtype===t.dtype)return[e,t];var n=Nt(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function dM(e,t){T(e.dtype===t.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"})}function VC(e){var t=[];return function n(r,o,i){if(r!=null){if(r instanceof Je)return void o.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];i.has(l)||(i.add(l),n(l,o,i))}}}}(e,t,new Set),t}var Xf,zy=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},e}(),fM=function(){function e(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new zy}return e.prototype.ready=function(){return oe(this,void 0,void 0,function(){var t,n,r;return ie(this,function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),n=0,o.label=1;case 1:return n<t.length?(r=t[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),n=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},e.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},e.prototype.registerBackend=function(t,n,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:n,priority:r},!0)},e.prototype.setBackend=function(t){return oe(this,void 0,void 0,function(){var n,r,o;return ie(this,function(i){switch(i.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new sM(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var t=this;My(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(t.backendInstance)})},e.prototype.disposeRegisteredKernels=function(t){var n=this;My(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[t])})},e.prototype.initializeBackend=function(t){var n=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<n.pendingBackendInitId)&&(n.registry[t]=s,n.pendingBackendInit=null,!0)}).catch(function(s){return!(i<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return t.registryFactory[r].priority-t.registryFactory[n].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),n=0;n<t.length;n++){var r=t[n],o=this.initializeBackend(r),i=o.success,a=o.asyncInit;if(a||i)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(t,n){var r=this.state.tensorInfo.get(n),o=r.backend,i=this.readSync(n);o.disposeData(n),r.backend=t,t.move(n,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(t,n){var r,o=this,i=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(t,n,r){t();try{var o=r();return n(),o}catch(i){throw n(),i}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(t){var n=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[n],function(o){return{x:function(){return o.toFloat()}}},[]),n},e.prototype.runKernel=function(t,n,r,o,i){return this.runKernelFunc(null,n,null,t,r,o,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(t,n,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-n-i-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},e.prototype.runKernelFunc=function(t,n,r,o,i,a,s){var u,l=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var c=[],d=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var f,h=function(y){d&&(c=y.map(function(x){return l.keep(l.clone(x))}))},p=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,m=MC(o,this.backendName);return f=m!=null?function(){var y=l.backend.numDataIds();g=m.kernelFunc({inputs:n,attrs:i,backend:l.backend});var x=Array.isArray(g)?g:[g];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,y,x);var w=x.map(function(E){var k=E.dataId,_=E.shape,R=E.dtype;return l.makeTensorFromDataId(k,_,R)}),b=w.filter(function(E,k){return s[k]});return h((a||[]).slice().concat(b)),w}:function(){var y=l.backend.numDataIds();g=l.tidy(function(){return t(l.backend,h)});var x=Array.isArray(g)?g:[g];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(o,y,x),x},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(o,n,function(){return f()}):f()}),d&&this.addTapeNode(o,n,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(y){return n[y].shape}),outputShapes:u.map(function(y){return y.shape})}),Array.isArray(g)?u:u[0]},e.prototype.makeTensor=function(t,n,r,o){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var i=t;r==="string"&&bm(t[0])&&(i=t.map(function(c){return iM(c)}));var a=o.write(i,n,r),s=new Je(n,r,a,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(a),l=nM(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},e.prototype.makeTensorFromDataId=function(t,n,r,o){var i=new Je(n,r=r||"float32",t,this.nextTensorId());return this.incRef(i,o),i},e.prototype.makeVariable=function(t,n,r,o){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==t.dtype&&(t=t.asType(o));var i=new es(t,n,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(t,n){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*BC(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof es||this.track(t)},e.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(t.dataId);n.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var n=this.state.registeredVariables[t];this.disposeVariable(n)}},e.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},e.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},e.prototype.profile=function(t){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(t,n,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:i},u=K3(t);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(l){return l=l.map(function(c,d){if(c==null){var f=r[d],h=Wu(f.size,f.dtype);return a.makeTensor(h,f.shape,f.dtype)}return c}),o(l.length>1?l:l[0],i)}),this.state.activeTape.push(s)},e.prototype.keep=function(t){return t.kept=!0,t},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(t){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n},e.prototype.endScope=function(t){for(var n=this,r=VC(t),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||n.track(u)})},e.prototype.gradients=function(t,n,r,o){var i=this;if(o===void 0&&(o=!1),T(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});T(a instanceof Je,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var d={},f={},h=0;h<l.length;h++)d[l[h].id]=!0;for(h=0;h<u.length;h++){var p=(E=u[h]).inputs;for(var v in p){for(var g=p[v],m=!1,y=0;y<l.length;y++)if(d[g.id]){E.outputs.forEach(function(N){return d[N.id]=!0}),m=!0,f[E.id]=!0;break}if(m)break}}var x={};x[c.id]=!0;var w={};for(h=u.length-1;h>=0;h--)for(p=(E=u[h]).inputs,y=0;y<E.outputs.length;y++)if(x[E.outputs[y].id]){for(var v in p)x[p[v].id]=!0,w[E.id]=!0;break}var b=[];for(h=0;h<u.length;h++){var E;if(f[(E=u[h]).id]&&w[E.id]){var k={};for(var v in E.inputs){var _=E.inputs[v];d[_.id]&&(k[v]=_)}var R=Object.assign({},E);R.inputs=k,R.outputs=E.outputs,b.push(R)}}return b}(this.state.activeTape,n,a);if(!o&&s.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=zC(ae(u),"float32"),O.makeTensor(l,u,"float32")),function(f,h,p){for(var v=function(m){var y=h[m],x=[];if(y.outputs.forEach(function(k){var _=f[k.id];_!=null?x.push(_):x.push(null)}),y.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+y.kernelName+".");var w=y.gradient(x),b=function(k){if(!(k in w))throw new Error("Cannot backprop through input "+k+". Available gradients found: "+Object.keys(w)+".");var _=p(function(){return w[k]()});if(_.dtype!=="float32")throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input "+k+" must have 'float32' dtype, but has '"+_.dtype+"'");var R=y.inputs[k];if(!St(_.shape,R.shape))throw new Error("Error in gradient for op "+y.kernelName+". The gradient of input '"+k+"' has shape '"+_.shape+"', which does not match the shape of the input '"+R.shape+"'");if(f[R.id]==null)f[R.id]=_;else{var N=f[R.id];f[R.id]=N.add(_),N.dispose()}};for(var E in y.inputs)b(E)},g=h.length-1;g>=0;g--)v(g)}(c,s,function(f){return i.tidy(f)});var d=n.map(function(f){return c[f.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:d}})},e.prototype.customGrad=function(t){var n=this;return T(Dp(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];T(o.every(function(s){return s instanceof Je}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),n.runKernelFunc(function(s,u){return T((r=t.apply(void 0,o.concat([u]))).value instanceof Je,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),T(Dp(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];T(c.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),T(c.every(function(f){return f instanceof Je}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return c.forEach(function(f,h){d[h]=function(){return f}}),d})}},e.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},e.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},e.prototype.time=function(t){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){switch(o.label){case 0:return n=wr(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=wr()-n,[2,r]}})})},e.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new zy,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),O=function(){var e=function(){if(Xf==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}Xf=n}return Xf}();if(e._tfengine==null){var t=new G3(e);e._tfengine=new fM(t)}return function(n){DC=n}(e._tfengine.ENV),Er=function(){return e._tfengine},e._tfengine}();function HC(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var zr=G();zr.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),zr.registerFlag("IS_BROWSER",function(){return HC()}),zr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),zr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),zr.registerFlag("PROD",function(){return!1}),zr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return zr.getBool("DEBUG")}),zr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),zr.registerFlag("IS_TEST",function(){return!1});var yu,Cn,wn,hi={},Yf={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function hM(e,t){hi[e]=t}function Or(e){e in hi||(hi[e]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete hi[n]},!1),n===1?r.getContext("webgl",Yf)||r.getContext("experimental-webgl",Yf):r.getContext("webgl2",Yf)}(e));var t=hi[e];return t.isContextLost()?(delete hi[e],Or(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),hi[e])}function Od(e,t){return[t,e]}function $s(e){var t=ae(e);return Pp(Math.ceil(t/4))}function $u(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Cm(e,t){var n,r,o,i,a,s,u,l,c,d=e;return G().getNumber("WEBGL_VERSION")===2?(n=d.R32F,r=d.R16F,o=d.RGBA16F,i=d.RGBA32F,a=d.RED,s=4,u=1,l=d.HALF_FLOAT,c=d.FLOAT):(n=e.RGBA,r=e.RGBA,o=e.RGBA,i=d.RGBA,a=e.RGBA,s=4,u=4,l=t!=null?t.HALF_FLOAT_OES:null,c=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function se(e,t,n){var r=n();return t&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+gM(o,i))}(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(yu||(yu={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Cn||(Cn={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(wn||(wn={}));var pM=596e-10,vM=65504;function mM(e){return!!(G().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||pM<Math.abs(e)&&Math.abs(e)<vM)}function gM(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function _l(e,t,n){return ro(e,t,function(){return e.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function yM(e,t,n){var r=ro(e,t,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(se(e,t,function(){return e.shaderSource(r,n)}),se(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function xM(e,t,n){var r=ro(e,t,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(se(e,t,function(){return e.shaderSource(r,n)}),se(e,t,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw function(o,i){var a=wM.exec(i);if(a==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split(`
`),l=u.length.toString().length+2,c=u.map(function(g,m){return Ra((m+1).toString(),l)+g}),d=0,f=0;f<c.length;f++)d=Math.max(c[f].length,d);var h=c.slice(0,s-1),p=c.slice(s-1,s),v=c.slice(s);console.log(h.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+Ra(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Qf,Jf,wM=/ERROR: [0-9]+:([0-9]+):/g;function bM(e,t){return ro(e,t,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function CM(e,t,n){if(se(e,t,function(){return e.linkProgram(n)}),e.getProgramParameter(n,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Zf(e,t,n){if(se(e,t,function(){return e.validateProgram(n)}),e.getProgramParameter(n,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function EM(e,t,n){var r=ro(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return se(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),se(e,t,function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function SM(e,t,n){var r=ro(e,t,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return se(e,t,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),se(e,t,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)}),r}function kM(e,t){return ro(e,t,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function _M(e,t){var n=G().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function RM(e,t){return ro(e,t,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Wy(e,t,n,r,o,i,a,s){var u=e.getAttribLocation(n,r);return u!==-1&&(se(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,o)}),se(e,t,function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,a,s)}),se(e,t,function(){return e.enableVertexAttribArray(u)}),!0)}function NM(e,t,n,r){DM(e,r),se(e,t,function(){return e.activeTexture(e.TEXTURE0+r)}),se(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)})}function IM(e,t,n,r){return ro(e,t,function(){return e.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function TM(e,t,n){return e.getUniformLocation(t,n)}function AM(e,t,n,r,o,i){se(e,t,function(){return NM(e,t,r,i)}),se(e,t,function(){return e.uniform1i(o,i)})}function eh(e,t,n,r){se(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),se(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)})}function $y(e,t,n){se(e,t,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),se(e,t,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function Rl(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+PM(e,t))}function PM(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function ro(e,t,n,r){var o=se(e,t,function(){return n()});if(o==null)throw new Error(r);return o}function DM(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function Lc(e,t){return t===void 0&&(t=2),ae(e.slice(0,e.length-t))}function Bc(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function th(e){var t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[Lc(e)].concat(Bc(e))),t}function MM(e,t){var n;t===void 0&&(t=!1);var r=G().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(e=e.map(function(l,c){return c>=e.length-2?LC(e[c]):e[c]})).length===1&&(e=[2,e[0]])),e.length!==2){var o=vi(e);e=o.newShape}var i=ae(e);if(e.length<=1&&i<=r)return[1,i];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var a=Lc(e),s=2,u=2;return e.length&&(s=(n=Bc(e))[0],u=n[1]),Pp(i=a*(s/2)*(u/2)).map(function(l){return 2*l})}return Pp(i)}function Nl(e){return e%2==0}function Il(e,t){if(St(e=e.slice(-2),t=t.slice(-2))||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||Nl(n)&&Nl(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Nl(e[0])&&Nl(t[0])}function FM(e){if(Qf==null){var t=Or(e);Qf=t.getParameter(t.MAX_TEXTURE_SIZE)}return Qf}function OM(e){if(Jf==null){var t=Or(e);Jf=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Jf)}function LM(e){if(e===0)return 0;var t=Or(e);return zn(t,"EXT_disjoint_timer_query_webgl2")&&e===2?2:zn(t,"EXT_disjoint_timer_query")?1:0}function zn(e,t){return e.getExtension(t)!=null}function Uy(e){try{if(Or(e)!=null)return!0}catch{return!1}return!1}function BM(e){if(e===0)return!1;var t=Or(e);if(e===1){if(!zn(t,"OES_texture_float"))return!1}else if(!zn(t,"EXT_color_buffer_float"))return!1;return jp(t)}function jM(e){if(e===0)return!1;var t=Or(e);if(e!==1){if(zn(t,"EXT_color_buffer_float"))return jp(t);if(zn(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=Cm(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(t,n)}return!1}return!!zn(t,"OES_texture_float")&&!!zn(t,"WEBGL_color_buffer_float")&&jp(t)}function jp(e){var t=Cm(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),o}function zM(e){return e===2&&Or(e).fenceSync!=null}var fe=G();function GC(e){G().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function te(e,t){return O.tidy(e,t)}function ln(e){VC(e).forEach(function(t){return t.dispose()})}function WM(e){return O.keep(e)}function jc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];G().getBool("IS_TEST")||console.warn.apply(console,e)}function ri(e,t){var n=e;if(Nr(e))return t==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Nr(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&G().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],!Array.isArray(i)&&!Nr(i))return void T(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});T(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),T(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),l=0;l<i.length;++l)o(i[l],u,s.concat(l))}(e,r,[]),r}function Vy(e,t,n,r){if(e!=null&&(e!=="numeric"&&e!==t||e==="numeric"&&t==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function I(e,t,n,r){if(r===void 0&&(r="numeric"),e instanceof Je)return Vy(r,e.dtype,t,n),e;var o=zu(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Vy(r,o,t,n),e==null||!Nr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var i=e==null?"null":e.constructor.name;throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=ri(e,o);Nr(e)||Array.isArray(e)||(e=[e]);var s=o!=="string"?jC(e,o,G().getBool("DEBUG")):Za(e,[],!0);return O.makeTensor(s,a,o)}function zc(e,t,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(o,i){return I(o,t+"["+i+"]",n)},r)}function qC(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function $M(e,t,n){for(var r=e.length+t.length,o=[],i=0,a=0,s=0;s<r;s++)n.indexOf(s)===-1?o.push(e[i++]):o.push(t[a++]);return o}function Ot(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t.indexOf(o)===-1&&n.push(e[o]);return[n,t.map(function(i){return e[i]})]}function cn(e,t){return $M(e,t.map(function(n){return 1}),t)}function yn(e,t,n){T(qC(t,n),function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."})}function Lr(e,t){if(qC(e,t))return null;for(var n=[],r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(function(o){return n.push(o)}),n}function Em(e){return e.map(function(t,n){return[n,t]}).sort(function(t,n){return t[1]-n[1]}).map(function(t){return t[0]})}function Br(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function UM(e,t){var n=e[0].length;e.forEach(function(o,i){T(o.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+n+")"})}),T(t>=0&&t<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=e[0];e.forEach(function(o,i){for(var a=0;a<n;a++)T(a===t||o[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function ts(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function M(e){var t=Object.keys(e);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];O.startScope(n);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),O.endScope(s),s}catch(u){throw O.endScope(null),u}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}fe.registerFlag("HAS_WEBGL",function(){return fe.getNumber("WEBGL_VERSION")>0}),fe.registerFlag("WEBGL_VERSION",function(){return Uy(2)?2:Uy(1)?1:0}),fe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return fe.get("WEBGL_VERSION")===2}),fe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),fe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),fe.registerFlag("WEBGL_PACK",function(){return fe.getBool("HAS_WEBGL")}),fe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_PACK_CLIP",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),fe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_PACK_REDUCE",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_CONV_IM2COL",function(){return fe.getBool("WEBGL_PACK")}),fe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return FM(fe.getNumber("WEBGL_VERSION"))}),fe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return OM(fe.getNumber("WEBGL_VERSION"))}),fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=fe.getNumber("WEBGL_VERSION");return e===0?0:LM(e)}),fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return fe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),fe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return BM(fe.getNumber("WEBGL_VERSION"))}),fe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!fe.getBool("WEBGL_FORCE_F16_TEXTURES")&&fe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),fe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return jM(fe.getNumber("WEBGL_VERSION"))}),fe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return zM(fe.getNumber("WEBGL_VERSION"))}),fe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return fe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),UC=GC;var Rt=M({complex_:function(e,t){var n=I(e,"real","complex"),r=I(t,"imag","complex");return Fe(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),O.runKernelFunc(function(o){return o.complex(n,r)},{$real:n,$imag:r})}}),Bn=M({real_:function(e){var t=I(e,"input","real");return O.runKernelFunc(function(n){return n.real(t)},{$input:t})}}),Sr=M({imag_:function(e){var t=I(e,"input","imag");return O.runKernelFunc(function(n){return n.imag(t)},{$input:t})}});function It(e,t,n){return oi(e,t,ri(e,n),n)}function oi(e,t,n,r){if(r==null&&(r=zu(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Nr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){WC(t);var o=ae(t),i=ae(n);T(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<n.length;++a){var s=n[a],u=a!==n.length-1||s!==ae(t.slice(a));T(n[a]===t[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "})}}return Nr(e)||Array.isArray(e)||(e=[e]),t=t||n,e=r!=="string"?jC(e,r,G().getBool("DEBUG")):Za(e,[],!0),O.makeTensor(e,t,r)}function Z(e,t){if((Nr(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Nr(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return oi(e,[],[],t)}function ct(e,t){ds(e);var n=ri(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return oi(e,null,n,t)}function Vo(e,t,n){if(ds(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=ri(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return oi(e,t,r,n)}function Sm(e,t,n){if(ds(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=ri(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return oi(e,t,r,n)}function nn(e,t,n){if(ds(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=ri(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return oi(e,t,r,n)}function VM(e,t,n){if(ds(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=ri(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return oi(e,t,r,n)}function HM(e,t,n){if(ds(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=ri(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return oi(e,t=t||r,r,n)}function GM(e,t,n,r){return t===void 0&&(t=!0),O.makeVariable(e,t,n,r)}function fs(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=fs(e,"float32"),r=Ke(e,"float32");return Rt(n,r)}var o=zC(ae(e),t);return O.makeTensor(o,e,t)}function Ke(e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Ke(e,"float32"),r=Ke(e,"float32");return Rt(n,r)}var o=Wu(ae(e),t);return O.makeTensor(o,e,t)}function Tr(e,t,n){return O.runKernelFunc(function(r){return r.fill(e,t,n)},{})}function qM(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return O.runKernelFunc(function(r){return r.linspace(e,t,n)},{})}function Wc(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Ke([0],r);var o=Wu(Math.abs(Math.ceil((t-e)/n)),r);t<e&&n===1&&(n=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return ct(o,r)}var KC=M({onesLike_:function(e){var t=I(e,"x","onesLike");if(t.dtype==="complex64"){var n=KC(Bn(t)),r=Re(Sr(t));return Rt(n,r)}return O.runKernelFunc(function(o){return o.onesLike(t)},{$x:t},function(o,i){return{$x:function(){return Re(o)}}})}}),Re=M({zerosLike_:function(e){var t=I(e,"x","zerosLike");return O.runKernelFunc(function(n){return n.zerosLike(t)},{$x:t},function(n,r){return{$x:function(){return Re(n)}}})}}),mt=M({concat_:function(e,t){t===void 0&&(t=0),T(e.length>=1,function(){return"Pass at least one tensor to concat"});var n=zc(e,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),t=wt(t,n[0].shape)[0];var r=ts(n.map(function(s){return s.shape}),t);if(ae(r)===0)return It([],r);if((n=n.filter(function(s){return s.size>0})).length===1)return n[0];var o=n.map(function(s){return s.shape});UM(o,t);var i=n,a={axis:t};return O.runKernelFunc(function(s){return s.concat(n,t)},i,function(s){var u=o.map(function(l){return l[t]});return km(s,u,t).map(function(l){return function(){return l}})},"Concat",a)}}),KM=M({concat1d_:function(e){return mt(e,0)}}),XM=M({concat2d_:function(e,t){return mt(e,t)}}),YM=M({concat3d_:function(e,t){return mt(e,t)}}),QM=M({concat4d_:function(e,t){return mt(e,t)}}),km=M({split_:function(e,t,n){n===void 0&&(n=0);var r,o=I(e,"x","split");return n=wt(n,o.shape)[0],typeof t=="number"?(T(o.shape[n]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[n]/t)):(T(o.shape[n]===t.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),O.runKernelFunc(function(i){return i.split(o,r,n)},{$x:o},function(i){return{$x:function(){return mt(i,n)}}})}});function $i(e,t){return e(t={exports:{}},t.exports),t.exports}var JM=$i(function(e){(function(t,n,r){function o(s){var u,l=this,c=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var d=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=0|d)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new o(s),c=u&&u.state,d=l.next;return d.int32=function(){return 4294967296*l.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&(typeof c=="object"&&i(c,l),d.state=function(){return i(l,{})}),d}n&&n.exports?n.exports=a:this.alea=a})(0,e)}),ZM=$i(function(e){(function(t,n,r){function o(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&i(c,l),d.state=function(){return i(l,{})}),d}n&&n.exports?n.exports=a:this.xor128=a})(0,e)}),e4=$i(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&i(c,l),d.state=function(){return i(l,{})}),d}n&&n.exports?n.exports=a:this.xorwow=a})(0,e)}),t4=$i(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,d=u.x,f=u.i;return l=d[f],c=(l^=l>>>7)^l<<24,c^=(l=d[f+1&7])^l>>>10,c^=(l=d[f+3&7])^l>>>3,c^=(l=d[f+4&7])^l<<7,l=d[f+7&7],c^=(l^=l<<13)^l<<9,d[f]=c,u.i=f+1&7,c},function(l,c){var d,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,d=0;d<c.length;++d)f[7&d]=f[7&d]<<15^c.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?f[7]=-1:f[d],l.x=f,l.i=0,d=256;d>0;--d)l.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(c.x&&i(c,l),d.state=function(){return i(l,{})}),d}n&&n.exports?n.exports=a:this.xorshift7=a})(0,e)}),n4=$i(function(e){(function(t,n,r){function o(s){var u=this;u.next=function(){var l,c,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,c=f[h+34&127],l=f[h=h+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[h]=c^l,u.i=h,c+(d^d>>>16)|0},function(l,c){var d,f,h,p,v,g=[],m=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,m=Math.max(m,c.length)),h=0,p=-32;p<m;++p)c&&(f^=c.charCodeAt((p+32)%c.length)),p===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(v=v+1640531527|0,h=(d=g[127&p]^=f+v)==0?h+1:0);for(h>=128&&(g[127&(c&&c.length||0)]=-1),h=127,p=512;p>0;--p)f=g[h+34&127],d=g[h=h+1&127],f^=f<<13,d^=d<<17,f^=f>>>15,d^=d>>>12,g[h]=f^d;l.w=v,l.X=g,l.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(c.X&&i(c,l),d.state=function(){return i(l,{})}),d}n&&n.exports?n.exports=a:this.xor4096=a})(0,e)}),r4=$i(function(e){(function(t,n,r){function o(s){var u=this,l="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new o(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&i(c,l),d.state=function(){return i(l,{})}),d}n&&n.exports?n.exports=a:this.tychei=a})(0,e)}),pi=$i(function(e){(function(t,n){var r,o=this,i=256,a=6,s="random",u=n.pow(i,a),l=n.pow(2,52),c=2*l,d=i-1;function f(m,y,x){var w=[],b=v(function _(R,N){var D,A=[],j=typeof R;if(N&&j=="object")for(D in R)try{A.push(_(R[D],N-1))}catch{}return A.length?A:j=="string"?R:R+"\0"}((y=y==1?{entropy:!0}:y||{}).entropy?[m,g(t)]:m??function(){try{var _;return r&&(_=r.randomBytes)?_=_(i):(_=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(_)),g(_)}catch{var R=o.navigator,N=R&&R.plugins;return[+new Date,o,N,o.screen,g(t)]}}(),3),w),E=new h(w),k=function(){for(var _=E.g(a),R=u,N=0;_<l;)_=(_+N)*i,R*=i,N=E.g(1);for(;_>=c;)_/=2,R/=2,N>>>=1;return(_+N)/R};return k.int32=function(){return 0|E.g(4)},k.quick=function(){return E.g(4)/4294967296},k.double=k,v(g(E.S),t),(y.pass||x||function(_,R,N,D){return D&&(D.S&&p(D,E),_.state=function(){return p(E,{})}),N?(n[s]=_,R):_})(k,b,"global"in y?y.global:this==n,y.state)}function h(m){var y,x=m.length,w=this,b=0,E=w.i=w.j=0,k=w.S=[];for(x||(m=[x++]);b<i;)k[b]=b++;for(b=0;b<i;b++)k[b]=k[E=d&E+m[b%x]+(y=k[b])],k[E]=y;(w.g=function(_){for(var R,N=0,D=w.i,A=w.j,j=w.S;_--;)R=j[D=d&D+1],N=N*i+j[d&(j[D]=j[A=d&A+R])+(j[A]=R)];return w.i=D,w.j=A,N})(i)}function p(m,y){return y.i=m.i,y.j=m.j,y.S=m.S.slice(),y}function v(m,y){for(var x,w=m+"",b=0;b<w.length;)y[d&b]=d&(x^=19*y[d&b])+w.charCodeAt(b++);return g(y)}function g(m){return String.fromCharCode.apply(0,m)}if(n["seed"+s]=f,v(n.random(),t),e.exports){e.exports=f;try{r=require("crypto")}catch{}}})([],Math)});pi.alea=JM,pi.xor128=ZM,pi.xorwow=e4,pi.xorshift7=t4,pi.xor4096=n4,pi.tychei=r4;var Ld=pi.alea,_m=function(){function e(t,n,r,o,i){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Ld(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var n,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(n)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},e.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},e.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},e}(),o4=function(){function e(t,n,r,o){this.alpha=t,this.beta=1/n,this.dtype=r;var i=o||Math.random();this.randu=Ld(i.toString()),this.randn=new _m(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var t,n,r,o,i,a;;){do o=this.randn.nextValue(),a=1+this.c*o;while(a<=0);if(a*=a*a,n=1-.331*(t=o*o)*t,r=.5*t+this.d*(1-a+Math.log(a)),(i=this.randu())<n||Math.log(i)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},e}(),i4=function(){function e(t,n,r,o){var i=this;if(t===void 0&&(t=0),n===void 0&&(n=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=t,this.range=n-t,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+n+" <= 1 and dtype is not float");this.random=Ld(o)}return e.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function ve(e,t,n){return t===void 0&&(t="float32"),t=t||"float32",WC(e),new gu(e,t,n)}function a4(e,t){t===void 0&&(t=!1),console.log(e.toString(t))}var XC=M({batchToSpaceND_:function(e,t,n){var r=I(e,"x","batchToSpaceND"),o=t.reduce(function(i,a){return i*a});return T(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),T(n.length===t.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length}),T(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),O.runKernelFunc(function(i){return i.batchToSpaceND(r,t,n)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(t,n)}}})}}),s4=M({broadcastTo_:function(e,t){var n=I(e,"broadcastTo","x"),r=n.shape;if(t.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var o=n.shape.slice();o.length<t.length;)o.unshift(1);n=n.reshape(o)}for(var i=Array.from(t),a=t.length-1;a>=0;a--)if(n.shape[a]===t[a])i[a]=1;else if(n.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return s.length===0?n.clone():O.runKernelFunc(function(u){return u.tile(n,i)},{input:n},function(u){return{input:function(){return u.sum(s,!0)}}})}}),u4=M({cast_:function(e,t){var n=I(e,"x","cast");if(!eM(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return O.runKernelFunc(function(o){return o.cast(n,t)},{x:n},function(o){return{x:function(){return o.clone()}}},"Cast",r)}}),l4=M({clone_:function(e){var t=I(e,"x","clone",null);return O.runKernelFunc(function(){return O.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(n){return{$x:function(){return n.toFloat()}}})}}),c4=M({cumsum_:function(e,t,n,r){t===void 0&&(t=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var o=I(e,"x","cumsum"),i=Lr([t|=0],o.rank),a=o;i!=null&&(a=o.transpose(i));var s=Br(1,o.rank)[0],u=O.runKernelFunc(function(l){return l.cumsum(a,s,n,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(t,n,!r)}}});return i!=null&&(u=u.transpose(i)),u}}),d4=M({depthToSpace_:function(e,t,n){n===void 0&&(n="NHWC");var r=I(e,"x","depthToSpace"),o=n==="NHWC"?r.shape[1]:r.shape[2],i=n==="NHWC"?r.shape[2]:r.shape[3],a=n==="NHWC"?r.shape[3]:r.shape[1];return T(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),T(i*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+t+` for depthToSpace with input shape
          `+r.shape}),T(a%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+r.shape}),O.runKernelFunc(function(s){return s.depthToSpace(r,t,n)},{$x:r})}}),Ln=M({expandDims_:function(e,t){t===void 0&&(t=0);var n=I(e,"x","expandDims",null);T(t<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return t<0&&(T(-(n.rank+1)<=t,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),t=n.rank+t+1),r.splice(t,0,1),Zn(n,r)}}),YC=M({eye_:function(e,t,n,r){r===void 0&&(r="float32"),t==null&&(t=e);for(var o=ve([e,t],r),i=e<=t?e:t,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(e,t);if(n==null)return s;if(n.length===1)return Na(Ln(s,0),[n[0],1,1]);if(n.length===2)return Na(Ln(Ln(s,0),0),[n[0],n[1],1,1]);if(n.length===3)return Na(Ln(Ln(Ln(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),f4=M({multinomial_:function(e,t,n,r){r===void 0&&(r=!1);var o=I(e,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=a===1?o.as2D(1,-1):o,u=O.runKernelFunc(function(l){return l.multinomial(s,r,t,n)},{logits2D:s});return a===1?u.as1D():u}}),zp=M({oneHot_:function(e,t,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=I(e,"indices","oneHot","int32"),i=o.shape.concat([t]);return o=o.flatten(),O.runKernelFunc(function(a){return a.oneHot(o,t,n,r)},{$indices:o},function(a){return{$indices:function(){return Ke(o.shape,"float32")}}}).reshape(i)}}),Ui=M({pad_:function(e,t,n){n===void 0&&(n=0);var r=I(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:t,constantValue:n};return O.runKernelFunc(function(i){return i.pad(r,t,n)},{x:r},function(i){var a=t.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",o)}}),h4=M({pad1d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Ui(e,[t],n)}}),p4=M({pad2d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ui(e,t,n)}}),v4=M({pad3d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ui(e,t,n)}}),m4=M({pad4d_:function(e,t,n){return n===void 0&&(n=0),T(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ui(e,t,n)}}),g4=M({rand_:function(e,t,n){var r=ae(e),o=null;if(n==null||n==="float32")o=new Float32Array(r);else if(n==="int32")o=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return O.makeTensor(o,e,n)}}),y4=M({randomNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new _m(t,n,r,!1,o),a=ve(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),x4=M({randomGamma_:function(e,t,n,r,o){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new o4(t,n,r,o),a=ve(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),QC=M({randomUniform_:function(e,t,n,r,o){t===void 0&&(t=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var i=ve(e,r),a=new i4(t,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Zn=M({reshape_:function(e,t){var n=I(e,"x","reshape",null);t=J3(t,n.size),T(n.size===ae(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return O.runKernelFunc(function(o){return o.reshape(n,t)},{x:n},function(o){return{x:function(){return o.reshape(n.shape)}}},"Reshape",r)}}),JC=M({spaceToBatchND_:function(e,t,n){var r=I(e,"x","spaceToBatchND");return T(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),T(n.length===t.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length}),T(r.shape.reduce(function(o,i,a){return a>0&&a<=t.length?o&&(i+n[a-1][0]+n[a-1][1])%t[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()}),O.runKernelFunc(function(o){return o.spaceToBatchND(r,t,n)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,n)}}})}}),ZC=M({squeeze_:function(e,t){var n=I(e,"x","squeeze");return Zn(n,vi(n.shape,t).newShape)}}),Rn=M({stack_:function(e,t){t===void 0&&(t=0);var n=zc(e,"tensors","stack");if(T(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(t);var r=n[0].rank,o=n[0].shape,i=n[0].dtype;T(t<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(s){Fe(o,s.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(s){T(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(s){return s.expandDims(t)});return mt(a,t)}}),Na=M({tile_:function(e,t){var n=I(e,"x","tile",null);T(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."});var r=[n],o={reps:t};return O.runKernelFunc(function(i,a){var s=i.tile(n,t);return a([n]),s},{x:n},function(i,a){var s=a[0];return{x:function(){var u=Re(s);if(s.rank===1)for(var l=0;l<t[0];++l)u=u.add(i.slice([l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(l=0;l<t[0];++l)for(var c=0;c<t[1];++c)u=u.add(i.slice([l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(var d=0;d<t[2];++d)u=u.add(i.slice([l*s.shape[0],c*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(d=0;d<t[2];++d)for(var f=0;f<t[3];++f)u=u.add(i.slice([l*s.shape[0],c*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",o,r)}}),w4=M({truncatedNormal_:function(e,t,n,r,o){if(t===void 0&&(t=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new _m(t,n,r,!0,o),a=ve(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),gt=M({unstack_:function(e,t){t===void 0&&(t=0),t=t||0;var n=I(e,"x","unstack");T(t>=-n.shape.length&&t<n.shape.length,function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),t<0&&(t+=n.shape.length);var r={axis:t};return O.runKernelFunc(function(o){return o.unstack(n,t)},{x:n},function(o){return{x:function(){return Rn(o,t)}}},"Unpack",r)}}),b4=function(e,t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return n=I(e,"x","setdiff1d"),r=I(t,"y","setdiff1d"),T(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),T(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),T(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(i=f.sent(),a=new Set(i),s=0,c=0;c<o.length;c++)a.has(o[c])||s++;for(u=new gu([s],n.dtype),l=new gu([s],"int32"),c=0,d=0;c<o.length;c++)a.has(o[c])||(u.values[d]=o[c],l.values[d]=c,d++);return[2,[u.toTensor(),l.toTensor()]]}})})};function $c(e,t,n,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(e[0]/n),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=t.length,a=0;a<i;++a)o=o.concat([e[a+1]/t[a],t[a]]);o=o.concat(e.slice(i+1))}return o}function Uc(e,t,n){n===void 0&&(n=!0);var r=[];if(n){r.push(t);for(var o=t+1;o<e;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<e;++o)o>=2*t+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function Vc(e,t,n,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/n):o.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?o.push(t[i-1]*e[i]):o.push(e[i]/t[i-1]):o.push(e[i]);return o}function eE(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function tE(e,t,n){for(var r=e.slice(0,1),o=0;o<n;++o)r.push(e[o+1]-t[o][0]-t[o][1]);return r}function nE(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=e.shape,s=n.slice();s.pop();var u=1;for(i=r;i<e.rank;++i)u*=a[i],s.push(a[i]);var l=Ir(e.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,o,u,l]}var rE=30;function nh(e){return e<=rE?e:Mp(e,Math.floor(Math.sqrt(e)))}function C4(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==t.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+t.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==e[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+e[a+o]+")")}function E4(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}C4(n,t,e)}function Hc(e,t,n){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,i=n.length,a=1,s=o;s<i;++s)a*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ae(t.shape)/u,sliceSize:a,strides:Ir(n.slice(0,o)).concat([1]),outputSize:ae(n)}}function S4(e,t,n){T(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."}),T(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."});for(var r=function(i){T(t[i]+n[i]<=e.shape[i],function(){return"Error in slice"+e.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+n[i])+") would overflow input.shape["+i+"] ("+e.shape[i]+")"})},o=0;o<e.rank;++o)r(o)}function Hy(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Rm(e,t,n){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((t[o]-e[o])/n[o]);return r}function k4(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=Ap(0,i,s-1)}function _4(e,t,n,r,o){var i=t[o],a=n[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=a>0?Ap(0,i,s):Ap(-1,i,s-1)}function oE(e,t,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function iE(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function R4(e,t){T(Dp(e),function(){return"The f passed in variableGrads(f) must be a function"}),T(t==null||Array.isArray(t)&&t.every(function(c){return c instanceof es}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=t!=null;if(!n)for(var r in t=[],O.registeredVariables)t.push(O.registeredVariables[r]);var o=n?t.filter(function(c){return!c.trainable}):null,i=t.length;T((t=t.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=O.gradients(e,t,null,!0),s=a.value,u=a.grads;T(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),T(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(c,d){u[d]!=null&&(l[c.name]=u[d])}),o!=null&&o.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function Bd(e){return O.customGrad(e)}var oo=M({softmax_:function(e,t){t===void 0&&(t=-1);var n=I(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return O.runKernelFunc(function(r,o){var i=r.softmax(n,t);return o([i]),i},{logits:n},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([t],!0).mul(i))}}},"Softmax",{dim:t},[],[!0])}}),N4=M({logSoftmax_:function(e,t){t===void 0&&(t=-1);var n=I(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return Bd(function(r,o){var i=r.max(t,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(t,!0).log());return o([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(n)}}),aE=function(){function e(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},e.prototype.set=function(t,n){this.dataIdsCount++,this.data.set(t,n)},e.prototype.has=function(t){return this.data.has(t)},e.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),sE=function(){function e(){}return e.prototype.time=function(t){return U("time")},e.prototype.read=function(t){return U("read")},e.prototype.readSync=function(t){return U("readSync")},e.prototype.numDataIds=function(){return U("numDataIds")},e.prototype.disposeData=function(t){return U("disposeData")},e.prototype.write=function(t,n,r){return U("write")},e.prototype.move=function(t,n,r,o){return U("move")},e.prototype.memory=function(){return U("memory")},e.prototype.floatPrecision=function(){return U("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(t,n,r,o){return U("batchMatMul")},e.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,U("fusedBatchMatMul")},e.prototype.slice=function(t,n,r){return U("slice")},e.prototype.stridedSlice=function(t,n,r,o){return U("stridedSlice")},e.prototype.unstack=function(t,n){return U("unstack")},e.prototype.reverse=function(t,n){return U("reverse")},e.prototype.concat=function(t,n){return U("concat")},e.prototype.neg=function(t){return U("neg")},e.prototype.add=function(t,n){return U("add")},e.prototype.addN=function(t){return U("addN")},e.prototype.subtract=function(t,n){return U("subtract")},e.prototype.multiply=function(t,n){return U("multiply")},e.prototype.realDivide=function(t,n){return U("realDivide")},e.prototype.floorDiv=function(t,n){return U("floorDiv")},e.prototype.sum=function(t,n){return U("sum")},e.prototype.prod=function(t,n){return U("prod")},e.prototype.unsortedSegmentSum=function(t,n,r){return U("unsortedSegmentSum")},e.prototype.argMin=function(t,n){return U("argMin")},e.prototype.argMax=function(t,n){return U("argMax")},e.prototype.equal=function(t,n){return U("equal")},e.prototype.notEqual=function(t,n){return U("notEqual")},e.prototype.less=function(t,n){return U("less")},e.prototype.lessEqual=function(t,n){return U("lessEqual")},e.prototype.greater=function(t,n){return U("greater")},e.prototype.greaterEqual=function(t,n){return U("greaterEqual")},e.prototype.logicalNot=function(t){return U("logicalNot")},e.prototype.logicalAnd=function(t,n){return U("logicalAnd")},e.prototype.logicalOr=function(t,n){return U("logicalOr")},e.prototype.where=function(t){return U("where")},e.prototype.select=function(t,n,r){return U("select")},e.prototype.topk=function(t,n,r){return U("topk")},e.prototype.min=function(t,n){return U("min")},e.prototype.minimum=function(t,n){return U("minimum")},e.prototype.mod=function(t,n){return U("mod")},e.prototype.max=function(t,n){return U("max")},e.prototype.maximum=function(t,n){return U("maximum")},e.prototype.all=function(t,n){return U("all")},e.prototype.any=function(t,n){return U("any")},e.prototype.squaredDifference=function(t,n){return U("squaredDifference")},e.prototype.ceil=function(t){return U("ceil")},e.prototype.floor=function(t){return U("floor")},e.prototype.round=function(t){return U("round")},e.prototype.sign=function(t){return U("sign")},e.prototype.isNaN=function(t){return U("isNaN")},e.prototype.isInf=function(t){return U("isInf")},e.prototype.isFinite=function(t){return U("isFinite")},e.prototype.pow=function(t,n){return U("pow")},e.prototype.exp=function(t){return U("exp")},e.prototype.expm1=function(t){return U("expm1")},e.prototype.softmax=function(t,n){return U("softmax")},e.prototype.log=function(t){return U("log")},e.prototype.log1p=function(t){return U("log1p")},e.prototype.sqrt=function(t){return U("sqrt")},e.prototype.rsqrt=function(t){return U("rsqrt")},e.prototype.square=function(t){return U("square")},e.prototype.reciprocal=function(t){return U("reciprocal")},e.prototype.relu=function(t){return U("relu")},e.prototype.relu6=function(t){return U("relu6")},e.prototype.prelu=function(t,n){return U("prelu")},e.prototype.elu=function(t){return U("elu")},e.prototype.eluDer=function(t,n){return U("eluDer")},e.prototype.selu=function(t){return U("selu")},e.prototype.int=function(t){return U("int")},e.prototype.clip=function(t,n,r){return U("clip")},e.prototype.abs=function(t){return U("abs")},e.prototype.complexAbs=function(t){return U("complexAbs")},e.prototype.sigmoid=function(t){return U("sigmoid")},e.prototype.softplus=function(t){return U("softplus")},e.prototype.sin=function(t){return U("sin")},e.prototype.cos=function(t){return U("cos")},e.prototype.tan=function(t){return U("tan")},e.prototype.asin=function(t){return U("asin")},e.prototype.acos=function(t){return U("acos")},e.prototype.atan=function(t){return U("atan")},e.prototype.atan2=function(t,n){return U("atan2")},e.prototype.sinh=function(t){return U("sinh")},e.prototype.cosh=function(t){return U("cosh")},e.prototype.tanh=function(t){return U("tanh")},e.prototype.asinh=function(t){return U("asinh")},e.prototype.acosh=function(t){return U("acosh")},e.prototype.atanh=function(t){return U("atanh")},e.prototype.erf=function(t){return U("erf")},e.prototype.step=function(t,n){return U("step")},e.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,U("fusedConv2d")},e.prototype.conv2d=function(t,n,r){return U("conv2d")},e.prototype.conv2dDerInput=function(t,n,r){return U("conv2dDerInput")},e.prototype.conv2dDerFilter=function(t,n,r){return U("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,U("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(t,n,r){return U("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(t,n,r){return U("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(t,n,r){return U("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(t,n,r){return U("conv3d")},e.prototype.conv3dDerInput=function(t,n,r){return U("conv3dDerInput")},e.prototype.conv3dDerFilter=function(t,n,r){return U("conv3dDerFilter")},e.prototype.maxPool=function(t,n){return U("maxPool")},e.prototype.maxPoolBackprop=function(t,n,r,o){return U("maxPoolBackprop")},e.prototype.avgPool=function(t,n){return U("avgPool")},e.prototype.avgPoolBackprop=function(t,n,r){return U("avgPoolBackprop")},e.prototype.avgPool3d=function(t,n){return U("avgPool3d")},e.prototype.avgPool3dBackprop=function(t,n,r){return U("avgPool3dBackprop")},e.prototype.maxPool3d=function(t,n){return U("maxPool3d")},e.prototype.maxPool3dBackprop=function(t,n,r,o){return U("maxPool3dBackprop")},e.prototype.reshape=function(t,n){return U("reshape")},e.prototype.cast=function(t,n){return U("cast")},e.prototype.tile=function(t,n){return U("tile")},e.prototype.pad=function(t,n,r){return U("pad")},e.prototype.transpose=function(t,n){return U("transpose")},e.prototype.gather=function(t,n,r){return U("gather")},e.prototype.gatherND=function(t,n){return U("gatherND")},e.prototype.scatterND=function(t,n,r){return U("scatterND")},e.prototype.batchToSpaceND=function(t,n,r){return U("batchToSpaceND")},e.prototype.spaceToBatchND=function(t,n,r){return U("spaceToBatchND")},e.prototype.resizeBilinear=function(t,n,r,o){return U("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(t,n,r){return U("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(t,n,r,o){return U("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(t,n,r){return U("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(t,n,r,o,i,a){return U("batchNormalization")},e.prototype.localResponseNormalization4D=function(t,n,r,o,i){return U("localResponseNormalization4D")},e.prototype.LRNGrad=function(t,n,r,o,i,a,s){return U("LRNGrad")},e.prototype.multinomial=function(t,n,r,o){return U("multinomial")},e.prototype.oneHot=function(t,n,r,o){return U("oneHot")},e.prototype.cumsum=function(t,n,r,o){return U("cumsum")},e.prototype.nonMaxSuppression=function(t,n,r,o,i){return U("nonMaxSuppression")},e.prototype.fft=function(t){return U("fft")},e.prototype.ifft=function(t){return U("ifft")},e.prototype.complex=function(t,n){return U("complex")},e.prototype.real=function(t){return U("real")},e.prototype.imag=function(t){return U("imag")},e.prototype.cropAndResize=function(t,n,r,o,i,a){return U("cropAndResize")},e.prototype.depthToSpace=function(t,n,r){return U("depthToSpace")},e.prototype.split=function(t,n,r){return U("split")},e.prototype.sparseToDense=function(t,n,r,o){return U("sparseToDense")},e.prototype.diag=function(t){return U("diag")},e.prototype.fill=function(t,n,r){return U("fill")},e.prototype.onesLike=function(t){return U("onesLike")},e.prototype.zerosLike=function(t){return U("zerosLike")},e.prototype.linspace=function(t,n,r){return U("linspace")},e.prototype.dispose=function(){return U("dispose")},e}();function U(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Po(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var i=n-1-o,a=e[i]||1;(t[t.length-1-o]||1)>1&&a===1&&r.unshift(i)}return r}function yt(e,t){for(var n=[],r=0;r<t.length;r++){var o=e[e.length-r-1],i=t.length-r-1,a=t[i];(o==null||o===1&&a>1)&&n.unshift(i)}return n}function Se(e,t){for(var n=[],r=Math.max(e.length,t.length),o=0;o<r;o++){var i=e[e.length-o-1];i==null&&(i=1);var a=t[t.length-o-1];if(a==null&&(a=1),i===1)n.unshift(a);else if(a===1)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(i)}}return n}function xu(e,t,n,r,o,i,a){a===void 0&&(a="channelsLast");var s,u=Kc(t),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,e[3],e[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,e[1],e[1]]}return Vi(e,s,n,r,o,i,!1,a)}function Gc(e,t,n,r,o,i,a){a===void 0&&(a="NDHWC");var s,u,l=Wp(t),c=l[0],d=l[1],f=l[2];if(a==="NDHWC")u="channelsLast",s=[c,d,f,e[4],e[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,d,f,e[1],e[1]]}return qc(e,s,n,r,o,!1,u,i)}function Vi(e,t,n,r,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],f=u[3];if(s==="channelsLast")l=e[0],c=e[1],d=e[2],f=e[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=e[0],f=e[1],c=e[2],d=e[3]}var h,p=t[0],v=t[1],g=t[3],m=Kc(n),y=m[0],x=m[1],w=Kc(r),b=w[0],E=w[1],k=Ia(p,b),_=Ia(v,E),R=function(F,z,B,$,P,L,W,H){var q,Q,re;if(typeof F=="number"){q={top:F,bottom:F,left:F,right:F,type:F===0?"VALID":"NUMBER"};var ce=function(we,_e,Ce,Le,Be){Le==null&&(Le=uE(we,_e,Ce));var Ie=we[0],Qt=we[1],Jt=Us((Ie-_e+2*Le)/Ce+1,Be);T(ut(Jt),function(){return"The output # of rows ("+Jt+") must be an integer. Change the stride and/or zero pad parameters"});var Ae=Us((Qt-_e+2*Le)/Ce+1,Be);return T(ut(Ae),function(){return"The output # of columns ("+Ae+") must be an integer. Change the stride and/or zero pad parameters"}),[Jt,Ae]}([z,B],L,$,F,H);Q=ce[0],re=ce[1]}else if(F==="same"){Q=Math.ceil(z/$),re=Math.ceil(B/P);var ee=Math.max(0,(Q-1)*$+L-z),de=Math.max(0,(re-1)*P+W-B),pe=Math.floor(ee/2),me=ee-pe,De=Math.floor(de/2);q={top:pe,bottom:me,left:De,right:de-De,type:"SAME"}}else{if(F!=="valid")throw Error("Unknown padding parameter: "+F);q={top:0,bottom:0,left:0,right:0,type:"VALID"},Q=Math.ceil((z-L+1)/$),re=Math.ceil((B-W+1)/P)}return{padInfo:q,outHeight:Q,outWidth:re}}(o,c,d,y,x,k,_,i),N=R.padInfo,D=R.outHeight,A=R.outWidth,j=a?g*f:g;return s==="channelsFirst"?h=[l,j,D,A]:s==="channelsLast"&&(h=[l,D,A,j]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:d,inChannels:f,outHeight:D,outWidth:A,outChannels:j,padInfo:N,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:v,effectiveFilterHeight:k,effectiveFilterWidth:_,dilationHeight:b,dilationWidth:E,inShape:e,outShape:h,filterShape:t}}function qc(e,t,n,r,o,i,a,s){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],f=u[3],h=u[4];if(a==="channelsLast")l=e[0],c=e[1],d=e[2],f=e[3],h=e[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=e[0],h=e[1],c=e[2],d=e[3],f=e[4]}var p,v=t[0],g=t[1],m=t[2],y=t[4],x=Wp(n),w=x[0],b=x[1],E=x[2],k=Wp(r),_=k[0],R=k[1],N=k[2],D=Ia(v,_),A=Ia(g,R),j=Ia(m,N),F=function(W,H,q,Q,re,ce,ee,de,pe,me,De){var we,_e,Ce,Le;if(typeof W=="number"){we={top:W,bottom:W,left:W,right:W,front:W,back:W,type:W===0?"VALID":"NUMBER"};var Be=function(lo,Dn,ai,hn,pn,cr){pn==null&&(pn=uE(lo,Dn,hn));var Yu=lo[0],ef=lo[1],Qu=lo[2],qi=Us((Yu-Dn+2*pn)/hn+1,cr);T(ut(qi),function(){return"The output # of depths ("+qi+") must be an integer. Change the stride and/or zero pad parameters"});var ps=Us((ef-Dn+2*pn)/hn+1,cr);T(ut(ps),function(){return"The output # of rows ("+ps+") must be an integer. Change the stride and/or zero pad parameters"});var si=Us((Qu-Dn+2*pn)/hn+1,cr);return T(ut(si),function(){return"The output # of columns ("+si+") must be an integer. Change the stride and/or zero pad parameters"}),[qi,ps,si,ai]}([H,q,Q,1],de,1,re,W,De);_e=Be[0],Ce=Be[1],Le=Be[2]}else if(W==="same"){_e=Math.ceil(H/re),Ce=Math.ceil(q/ce),Le=Math.ceil(Q/ee);var Ie=(_e-1)*re+de-H,Qt=(Ce-1)*ce+pe-q,Jt=(Le-1)*ee+me-Q,Ae=Math.floor(Ie/2),fn=Ie-Ae,Hn=Math.floor(Qt/2),lr=Qt-Hn,Zt=Math.floor(Jt/2);we={top:Hn,bottom:lr,left:Zt,right:Jt-Zt,front:Ae,back:fn,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);we={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},_e=Math.ceil((H-de+1)/re),Ce=Math.ceil((q-pe+1)/ce),Le=Math.ceil((Q-me+1)/ee)}return{padInfo:we,outDepth:_e,outHeight:Ce,outWidth:Le}}(o,c,d,f,w,b,E,D,A,j,s),z=F.padInfo,B=F.outDepth,$=F.outHeight,P=F.outWidth,L=i?y*h:y;return a==="channelsFirst"?p=[l,L,B,$,P]:a==="channelsLast"&&(p=[l,B,$,P,L]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:d,inWidth:f,inChannels:h,outDepth:B,outHeight:$,outWidth:P,outChannels:L,padInfo:z,strideDepth:w,strideHeight:b,strideWidth:E,filterDepth:v,filterHeight:g,filterWidth:m,effectiveFilterDepth:D,effectiveFilterHeight:A,effectiveFilterWidth:j,dilationDepth:_,dilationHeight:R,dilationWidth:N,inShape:e,outShape:p,filterShape:t}}function uE(e,t,n,r){r===void 0&&(r=1);var o=Ia(t,r);return Math.floor((e[0]*(n-1)-n+o)/2)}function Kc(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function Wp(e){return typeof e=="number"?[e,e,e]:e}function Ia(e,t){return t<=1?e:e+(e-1)*(t-1)}function Us(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function ns(e){var t=Kc(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function dn(e,t){return ns(e)||ns(t)}function Nm(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function lE(e,t,n){if(t==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Ke(e.shape),o=e.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!tM(e.dtype,t))return O.makeTensorFromDataId(e.dataId,e.shape,t);if(e.dtype==="complex64"){var a=n.real(e);return i=a.cast(t),a.dispose(),i}if(t==="int32")return n.int(e);if(t==="bool"){var s=Z(0,e.dtype);return i=n.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function $p(e,t){return O.makeTensorFromDataId(e.dataId,t,e.dtype)}function cE(e,t,n){var r=(t-e)/(n-1),o=Wu(n,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return ct(o,"float32")}function Up(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Gy(e,t){return{real:e[2*t],imag:e[2*t+1]}}function I4(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function T4(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function A4(e,t,n){var r=function(i,a,s){return function(u,l,c){for(var d=0,f=u.length,h=0,p=!1;d<f;){var v=c(l,u[h=d+(f-d>>>1)]);v>0?d=h+1:(f=h,p=!v)}return p?d:-d-1}(i,a,s||P4)}(e,t,n),o=r<0?-(r+1):r;e.splice(o,0,t)}function P4(e,t){return e>t?1:e<t?-1:0}function Im(e,t,n,r,o){return dE(e,t,n,r,o,0).selectedIndices}function Tm(e,t,n,r,o,i){var a=dE(e,t,n,r,o,i);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function dE(e,t,n,r,o,i,a,s){s===void 0&&(s=!1);for(var u=Array.from(t).map(function(w,b){return{score:w,boxIndex:b,suppressBeginIndex:0}}).filter(function(w){return w.score>o}).sort(qy),l=i>0?-.5/i:0,c=[],d=[];c.length<n&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,v=f.suppressBeginIndex;if(h<o)break;for(var g=!1,m=c.length-1;m>=v;--m){var y=D4(e,p,c[m]);if(y>=r){g=!0;break}if(f.score=f.score*M4(r,l,y),f.score<=o)break}f.suppressBeginIndex=c.length,g||(f.score===h?(c.push(p),d.push(f.score)):f.score>o&&A4(u,f,qy))}var x=c.length;return s&&(c.fill(0,x),d.fill(0,x)),{selectedIndices:ct(c,"int32"),selectedScores:ct(d,"float32"),numValidOutputs:Z(x,"int32")}}function D4(e,t,n){var r=e.subarray(4*t,4*t+4),o=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(d-l)*(f-c);if(h<=0||p<=0)return 0;var v=Math.max(i,l),g=Math.max(a,c),m=Math.min(s,d),y=Math.min(u,f),x=Math.max(m-v,0)*Math.max(y-g,0);return x/(h+p-x)}function M4(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function qy(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function fE(e,t,n){var r=new Array(e.rank).fill(0),o=e.shape.slice();return t.map(function(i){o[n]=i;var a=e.slice(r,o);return r[n]+=i,a})}function hE(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var o=ve(n,e.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=i[s]%e.shape[s];var u=e.locToIndex(a);o.values[r]=e.values[u]}return o.toTensor()}function pE(e,t,n,r,o){for(var i=t[t.length-1],a=[e.length/i,i],s=a[0],u=a[1],l=mu(n,s*r),c=mu("int32",s*r),d=0;d<s;d++){for(var f=d*u,h=e.subarray(f,f+u),p=[],v=0;v<h.length;v++)p.push({value:h[v],index:v});p.sort(function(w,b){return b.value-w.value});var g=d*r,m=l.subarray(g,g+r),y=c.subarray(g,g+r);for(v=0;v<r;v++)m[v]=p[v].value,y[v]=p[v].index}var x=t.slice();return x[x.length-1]=r,[It(l,x,n),It(c,x,"int32")]}function Am(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var o=ve(e,"int32"),i=ve([n.length,e.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]),s=r*e.length;i.values.set(a,s)}return i.toTensor()}var F4=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(o,i){return"T"+i});var n=[];this.variableNames.forEach(function(o){n.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},O4=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(o,i){return"T"+i});var n=[];this.variableNames.forEach(function(o){n.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},L4=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,a=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function vE(e,t){return["x","y","z","w","u","v"].slice(0,t).map(function(n){return e+"."+n})}function rn(e,t){return t===1?[e]:vE(e,t)}function zt(){var e,t,n,r,o,i,a,s,u,l;return G().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function wi(e,t,n){n===void 0&&(n="index");var r=Ir(t);return r.map(function(o,i){return"int "+e[i]+" = "+n+" / "+o+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+o:"index -= "+e[i]+" * "+o)+";"}).join("")}function Pm(e){var t=Ir(e).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var mE=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function B4(e,t,n,r){var o=[];e.forEach(function(h){var p=ae(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,s=o.join(`
`),u=e.map(function(h){return function(p,v,g){g===void 0&&(g=!1);var m="";m+=g?gE(p):na(p);var y=p.shapeInfo.logicalShape,x=v.logicalShape;return y.length<=x.length&&(m+=g?function(w,b){var E,k=w.name,_=k.charAt(0).toUpperCase()+k.slice(1),R="get"+_+"AtOutCoords",N=w.shapeInfo.logicalShape.length,D=b.logicalShape.length,A=Po(w.shapeInfo.logicalShape,b.logicalShape),j=Ue(D),F=D-N,z=["x","y","z","w","u","v"];E=N===0?"":D<2&&A.length>=1?"coords = 0;":A.map(function(q){return"coords."+z[q+F]+" = 0;"}).join(`
`);var B="";B=D<2&&N>0?"coords":w.shapeInfo.logicalShape.map(function(q,Q){return"coords."+z[Q+F]}).join(", ");var $="return outputValue;",P=ae(w.shapeInfo.logicalShape)===1,L=ae(b.logicalShape)===1;if(N!==1||P||L){if(P&&!L)$=D===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(A.length){var W=N-2,H=N-1;A.indexOf(W)>-1&&A.indexOf(H)>-1?$="return vec4(outputValue.x);":A.indexOf(W)>-1?$="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":A.indexOf(H)>-1&&($="return vec4(outputValue.xx, outputValue.zz);")}}else $=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+R+`() {
      `+j+` coords = getOutputCoords();
      `+E+`
      vec4 outputValue = get`+_+"("+B+`);
      `+$+`
    }
  `}(p,v):function(w,b){var E=w.name,k=E.charAt(0).toUpperCase()+E.slice(1),_="get"+k+"AtOutCoords",R=b.texShape,N=w.shapeInfo.texShape,D=w.shapeInfo.logicalShape.length,A=b.logicalShape.length;if(!w.shapeInfo.isUniform&&D===A&&w.shapeInfo.flatOffset==null&&St(N,R))return`
      float `+_+`() {
        return sampleTexture(`+E+`, resultUV);
      }
    `;var j,F=Ue(A),z=Po(w.shapeInfo.logicalShape,b.logicalShape),B=A-D,$=["x","y","z","w","u","v"];j=D===0?"":A<2&&z.length>=1?"coords = 0;":z.map(function(L){return"coords."+$[L+B]+" = 0;"}).join(`
`);var P="";return P=A<2&&D>0?"coords":w.shapeInfo.logicalShape.map(function(L,W){return"coords."+$[W+B]}).join(", "),`
    float `+_+`() {
      `+F+` coords = getOutputCoords();
      `+j+`
      return get`+k+"("+P+`);
    }
  `}(p,v)),m}(h,t,r)}).join(`
`),l=t.texShape,c=zt(),d=function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+j4+`
    `+z4+`
    `+W4+`
  `}(c);return t.isPacked?(i=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(w,b){var E=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];return E[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+E[1]+`.0);
      }
    `:E[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+E[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      return 2 * (resTexRC.x * `+E[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(w,b){var E=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)];if(St(w,b))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+E[0]+", "+E[1]+`));
      }
    `;var k=Math.ceil(w[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));

      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      int r = 2 * (index / `+k+`);
      int c = imod(index, `+k+`) * 2;

      return ivec2(r, c);
    }
  `}(h,p);case 3:return v=h,g=p,m=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],y=Math.ceil(v[2]/2),x=y*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+y+`);
      int c = imod(index, `+y+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(w,b){for(var E=[Math.ceil(b[0]/2),Math.ceil(b[1]/2)],k=Math.ceil(w[w.length-1]/2),_=k*Math.ceil(w[w.length-2]/2),R=_,N="",D="b, r, c",A=2;A<w.length-1;A++)R*=w[w.length-A-1],N=`
      int b`+A+" = index / "+R+`;
      index -= b`+A+" * "+R+`;
    `+N,D="b"+A+", "+D;return`
    ivec`+w.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      `+N+`

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+k+`);
      int c = imod(index, `+k+`) * 2;

      return ivec`+w.length+"("+D+`);
    }
  `}(h,p)}var v,g,m,y,x}(t.logicalShape,l),a=function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `}(c)):(i=function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(m,y){return y[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+y[1]+`.0);
      }
    `:y[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+y[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      return resTexRC.x * `+y[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(m,y){return St(m,y)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+y[0]+", "+y[1]+`));
      }
    `:m[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:m[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+y[0]+", "+y[1]+`));
        int index = resTexRC.x * `+y[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      int r = index / `+m[1]+`;
      int c = index - r * `+m[1]+`;
      return ivec2(r, c);
    }
  `}(h,p);case 3:return v=p,g=wi(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(m,y){var x=wi(["r","c","d","d2"],m);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `}(h,p);case 5:return function(m,y){var x=wi(["r","c","d","d2","d3"],m);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+y[0]+`,
                             `+y[1]+`));

      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(h,p);case 6:return function(m,y){var x=wi(["r","c","d","d2","d3","d4"],m);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var v,g}(t.logicalShape,l),a=function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=$4),[f,d,a,s,i,u,n].join(`
`)}function na(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=n.shapeInfo.texShape,a=i[0],s=i[1];if(a===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=n.shapeInfo.texShape,l=u[0],c=u[1],d=ui(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 1:return function(n){var r=n.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Ji(n)+`
      }
    `;var i=n.shapeInfo.texShape,a=i[0],s=i[1];if(s===1&&a===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=ui(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 2:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=n.shapeInfo.texShape;if(a!=null&&St(r,a)){var s=a[0],u=a[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var l=vi(r),c=l.newShape,d=l.keptDims,f=c;if(f.length<r.length){var h=ra(n,f);return`
      `+na(h)+`
      float `+i+`(int row, int col) {
        return `+i+"("+oa(["row","col"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Ji(n)+`
      }
    `;var p=a[0],v=a[1],g=ui(o);return v===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+v+`, index);
    return sampleTexture(`+o+`, uv);
  }
`}(e);case 3:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=vi(r),l=u.newShape,c=u.keptDims,d=l;if(d.length<r.length){var f=ra(n,d);return`
        `+na(f)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+oa(["row","col","depth"],c)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Ji(n)+`
      }
    `;var h=n.shapeInfo.texShape,p=h[0],v=h[1],g=n.shapeInfo.flatOffset;if(v===a&&g==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(v===s&&g==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var m=ui(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+m+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `}(e);case 4:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=vi(r),c=l.newShape,d=l.keptDims;if(c.length<r.length){var f=ra(n,c);return`
      `+na(f)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+oa(["row","col","depth","depth2"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Ji(n)+`
      }
    `;var h=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,v=p[0],g=p[1];if(g===u&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===a&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var m=ui(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+g+", index + "+m+`);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 5:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=vi(r),d=c.newShape,f=c.keptDims;if(d.length<r.length){var h=ra(n,d);return`
      `+na(h)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+oa(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Ji(n)+`
      }
    `;var p=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,g=v[0],m=v[1];if(m===l&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(m===a&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var y=ui(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+y+`;
      vec2 uv = uvFromFlat(`+g+", "+m+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);case 6:return function(n){var r=n.shapeInfo.logicalShape,o=n.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=vi(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=ra(n,s);return`
      `+na(l)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+oa(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],d=r[4]*c,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(n.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+f+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Ji(n)+`
      }
    `;var v=n.shapeInfo.flatOffset,g=n.shapeInfo.texShape,m=g[0],y=g[1];if(y===p&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+f+", "+d+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(y===c&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var x=ui(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+f+` +
          depth2 * `+d+" + depth3 * "+c+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+m+", "+y+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `}(e);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function gE(e){var t,n,r;switch(e.shapeInfo.logicalShape.length){case 0:return t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=zt(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(o){var i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=zt();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+i+`, uv);
    }
  `}(e);case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,l=u[0],c=u[1],d=zt();if(u!=null&&St(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+d.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+f[0]+", "+f[1]+`, row, col);
      return `+d.texture2D+"("+a+`, uv);
    }
  `}(e);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var c=i.slice(1),d=ra(o,c);return`
        `+gE(d)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+oa(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],h=l[1],p=Math.ceil(i[2]/2),v=p*Math.ceil(i[1]/2),g=zt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+h+", "+v+", "+p+`, b, row, col);
      return `+g.texture2D+"("+a+`, uv);
    }
  `}(e);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=o.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],f=c[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),v="int b, int row, int col",g="b * "+p+" + (row / 2) * "+h+" + (col / 2)",m=2;m<a-1;m++)v="int b"+m+", "+v,p*=i[a-m-1],g="b"+m+" * "+p+" + "+g;var y=zt();return`
    vec4 `+u+"("+v+`) {
      int index = `+g+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+d+`);
      return `+y.texture2D+"("+s+`, uv);
    }
  `}(e)}}var j4=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,z4=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,W4=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,$4=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function ui(e){return"offset"+e}function Ji(e){var t=e.name,n=ae(e.shapeInfo.logicalShape);return n<2?"return "+t+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function Ue(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function ra(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function oa(e,t){return t.map(function(n){return e[n]}).join(", ")}var U4=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Ue(l),d=rn("coords",l);if(i===1){var f=Ue(s=l+1);a=`
        `+f+" sourceLocR = "+f+"("+d.join()+`, 0);
        ++`+d[l-1]+`;
        `+f+" sourceLocG = "+f+"("+d.join()+`, 0);
        ++`+d[l-2]+`;
        `+f+" sourceLocA = "+f+"("+d.join()+`, 0);
        --`+d[l-1]+`;
        `+f+" sourceLocB = "+f+"("+d.join()+`, 0);
        --`+d[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+d[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+d[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+d[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+d[l-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],v=h.map(function(_){return"int "+_}),g=rn("sourceLocR",s-1).concat("inIdx.r"),m=rn("sourceLocG",s-1).concat("inIdx.g"),y=rn("sourceLocB",s-1).concat("inIdx.b"),x=rn("sourceLocA",s-1).concat("inIdx.a"),w=n==="max"?"greaterThan":"lessThan",b=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",E=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+m.join()+`) : 0.,
            hasNextRow ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",k=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+k+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+d[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+d[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+E+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+b+`
          vec4 candidate = `+E+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+w+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},V4=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.top,c=u-1-e.padInfo.left,d=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},H4=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=c-1-e.padInfo.front,p=d-1-e.padInfo.top,v=f-1-e.padInfo.left,g=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+p+", "+v+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},G4=function(e,t,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Se(e,t),Se(e,n);var a="0.0";r!=null&&(Se(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";o!=null&&(Se(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},q4=function(e,t,n,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Se(e,t),Se(e,n);var a="vec4(0.0)";r!=null&&(Se(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(Se(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},K4="return areal * breal - aimag * bimag;",X4="return areal * bimag + aimag * breal;",Ky=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Se(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},rh="return a + b;",oh="return a - b;",Xy="return a * b;",yE="return (a < 0.) ? b * a : a;",rt=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Se(t,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},xE=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,$r=function(e,t,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Se(t,n);var o=this.outputShape.length,i="";if(r)if(o===0||ae(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Ue(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=rn("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+a[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+a[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},Y4=function(){function e(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),Q4=function(){function e(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(t,n){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,n)}},e}(),J4=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Z4=function(e){this.outputShape=[],this.outputShape=ts(e,1),this.variableNames=e.map(function(s,u){return"T"+u});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++){var o=t[n-1];r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var i=t.length,a=t[t.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},eF=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ts(e,t);var n=this.outputShape,r=n.length,o=Ue(r),i=rn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(g,m){return"T"+m});var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var l=a[t],c=a.slice(-2),d=a.join(),f="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var h=s[u-1];f+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Tl(a,l,h)+`),
            vec2(`+Tl(c,l,h)+`));
        }`}var p=s.length,v=s[s.length-1];f+=`
        return getChannel(
          getT`+p+"("+Tl(a,l,v)+`),
          vec2(`+Tl(c,l,v)+"));",this.userCode=`
      float getValue(`+a.map(function(g){return"int "+g})+`) {
        `+f+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+n[r-2]+` &&
            `+i[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function Tl(e,t,n){var r=e.indexOf(t);return e.map(function(o,i){return i===r?o+" - "+n:o}).join()}var tF=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},nF=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=i?1:2,l=i?2:3,c=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},rF=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+i+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},oF=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.front,u=n-1-e.padInfo.top,l=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},iF=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},aF=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Yy=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,f=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p=e.dataFormat==="channelsLast",v=p?1:2,g=p?2:3,m=p?3:1,y="",x="";n&&(y=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,x="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+m+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+w+`
        `+x+`
        setOutput(result);
      }
    `},sF=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.filterDepth,d=e.filterHeight,f=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Qy=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,v="",g="";n&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,g="result = activation(result);");var m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+m+`
        `+g+`
        setOutput(result);
      }
    `},Jy=function(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,f=e.filterHeight,h=e.filterWidth,p=h,v="int xR; int xC; int xCOffset;",g=0;g<f;g++)for(var m=0;m<h;m++)v+=`
          vec4 xTexelR`+g+"C"+2*m+` = vec4(0.);
          vec4 wR`+g+"C"+m+` = vec4(0.);
          vec4 xR`+g+"C"+m+" = vec4(0.);";for(g=0;g<f;g++)for(var y=0;y<p;y++){if(v+=`
          xR = xRCorner + `+g*c+`;
          xC = xCCorner + `+(m=2*y)*d+`;
        `,l===1){if(m<h&&(v+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+g+"C"+m+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+m+" = vec4(previous.zw, xTexelR"+g+"C"+m+`.xy);
                } else {
                  xR`+g+"C"+m+" = vec4(0, 0, xTexelR"+g+"C"+m+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xR`+g+"C"+m+" = xTexelR"+g+"C"+m+`;
              `,m+1<h)){var x=s%2==0?LC(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(v+=`
                  xCOffset = xC + `+s%2+" + "+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+m+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+g+"C"+(m+1)+` = vec4(
                    xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(m+1)+" = xTexelR"+g+"C"+(m+2)+`;
                `}}else m<h&&(v+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(v+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(m+2)+` = vec4(0.);
                }

                xR`+g+"C"+m+` = vec4(
                  xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.zw);
              `,m+1<h&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(m+1)+" = vec4(xTexelR"+g+"C"+(m+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(m+2)+` = vec4(0.);
                }

                xR`+g+"C"+m+` = vec4(
                  xTexelR`+g+"C"+m+".xy, xTexelR"+g+"C"+(m+2)+`.xy);
              `,m+1<h&&(v+=`
                  xR`+g+"C"+(m+1)+` = vec4(
                    xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.zw);
                `)),v+="}");m<h&&(v+=`
            vec4 wTexelR`+g+"C"+m+" = getW("+g+", "+m+`, d1, q);
            wR`+g+"C"+m+" = vec4(wTexelR"+g+"C"+m+".xz, wTexelR"+g+"C"+m+`.xz);
          `,m+1<h&&(v+=`
              vec4 wTexelR`+g+"C"+(m+1)+" = getW("+g+", "+(m+1)+`, d1, q);
              wR`+g+"C"+(m+1)+` =
                vec4(wTexelR`+g+"C"+(m+1)+".xz, wTexelR"+g+"C"+(m+1)+".xz);"))}for(g=0;g<f;g++)for(m=0;m<h;m++)v+="dotProd += xR"+g+"C"+m+" * wR"+g+"C"+m+";";var w="",b="";n&&(w=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,b="result = activation(result);");var E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+E+`
        `+b+`
        setOutput(result);
      }
    `},uF=function(e,t,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],a=e[1],s=e[2],u=e[3],l=t[0],c=n[0],d=n[1];this.outputShape=[l,c,d,u];var f=r==="bilinear"?1:0,h=[a-1+".0",s-1+".0"],p=h[0],v=h[1],g=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],m=g[0],y=g[1],x=g[2],w=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],b=w[0],E=w[1],k=w[2];this.userCode=`
      const float height_ratio = float(`+m+`);
      const float width_ratio = float(`+b+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+y+`;
        float width_scale = `+E+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+k+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},lF=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ue(r)+` coords = getOutputCoords();
        int end = `+Zy(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Zy(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function Zy(e,t){if(e===1)return""+t;if(e===2)return t+".y";if(e===3)return t+".z";if(e===4)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var cF=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=yu.DENSE;var t=$s(e),n=zt();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+wi(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},dF=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=yu.DENSE;var t=$s(e),n=zt();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+wi(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},fF=function(){function e(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),hF=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},pF=function(e){this.variableNames=["A"],this.outTexUsage=Cn.DOWNLOAD;var t=zt();this.outputShape=e,this.userCode=`
      `+mE+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},vF=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Cn.DOWNLOAD;var t=zt();this.outputShape=e,this.userCode=`
      `+mE+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},mF=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=zt(),o=t[0],i=t[1];this.outputShape=e;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Pm(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},gF=function(e,t,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=zt(),o=t[0],i=t[1];this.outputShape=e;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+e[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+e[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Pm(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},yF="return real * expR - imag * expI;",xF="return real * expI + imag * expR;",e1=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},wF=function(){function e(t,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(n.valueLoc,t)}},e}(),bF=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var o=Ue(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=0;d<a.length;d++)d===s?c.push("int(getIndices("+l[d]+"))"):c.push(""+l[d]);return c.join()}(e,n);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},CF=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=Ue(t.length),o=Ue(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function EF(e,t){var n=zt();return yM(e,t,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function SF(e,t){return EM(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function kF(e,t){return SM(e,t,new Uint16Array([0,1,2,2,1,3]))}function Uu(e,t,n,r,o,i,a){_M(n,r);var s=kM(e,t),u=e.TEXTURE_2D;return se(e,t,function(){return e.bindTexture(u,s)}),se(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),se(e,t,function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),se(e,t,function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)}),se(e,t,function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)}),se(e,t,function(){return e.texImage2D(u,0,o,n,r,0,i,a,null)}),se(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function _F(e,t,n,r,o){var i=Od(n,r);return Uu(e,t,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function RF(e,t,n,r,o){var i=Od(n,r);return Uu(e,t,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function NF(e,t,n,r,o){var i=Od(n,r);return Uu(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function IF(e,t,n,r,o){var i=$u(n,r);return Uu(e,t,i[0],i[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function TF(e,t,n,r,o){var i=$u(n,r);return Uu(e,t,i[0],i[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function AF(e,t,n,r){return se(e,t,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),Wy(e,t,n,"clipSpacePos",r,3,20,0)&&Wy(e,t,n,"uv",r,2,20,12)}function PF(e,t,n,r,o,i,a){var s,u,l;se(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,l=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,l=a.internalFormatPackedFloat),s.set(i),se(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,l,r,o,0,e.RGBA,u,s)}),se(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function DF(e,t,n,r){se(e,t,function(){return e.bindTexture(e.TEXTURE_2D,n)}),r.data instanceof Uint8Array?se(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):se(e,t,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),se(e,t,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function MF(e,t,n,r,o){var i=e.createBuffer();se(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)});var a=16*n*r;return se(e,t,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)}),se(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),se(e,t,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),i}function FF(e,t,n){var r=e,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function OF(e,t,n,r,o){var i=Od(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return se(e,t,function(){return e.readPixels(0,0,a,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function LF(e,t,n,r,o,i,a,s){var u=e,l=new Float32Array(function(c,d){var f=$u(c,d);return f[0]*f[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function BF(e,t,n,r){var o=new Float32Array(n*r*4);return se(e,t,function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,o)}),o}var jF=function(){function e(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=G().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,hM(n,t)):this.gl=Or(n);var r="WEBGL_color_buffer_float";if(G().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=_l(this.gl,this.debug,"OES_texture_float"),zn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=_l(this.gl,this.debug,"OES_texture_half_float");else if(G().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),zn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=_l(this.gl,this.debug,"EXT_color_buffer_half_float");else if(G().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",zn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!zn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=SF(this.gl,this.debug),this.indexBuffer=kF(this.gl,this.debug),this.framebuffer=RM(this.gl,this.debug),this.textureConfig=Cm(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return G().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;se(n,this.debug,function(){return n.finish()}),se(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),se(n,this.debug,function(){return n.deleteFramebuffer(t.framebuffer)}),se(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),se(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),se(n,this.debug,function(){return n.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(t,n){return this.throwIfDisposed(),_F(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(t,n){return this.throwIfDisposed(),RF(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(t,n){return this.throwIfDisposed(),NF(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(t,n){this.throwIfDisposed(),DF(this.gl,this.debug,t,n)},e.prototype.uploadDenseMatrixToTexture=function(t,n,r,o){this.throwIfDisposed(),PF(this.gl,this.debug,t,n,r,o,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(t,n){return this.throwIfDisposed(),TF(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(t,n){return this.throwIfDisposed(),IF(this.gl,this.debug,t,n,this.textureConfig)},e.prototype.deleteMatrixTexture=function(t){var n=this;this.throwIfDisposed(),this.outputTexture===t&&($y(this.gl,this.debug,this.framebuffer),this.outputTexture=null),se(this.gl,this.debug,function(){return n.gl.deleteTexture(t)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return OF(o.gl,o.debug,n,r,o.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(t,n,r,o,i,a){return LF(this.gl,t,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(t,n){return FF(this.gl,t,n)},e.prototype.createBufferFromTexture=function(t,n,r){this.bindTextureToFrameBuffer(t);var o=MF(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},e.prototype.createFence=function(t){var n,r,o=this;if(G().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=a}else G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(n,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(t,n,r){var o=this;return this.downloadMatrixDriver(t,function(){return BF(o.gl,o.debug,n,r)})},e.prototype.createProgram=function(t){this.throwIfDisposed();var n=this.gl,r=xM(n,this.debug,t),o=EF(n,this.debug),i=bM(n,this.debug);return se(n,this.debug,function(){return n.attachShader(i,o)}),se(n,this.debug,function(){return n.attachShader(i,r)}),CM(n,this.debug,i),this.debug&&Zf(n,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=AF(n,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(t){var n=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&se(this.gl,this.debug,function(){return n.gl.deleteProgram(t)})},e.prototype.setProgram=function(t){var n=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Zf(this.gl,this.debug,this.program),se(this.gl,this.debug,function(){return n.gl.useProgram(t)})},e.prototype.getUniformLocation=function(t,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?IM(this.gl,this.debug,t,n):TM(this.gl,t,n)},e.prototype.getAttributeLocation=function(t,n){var r=this;return this.throwIfDisposed(),se(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,n)})},e.prototype.getUniformLocationNoThrow=function(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)},e.prototype.setInputMatrixTexture=function(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),AM(this.gl,this.debug,this.program,t,n,r)},e.prototype.setOutputMatrixTexture=function(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)},e.prototype.setOutputPackedMatrixTexture=function(t,n,r){this.throwIfDisposed();var o=$u(n,r),i=o[0],a=o[1];this.setOutputMatrixTextureDriver(t,i,a)},e.prototype.setOutputMatrixWriteRegion=function(t,n,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,n)},e.prototype.setOutputPackedMatrixWriteRegion=function(t,n,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Zf(this.gl,this.debug,this.program),Rl(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),se(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),se(this.gl,this.debug,function(){return t.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=_l(this.gl,this.debug,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(n.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(t){return oe(this,void 0,void 0,function(){var n=this;return ie(this,function(r){switch(r.label){case 0:return[4,Fy(function(){return n.disposed||n.isQueryAvailable(t,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(t,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(t,n){if(n===0)return!0;if(n===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var t=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=t;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},e.prototype.addItemToPoll=function(t,n){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1||Fy(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),eh(this.gl,this.debug,t,this.framebuffer),this.debug&&Rl(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(eh(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Rl(this.gl)):$y(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(t,n){this.bindTextureToFrameBuffer(t);var r=n();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(t,n,r){this.throwIfDisposed();var o=this.gl;eh(o,this.debug,t,this.framebuffer),this.debug&&Rl(o),this.outputTexture=t,se(o,this.debug,function(){return o.viewport(0,0,n,r)}),se(o,this.debug,function(){return o.scissor(0,0,n,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(t,n,r,o){var i=this;this.throwIfDisposed(),se(this.gl,this.debug,function(){return i.gl.scissor(t,n,r,o)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function t1(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach(function(n,r){var o=n.logicalShape,i=t[r],a=i.shape;if(!St(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!n.isUniform||!i.isUniform){var s=n.texShape,u=i.isUniform?null:i.texData.texShape;if(!St(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var zF=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.filterWidth,o=n.inChannels,i=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,d=n.dataFormat,f=s.left,h=s.top,p=o*r,v=zt(),g=d==="channelsLast",m=g?0:1,y=g?1:2,x="",w=0;w<=1;w++)for(var b=0;b<=1;b++)x+=`
          blockIndex = rc.y + `+b+`;
          pos = rc.x + `+w+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+h+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+t[m]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+t[y]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*w+b)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*w+b)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+v.output+` = result;
      }
    `},WF=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},$F=function(e,t,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},UF=function(e,t,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},VF=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,s=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},HF=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=s-1-e.padInfo.front,d=u-1-e.padInfo.top,f=l-1-e.padInfo.left,h=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+d+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},ih=function(e,t,n,r,o,i,a){n===void 0&&(n=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=n?e[1]:e[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+f[0]+`);
          result += (`+d[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+p+`

        setOutput(result);
      }
    `},GF=function(){function e(t,n,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;return function(r,o){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(n.seedLoc,t)}},e}(),qF=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},KF=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=rn("rc",t),r=Ue(t),o=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",d=s-2;d<s;d++)c+=l[d]+" >= "+u[d],d<s-1&&(c+="||");return c}(t,e,n),i=function(s,u,l,c){if(s===1)return"";var d=c.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(t,e[e.length-1],e[e.length-2],n),a=function(s,u){var l=s.length,c=function(d,f){for(var h=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var g=(p===0?"r":"rp1")+", "+(v===0?"c":"cp1"),m=2;m<d;m++)g=f[f.length-1-m]+","+g;h.push(g)}return h}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(e,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},XF=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+e[l]+u[1]});var r=e.length,o=Ue(r),i=t.map(function(u){return u[0]}).join(","),a=t.map(function(u,l){return u[0]+e[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},YF=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(g,m){return g[0]+e[m]+g[1]});for(var r=e.length,o=Ue(r),i=t.map(function(g){return g[0]}).join(","),a=t.map(function(g,m){return g[0]+e[m]}).join(","),s=rn("rc",r),u=rn("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,v=r===1?2:4;p<v;p++)h+=`
        `+d[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+n+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;h+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},ah=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var f=t==="avg",h="0.0";if(f||(h="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+c+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(p="avgValue / count");var v=4*Math.floor(r/4),g=r%4,m=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+c+", "+d+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+m+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+m+`
          }
        }
        setOutput(`+p+`);
      }
    `}},sh=function(e,t,n){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;var g=t==="avg",m="0.0";if(g||(m="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+a+`);
        const ivec3 pads = ivec3(`+h+", "+p+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(y="avgValue / count");var x=4*Math.floor(r/4),w=r%4,b=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+h+", "+p+", "+v+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+b+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(w===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(w===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+b+`
            } else if (`+(w===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+b+`
            }
          }
          setOutput(`+y+`);
        }
      }
    `}},QF=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",s="min"):t==="max"&&(a="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,d=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";t==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var h="";o%n>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},JF=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+wi(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+Pm(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+n+`

        setOutput(result);
      }
    `},ZF=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],f=l[1]/c[1],h=1/d,p=1/f,v=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},eO=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},tO=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},nO=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&s>1?o-1:o,n&&u>1?i-1:i],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],f=l[1]/c[1],h=1/d,p=1/f,v=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},rO=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,t,n,s];var u=[r&&t>1?i-1:i,r&&n>1?a-1:a],l=[r&&t>1?t-1:t,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},oO=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n!==1){var r=e.map(function(i,a){return function(s){return t.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),o=Ue(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},iO=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=rn("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=Ue(n);function s(u){var l=e.map(function(c,d){return function(f,h){return t.indexOf(f)!==-1&&e[f]!==1?e[f]+" - "+h[f]+" - 1":""+h[f]}(d,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+o+`){
            result.g = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+function(u){return u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+o+`) {
              result.a = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},n1=function(e,t,n,r,o,i,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Ue(o.length),u=Ue(i.length),l="";n===1?l="i":n===2&&(l="i, j");var c="getIndices("+l+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var f="getUpdates("+d+")",h=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},aO=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";o%n>0&&(c=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var d="";o%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},sO=function(e,t,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+i[u]),u<e&&a.push(""+i[u]);r=a.join(),o=s.join()}var l=Ue(n);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},uO=function(){function e(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=Ue(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(a===1)return"sourceLoc";if(a<=6)return uh.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(a,s){return"sourceLoc."+uh[s]+" = start["+s+"] + coords."+uh[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+n+`
        setOutput(getSource(`+i+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),uh=["x","y","z","w","u","v"],lO=function(){function e(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=Ue(this.rank),r=rn("coords",this.rank),o=rn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+a+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+n+"("+t.map(function(c,d){return"start["+d+"]"}).join()+");":t.map(function(c,d){return o[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(t){var n=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(o,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,t)}},e}(),cO=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=Ue(n.length),i=Ue(n.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=n.map(function(u,l){return s++,n.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+e+`);
      `+o+" strides = "+o+"("+t+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},dO=function(){function e(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(t,n,r){var o,i=r1(n,r),a=o1(t,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===wn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===wn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===wn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===wn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===wn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(o),o},e.prototype.releaseTexture=function(t,n,r,o){if(this.freeTextures!=null){var i=o1(n,r1(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function r1(e,t){if(e===Cn.UPLOAD)return wn.PACKED_2X2_FLOAT32;if(e===Cn.RENDER||e==null)return function(n){return G().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?wn.PACKED_2X2_FLOAT32:wn.UNPACKED_FLOAT32:n?wn.PACKED_2X2_FLOAT16:wn.UNPACKED_FLOAT16}(t);if(e===Cn.DOWNLOAD||e===Cn.PIXELS)return wn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function o1(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var fO=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var o=Ue(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()}(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},hO=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var o=Ue(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()}(t);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},pO=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Ue(this.rank),i=vE("rc",this.rank),a=new Array(this.rank);for(r=0;r<t.length;r++)a[t[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},Dm=1.7580993408473768,Mm=1.0507009873554805,xe=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},ur="if (isnan(x)) return x;",vO="return x;",i1="return abs(x);",wE=ur+`
  return (x < 0.0) ? 0.0 : x;
`,bE=ur+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,CE="return (x >= 0.0) ? x : (exp(x) - 1.0);",mO=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Dm+`;
  float scale = `+Mm+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,a1="return -x;",s1="return ceil(x);",u1="return floor(x);",l1="return exp(x);",c1="return exp(x) - 1.0;",gO=ur+`
  return sin(x);
`,yO=ur+`
  return cos(x);
`,xO=ur+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,wO=ur+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,bO=ur+`
  return atan(x);
`,CO=ur+"return log(x + sqrt(x * x + 1.0));",EO=ur+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,SO=ur+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Al="return x;",kO="return x;",EE=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,SE=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,kE=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ns=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},_O=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=rn("rc",t),r=Ue(t),o=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(t,n),i=n.slice(-2),a=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},Pl={};function Dl(e,t){if(t===void 0&&(t=!1),e==="linear")return t?kO:vO;if(e==="relu")return t?EE:wE;if(e==="elu")return t?kE:CE;if(e==="relu6")return t?SE:bE;if(e==="prelu")return t?xE:yE;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var RO=600,NO=function(e){function t(n){var r,o=e.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!G().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var i=Or(G().getNumber("WEBGL_VERSION"));o.binaryCache=((r=G().getNumber("WEBGL_VERSION"))in Pl||(Pl[r]={}),Pl[r]),o.gpgpu=new jF(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=n,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=n.gl.canvas;return o.textureManager=new dO(o.gpgpu),o.numMBBeforeWarning=G().global.screen==null?1024:G().global.screen.height*G().global.screen.width*window.devicePixelRatio*RO/1024/1024,o.texData=new aE(o,O),o}return sr(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(n,r,o){if(G().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:n,usage:Cn.UPLOAD}),i},t.prototype.move=function(n,r,o,i){if(G().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:o,dtype:i,values:r,usage:Cn.UPLOAD})},t.prototype.readSync=function(n){var r=this.texData.get(n),o=r.values,i=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new Ns(u,Al):new xe(u,Al);var d=this.runWebGLProgram(c,[{dataId:n,shape:u,dtype:i}],i),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(o!=null)return this.convertAndCacheOnCPU(n);if(i==="string")return o;var h,p,v=this.activeTimers!=null;return v&&(h=wr()),i==="complex64"?p=Up(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(n),v&&(this.downloadWaitMs+=wr()-h),this.convertAndCacheOnCPU(n,p)},t.prototype.read=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,d,f,h,p,v,g,m,y,x,w,b,E,k,_;return ie(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(N){return r.push(N)})];if(o=this.texData.get(n),i=o.values,a=o.shape,s=o.slice,u=o.dtype,l=o.complexTensors,c=o.isPacked,s!=null)return d=void 0,d=c?new Ns(a,Al):new xe(a,Al),f=this.runWebGLProgram(d,[{dataId:n,shape:a,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(i!=null)return[2,this.convertAndCacheOnCPU(n)];if(!G().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&G().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&G().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(n),g=this.texData.get(v.dataId),p=(_=this.gpgpu).createBufferFromTexture.apply(_,[g.texture].concat($s(a)))),this.pendingRead.set(n,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return y=R.sent(),x=y[0],w=y[1],m=Up(x,w),[3,5];case 4:p==null?m=this.getValuesFromTexture(n):(b=ae(a),m=this.gpgpu.downloadFloat32MatrixFromBuffer(p,b)),R.label=5;case 5:return v!=null&&this.disposeData(v.dataId),E=this.convertAndCacheOnCPU(n,m),k=this.pendingRead.get(n),this.pendingRead.delete(n),k.forEach(function(N){return N(E)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,E]}})})},t.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var o=n[r];if(!mM(o))throw G().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(n){var r,o=this.texData.get(n),i=o.shape,a=o.dtype,s=o.isPacked,u=ae(i);if(G().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(n),c=this.texData.get(l.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat($s(i))).subarray(0,u);return this.disposeData(l.dataId),d}var f=G().getBool("WEBGL_PACK")&&s===!0,h=f?th(i):i,p=f?new vF(h):new pF(h),v=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:n}],"float32"),g=this.texData.get(v.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),m},t.prototype.time=function(n){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,l;return ie(this,function(c){switch(c.label){case 0:return r=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,n(),a=Za(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),s=Za(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=Y3(l),u.getExtraProfileInfo=function(){return l.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:wr(),endMs:null}},t.prototype.endTimer=function(n){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=wr(),n)},t.prototype.getQueryTime=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},t.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},t.prototype.releaseGPUData=function(n){var r=this.texData.get(n),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||n,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),o!=null&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var f=this.texData.get(n);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},t.prototype.getDataInfo=function(n){return this.texData.get(n)},t.prototype.getCPUBackend=function(){return G().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=O.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(n,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(i){return o.texData.get(i.dataId).texture==null&&i.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(n,r){var o=this.makeOutput(n.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:O.keep(n.clone()),imag:O.keep(r.clone())},o},t.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,o);if(ae(o)===0)return It([],o,n.dtype);var i=this.texData.get(n.dataId).isPacked,a=oE(n.shape,r,o);if(i||!a){var s=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lO(o):new uO(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[n],null,u)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,o)},t.prototype.shallowSlice=function(n,r,o){var i=this.texData.get(n.dataId),a=this.makeOutput(o,n.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=n.dtype;var u=iE(r,n.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||n.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},t.prototype.stridedSlice=function(n,r,o,i){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,o,i);var a=Rm(r,o,i);if(a.some(function(u){return u===0}))return It([],a);var s=new cO(r,i,a);return this.compileAndRun(s,[n])},t.prototype.reverse=function(n,r){var o=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iO(n.shape,r):new oO(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var o=n.map(function(h){return Bn(h)}),i=n.map(function(h){return Sr(h)});return Rt(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>G().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),s=this.concat(n.slice(0,a),r),u=this.concat(n.slice(a),r);return this.concat([s,u],r)}if(G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var l=new eF(n.map(function(h){return h.shape}),r);return this.compileAndRun(l,n)}var c=ts(n.map(function(h){return h.shape}),r),d=n.map(function(h){return h.as2D(-1,ae(h.shape.slice(r)))}),f=new Z4(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(c)},t.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,a1,n.dtype);var r=new xe(n.shape,a1);return this.compileAndRun(r,[n])},t.prototype.batchMatMul=function(n,r,o,i){var a=o?n.shape[2]:n.shape[1],s=i?r.shape[1]:r.shape[2],u=o?n.shape[1]:n.shape[2],l=n.shape[0];if((a===1||s===1)&&u>1e3){o&&(n=n.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var c=s===1?n:n.as3D(l,u,1),d=s===1?2:1,f=s===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(d,!0)}var h=Nt(n.dtype,r.dtype),p=new ih(n.shape,[l,a,s],o,i);return this.compileAndRun(p,[n,r],h)},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,i=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=i?r.shape[2]:r.shape[1],d=a?o.shape[1]:o.shape[2],f=r.shape[0],h=Nt(r.dtype,o.dtype),p=s!=null,v=l!=null,g=u?Dl(u,!0):null,m=new ih(r.shape,[f,c,d],i,a,p,g,v),y=[r,o];return s&&y.push(s),l&&y.push(l),this.compileAndRun(m,y,h)},t.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var o=this.texData.get(n.dataId),i=this.texData.get(r.dataId),a=new Ky(K4,n.shape,r.shape),s=new Ky(X4,n.shape,r.shape),u=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),d=this.complex(l,c);return l.dispose(),c.dispose(),d}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,Xy,n.dtype);var f=new rt(Xy,n.shape,r.shape);return this.compileAndRun(f,[n,r],n.dtype)},t.prototype.batchNormalization=function(n,r,o,i,a,s){var u=[n,r,o],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),G().getBool("WEBGL_PACK_NORMALIZATION")){var d=new q4(n.shape,r.shape,o.shape,l,c,i);return this.compileAndRun(d,u)}var f=new G4(n.shape,r.shape,o.shape,l,c,i);return this.compileAndRun(f,u)},t.prototype.localResponseNormalization4D=function(n,r,o,i,a){var s=G().getBool("WEBGL_PACK_NORMALIZATION")?new UF(n.shape,r,o,i,a):new WF(n.shape,r,o,i,a);return this.compileAndRun(s,[n])},t.prototype.LRNGrad=function(n,r,o,i,a,s,u){var l=new $F(r.shape,i,a,s,u);return this.compileAndRun(l,[r,o,n])},t.prototype.tile=function(n,r){if(n.dtype==="string"){var o=this.readSync(n.dataId).map(function(a){return Oc(a)});return hE(ve(n.shape,n.dtype,o),r)}var i=new fO(n.shape,r);return this.compileAndRun(i,[n])},t.prototype.pad=function(n,r,o){var i=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new YF(n.shape,r,o):new XF(n.shape,r,o);return this.compileAndRun(i,[n])},t.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var o=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pO(n.shape,r):new hO(n.shape,r);return this.compileAndRun(o,[n])},t.prototype.gather=function(n,r,o){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,o);var i=new bF(n.shape,r.size,o);return this.compileAndRun(i,[n,r])},t.prototype.batchToSpaceND=function(n,r,o){T(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,f){return d*f}),a=$c(n.shape,r,i),s=Uc(a.length,r.length),u=Vc(n.shape,r,i),l=eE(o,r.length),c=tE(u,o,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){T(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=$c(u.shape,r,i,!1),c=Uc(l.length,r.length,!1),d=Vc(u.shape,r,i,!1);return u.reshape(l).transpose(c).reshape(d)},t.prototype.reduce=function(n,r,o){var i=n.shape[0],a=n.shape[1],s=nh(a),u=new QF({windowSize:s,inSize:a,batchSize:i},r),l=this.compileAndRun(u,[n],o);return l.shape[1]===1?l:this.reduce(l,r,o)},t.prototype.argReduce=function(n,r,o){o===void 0&&(o=null);var i=n.shape[0],a=n.shape[1];o!=null&&(i=o.shape[0],a=o.shape[1]);var s=nh(a),u=new L4({windowSize:s,inSize:a,batchSize:i},r,o==null),l=[n];o!=null&&l.push(o);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(n,r,c)},t.prototype.argReducePacked=function(n,r,o){o===void 0&&(o=null);var i=o!=null?o.shape:n.shape,a=nh(i[i.length-1]),s=new U4(i,a,r,o==null),u=o==null?[n]:[n,o],l=this.compileAndRun(s,u,"int32");return l.rank===n.rank?this.argReducePacked(n,r,l):l},t.prototype.sum=function(n,r){yn("sum",r,n.rank);var o=Ot(n.shape,r),i=o[0],a=ae(o[1]),s=n.as2D(-1,a),u=Kf(n.dtype);return this.reduce(s,"sum",u).reshape(i)},t.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var o=Ot(n.shape,r),i=o[0],a=ae(o[1]),s=n.as2D(-1,a),u=Kf(n.dtype);return this.reduce(s,"prod",u).reshape(i)},t.prototype.unsortedSegmentSum=function(n,r,o){var i=0,a=Lr([i],n.rank),s=n;a!=null&&(s=n.transpose(a),i=Br(1,n.rank)[0]);var u=function(h,p,v){for(var g=[],m=h.length,y=0;y<m;y++)y!==p?g.push(h[y]):g.push(v);return g}(s.shape,i,o),l=ae([s.shape[i]]),c=s.as2D(-1,l),d=Kf(n.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,d,o).reshape(u);return a!=null&&(f=f.transpose(Em(a))),f},t.prototype.segOpCompute=function(n,r,o,i,a){var s=n.shape[0],u=n.shape[1],l=function(f,h){var p,v=!1;for(f<=rE?(p=f,v=!0):p=Mp(f,Math.floor(Math.sqrt(f)));!v;)p>h||p===f?v=!0:p=Mp(f,p+1);return p}(u,a),c=new aO({windowSize:l,inSize:u,batchSize:s,numSegments:a}),d=this.compileAndRun(c,[n,o],i);return d.shape[1]===a?d:(o=Wc(0,a).tile([u/l]),this.segOpCompute(d,r,o,i,a))},t.prototype.argMinMaxReduce=function(n,r,o){var i=[r];if(yn("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,n.rank),!G().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var a=Ot(n.shape,i),s=a[0],u=ae(a[1]),l=n.as2D(-1,u);return this.argReduce(l,o).reshape(s)}return this.argReducePacked(n,o)},t.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},t.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},t.prototype.cumsum=function(n,r,o,i){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var a=new lF(n.shape,o,i);return this.compileAndRun(a,[n])},t.prototype.equal=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var o=new rt("return float(a == b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.notEqual=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new rt("return float(a != b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new rt("return float(a < b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.lessEqual=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new rt("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new rt("return float(a > b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.greaterEqual=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new rt("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalNot=function(n){var r=new xe(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},t.prototype.logicalAnd=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new rt("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.logicalOr=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new rt("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r],"bool")},t.prototype.select=function(n,r,o){var i=new sO(n.rank,r.shape,r.rank);return this.compileAndRun(i,[n,r,o],Nt(r.dtype,o.dtype))},t.prototype.where=function(n){jc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return Am(n.shape,r)},t.prototype.topk=function(n,r,o){return pE(n.dataSync(),n.shape,n.dtype,r)},t.prototype.min=function(n,r){yn("min",r,n.rank);var o=Ot(n.shape,r),i=o[0],a=ae(o[1]),s=n.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},t.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var o=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new rt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.mod=function(n,r){var o=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new rt(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);yn("max",r,n.rank);var o=Ot(n.shape,r),i=o[0],a=ae(o[1]),s=n.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},t.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var o=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new rt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.all=function(n,r){yn("all",r,n.rank);var o=Ot(n.shape,r),i=o[0],a=ae(o[1]),s=n.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},t.prototype.any=function(n,r){yn("any",r,n.rank);var o=Ot(n.shape,r),i=o[0],a=ae(o[1]),s=n.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},t.prototype.realDivide=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new rt(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"float32")},t.prototype.floorDiv=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new rt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(o,[n,r],"int32")},t.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,rh);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var o=Nt(n.dtype,r.dtype);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,rh,o);var i=new rt(rh,n.shape,r.shape);return this.compileAndRun(i,[n,r],o)},t.prototype.packedUnaryOp=function(n,r,o){var i=new Ns(n.shape,r);return this.compileAndRun(i,[n],o)},t.prototype.packedBinaryOp=function(n,r,o,i,a){a===void 0&&(a=!1);var s=new $r(o,n.shape,r.shape,a);return this.compileAndRun(s,[n,r],i)},t.prototype.complexSeparableBinaryOp=function(n,r,o){var i=this,a=this.texData.get(n.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],v=i.makeComplexComponentTensorInfo(n,h),g=i.makeComplexComponentTensorInfo(r,p),m=new rt(o,n.shape,r.shape);return i.compileAndRun(m,[v,g],Nt(h.dtype,p.dtype))}),l=u[0],c=u[1],d=this.complex(l,c);return l.dispose(),c.dispose(),d},t.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},t.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>G().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),o=this.addN(n.slice(0,r)),i=this.addN(n.slice(r));return this.addN([o,i])}var a=n.map(function(l){return l.dtype}).reduce(function(l,c){return Nt(l,c)}),s=n.map(function(l){return l.shape}),u=G().getBool("WEBGL_PACK")?new O4(n[0].shape,s):new F4(n[0].shape,s);return this.compileAndRun(u,n,a)},t.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,oh);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var o=Nt(n.dtype,r.dtype);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,oh,n.dtype);var i=new rt(oh,n.shape,r.shape);return this.compileAndRun(i,[n,r],o)},t.prototype.pow=function(n,r){var o=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new rt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),i=Nt(n.dtype,r.dtype);return this.compileAndRun(o,[n,r],i)},t.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,s1,n.dtype);var r=new xe(n.shape,s1);return this.compileAndRun(r,[n])},t.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,u1,n.dtype);var r=new xe(n.shape,u1);return this.compileAndRun(r,[n])},t.prototype.sign=function(n){var r=new xe(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},t.prototype.isNaN=function(n){var r=new xe(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isInf=function(n){var r=new xe(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.isFinite=function(n){var r=new xe(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},t.prototype.round=function(n){var r=new xe(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},t.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,l1,n.dtype);var r=new xe(n.shape,l1);return this.compileAndRun(r,[n])},t.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,c1,n.dtype);var r=new xe(n.shape,c1);return this.compileAndRun(r,[n])},t.prototype.softmax=function(n,r){var o=wt([r],n.shape),i=this.max(n,o),a=cn(i.shape,o),s=this.subtract(n,i.reshape(a)),u=this.exp(s),l=this.sum(u,o).reshape(a);return this.realDivide(u,l)},t.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new xe(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},t.prototype.log1p=function(n){var r=new xe(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},t.prototype.sqrt=function(n){var r=new xe(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},t.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new xe(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},t.prototype.reciprocal=function(n){var r=new xe(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},t.prototype.relu=function(n){var r;return r=G().getBool("WEBGL_PACK")?new Ns(n.shape,EE):new xe(n.shape,wE),this.compileAndRun(r,[n])},t.prototype.relu6=function(n){var r;return r=G().getBool("WEBGL_PACK")?new Ns(n.shape,SE):new xe(n.shape,bE),this.compileAndRun(r,[n])},t.prototype.prelu=function(n,r){var o=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(xE,n.shape,r.shape):new rt(yE,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.elu=function(n){if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,kE,n.dtype);var r=new xe(n.shape,CE);return this.compileAndRun(r,[n])},t.prototype.eluDer=function(n,r){var o=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new rt("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.selu=function(n){var r=new xe(n.shape,mO);return this.compileAndRun(r,[n])},t.prototype.int=function(n){var r=new xe(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},t.prototype.clip=function(n,r,o){var i,a=(i=G().getBool("WEBGL_PACK_CLIP")?new Q4(n.shape):new Y4(n.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[n],null,a)},t.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,i1,n.dtype);var r=new xe(n.shape,i1);return this.compileAndRun(r,[n])},t.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),o=new J4(n.shape),i=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(o,i)},t.prototype.sigmoid=function(n){var r=new xe(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},t.prototype.softplus=function(n){var r=new xe(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},t.prototype.sin=function(n){var r=new xe(n.shape,gO);return this.compileAndRun(r,[n])},t.prototype.cos=function(n){var r=new xe(n.shape,yO);return this.compileAndRun(r,[n])},t.prototype.tan=function(n){var r=new xe(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},t.prototype.asin=function(n){var r=new xe(n.shape,xO);return this.compileAndRun(r,[n])},t.prototype.acos=function(n){var r=new xe(n.shape,wO);return this.compileAndRun(r,[n])},t.prototype.atan=function(n){var r=new xe(n.shape,bO);return this.compileAndRun(r,[n])},t.prototype.atan2=function(n,r){var o=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new rt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(o,[n,r])},t.prototype.sinh=function(n){var r=new xe(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.cosh=function(n){var r=new xe(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},t.prototype.tanh=function(n){var r=new xe(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},t.prototype.asinh=function(n){var r=new xe(n.shape,CO);return this.compileAndRun(r,[n])},t.prototype.acosh=function(n){var r=new xe(n.shape,EO);return this.compileAndRun(r,[n])},t.prototype.atanh=function(n){var r=new xe(n.shape,SO);return this.compileAndRun(r,[n])},t.prototype.erf=function(n){var r=new xe(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},t.prototype.step=function(n,r){var o=new xe(n.shape,function(i){return i===void 0&&(i=0),ur+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(r));return this.compileAndRun(o,[n])},t.prototype.conv2dByMatMul=function(n,r,o,i,a,s){var u=n.shape,l=this.texData.get(n.dataId),c=o.inChannels,d=u[0]*u[1]*u[2],f=o.outChannels,h=o.dataFormat==="channelsLast",p=(d===1||f===1)&&c>1e3,v=u[2]%2!=0&&!!l.isPacked;if(p||!G().getBool("WEBGL_LAZILY_UNPACK")||!G().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var g=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],m=this.reshape(n,[1,g,o.inChannels]),y=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:y,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var x=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),w={dataId:n.dataId,shape:[1,x,o.inChannels],dtype:n.dtype},b=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,T(Il(l.shape,w.shape),function(){return"packed reshape "+l.shape+" to "+w.shape+" isn't free"});var E=this.reshape(r,[1,o.inChannels,o.outChannels]),k=this.fusedBatchMatMul({a:w,b:E,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),_=this.texData.get(k.dataId);return T(_.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=b,_.shape=o.outShape,O.makeTensorFromDataId(k.dataId,o.outShape,k.dtype)},t.prototype.conv2dWithIm2Row=function(n,r,o,i,a,s){var u=o.filterWidth,l=o.filterHeight,c=o.inChannels,d=o.outWidth,f=o.outHeight,h=o.dataFormat==="channelsLast",p=u*l*c,v=f*d,g=[p,v],m=n.squeeze([0]),y=r.reshape([1,p,-1]),x=new zF(g,m.shape,o),w=this.compileAndRun(x,[m]).reshape([1,g[0],g[1]]),b=i!=null,E=s!=null,k=a?Dl(a,!0):null,_=new ih(w.shape,[1,v,o.outChannels],!0,!1,b,k,E),R=[w,y];i&&R.push(i),E&&R.push(s);var N=this.compileAndRun(_,R);return h?N.reshape([1,f,d,o.outChannels]):N.reshape([1,o.outChannels,f,d])},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,i,a,s,u);if(G().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,i,a,s,u);var l=a!=null,c=u!=null,d=s?Dl(s,!1):null,f=new Yy(i,l,d,c),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(f,h)},t.prototype.conv2d=function(n,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,o);if(G().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,o);var i=new Yy(o);return this.compileAndRun(i,[n,r])},t.prototype.conv2dDerInput=function(n,r,o){var i=new nF(o);return this.compileAndRun(i,[n,r])},t.prototype.conv2dDerFilter=function(n,r,o){var i=new tF(o);return this.compileAndRun(i,[n,r])},t.prototype.fusedDepthwiseConv2D=function(n){var r,o=n.input,i=n.filter,a=n.convInfo,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=G().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=u?Dl(u,c):null,f=[o,i],h=s!=null,p=l!=null;return h&&f.push(s),p&&f.push(l),c?(r=new Jy(a,h,d,p),this.compileAndRun(r,f)):(r=new Qy(a,h,d,p),this.compileAndRun(r,f))},t.prototype.depthwiseConv2D=function(n,r,o){var i;return G().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new Jy(o),this.compileAndRun(i,[n,r])):(i=new Qy(o),this.compileAndRun(i,[n,r]))},t.prototype.depthwiseConv2DDerInput=function(n,r,o){var i=new aF(o);return this.compileAndRun(i,[n,r])},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){var i=new iF(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3d=function(n,r,o){var i=new sF(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3dDerInput=function(n,r,o){var i=new oF(o);return this.compileAndRun(i,[n,r])},t.prototype.conv3dDerFilter=function(n,r,o){var i=new rF(o);return this.compileAndRun(i,[n,r])},t.prototype.maxPool=function(n,r){var o=new ah(r,"max",!1);return this.compileAndRun(o,[n])},t.prototype.avgPool=function(n,r){var o=new ah(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPoolBackprop=function(n,r,o,i){var a=new ah(i,"max",!0),s=this.compileAndRun(a,[r]),u=new VF(i),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.avgPoolBackprop=function(n,r,o){var i=new V4(o);return this.compileAndRun(i,[n],r.dtype)},t.prototype.cast=function(n,r){return lE(n,r,this)},t.prototype.unstack=function(n,r){for(var o=n.shape[r],i=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(i[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(i);return c},t.prototype.avgPool3d=function(n,r){var o=new sh(r,"avg",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.avgPool3dBackprop=function(n,r,o){var i=new H4(o);return this.compileAndRun(i,[n],r.dtype)},t.prototype.maxPool3d=function(n,r){var o=new sh(r,"max",!1);return this.compileAndRun(o,[n],"float32")},t.prototype.maxPool3dBackprop=function(n,r,o,i){var a=new sh(i,"max",!0),s=this.compileAndRun(a,[r]),u=new HF(i),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},t.prototype.reshape=function(n,r){var o=this.texData.get(n.dataId);if(o.isPacked&&!Il(n.shape,r)&&(o.texture===null||!Il(o.shape,r))){var i=this.packedReshape(n,r);return O.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return $p(n,r)},t.prototype.resizeBilinear=function(n,r,o,i){var a=G().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tO(n.shape,r,o,i):new eO(n.shape,r,o,i);return this.compileAndRun(a,[n],"float32")},t.prototype.resizeBilinearBackprop=function(n,r,o){var i=new ZF(n,r,o);return this.compileAndRun(i,[n])},t.prototype.resizeNearestNeighbor=function(n,r,o,i){var a=new rO(n.shape,r,o,i);return this.compileAndRun(a,[n])},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){var i=new nO(n,r,o);return this.compileAndRun(i,[n])},t.prototype.multinomial=function(n,r,o,i){var a=r?n:oo(n),s=a.shape[0],u=a.shape[1],l=new GF(s,u,o),c=l.getCustomSetupFunc(i);return this.compileAndRun(l,[a],"int32",c)},t.prototype.oneHot=function(n,r,o,i){var a=new qF(n.size,r,o,i);return this.compileAndRun(a,[n])},t.prototype.diag=function(n){var r=new hF(n.size);return this.compileAndRun(r,[n])},t.prototype.nonMaxSuppression=function(n,r,o,i,a){return jc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Im(n.dataSync(),r.dataSync(),o,i,a)},t.prototype.cropAndResize=function(n,r,o,i,a,s){var u=new uF(n.shape,r.shape,i,a,s);return this.compileAndRun(u,[n,r,o],"float32")},t.prototype.depthToSpace=function(n,r,o){T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=n.shape[0],a=o==="NHWC"?n.shape[1]:n.shape[2],s=o==="NHWC"?n.shape[2]:n.shape[3],u=o==="NHWC"?n.shape[3]:n.shape[1],l=a*r,c=s*r,d=u/(r*r),f=new fF(o==="NHWC"?[i,l,c,d]:[i,d,l,c],r,o);return this.compileAndRun(f,[n])},t.prototype.split=function(n,r,o){return fE(n,r,o)},t.prototype.scatterND=function(n,r,o){var i=Hc(0,n,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,l=i.strides,c=i.outputSize,d=[c/u,u],f=n.reshape([s,a]),h=r.reshape([s,u]);if(c===0)return $p(It([]),o);var p=Z(0),v=new n1(s,a,f.rank,h.rank,l,d);return this.compileAndRun(v,[h,f,p]).reshape(o)},t.prototype.sparseToDense=function(n,r,o,i){var a=Hc(0,n,o),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,d=new n1(u,s,n.rank,r.rank,l,[c,1]);return this.compileAndRun(d,[r,n,i]).reshape(o)},t.prototype.fft=function(n){return this.fftImpl(n,!1)},t.prototype.ifft=function(n){return this.fftImpl(n,!0)},t.prototype.fftImpl=function(n,r){var o=this.texData.get(n.dataId),i=new e1(yF,n.shape,r),a=new e1(xF,n.shape,r),s=[this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag)],u=this.compileAndRun(i,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(n.shape[0],n.shape[1]);return u.dispose(),l.dispose(),c},t.prototype.gatherND=function(n,r){var o=r.shape,i=o[o.length-1],a=nE(n,r),s=a[0],u=a[1],l=a[2],c=a[3],d=r.reshape([u,i]),f=n.reshape([n.size/l,l]),h=new CF(i,c,[u,l]);return this.compileAndRun(h,[f,d]).reshape(s)},t.prototype.fill=function(n,r,o){if((o=o||zu(r))==="string"){var i=Fc(o,ae(n));return i.fill(r),O.makeTensor(i,n,o,this)}var a=new wF(n,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},t.prototype.linspace=function(n,r,o){return cE(n,r,o)},t.prototype.makeTensorInfo=function(n,r){var o=this.write(null,n,r);return this.texData.get(o).usage=null,{dataId:o,shape:n,dtype:r}},t.prototype.makeOutput=function(n,r){var o=this.makeTensorInfo(n,r).dataId;return O.makeTensorFromDataId(o,n,r,this)},t.prototype.unpackTensor=function(n){var r=new _O(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},t.prototype.packTensor=function(n){var r=new KF(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},t.prototype.packedReshape=function(n,r){var o=[Lc(n.shape)].concat(Bc(n.shape)),i={dtype:n.dtype,shape:o,dataId:n.dataId},a=[Lc(r)].concat(Bc(r)),s=new JF(a,o),u=this.runWebGLProgram(s,[i],n.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(n){var r,o=this.texData.get(n),i=o.isPacked,a=o.shape,s=o.dtype,u=th(a);return r=i?new dF(u):new cF(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:n}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(n,r,o,i,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(n.outputShape,o),l=this.texData.get(u.dataId);if(n.packedOutput&&(l.isPacked=!0),n.outPackingScheme===yu.DENSE){var c=$s(n.outputShape);l.texShape=c.map(function(x){return 2*x})}if(n.outTexUsage!=null&&(l.usage=n.outTexUsage),ae(u.shape)===0)return l.values=mu(u.dtype,0),u;var d=[],f=r.map(function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(x.dataId);if(w.texture==null){if(!n.packedInputs&&ae(x.shape)<=G().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:w.values};n.packedInputs&&(w.isPacked=!0,w.shape=x.shape)}else if(!!w.isPacked!=!!n.packedInputs)x=w.isPacked?s.unpackTensor(x):s.packTensor(x),d.push(x),w=s.texData.get(x.dataId);else if(w.isPacked&&!Il(w.shape,x.shape)){var b=x,E=x.shape;x.shape=w.shape,x=s.packedReshape(x,E),d.push(x),w=s.texData.get(x.dataId),b.shape=E}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var h,p={shape:u.shape,texData:l,isUniform:!1},v=function(x,w,b){var E="";w.concat(b).forEach(function(R){var N=R.texData!=null&&R.texData.slice!=null&&R.texData.slice.flatOffset>0,D=R.isUniform?"uniform":R.texData.texShape;E+=R.shape+"_"+D+"_"+N});var k=x.userCode,_=x.constructor.name;return _+="_"+E+"_"+k}(n,f,p),g=this.getAndSaveBinary(v,function(){return function(x,w,b,E){var k=w.userCode,_=b.map(function(P,L){var W={logicalShape:P.shape,texShape:P.isUniform?null:P.texData.texShape,isUniform:P.isUniform,isPacked:!P.isUniform&&P.texData.isPacked,flatOffset:null};return P.texData!=null&&P.texData.slice!=null&&P.texData.slice.flatOffset>0&&(W.flatOffset=P.texData.slice.flatOffset),{name:w.variableNames[L],shapeInfo:W}}),R=_.map(function(P){return P.shapeInfo}),N={logicalShape:E.shape,texShape:E.texData.texShape,isUniform:!1,isPacked:E.texData.isPacked,flatOffset:null},D=B4(_,N,k,w.packedInputs),A=x.createProgram(D),j=null,F=x.getUniformLocation(A,"NAN",!1);G().getNumber("WEBGL_VERSION")===1&&(j=x.getUniformLocation(A,"INFINITY",!1));for(var z={},B=0;B<w.variableNames.length;B++){var $=w.variableNames[B];z[$]=x.getUniformLocation(A,$,!1),z["offset"+$]=x.getUniformLocation(A,"offset"+$,!1)}return{program:w,source:D,webGLProgram:A,uniformLocations:z,inShapeInfos:R,outShapeInfo:N,infLoc:j,nanLoc:F}}(s.gpgpu,n,f,p)}),m=this.activeTimers!=null;if(m&&(h=this.startTimer()),function(x,w,b,E,k){t1(w.inShapeInfos,b),t1([w.outShapeInfo],[E]);var _=E.texData.texture,R=E.texData.texShape;E.texData.isPacked?x.setOutputPackedMatrixTexture(_,R[0],R[1]):x.setOutputMatrixTexture(_,R[0],R[1]),x.setProgram(w.webGLProgram),G().getNumber("WEBGL_VERSION")===1&&w.infLoc!==null&&x.gl.uniform1f(w.infLoc,1/0),w.nanLoc!==null&&x.gl.uniform1f(w.nanLoc,NaN),b.forEach(function(N,D){var A=w.program.variableNames[D],j=w.uniformLocations[A],F=w.uniformLocations["offset"+A];if(j!=null)if(N.isUniform)if(ae(N.shape)<2)x.gl.uniform1f(j,N.uniformValues[0]);else{var z=N.uniformValues;z instanceof Float32Array||(z=new Float32Array(z)),x.gl.uniform1fv(j,z)}else N.texData.slice!=null&&F!=null&&x.gl.uniform1i(F,N.texData.slice.flatOffset),x.setInputMatrixTexture(N.texData.texture,j,D)}),k!=null&&k(x,w.webGLProgram),x.executeProgram()}(this.gpgpu,g,f,p,i),d.forEach(function(x){return s.disposeData(x.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(h)})),!G().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var y=this.unpackTensor(u);return this.disposeData(u.dataId),y}return u},t.prototype.compileAndRun=function(n,r,o,i,a){a===void 0&&(a=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(n,r,o,i,a);return O.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var n=this;this.disposed||(G().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=te(function(){if(!G().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=G().getBool("DEBUG");G().set("DEBUG",!1);var o=n.abs(Z(1e-8)).dataSync()[0];if(G().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(n){var r,o=this.texData.get(n),i=o.shape,a=o.dtype,s=o.values,u=o.texture,l=o.usage,c=o.isPacked;if(u==null){var d,f=this.activeTimers!=null;f&&(d=wr());var h=o.texShape;if(h==null&&(h=MM(i,c),o.texShape=h),s!=null){var p=th(i),v=void 0,g=h[1],m=h[0],y=s instanceof Uint8Array;c?(g=(r=$u(h[0],h[1]))[0],m=r[1],v=new gF(p,[m,g],y)):v=new mF(p,[m,g],y);var x=this.makeTensorInfo([m,g],a);this.texData.get(x.dataId).usage=y?Cn.PIXELS:Cn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),g,m,s);var w=this.runWebGLProgram(v,[x],a,null,!0),b=this.texData.get(w.dataId);o.texture=b.texture,o.texShape=b.texShape,o.isPacked=b.isPacked,o.usage=b.usage,this.disposeData(x.dataId),this.texData.delete(w.dataId),o.values=null,f&&(this.uploadWaitMs+=wr()-d)}else{var E=this.acquireTexture(h,l,a,c);o.texture=E}}},t.prototype.convertAndCacheOnCPU=function(n,r){var o=this.texData.get(n),i=o.dtype;return this.releaseGPUData(n),r!=null&&(o.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},t.prototype.acquireTexture=function(n,r,o,i){if(this.numBytesInGPU+=this.computeBytes(n,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,i)},t.prototype.computeBytes=function(n,r){return n[0]*n[1]*BC(r)},t}(sE);HC()&&O.registerBackend("webgl",function(){return new NO},2);var IO=M({square_:function(e){var t=I(e,"x","square"),n=[t];return O.runKernelFunc(function(r,o){return o([t]),r.square(t)},{x:t},null,"Square",{},n,[])}}),wu="SquaredDifference",_E=M({squaredDifference_:function(e,t){var n,r=I(e,"a","squaredDifference"),o=I(t,"b","squaredDifference");n=nt(r,o),r=n[0],o=n[1],Se(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return O.runKernelFunc(function(s,u){var l=s.squaredDifference(r,o);return u([r,o]),l},i,function(s,u){var l=u[0],c=u[1],d=Z(2);return{a:function(){return s.mul(l.sub(c).mul(d))},b:function(){return s.mul(c.sub(l).mul(d))}}},wu,{},a,[])}}),TO=M({abs_:function(e){var t=I(e,"x","abs");return t.dtype==="complex64"?O.runKernelFunc(function(n){return n.complexAbs(t)},{$x:t}):O.runKernelFunc(function(n,r){var o=n.abs(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.toFloat().step(-1))}}},"Abs")}}),AO=M({acos_:function(e){var t=I(e,"x","acos");return O.runKernelFunc(function(n,r){var o=n.acos(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(Z(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),PO=M({acosh_:function(e){var t=I(e,"x","acosh");return O.runKernelFunc(function(n,r){var o=n.acosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),DO=M({asin_:function(e){var t=I(e,"x","asin");return O.runKernelFunc(function(n,r){var o=n.asin(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(Z(1).sub(o.toFloat().square()).sqrt())}}})}}),MO=M({asinh_:function(e){var t=I(e,"x","asinh");return O.runKernelFunc(function(n,r){var o=n.asinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.divStrict(Z(1).add(o.toFloat().square()).sqrt())}}})}}),FO=M({atan_:function(e){var t=I(e,"x","atan");return O.runKernelFunc(function(n,r){var o=n.atan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().square().add(1))}}})}}),OO=M({atanh_:function(e){var t=I(e,"x","atanh");return O.runKernelFunc(function(n,r){var o=n.atanh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(Z(1).sub(o.toFloat().square()))}}})}}),LO=M({ceil_:function(e){var t=I(e,"x","ceil");return O.runKernelFunc(function(n){return n.ceil(t)},{$x:t},function(n){return{$x:function(){return Re(n)}}})}}),Fm=M({clipByValue_:function(e,t,n){var r=I(e,"x","clipByValue");T(t<=n,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."});var o=[r],i={min:t,max:n};return O.runKernelFunc(function(a,s){var u=a.clip(r,t,n);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(t).logicalAnd(u.lessEqual(n)),Re(a))}}},"ClipByValue",i,o)}}),BO=M({cos_:function(e){var t=I(e,"x","cos"),n=[t];return O.runKernelFunc(function(r,o){var i=r.cos(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),jO=M({cosh_:function(e){var t=I(e,"x","cosh");return O.runKernelFunc(function(n,r){var o=n.cosh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(n)}}})}}),zO=M({erf_:function(e){var t=I(e,"x","erf");return T(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),O.runKernelFunc(function(n,r){var o=n.erf(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Vp=M({exp_:function(e){var t=I(e,"x","exp");return O.runKernelFunc(function(n,r){var o=n.exp(t);return r([o]),o},{x:t},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),WO=M({expm1_:function(e){var t=I(e,"x","expm1");return O.runKernelFunc(function(n,r){var o=n.expm1(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.exp())}}})}}),$O=M({floor_:function(e){var t=I(e,"x","floor");return O.runKernelFunc(function(n){return n.floor(t)},{$x:t},function(n){return{$x:function(){return Re(n)}}})}}),UO=M({log_:function(e){var t=I(e,"x","log"),n=[t];return O.runKernelFunc(function(r,o){var i=r.log(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},n)}}),VO=M({log1p_:function(e){var t=I(e,"x","log1p");return O.runKernelFunc(function(n,r){var o=n.log1p(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.add(1))}}})}}),HO=M({logSigmoid_:function(e){var t=I(e,"x","logSigmoid");return O.runKernelFunc(function(n,r){var o=n.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.neg().sigmoid())}}})}}),Xc=M({neg_:function(e){var t=I(e,"x","neg"),n=[t];return O.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),GO=M({reciprocal_:function(e){var t=I(e,"x","reciprocal");return O.runKernelFunc(function(n,r){var o=n.reciprocal(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.square().neg())}}})}}),qO=M({round_:function(e){var t=I(e,"x","round");return O.runKernelFunc(function(n){return n.round(t)},{$x:t},function(n){return{$x:function(){return Re(n)}}})}}),RE=M({rsqrt_:function(e){var t=I(e,"x","rsqrt"),n=[t];return O.runKernelFunc(function(r,o){var i=r.rsqrt(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),NE=M({sigmoid_:function(e){var t=I(e,"x","sigmoid");return O.runKernelFunc(function(n,r){var o=n.sigmoid(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mul(o.mul(Z(1).sub(o)))}}},"Sigmoid")}}),KO=M({sign_:function(e){var t=I(e,"x","sign");return O.runKernelFunc(function(n){return n.sign(t)},{$x:t},function(n){return{$x:function(){return Re(n)}}})}}),XO=M({isNaN_:function(e){var t=I(e,"x","isNaN");return O.runKernelFunc(function(n){return n.isNaN(t)},{$x:t},function(n){return{$x:function(){return Re(n)}}})}}),YO=M({isInf_:function(e){var t=I(e,"x","isInf");return O.runKernelFunc(function(n){return n.isInf(t)},{$x:t},function(n){return{$x:function(){return Re(n)}}})}}),QO=M({isFinite_:function(e){var t=I(e,"x","isFinite");return O.runKernelFunc(function(n){return n.isFinite(t)},{$x:t},function(n){return{$x:function(){return Re(n)}}})}}),JO=M({sin_:function(e){var t=I(e,"x","sin"),n=[t];return O.runKernelFunc(function(r,o){var i=r.sin(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},n)}}),ZO=M({sinh_:function(e){var t=I(e,"x","sinh");return O.runKernelFunc(function(n,r){var o=n.sinh(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(n)}}})}}),eL=M({softplus_:function(e){var t=I(e,"x","softplus");return O.runKernelFunc(function(n,r){var o=n.softplus(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.mul(o.sigmoid())}}})}}),tL=M({sqrt_:function(e){var t=I(e,"x","sqrt");return O.runKernelFunc(function(n,r){var o=n.sqrt(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.toFloat().sqrt().mul(2))}}})}}),nL=M({step_:function(e,t){t===void 0&&(t=0);var n=I(e,"x","step");return O.runKernelFunc(function(r){return r.step(n,t)},{$x:n},function(r){return{$x:function(){return Re(r)}}})}}),rL=M({tan_:function(e){var t=I(e,"x","tan");return O.runKernelFunc(function(n,r){var o=n.tan(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return n.div(o.cos().square())}}})}}),oL=M({tanh_:function(e){var t=I(e,"x","tanh");return O.runKernelFunc(function(n,r){var o=n.tanh(t);return r([o]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return Z(1).sub(o.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function IE(e,t,n,r,o,i){var a,s,u=I(e,"x","batchNorm"),l=I(t,"mean","batchNorm"),c=I(n,"variance","batchNorm");return o!=null&&(a=I(o,"scale","batchNorm")),r!=null&&(s=I(r,"offset","batchNorm")),T(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),T(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),T(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&T(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&T(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Vu(u,l,c,s,a,i)}function TE(e,t,n,r,o,i){var a,s,u=I(e,"x","batchNorm"),l=I(t,"mean","batchNorm"),c=I(n,"variance","batchNorm");return o!=null&&(a=I(o,"scale","batchNorm")),r!=null&&(s=I(r,"offset","batchNorm")),T(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),T(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),T(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&T(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&T(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Vu(u,l,c,s,a,i)}function AE(e,t,n,r,o,i){var a,s,u=I(e,"x","batchNorm"),l=I(t,"mean","batchNorm"),c=I(n,"variance","batchNorm");return o!=null&&(a=I(o,"scale","batchNorm")),r!=null&&(s=I(r,"offset","batchNorm")),T(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),T(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),T(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&T(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&T(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Vu(u,l,c,s,a,i)}function Vu(e,t,n,r,o,i){i==null&&(i=.001);var a,s,u,l=I(e,"x","batchNorm"),c=I(t,"mean","batchNorm"),d=I(n,"variance","batchNorm");o!=null&&(a=I(o,"scale","batchNorm")),r!=null&&(s=I(r,"offset","batchNorm")),T(c.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),T(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),T(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var f=[l,c,d,a];return O.runKernelFunc(function(h,p){var v=h.batchNormalization(u,Ml(c),Ml(d),i,Ml(a),Ml(s));return p([l,c,d,a]),v},{x:l,mean:c,variance:d,scale:a,offset:s},function(h,p){var v=p,g=v[0],m=v[1],y=v[2],x=v[3],w=x??Z(1),b=yt(m.shape,u.shape),E=[];if(m.rank===1){for(var k=0;k<u.shape.length-1;++k)E.push(u.shape[k]);E.push(1)}var _=g.sub(m),R=h.mul(w),N=RE(y.add(Z(i))),D=N.mul(N).mul(N).mul(Z(-.5));return{x:function(){return m.rank===1?h.mul(Na(N.as4D(1,1,1,m.shape[0]),E)).mul(w).reshape(g.shape):h.mul(N).mul(w).reshape(g.shape)},mean:function(){var A=N.mul(Z(-1)).mul(R);return m.rank===1&&(A=A.sum(b)),A.reshape(m.shape)},variance:function(){var A=D.mul(_).mul(R);return m.rank===1&&(A=A.sum(b)),A.reshape(m.shape)},scale:function(){var A=_.mul(N),j=h.mul(A);return m.rank===1&&(j=j.sum(b)),j.reshape(m.shape)},offset:function(){var A=h;return m.rank===1&&(A=A.sum(b)),A.reshape(m.shape)}}},"BatchNormalization",{varianceEpsilon:i},f).reshape(l.shape)}function Ml(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function jd(){GC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var iL=M({batchNormalization2d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),jd(),IE(e,t,n,i,o,r)}}),aL=M({batchNormalization3d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),jd(),TE(e,t,n,i,o,r)}}),sL=M({batchNormalization4d_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),jd(),AE(e,t,n,i,o,r)}}),uL=M({batchNormalization_:function(e,t,n,r,o,i){return r===void 0&&(r=.001),jd(),Vu(e,t,n,i,o,r)}}),PE=M({batchNorm_:Vu}),lL=M({batchNorm2d_:IE}),cL=M({batchNorm3d_:TE}),dL=M({batchNorm4d_:AE}),zd=M({logicalAnd_:function(e,t){var n=I(e,"a","logicalAnd","bool"),r=I(t,"b","logicalAnd","bool");return Se(n.shape,r.shape),O.runKernelFunc(function(o){return o.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),fL=M({logicalNot_:function(e){var t=I(e,"x","logicalNot","bool");return O.runKernelFunc(function(n){return n.logicalNot(t)},{$x:t})}}),DE=M({logicalOr_:function(e,t){var n=I(e,"a","logicalOr","bool"),r=I(t,"b","logicalOr","bool");return Se(n.shape,r.shape),O.runKernelFunc(function(o){return o.logicalOr(n,r)},{$a:n,$b:r})}}),hL=M({logicalXor_:function(e,t){var n=I(e,"a","logicalXor","bool"),r=I(t,"b","logicalXor","bool");return Se(n.shape,r.shape),DE(e,t).logicalAnd(zd(e,t).logicalNot())}}),Li=M({where_:function(e,t,n){var r=I(t,"a","where"),o=I(n,"b","where"),i=I(e,"condition","where","bool");return Fe(r.shape,o.shape,"Error in where: "),i.rank===1?T(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Fe(i.shape,o.shape,"Error in where: "),O.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return Re(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),ME=function(e){return oe(this,void 0,void 0,function(){var t,n,r;return ie(this,function(o){switch(o.label){case 0:return[4,(t=I(e,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=Am(t.shape,n),e!==t&&t.dispose(),[2,r]}})})},Ee=M({add_:function(e,t){var n,r=I(e,"a","add"),o=I(t,"b","add");n=nt(r,o),r=n[0],o=n[1];var i=Se(r.shape,o.shape);return O.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=yt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=yt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),pL=M({addN_:function(e){T(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),T(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(o,i){return I(o,"tensors"+i,"addN")}),n=t[0];t.forEach(function(o){if(o.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!St(o.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return O.runKernelFunc(function(o){return o.addN(t)},r,function(o){var i={};return t.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),vL=M({addStrict_:function(e,t){var n=I(e,"a","addStrict"),r=I(t,"b","addStrict");return Fe(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),mL=M({atan2_:function(e,t){var n,r=I(e,"a","atan2"),o=I(t,"b","atan2");n=nt(r,o),r=n[0],o=n[1];var i=Se(r.shape,o.shape);return O.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Ee(u.square(),l.square()),d=a.mul(l.div(c)),f=yt(u.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var c=Ee(u.square(),l.square()),d=Xc(a.mul(u.div(c))),f=yt(l.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(l.shape)}}})}}),Jn=M({div_:function(e,t){var n,r=I(e,"a","div"),o=I(t,"b","div");if(n=nt(r,o),r=n[0],o=n[1],r.dtype==="int32"&&o.dtype==="int32")return FE(r,o);var i=Se(r.shape,o.shape);return O.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),d=yt(u.shape,i);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),d=yt(l.shape,i);d.length>0&&(c=c.sum(d).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"Div")}}),gL=M({divNoNan_:function(e,t){var n,r=I(e,"a","div"),o=I(t,"b","div");r=(n=nt(r,o))[0],o=n[1];var i=Jn(r,o),a=Re(i),s=o.equal(a);return Li(s,a,i)}}),yL=M({divStrict_:function(e,t){var n=I(e,"a","div"),r=I(t,"b","div");return Fe(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),FE=M({floorDiv_:function(e,t){var n,r=I(e,"a","floorDiv"),o=I(t,"b","floorDiv");n=nt(r,o),r=n[0],o=n[1];var i=Se(r.shape,o.shape);return O.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),d=yt(u.shape,i);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),d=yt(l.shape,i);d.length>0&&(c=c.sum(d).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"FloorDiv")}}),Om=M({maximum_:function(e,t){var n,r=I(e,"a","maximum"),o=I(t,"b","maximum");return n=nt(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Se(r.shape,o.shape),O.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),xL=M({maximumStrict_:function(e,t){var n=I(e,"a","maximumStrict"),r=I(t,"b","maximumStrict");return Fe(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),OE=M({minimum_:function(e,t){var n,r=I(e,"a","minimum"),o=I(t,"b","minimum");return n=nt(r,o),r=n[0],o=n[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Se(r.shape,o.shape),O.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),wL=M({minimumStrict_:function(e,t){var n=I(e,"a","minimumStrict"),r=I(t,"b","minimumStrict");return Fe(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),bL=M({mod_:function(e,t){var n,r=I(e,"a","mod"),o=I(t,"b","mod");n=nt(r,o),r=n[0],o=n[1];var i=Se(r.shape,o.shape);return O.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=yt(u.shape,i);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),d=yt(l.shape,i);return d.length>0?c.sum(d).reshape(l.shape):c}}})}}),CL=M({modStrict_:function(e,t){var n=I(e,"a","modStrict"),r=I(t,"b","modStrict");return Fe(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),$t=M({mul_:function(e,t){var n,r=I(e,"a","mul"),o=I(t,"b","mul");n=nt(r,o),r=n[0],o=n[1];var i=Se(r.shape,o.shape);return O.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),d=yt(u.shape,i);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),d=yt(l.shape,i);return d.length>0?c.sum(d).reshape(l.shape):c}}},"Mul")}}),EL=M({mulStrict_:function(e,t){var n=I(e,"a","mul"),r=I(t,"b","mul");return Fe(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Yc=M({pow_:function(e,t){var n,r=I(e,"base","pow"),o=I(t,"exp","pow");n=nt(r,o),r=n[0],o=n[1];var i=Se(r.shape,o.shape),a=[r,o];return O.runKernelFunc(function(s,u){var l=s.pow(r,o);return u([r,o,l]),l},{a:r,b:o},function(s,u){var l=u[0],c=u[1],d=u[2];return{a:function(){var f=c.toFloat(),h=s.mul(f.mul(l.pow(f.sub(Z(1))))),p=yt(l.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(l.shape)},b:function(){var f=l.greater(0),h=l.log().where(f,Re(l)),p=s.mul(d.mul(h)),v=yt(c.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(c.shape)}}},"Pow",{},a,[!0])}}),SL=M({powStrict_:function(e,t){return Fe(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),kL=M({squaredDifferenceStrict_:function(e,t){var n=I(e,"a","squaredDifferenceStrict"),r=I(t,"b","squaredDifferenceStrict");return Fe(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),xt=M({sub_:function(e,t){var n,r=I(e,"a","sub"),o=I(t,"b","sub");n=nt(r,o),r=n[0],o=n[1];var i=Se(r.shape,o.shape);return O.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=yt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=yt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),_L=M({subStrict_:function(e,t){var n=I(e,"a","subStrict"),r=I(t,"b","subStrict");return Fe(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),LE=M({equal_:function(e,t){var n,r=I(e,"a","equal"),o=I(t,"b","equal");return n=nt(r,o),r=n[0],o=n[1],Se(r.shape,o.shape),O.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),RL=M({equalStrict_:function(e,t){var n=I(e,"a","equalStrict"),r=I(t,"b","equalStrict");return Fe(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),NL=M({greater_:function(e,t){var n,r=I(e,"a","greater"),o=I(t,"b","greater");return n=nt(r,o),r=n[0],o=n[1],Se(r.shape,o.shape),O.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),BE=M({greaterEqual_:function(e,t){var n,r=I(e,"a","greaterEqual"),o=I(t,"b","greaterEqual");return n=nt(r,o),r=n[0],o=n[1],Se(r.shape,o.shape),O.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return Re(s)},b:function(){return Re(u)}}},"GreaterEqual")}}),IL=M({greaterEqualStrict_:function(e,t){var n=I(e,"a","greaterEqualStrict"),r=I(t,"b","greaterEqualStrict");return Fe(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),TL=M({greaterStrict_:function(e,t){var n=I(e,"a","greaterStrict"),r=I(t,"b","greaterStrict");return Fe(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),AL=M({less_:function(e,t){var n,r=I(e,"a","less"),o=I(t,"b","less");return n=nt(r,o),r=n[0],o=n[1],Se(r.shape,o.shape),O.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),PL=M({lessEqual_:function(e,t){var n,r=I(e,"a","lessEqual"),o=I(t,"b","lessEqual");return n=nt(r,o),r=n[0],o=n[1],Se(r.shape,o.shape),O.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),DL=M({lessEqualStrict_:function(e,t){var n=I(e,"a","lessEqualStrict"),r=I(t,"b","lessEqualStrict");return Fe(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),ML=M({lessStrict_:function(e,t){var n=I(e,"a","lessStrict"),r=I(t,"b","lessStrict");return Fe(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),FL=M({notEqual_:function(e,t){var n,r=I(e,"a","notEqual"),o=I(t,"b","notEqual");return n=nt(r,o),r=n[0],o=n[1],Se(r.shape,o.shape),O.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),OL=M({notEqualStrict_:function(e,t){var n=I(e,"a","notEqualStrict"),r=I(t,"b","notEqualStrict");return Fe(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function d1(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function f1(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Lm=M({gather_:function(e,t,n){n===void 0&&(n=0);var r=I(e,"x","gather"),o=I(t,"indices","gather","int32");n=wt(n,r.shape)[0];var i=function(a,s,u){for(var l=a.shape[u],c=[],d=1,f=1,h=0;h<u;h++)c.push(a.shape[h]),d*=a.shape[h];for(h=0;h<s.rank;h++)c.push(s.shape[h]);for(h=u+1;h<a.rank;h++)c.push(a.shape[h]),f*=a.shape[h];return{batchSize:d,sliceSize:f,dimSize:l,outputShape:c}}(r,o,n);return O.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),n);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,d=l.slice(0,n),f=d.length,h=l.slice(n,l.length).slice(1),p=h.length,v=d1(0,f),g=d1(f+1,f+1+p),m=f1([d,[c],h]),y=a.reshape(m),x=u.reshape([c]),w=f1([[f],v,g]),b=y.transpose(w),E=jE(b,x,r.shape[n]),k=Em(w);return E=E.transpose(k)},indices:function(){return u}}},"Gather",{axis:n}).reshape(i.outputShape)}}),jE=M({unsortedSegmentSum_:function(e,t,n){var r=I(e,"x","unsortedSegmentSum"),o=I(t,"segmentIds","unsortedSegmentSum","int32");return T(ut(n),function(){return"numSegments must be of dtype int"}),O.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,n);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,l){for(var c=Om(l,Re(l)),d=Lm(u,c),f=BE(l,Z(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=Ln(f,p+1);f=zd(f,fs(d.shape,"bool"));var v=Re(d);return Li(f,d,v)}(i,s)}}})}}),LL=function(e,t,n){return oe(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,d,f,h,p,v;return ie(this,function(g){switch(g.label){case 0:for(r=I(e,"tensor","boolMask"),o=I(t,"mask","boolMask","bool"),i=n??0,a=o.rank,s=r.shape,T(a>0,function(){return"mask cannot be scalar"}),Fe(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+a;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+a)),d=r.reshape(c),f=o.reshape([-1]),[4,ME(f)];case 1:return h=g.sent(),p=h.squeeze([1]),v=Lm(d,p,i),e!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,v]}})})};function zE(e,t,n,r,o,i,a){i===void 0&&(i="NHWC"),T(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var s=e,u=t,l=!1;t.rank===3&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),T(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),T(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),T(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c=i==="NHWC"?s[3]:s[1],d=i==="NHWC"?u.shape[3]:u.shape[1];T(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),T(d===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+n.shape[3]+"."}),a!=null&&T(ut(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=Nm(i),h=Vi(s,n.shape,r,1,o,a,!1,f),p=O.runKernelFunc(function(v,g){var m=v.conv2dDerInput(u,n,h);return g([n,u]),m},{dy4D:u,filter:n},function(v,g){var m=g[0],y=g[1];return{dy4D:function(){return Vn(v,m,r,o,i,1,a)},filter:function(){return Bm(v,y,m.shape,r,o,i,a)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function lh(e){var t=function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i}(e),n=t[0],r=t[1],o=t[2];return n===1&&r===1&&o===1}function WE(e,t,n,r,o){T(e.length===t.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"});var i=e,a=t,s=!1;t.rank===4&&(s=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],l=a.shape[4];T(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),T(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),T(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),T(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),T(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=qc(i,n.shape,r,1,o),d=O.runKernelFunc(function(f){return f.conv3dDerInput(a,n,c)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var BL=M({conv1d_:function(e,t,n,r,o,i,a){o===void 0&&(o="NWC"),i===void 0&&(i=1);var s=I(e,"x","conv1d"),u=I(t,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),T(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),T(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&T(ut(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),T(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),T(dn(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),T(o==="NWC",function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),h=Vn(f,d,[1,n],r,"NHWC",[1,i],a);return c?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Vn=M({conv2d_:function(e,t,n,r,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=I(e,"x","conv2d"),u=I(t,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),T(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&T(ut(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=o==="NHWC"?l.shape[3]:l.shape[1];T(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),T(dn(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var f=Nm(o),h=Vi(l.shape,u.shape,n,i,r,a,!1,f),p=[u,l],v=O.runKernelFunc(function(g,m){var y=g.conv2d(l,u,h);return m([u,l]),y},{x:l,filter:u},function(g,m){var y=m,x=y[0],w=y[1];return T(ns(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return $E(w.shape,g,x,n,r,o)},filter:function(){return Bm(w,g,x.shape,n,r,o)}}},"Conv2D",h,p);return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),jL=M({conv3d_:function(e,t,n,r,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var a=I(e,"x","conv3d"),s=I(t,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),T(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),T(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),T(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),T(function(f,h){return lh(f)||lh(h)}(n,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),T(o==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var c=qc(u.shape,s.shape,n,i,r),d=O.runKernelFunc(function(f,h){var p=f.conv3d(u,s,c);return h([u,s]),p},{x:u,$filter:s},function(f,h){T(lh(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],v=h[1];return{x:function(){return WE(p.shape,f,v,n,r)},$filter:function(){return function(g,m,y,x,w){var b=g;g.rank===4&&(b=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var E=m;E.rank===4&&(E=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),T(b.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+b.shape+"."}),T(E.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+E.shape+"."}),T(y.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+y+"."}),T(b.shape[4]===y[3],function(){return"Error in conv3dDerFilter: depth of input "+b.shape[4]+") must match input depth in filter ("+y[3]+"."}),T(E.shape[4]===y[4],function(){return"Error in conv3dDerFilter: depth of dy ("+E.shape[4]+") must match output depth for filter ("+y[4]+")."});var k=qc(b.shape,y,x,1,w);return O.runKernelFunc(function(_){return _.conv3dDerFilter(b,E,k)},{x5D:b,dy5D:E})}(p,f,v.shape,n,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Bm=M({conv2dDerFilter_:function(e,t,n,r,o,i,a){i===void 0&&(i="NHWC");var s=e;e.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),T(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),T(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),T(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];T(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),T(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),a!=null&&T(ut(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=Nm(i),f=Vi(s.shape,n,r,1,o,a,!1,d);return O.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),$E=M({conv2dDerInput_:zE}),Wd=M({depthwiseConv2d_:function(e,t,n,r,o,i,a){i===void 0&&(i=[1,1]);var s=I(e,"x","depthwiseConv2d"),u=I(t,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),T(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),T(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),i==null&&(i=[1,1]),T(dn(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),a!=null&&T(ut(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=Vi(l.shape,u.shape,n,i,r,a,!0),f=[l,u],h=O.runKernelFunc(function(p,v){var g=p.depthwiseConv2D(l,u,d);return v([l,u]),g},{x:l,filter:u},function(p,v){T(ns(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var g=v[0],m=v[1];return{x:function(){return UE(g.shape,p,m,d)},filter:function(){return VE(g,p,m.shape,d)}}},"DepthwiseConv2dNative",d,f);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),UE=M({depthwiseConv2dDerInput_:function(e,t,n,r){var o=t,i=!1;t.rank===3&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=O.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),VE=M({depthwiseConv2dDerFilter_:function(e,t,n,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=t;return i.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),O.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),jm=M({separableConv2d_:function(e,t,n,r,o,i,a){i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC");var s=I(e,"x","separableConv2d"),u=I(t,"depthwiseFilter","separableConv2d"),l=I(n,"pointwiseFilter","separableConv2d"),c=s,d=!1;if(s.rank===3&&(d=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),T(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),T(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),T(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),T(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],h=u.shape[3];T(l.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+l.shape[2]+"."});var p=Wd(c,u,r,o,a,i),v=Vn(p,l,1,"valid",a);return d?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),zL=M({conv2dTranspose_:function(e,t,n,r,o,i){return zE(n,I(e,"x","conv2dTranspose"),I(t,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),WL=M({conv3dTranspose_:function(e,t,n,r,o){return WE(n,I(e,"x","conv3dTranspose"),I(t,"filter","conv3dTranspose"),r,o)}}),$d=M({matMul_:function(e,t,n,r){var o;n===void 0&&(n=!1),r===void 0&&(r=!1);var i=I(e,"a","matMul"),a=I(t,"b","matMul");o=nt(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?i.shape[i.rank-1]:i.shape[i.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=i.shape.slice(0,-2),f=a.shape.slice(0,-2),h=ae(d),p=ae(f);T(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),T(St(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),T(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var v=i.shape.slice(0,-2).concat([l,c]),g=n?i.as3D(h,s,l):i.as3D(h,l,s),m=r?a.as3D(p,c,u):a.as3D(p,u,c),y={transposeA:n,transposeB:r};return O.runKernelFunc(function(x,w){var b=x.batchMatMul(g,m,n,r);return w([g,m]),b},{a:g,b:m},function(x,w){var b=w,E=b[0],k=b[1];return n||r?!n&&r?{a:function(){return x.matMul(k,!1,!1)},b:function(){return x.matMul(E,!0,!1)}}:n&&!r?{a:function(){return k.matMul(x,!1,!0)},b:function(){return E.matMul(x,!1,!1)}}:{a:function(){return k.matMul(x,!0,!0)},b:function(){return x.matMul(E,!0,!0)}}:{a:function(){return x.matMul(k,!1,!0)},b:function(){return E.matMul(x,!0,!1)}}},"BatchMatMul",y).reshape(v)}}),$L=M({dot_:function(e,t){var n=I(e,"t1","dot"),r=I(t,"t2","dot");T(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=n.rank===1?n.size:n.shape[1],i=r.rank===1?r.size:r.shape[0];return T(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),UL=M({outerProduct_:function(e,t){var n=I(e,"v1","outerProduct"),r=I(t,"v2","outerProduct");return T(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Hu=M({reverse_:function(e,t){var n=I(e,"x","reverse");if(n.rank===0)return n.clone();var r=wt(t,n.shape);return O.runKernelFunc(function(o){return o.reverse(n,r)},{$x:n},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(n)}}),VL=M({reverse1d_:function(e){var t=I(e,"x","reverse");return T(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Hu(t,0)}}),HL=M({reverse2d_:function(e,t){var n=I(e,"x","reverse");return T(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Hu(n,t)}}),GL=M({reverse3d_:function(e,t){var n=I(e,"x","reverse");return T(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Hu(n,t)}}),qL=M({reverse4d_:function(e,t){var n=I(e,"x","reverse");return T(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Hu(n,t)}});function HE(e,t,n,r,o,i){var a=I(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),T(dn(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),i!=null&&T(ut(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=xu(s.shape,t,n,r,o,i);if(l.filterWidth===1&&l.filterHeight===1&&St(l.inShape,l.outShape))return a.clone();var c=[s],d=O.runKernelFunc(function(f,h){var p=f.maxPool(s,l);return h([s,p]),p},{x:s},function(f,h){var p=h[0],v=h[1];return{x:function(){return function(g,m,y,x,w,b,E,k){var _=I(g,"dy","maxPoolBackprop"),R=I(m,"input","maxPoolBackprop"),N=I(y,"output","maxPoolBackprop");T(R.rank===_.rank,function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+_.rank+")"}),T(dn(w,b),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+b+"'"}),T(_.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+_.rank+"."}),T(R.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var D=xu(R.shape,x,w,b,E,k);return O.runKernelFunc(function(A){return A.maxPoolBackprop(_,R,N,D)},{$dy:_,$input:R})}(f,p,v,t,n,r,o)}}},"MaxPool",l,c);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function GE(e,t,n,r,o,i){var a=I(e,"x","avgPool","float32");T(dn(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),i!=null&&T(ut(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var l=xu(s.shape,t,n,r,o,i);if(l.filterWidth===1&&l.filterHeight===1&&St(l.inShape,l.outShape))return a.clone();var c=O.runKernelFunc(function(d){return d.avgPool(s,l)},{x:s},function(d){return{x:function(){return function(f,h,p,v,g,m){var y=I(f,"dy","avgPoolBackprop"),x=I(h,"input","avgPoolBackprop");T(x.rank===y.rank,function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+y.rank+")"}),T(dn(v,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+g+"'"});var w=x,b=y,E=!1;x.rank===3&&(E=!0,w=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),b=y.as4D(1,y.shape[0],y.shape[1],y.shape[2])),T(b.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+b.rank+"."}),T(w.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var k=xu(w.shape,p,v,g,m),_=O.runKernelFunc(function(R){return R.avgPoolBackprop(b,w,k)},{dy4D:b,input4D:w});return E?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}(d,s,t,n,r,o)}}},"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var bt=M({maxPool_:function(e,t,n,r,o){return HE(e,t,n,1,r,o)}}),Gu=M({avgPool_:function(e,t,n,r,o){return GE(e,t,n,1,r,o)}}),KL=M({pool_:function(e,t,n,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var a=I(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(dn(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var l,c=xu(s.shape,t,i,o,r),d=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(w,b){var E=w.map(function(R,N){return R+(R-1)*(b[N]-1)}).map(function(R){return R-1}),k=E.map(function(R){return Math.floor(R/2)}),_=E.map(function(R,N){return R-k[N]});return E.map(function(R,N){return[k[N],_[N]]})}([c.filterHeight,c.filterWidth],d):[[0,0],[0,0]];var f=d[0]===1&&d[1]===1,h=function(w,b,E){var k=E.map(function(F){return F[0]}),_=E.map(function(F){return F[1]}),R=w.concat(k,_),N=b.map(function(F,z){return(F-R[z]%F)%F}),D=_.map(function(F,z){return F+N[z]}),A=b.map(function(F,z){return[k[z],D[z]]}),j=b.map(function(F,z){return[0,N[z]]});return[A,j]}([c.inHeight,c.inWidth],d,l),p=h[0],v=h[1],g=f?r:"valid",m=f?s:JC(s,d,p),y=(n==="avg"?function(){return GE(m,t,i,1,g)}:function(){return HE(m,t,i,1,g)})(),x=f?y:XC(y,d,v);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),XL=M({maxPool3d_:function(e,t,n,r,o,i,a){i===void 0&&(i="NDHWC");var s=I(e,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),T(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),T(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),T(dn(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),o!=null&&T(ut(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=Gc(u.shape,t,n,a,r,o,i),d=O.runKernelFunc(function(f,h){var p=f.maxPool3d(u,c);return h([u,p]),p},{x:u},function(f,h){var p=h[0],v=h[1];return{x:function(){return function(g,m,y,x,w,b,E,k){var _=I(g,"dy","maxPool3dBackprop"),R=I(m,"input","maxPool3dBackprop"),N=I(y,"output","maxPool3dBackprop"),D=_,A=R,j=N,F=!1;R.rank===4&&(F=!0,D=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),A=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),j=N.as5D(1,N.shape[0],N.shape[1],N.shape[2],N.shape[3])),T(D.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+D.rank+"."}),T(A.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."}),T(j.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+j.rank+"."}),b==null&&(b=[1,1,1]),T(dn(w,b),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+b+"'"}),k!=null&&T(ut(E),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+k+" but got pad "+E+"."});var z=Gc(A.shape,x,w,b,E,k),B=O.runKernelFunc(function($){return $.maxPool3dBackprop(D,A,j,z)},{dy5D:D,input5D:A});return F?B.as4D(B.shape[1],B.shape[2],B.shape[3],B.shape[4]):B}(f,p,v,t,n,a,r,o)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),YL=M({avgPool3d_:function(e,t,n,r,o,i,a){i===void 0&&(i="NDHWC");var s=I(e,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),T(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),T(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),T(dn(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),o!=null&&T(ut(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var c=Gc(u.shape,t,n,a,r,o,i),d=O.runKernelFunc(function(f){return f.avgPool3d(u,c)},{x:u},function(f){return{x:function(){return function(h,p,v,g,m,y,x){var w=I(h,"dy","avgPool3dBackprop"),b=I(p,"input","avgPool3dBackprop"),E=w,k=b,_=!1;b.rank===4&&(_=!0,E=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),k=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),T(E.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+E.rank+"."}),T(k.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+k.rank+"."}),m==null&&(m=[1,1,1]),T(dn(g,m),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"}),x!=null&&T(ut(y),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+y+"."});var R=Gc(k.shape,v,g,m,y,x),N=O.runKernelFunc(function(D){return D.avgPool3dBackprop(E,k,R)},{dy5D:E,input5D:k});return _?N.as4D(N.shape[1],N.shape[2],N.shape[3],N.shape[4]):N}(f,u,t,n,a,r,o)}}});return d=d.cast(u.dtype),l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Dr=M({slice_:function(e,t,n){var r,o,i=I(e,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(u){T(u!==-1,function(){return"slice() does not support negative begin indexing."})}),o=(o=n==null?new Array(i.rank).fill(-1):typeof n=="number"?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(u,l){return u>=0?u:(T(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),i.shape[l]-r[l])}),S4(i,r,o);var a=i.shape,s={begin:r,size:o};return O.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],a[c]-r[c]-o[c]]);return{x:function(){return u.pad(l)}}},"Slice",s)}}),QL=M({slice1d_:function(e,t,n){var r=I(e,"x","slice1d");return T(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Dr(r,[t],[n])}}),JL=M({slice2d_:function(e,t,n){var r=I(e,"x","slice2d");return T(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Dr(r,t,n)}}),qE=M({slice3d_:function(e,t,n){var r=I(e,"x","slice3d");return T(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Dr(r,t,n)}}),ZL=M({slice4d_:function(e,t,n){var r=I(e,"x","slice4d");return T(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Dr(r,t,n)}});function KE(e,t,n,r,o){return t.rank<n.rank&&(t=t.reshape(cn(t.shape,r))),e.rank<n.rank&&(e=e.reshape(cn(e.shape,r))),{x:function(){var i=e.mul(n.equal(t).cast(e.dtype));return o==null?i:i.transpose(o)}}}var eB=M({all_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","all","bool"),o=wt(t,r.shape),i=o,a=Lr(i,r.rank);a!=null&&(r=r.transpose(a),i=Br(i.length,r.rank));var s=O.runKernelFunc(function(l){return l.all(r,i)},{$x:r});if(n){var u=cn(s.shape,o);return s.reshape(u)}return s}}),tB=M({any_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","any","bool"),o=wt(t,r.shape),i=o,a=Lr(i,r.rank);a!=null&&(r=r.transpose(a),i=Br(i.length,r.rank));var s=O.runKernelFunc(function(l){return l.any(r,i)},{$x:r});if(n){var u=cn(s.shape,o);return s.reshape(u)}return s}}),nB=M({argMax_:function(e,t){t===void 0&&(t=0);var n=I(e,"x","argMax");t==null&&(t=0);var r=wt(t,n.shape),o=Lr(r,n.rank);o!=null&&(n=n.transpose(o),r=Br(r.length,n.rank));var i={axis:r[0]},a=[n];return O.runKernelFunc(function(s,u){var l=s.argMax(n,r[0]);return u([n]),l},{x:n},function(s,u){var l=u[0];return{x:function(){return Re(l)}}},"ArgMax",i,a)}}),rB=M({argMin_:function(e,t){t===void 0&&(t=0);var n=I(e,"x","argMin");t==null&&(t=0);var r=wt(t,n.shape),o=Lr(r,n.rank);return o!=null&&(n=n.transpose(o),r=Br(r.length,n.rank)),O.runKernelFunc(function(i,a){var s=i.argMin(n,r[0]);return a([n]),s},{$x:n},function(i,a){var s=a[0];return{$x:function(){return Re(s)}}})}}),oB=M({logSumExp_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","logSumExp"),o=wt(t,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=cn(s.shape,o);return s.reshape(u)}return s}}),Ud=M({max_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","max"),o=r,i=wt(t,r.shape),a=i,s=Lr(a,r.rank);s!=null&&(r=r.transpose(s),a=Br(a.length,r.rank));var u=[r],l=O.runKernelFunc(function(d,f){var h=d.max(r,a);return f([o,h]),h},{x:r},function(d,f){return KE(d,f[1],f[0],i,s)},"Max",{axes:a},u,[!0]);if(n){var c=cn(l.shape,i);l=l.reshape(c)}return l}}),iB=M({mean_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","mean"),o=wt(t,r.shape),i=ae(Ot(r.shape,o)[1]);return Bd(function(a){var s=Z(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(t,n),gradFunc:function(u){var l=a.shape.slice();return o.forEach(function(c){l[c]=1}),u.reshape(l).mul(fs(a.shape,"float32")).div(i)}}})(r)}}),aB=M({min_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","min"),o=r,i=wt(t,r.shape),a=i,s=Lr(a,r.rank);s!=null&&(r=r.transpose(s),a=Br(a.length,r.rank));var u=[r],l=O.runKernelFunc(function(d,f){var h=d.min(r,a);return f([o,h]),h},{x:r},function(d,f){return KE(d,f[1],f[0],i,s)},"Min",{axes:a},u,[!0]);if(n){var c=cn(l.shape,i);l=l.reshape(c)}return l}}),sB=M({moments_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=wt(t,(e=I(e,"x","moments")).shape),o=e.mean(r,n),i=o.shape;n||(i=cn(o.shape,r));var a=e.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),XE=M({sum_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=wt(t,r.shape);return Bd(function(i){var a=Lr(o,i.rank),s=o,u=i;a!=null&&(u=i.transpose(a),s=Br(s.length,i.rank));var l=function(h){var p=i.shape.slice();return o.forEach(function(v){p[v]=1}),h.reshape(p).mul(fs(i.shape,"float32"))},c={axes:s},d=O.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return l(h)}}},"Sum",c);if(n){var f=cn(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:l}})(r)}}),uB=M({prod_:function(e,t,n){t===void 0&&(t=null),n===void 0&&(n=!1);var r=I(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=wt(t,r.shape),i=Lr(o,r.rank),a=o,s=r;i!=null&&(s=r.transpose(i),a=Br(a.length,r.rank));var u=O.runKernelFunc(function(c){return c.prod(s,a)},{permutedX:s});if(n){var l=cn(u.shape,o);u=u.reshape(l)}return u}}),YE=M({elu_:function(e){var t=I(e,"x","elu");return O.runKernelFunc(function(n,r){var o=n.elu(t);return r([o]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){return O.runKernelFunc(function(i){return i.eluDer(n,o)},{dy:n,y:o})}}})}}),lB=M({leakyRelu_:function(e,t){t===void 0&&(t=.2);var n=I(e,"x","leakyRelu");return Om(Z(t).mul(n),n)}}),QE=M({prelu_:function(e,t){var n=I(e,"x","prelu"),r=I(t,"alpha","prelu");return O.runKernelFunc(function(o,i){var a=o.prelu(n,r);return i([n,r]),a},{x:n,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return Li(u,o,o.mul(s))},alpha:function(){var l=Li(u,Re(o),o.mul(a)),c=yt(s.shape,o.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),Ze=M({relu_:function(e){var t=I(e,"x","relu");return t.dtype==="bool"?t.toInt():O.runKernelFunc(function(n,r){var o=n.relu(t);return r([t]),o},{x:t},function(n,r){var o=r[0];return{x:function(){return n.mulStrict(o.step().toFloat())}}},"Relu")}}),JE=M({relu6_:function(e){var t=I(e,"x","relu6");return t.dtype==="bool"?t.toInt():O.runKernelFunc(function(n,r){var o=n.relu6(t);return r([t]),o},{x:t},function(n,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return n.mulStrict(i.toFloat())}}},"Relu6")}}),cB=M({selu_:function(e){var t=I(e,"x","selu");return O.runKernelFunc(function(n,r){var o=n.selu(t);return r([t]),o},{$x:t},function(n,r){var o=r[0];return{$x:function(){var i=o.greater(Z(0)),a=Z(Dm),s=Z(Mm),u=n.mul(s),l=n.mul(a).mul(o.toFloat().exp());return Li(i,u,l)}}})}}),Zo=M({transpose_:function(e,t){var n=I(e,"x","transpose");if(t==null&&(t=n.shape.map(function(o,i){return i}).reverse()),T(n.rank===t.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."}),t.forEach(function(o){T(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t})}),n.rank<=1)return n.clone();var r={perm:t};return O.runKernelFunc(function(o){return o.transpose(n,t)},{x:n},function(o){var i=Em(t);return{x:function(){return o.transpose(i)}}},"Transpose",r)}}),dB=M({localResponseNormalization_:function(e,t,n,r,o){t===void 0&&(t=5),n===void 0&&(n=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=I(e,"x","localResponseNormalization");T(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),T(ut(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var a=i,s=!1;i.rank===3&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=O.runKernelFunc(function(l,c){var d=l.localResponseNormalization4D(a,t,n,r,o);return c([a,d]),d},{x4D:a},function(l,c){var d=c[0],f=c[1];return{x4D:function(){return O.runKernelFunc(function(h){return h.LRNGrad(l,d,f,t,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),ZE=M({norm_:function(e,t,n,r){t===void 0&&(t="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var o=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(Z(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(e=I(e,"x","norm"),t,n),i=o.shape;if(r){var a=wt(n,e.shape);i=cn(o.shape,a)}return o.reshape(i)}}),fB=M({basicLSTMCell_:function(e,t,n,r,o,i){var a=I(e,"forgetBias","basicLSTMCell"),s=I(t,"lstmKernel","basicLSTMCell"),u=I(n,"lstmBias","basicLSTMCell"),l=I(r,"data","basicLSTMCell"),c=I(o,"c","basicLSTMCell"),d=I(i,"h","basicLSTMCell"),f=l.concat(d,1).matMul(s).add(u),h=f.shape[0],p=f.shape[1]/4,v=[h,p],g=f.slice([0,0],v),m=f.slice([0,p],v),y=f.slice([0,2*p],v),x=f.slice([0,3*p],v),w=g.sigmoid().mulStrict(m.tanh()).addStrict(c.mulStrict(a.add(y).sigmoid())),b=w.tanh().mulStrict(x.sigmoid());return[w,b]}}),hB=M({multiRNNCell_:function(e,t,n,r){for(var o=I(t,"data","multiRNNCell"),i=zc(n,"c","multiRNNCell"),a=zc(r,"h","multiRNNCell"),s=o,u=[],l=0;l<e.length;l++){var c=e[l](s,i[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var d=[],f=[];for(l=0;l<u.length;l+=2)d.push(u[l]),f.push(u[l+1]);return[d,f]}}),pB=M({movingAverage_:function(e,t,n,r,o){o===void 0&&(o=!0);var i=I(e,"v","movingAverage"),a=I(t,"x","movingAverage"),s=I(n,"decay","movingAverage");dM(i,a),T(St(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Z(1),l=u.sub(s),c=a.sub(i).mul(l);if(o){T(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=I(r,"step","movingAverage");c=c.div(u.sub(Yc(s,d)))}return i.add(c)}}),vB=M({stridedSlice_:function(e,t,n,r,o,i,a,s,u){if(o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(t.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=I(e,"x","stridedSlice"),c=Hy(s),d=l.shape.slice();c.forEach(function(g){t[g]=0,n[g]=1,d.splice(g,0,1)}),l=l.reshape(d);for(var f=0;f<l.rank;f++)t[f]=k4(o,t,r,l.shape,f),n[f]=_4(i,n,r,l.shape,f),r[f]=r[f]||1;var h=Hy(u);h.forEach(function(g){n[g]=t[g]+1,r[g]=1});var p=Rm(t,n,r),v=p.filter(function(g,m){return h.indexOf(m)===-1});return r.every(function(g){return g===1})?Dr(l,t,p).reshape(v):O.runKernelFunc(function(g){return g.stridedSlice(l,t,n,r)},{$x:l}).reshape(v)}}),mB=M({topk_:function(e,t,n){t===void 0&&(t=1),n===void 0&&(n=!0);var r=I(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=O.runKernelFunc(function(a){return a.topk(r,t,n)},{$x:r});return{values:i[0],indices:i[1]}}}),gB=M({scatterND_:function(e,t,n){var r=I(e,"indices","scatterND","int32"),o=I(t,"updates","scatterND");return E4(o,r,n),O.runKernelFunc(function(i){return i.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),zm=M({fft_:function(e){T(e.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return O.runKernelFunc(function(o){return o.fft(r)},{input:e}).reshape(e.shape)}}),Qc=M({ifft_:function(e){T(e.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var t=e.shape[e.shape.length-1],n=e.size/t,r=e.as2D(n,t);return O.runKernelFunc(function(o){return o.ifft(r)},{input:e}).reshape(e.shape)}}),Wm=M({rfft_:function(e,t){T(e.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+e.dtype});var n,r=e.shape[e.shape.length-1],o=e.size/r;if(t!=null&&t<r){var i=e.shape.map(function(m){return 0}),a=e.shape.map(function(m){return m});a[e.shape.length-1]=t,n=e.slice(i,a),r=t}else if(t!=null&&t>r){var s=e.shape.map(function(m){return m});s[e.shape.length-1]=t-r,n=e.concat(Ke(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),l=Rt(n,u).as2D(o,r),c=zm(l),d=Math.floor(r/2)+1,f=Bn(c),h=Sr(c),p=f.split([d,r-d],f.shape.length-1),v=h.split([d,r-d],h.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=d,Rt(p[0],v[0]).reshape(g)}}),eS=M({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),o=Qc(r);return Bn(o)}var i=[n,2*(t-1)],a=Bn(e).as2D(n,t),s=Sr(e).as2D(n,t),u=a.slice([0,1],[n,t-2]).reverse(1),l=s.slice([0,1],[n,t-2]).reverse(1).mul(Z(-1)),c=a.concat(u,1),d=s.concat(l,1);return r=Rt(c,d).as2D(i[0],i[1]),o=Qc(r),Bn(o)}}),yB=Object.freeze({fft:zm,ifft:Qc,rfft:Wm,irfft:eS}),xB=M({sparseToDense_:function(e,t,n,r){r===void 0&&(r=0);var o=I(e,"sparseIndices","sparseToDense","int32"),i=I(t,"sparseValues","sparseToDense"),a=I(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),O.runKernelFunc(function(s){return s.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),wB=M({gatherND_:function(e,t){var n=I(t,"indices","gatherND","int32"),r=I(e,"x","gatherND");return O.runKernelFunc(function(o){return o.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),bB=M({diag_:function(e){var t=I(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return O.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(n)}}),CB=M({dropout_:function(e,t,n,r){var o=I(e,"x","dropout");if(T(o.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),T(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return e instanceof Je?o.clone():o;var i=function(u,l){if(l==null)return u.shape.slice();if(St(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],d=0;d<u.shape.length;d++)l[d]==null&&u.shape[d]!=null?c.push(u.shape[d]):c.push(l[d]);return c}return l}(o,n),a=1-t,s=QC(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function tS(e,t,n){for(var r=1-e%2,o=new Float32Array(e),i=0;i<e;++i){var a=2*Math.PI*i/(e+r-1);o[i]=t-n*Math.cos(a)}return ct(o,"float32")}var $m=M({hannWindow_:function(e){return tS(e,.5,.5)}}),nS=M({hammingWindow_:function(e){return tS(e,.54,.46)}}),Um=M({frame_:function(e,t,n,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var i=0,a=[];i+t<=e.size;)a.push(Dr(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=mt([Dr(e,i,t-s),Tr([s],o)]);a.push(u),i+=n}return a.length===0?Vo([],[0,t]):mt(a).as2D(a.length,t)}}),rS=M({stft_:function(e,t,n,r,o){var i;o===void 0&&(o=$m),r==null&&(i=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=Um(e,t,n),s=$t(a,o(t)),u=[],l=0;l<a.shape[0];l++)u.push(Wm(s.slice([l,0],[1,t]),r));return mt(u)}}),EB=Object.freeze({hannWindow:$m,hammingWindow:nS,frame:Um,stft:rS}),Wt,SB=function(e,t,n){return n===void 0&&(n=1),oe(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,d,f,h,p,v,g;return ie(this,function(m){switch(m.label){case 0:return r=I(e,"predictions","inTopK"),o=I(t,"targets","inTopK"),T(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),T(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Fe(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],T(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return a=m.sent(),[4,o.data()];case 2:for(s=m.sent(),u=[a.length/i,i],c=u[1],d=mu("bool",l=u[0]),f=0;f<l;f++){for(h=f*c,p=a.subarray(h,h+c),v=[],g=0;g<p.length;g++)v.push({value:p[g],index:g});for(v.sort(function(y,x){return x.value-y.value}),d[f]=0,g=0;g<n;g++)if(v[g].index===s[f]){d[f]=1;break}}return e!==r&&r.dispose(),t!==o&&o.dispose(),[2,It(d,o.shape,"bool")]}})})};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Wt||(Wt={}));var kB=M({absoluteDifference_:function(e,t,n,r){r===void 0&&(r=Wt.SUM_BY_NONZERO_WEIGHTS);var o=I(e,"labels","absoluteDifference"),i=I(t,"predictions","absoluteDifference"),a=null;n!=null&&(a=I(n,"weights","absoluteDifference")),Fe(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return io(s,a,r)}}),io=M({computeWeightedLoss_:function(e,t,n){n===void 0&&(n=Wt.SUM_BY_NONZERO_WEIGHTS);var r=I(e,"losses","computeWeightedLoss"),o=null;t!=null&&(o=I(t,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(n===Wt.NONE)return i;if(n===Wt.SUM)return i.sum();if(n===Wt.MEAN){if(o==null)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(Z(a)):s}if(n===Wt.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(Z(r.size));var u=o.mul(fs(r.shape)).notEqual(Z(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),_B=M({cosineDistance_:function(e,t,n,r,o){o===void 0&&(o=Wt.SUM_BY_NONZERO_WEIGHTS);var i=I(e,"labels","cosineDistance"),a=I(t,"predictions","cosineDistance"),s=null;r!=null&&(s=I(r,"weights","cosineDistance")),Fe(i.shape,a.shape,"Error in cosineDistance: ");var u=Z(1).sub(i.mul(a).sum(n,!0));return io(u,s,o)}}),RB=M({hingeLoss_:function(e,t,n,r){r===void 0&&(r=Wt.SUM_BY_NONZERO_WEIGHTS);var o=I(e,"labels","hingeLoss"),i=I(t,"predictions","hingeLoss"),a=null;n!=null&&(a=I(n,"weights","hingeLoss")),Fe(o.shape,i.shape,"Error in hingeLoss: ");var s=Z(1);o=Z(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return io(u,a,r)}}),NB=M({huberLoss_:function(e,t,n,r,o){r===void 0&&(r=1),o===void 0&&(o=Wt.SUM_BY_NONZERO_WEIGHTS);var i=I(e,"labels","huberLoss"),a=I(t,"predictions","huberLoss"),s=null;n!=null&&(s=I(n,"weights","huberLoss")),Fe(i.shape,a.shape,"Error in huberLoss: ");var u=Z(r),l=a.sub(i).abs(),c=OE(l,u),d=l.sub(c),f=Z(.5).mul(c.square()).add(u.mul(d));return io(f,s,o)}}),IB=M({logLoss_:function(e,t,n,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Wt.SUM_BY_NONZERO_WEIGHTS);var i=I(e,"labels","logLoss"),a=I(t,"predictions","logLoss"),s=null;n!=null&&(s=I(n,"weights","logLoss")),Fe(i.shape,a.shape,"Error in logLoss: ");var u=Z(1),l=Z(r),c=i.mul(a.add(l).log()).neg().sub(u.sub(i).mul(u.sub(a).add(l).log()));return io(c,s,o)}}),TB=M({meanSquaredError_:function(e,t,n,r){r===void 0&&(r=Wt.SUM_BY_NONZERO_WEIGHTS);var o=I(e,"labels","meanSquaredError"),i=I(t,"predictions","meanSquaredError"),a=null;n!=null&&(a=I(n,"weights","meanSquaredError")),Fe(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return io(s,a,r)}}),AB=M({sigmoidCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Wt.SUM_BY_NONZERO_WEIGHTS);var i=I(e,"multiClassLabels","sigmoidCrossEntropy"),a=I(t,"logits","sigmoidCrossEntropy"),s=null;if(n!=null&&(s=I(n,"weights","sigmoidCrossEntropy")),Fe(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Z(r),l=Z(1),c=Z(.5);i=i.mul(l.sub(u)).add(c.mul(u))}var d=function(f,h){var p=I(f,"labels","sigmoidCrossEntropyWithLogits"),v=I(h,"logits","sigmoidCrossEntropyWithLogits");Fe(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=v.relu(),m=v.mul(p),y=v.abs().neg().exp().log1p();return g.sub(m).add(y)}(i,a);return io(d,s,o)}}),PB=M({softmaxCrossEntropy_:function(e,t,n,r,o){r===void 0&&(r=0),o===void 0&&(o=Wt.SUM_BY_NONZERO_WEIGHTS);var i=I(e,"onehotLabels","softmaxCrossEntropy"),a=I(t,"logits","softmaxCrossEntropy"),s=null;if(n!=null&&(s=I(n,"weights","softmaxCrossEntropy")),Fe(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Z(r),l=Z(1),c=Z(i.shape[1]);i=i.mul(l.sub(u)).add(u.div(c))}var d=function(f,h,p){if(p===void 0&&(p=-1),p===-1&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return Bd(function(v,g,m){var y=g.logSumExp([p],!0),x=g.toFloat().sub(y);return m([v,x]),{value:x.mul(v).neg().sum([p]),gradFunc:function(w,b){var E=b[0],k=b[1],_=cn(w.shape,[p]);return[w.reshape(_).mul(E.toFloat().sub(k.exp())),w.reshape(_).mul(k.exp().sub(E.toFloat()))]}}})(f,h)}(i,a);return io(d,s,o)}}),DB=Object.freeze({get Reduction(){return Wt},absoluteDifference:kB,computeWeightedLoss:io,cosineDistance:_B,hingeLoss:RB,huberLoss:NB,logLoss:IB,meanSquaredError:TB,sigmoidCrossEntropy:AB,softmaxCrossEntropy:PB});function h1(e,t){return t===void 0&&(t=!1),O.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],o=YC(n),i=e.clone(),a=Vo([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(d){var f,h=i,p=s,v=o;f=O.tidy(function(){var g=i.slice([d,d],[n-d,1]),m=g.norm(),y=i.slice([d,d],[1,1]),x=Vo([[-1]]).where(y.greater(0),Vo([[1]])),w=y.sub(x.mul(m)),b=g.div(w);s=b.shape[0]===1?a.clone():a.concat(b.slice([1,0],[b.shape[0]-1,b.shape[1]]),0);var E=x.matMul(w).div(m).neg(),k=i.slice([d,0],[n-d,r]),_=E.mul(s);if(d===0)i=k.sub(_.matMul(s.transpose().matMul(k)));else{var R=k.sub(_.matMul(s.transpose().matMul(k)));i=i.slice([0,0],[d,r]).concat(R,0)}var N=o.slice([0,d],[n,o.shape[1]-d]);if(d===0)o=N.sub(N.matMul(s).matMul(_.transpose()));else{var D=N.sub(N.matMul(s).matMul(_.transpose()));o=o.slice([0,0],[n,d]).concat(D,1)}return[s,i,o]}),s=f[0],i=f[1],o=f[2],ln([h,p,v])},c=0;c<u;++c)l(c);return!t&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var MB=M({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=I(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(t<=a))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=a),n<0&&(n=s);var u=Wc(0,a,1,"int32").reshape([-1,1]),l=Wc(0,s,1,"int32"),c=xt(u,l),d=zd(c.lessEqual(Z(+t,"int32")),c.greaterEqual(Z(-n,"int32"))),f=Ke([a,s],r.dtype);return Rn(gt(r.reshape([-1,a,s])).map(function(h){return Li(d,h,f)})).reshape(o)}}),FB=M({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,T(e!=null&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=e[0].shape[0],r=function(u){T(e[u].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[u].shape[0]+" vs. "+n+")"})},o=1;o<e.length;++o)r(o)}else t=!0,e=km(e,e.shape[0],0).map(function(u){return ZC(u,[0])});T(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var i=[],a=e,s=function(u){i.push(O.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var d=XE(i[c].mulStrict(l)).mul(i[c]);l=l.sub(d)}return l.div(ZE(l,"euclidean"))}))};for(o=0;o<e.length;++o)s(o);return t?Rn(i,0):i}}),OB=M({qr_:function(e,t){if(t===void 0&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return h1(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce(function(a,s){return a*s}),r=gt(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=h1(a,t),u=s[0],l=s[1];o.push(u),i.push(l)}),[Rn(o,0).reshape(e.shape),Rn(i,0).reshape(e.shape)]}}),LB=Object.freeze({bandPart:MB,gramSchmidt:FB,qr:OB});function Vd(e,t,n,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var a=e.shape[0];return n=Math.min(n,a),T(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),T(e.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),T(e.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),T(t.rank===1,function(){return"scores must be a 1D tensor"}),T(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),T(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var BB=M({resizeBilinear_:function(e,t,n){n===void 0&&(n=!1);var r=I(e,"images","resizeBilinear");T(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=O.runKernelFunc(function(l,c){return c([o]),l.resizeBilinear(o,a,s,n)},{x:o},function(l,c){return{x:function(){return O.runKernelFunc(function(d){return d.resizeBilinearBackprop(l,c[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),jB=M({resizeNearestNeighbor_:function(e,t,n){n===void 0&&(n=!1);var r=I(e,"images","resizeNearestNeighbor");T(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),T(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=O.runKernelFunc(function(l,c){return c([o]),l.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(l,c){return{batchImages:function(){return O.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(l,c[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),zB=M({nonMaxSuppression_:function(e,t,n,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=I(e,"boxes","nonMaxSuppression"),a=I(t,"scores","nonMaxSuppression"),s=Vd(i,a,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return O.runKernelFunc(function(l){return l.nonMaxSuppression(i,a,n,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),WB=function(e,t,n,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),oe(this,void 0,void 0,function(){var i,a,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return i=I(e,"boxes","nonMaxSuppressionAsync"),a=I(t,"scores","nonMaxSuppressionAsync"),s=Vd(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],d=Im(l,c,n,r,o),i!==e&&i.dispose(),a!==t&&a.dispose(),[2,d]}})})},$B=M({nonMaxSuppressionWithScore_:function(e,t,n,r,o,i){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var a=I(e,"boxes","nonMaxSuppression"),s=I(t,"scores","nonMaxSuppression"),u=Vd(a,s,n,r,o,i),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},c=O.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),UB=function(e,t,n,r,o,i){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),oe(this,void 0,void 0,function(){var a,s,u,l,c,d,f;return ie(this,function(h){switch(h.label){case 0:return a=I(e,"boxes","nonMaxSuppressionAsync"),s=I(t,"scores","nonMaxSuppressionAsync"),u=Vd(a,s,n,r,o,i),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=h.sent(),c=l[0],d=l[1],f=Tm(c,d,n,r,o,i),a!==e&&a.dispose(),s!==t&&s.dispose(),[2,f]}})})},VB=M({cropAndResize_:function(e,t,n,r,o,i){var a=I(e,"image","cropAndResize"),s=I(t,"boxes","cropAndResize","float32"),u=I(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var l=s.shape[0];return T(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),T(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),T(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),T(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),T(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),T(o==="bilinear"||o==="nearest",function(){return"method must be bilinear or nearest, but was "+o}),O.runKernelFunc(function(c,d){return c.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Vm=Object.freeze({resizeBilinear:BB,resizeNearestNeighbor:jB,nonMaxSuppression:zB,nonMaxSuppressionAsync:WB,nonMaxSuppressionWithScore:$B,nonMaxSuppressionWithScoreAsync:UB,cropAndResize:VB}),Hm=function(e,t){return!(e>0)||t==="linear"},Gm=function(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},qm=function(e,t){var n=t,r=yt(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Km=function(e,t,n){if(t==="linear")return e;if(t==="relu")return Ze(e);if(t==="elu")return YE(e);if(t==="relu6")return JE(e);if(t==="prelu")return QE(e,n);throw new Error("Unknown fused activation "+t+".")},HB=M({fusedMatMul_:function(e){var t,n=e.a,r=e.b,o=e.transposeA,i=o!==void 0&&o,a=e.transposeB,s=a!==void 0&&a,u=e.bias,l=e.activation,c=l===void 0?"linear":l,d=e.preluActivationWeights;if(Hm(O.state.gradientDepth,c)===!1){var f=$d(n,r,i,s);return u!=null&&(f=Ee(f,u)),Km(f,c,d)}var h=I(n,"a","fused matMul"),p=I(r,"b","fused matMul");t=nt(h,p),h=t[0],p=t[1];var v=i?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],m=i?h.shape[h.rank-1]:h.shape[h.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=h.shape.slice(0,-2),w=p.shape.slice(0,-2),b=ae(x),E=ae(w);T(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),T(St(x,w),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+w+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),T(v===g,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+g+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var k,_,R=h.shape.slice(0,-2).concat([m,y]),N=i?h.as3D(b,v,m):h.as3D(b,m,v),D=s?p.as3D(E,y,g):p.as3D(E,g,y);u!=null&&Se(R,(k=nt(k=I(u,"bias","fused matMul"),h)[0]).shape),d!=null&&(_=I(d,"prelu weights","fused matMul"));var A={a:N,b:D};u!=null&&(A.bias=k),d!=null&&(A.preluActivationWeights=_);var j=[N,D];return O.runKernelFunc(function(F,z){var B=F.fusedBatchMatMul({a:N,b:D,transposeA:i,transposeB:s,bias:k,activation:c,preluActivationWeights:_});return z([N,D,B]),B},A,function(F,z){var B=z[0],$=z[1],P=z[2],L=Gm(F,P,c),W={};return u!=null&&(W={bias:function(){return qm(k,L)}}),Object.assign(i||s?!i&&s?{a:function(){return L.matMul($,!1,!1)},b:function(){return L.matMul(B,!0,!1)}}:i&&!s?{a:function(){return $.matMul(L,!1,!0)},b:function(){return B.matMul(L,!1,!1)}}:{a:function(){return $.matMul(L,!0,!0)},b:function(){return L.matMul(B,!0,!0)}}:{a:function(){return L.matMul($,!1,!0)},b:function(){return B.matMul(L,!0,!1)}},W)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:c},j,[!0]).reshape(R)}}),GB=M({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,d=e.activation,f=d===void 0?"linear":d,h=e.preluActivationWeights;if(f=f||"linear",Hm(O.state.gradientDepth,f)===!1){var p=Vn(t,n,r,o,a,u,l);return c!=null&&(p=Ee(p,c)),Km(p,f,h)}var v=I(t,"x","conv2d"),g=I(n,"filter","conv2d"),m=v,y=!1;v.rank===3&&(y=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),T(m.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),T(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),l!=null&&T(ut(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+o+"."}),T(m.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),T(dn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),T(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var x,w,b=Vi(m.shape,g.shape,r,u,o,l);c!=null&&(x=nt(x=I(c,"bias","fused conv2d"),v)[0],Se(b.outShape,x.shape)),h!=null&&(w=I(h,"prelu weights","fused conv2d"));var E={x:m,filter:g};c!=null&&(E.bias=x),h!=null&&(E.preluActivationWeights=w);var k=[g,m],_=O.runKernelFunc(function(R,N){var D=R.fusedConv2d({input:m,filter:g,convInfo:b,bias:x,activation:f,preluActivationWeights:w});return N([g,m,D]),D},E,function(R,N){var D=N,A=D[0],j=D[1],F=D[2],z=Gm(R,F,f);T(ns(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var B={};return c!=null&&(B={bias:function(){return qm(x,z)}}),Object.assign({x:function(){return $E(j.shape,z,A,r,o)},filter:function(){return Bm(j,z,A.shape,r,o)}},B)},"FusedConv2D",{convInfo:b,activation:f},k,[!0]);return y?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),qB=M({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,l=e.dimRoundingMode,c=e.bias,d=e.activation,f=d===void 0?"linear":d,h=e.preluActivationWeights;if(Hm(O.state.gradientDepth,f)===!1){var p=Wd(t,n,r,o,a,u,l);return c!=null&&(p=Ee(p,c)),Km(p,f,h)}var v=I(t,"x","depthwiseConv2d"),g=I(n,"filter","depthwiseConv2d"),m=v,y=!1;v.rank===3&&(y=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),T(m.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),T(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),T(m.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),u==null&&(u=[1,1]),T(dn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&T(ut(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+o+"."});var x,w,b=Vi(m.shape,g.shape,r,u,o,l,!0);c!=null&&(x=nt(x=I(c,"bias","fused conv2d"),v)[0],Se(b.outShape,x.shape)),h!=null&&(w=I(h,"prelu weights","fused depthwiseConv2d"));var E={x:m,filter:g};c!=null&&(E.bias=x),h!=null&&(E.preluActivationWeights=w);var k=[g,m],_=O.runKernelFunc(function(R,N){var D=R.fusedDepthwiseConv2D({input:m,filter:g,convInfo:b,bias:x,activation:f,preluActivationWeights:w});return N([g,m,D]),D},E,function(R,N){T(ns(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var D=N[0],A=N[1],j=N[2],F=Gm(R,j,f),z={};return c!=null&&(z={bias:function(){return qm(x,F)}}),Object.assign({x:function(){return UE(A.shape,F,D,b)},filter:function(){return VE(A,F,D.shape,b)}},z)},"FusedDepthwiseConv2D",{convInfo:b,activation:f},k,[!0]);return y?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),KB=Object.freeze({matMul:HB,conv2d:GB,depthwiseConv2d:qB}),XB=Object.freeze({image:Vm,linalg:LB,losses:DB,spectral:yB,fused:KB,signal:EB,square:IO,squaredDifference:_E,conv1d:BL,conv2d:Vn,conv3d:jL,depthwiseConv2d:Wd,separableConv2d:jm,conv2dTranspose:zL,conv3dTranspose:WL,op:M,batchNormalization2d:iL,batchNormalization3d:aL,batchNormalization4d:sL,batchNormalization:uL,batchNorm:PE,batchNorm2d:lL,batchNorm3d:cL,batchNorm4d:dL,booleanMaskAsync:LL,complex:Rt,real:Bn,imag:Sr,concat:mt,concat1d:KM,concat2d:XM,concat3d:YM,concat4d:QM,split:km,matMul:$d,dot:$L,outerProduct:UL,reverse:Hu,reverse1d:VL,reverse2d:HL,reverse3d:GL,reverse4d:qL,maxPool:bt,avgPool:Gu,pool:KL,maxPool3d:XL,avgPool3d:YL,slice:Dr,slice1d:QL,slice2d:JL,slice3d:qE,slice4d:ZL,abs:TO,acos:AO,acosh:PO,asin:DO,asinh:MO,atan:FO,atanh:OO,ceil:LO,clipByValue:Fm,cos:BO,cosh:jO,erf:zO,exp:Vp,expm1:WO,floor:$O,log:UO,log1p:VO,logSigmoid:HO,neg:Xc,reciprocal:GO,round:qO,rsqrt:RE,sigmoid:NE,sign:KO,isNaN:XO,isInf:YO,isFinite:QO,sin:JO,sinh:ZO,softplus:eL,sqrt:tL,step:nL,tan:rL,tanh:oL,all:eB,any:tB,argMax:nB,argMin:rB,logSumExp:oB,max:Ud,mean:iB,min:aB,moments:sB,sum:XE,prod:uB,equal:LE,equalStrict:RL,greater:NL,greaterEqual:BE,greaterEqualStrict:IL,greaterStrict:TL,less:AL,lessEqual:PL,lessEqualStrict:DL,lessStrict:ML,notEqual:FL,notEqualStrict:OL,add:Ee,addN:pL,addStrict:vL,atan2:mL,div:Jn,divNoNan:gL,divStrict:yL,floorDiv:FE,maximum:Om,maximumStrict:xL,minimum:OE,minimumStrict:wL,mod:bL,modStrict:CL,mul:$t,mulStrict:EL,pow:Yc,powStrict:SL,squaredDifferenceStrict:kL,sub:xt,subStrict:_L,elu:YE,leakyRelu:lB,prelu:QE,relu:Ze,relu6:JE,selu:cB,logicalAnd:zd,logicalNot:fL,logicalOr:DE,logicalXor:hL,where:Li,whereAsync:ME,buffer:ve,print:a4,batchToSpaceND:XC,broadcastTo:s4,cast:u4,clone:l4,cumsum:c4,depthToSpace:d4,expandDims:Ln,eye:YC,multinomial:f4,oneHot:zp,pad:Ui,pad1d:h4,pad2d:p4,pad3d:v4,pad4d:m4,rand:g4,randomNormal:y4,randomGamma:x4,randomUniform:QC,reshape:Zn,spaceToBatchND:JC,squeeze:ZC,stack:Rn,tile:Na,truncatedNormal:w4,unstack:gt,setdiff1dAsync:b4,fill:Tr,linspace:qM,ones:fs,range:Wc,scalar:Z,tensor:It,tensor1d:ct,tensor2d:Vo,tensor3d:Sm,tensor4d:nn,tensor5d:VM,tensor6d:HM,variable:GM,zeros:Ke,onesLike:KC,zerosLike:Re,transpose:Zo,softmax:oo,logSoftmax:N4,localResponseNormalization:dB,norm:ZE,gather:Lm,unsortedSegmentSum:jE,basicLSTMCell:fB,multiRNNCell:hB,movingAverage:pB,stridedSlice:vB,topk:mB,scatterND:gB,fft:zm,ifft:Qc,rfft:Wm,irfft:eS,sparseToDense:xB,gatherND:wB,diag:bB,dropout:CB,hannWindow:$m,hammingWindow:nS,frame:Um,stft:rS,inTopKAsync:SB});function X(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(n){n!=null&&T(n.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function ch(e,t,n,r){if(n==="linear")return e.linear(t);if(n==="relu")return e.relu(t);if(n==="elu")return e.elu(t);if(n==="relu6")return e.relu6(t);if(n==="prelu")return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var YB=function(e){function t(){var n=e.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new aE(n,O),n}return sr(t,e),t.prototype.write=function(n,r,o){this.firstUse&&(this.firstUse=!1,G().get("IS_NODE")&&jc(`
============================
Hi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:n,dtype:o}),i},t.prototype.move=function(n,r,o,i){this.data.set(n,{values:r,dtype:i})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){return[2,this.readSync(n)]})})},t.prototype.readSync=function(n){var r=this.data.get(n),o=r.dtype,i=r.complexTensors;return o==="complex64"?Up(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(n).values},t.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),o=r;if(n.dtype==="string")try{o=r.map(function(i){return Oc(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ve(n.shape,n.dtype,o)},t.prototype.makeOutput=function(n,r,o){var i=this.write(n,r,o);return O.makeTensorFromDataId(i,r,o,this)},t.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},t.prototype.time=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){return r=wr(),n(),[2,{kernelMs:wr()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(n,r){var o=this.makeOutput(null,n.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:O.keep(n.clone()),imag:O.keep(r.clone())},o},t.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},t.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},t.prototype.slice=function(n,r,o){if(X(n,"slice"),oE(n.shape,r,o)){var i=iE(r,n.strides),a=ae(o);return It(this.readSync(n.dataId).subarray(i,i+a),o,n.dtype)}for(var s=ve(o,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(d,f){return d+r[f]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},t.prototype.stridedSlice=function(n,r,o,i){X(n,"stridedSlice");var a=Rm(r,o,i);if(a.some(function(h){return h===0}))return It([],a);for(var s=ve(a,n.dtype),u=this.bufferSync(n),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),d=new Array(c.length),f=0;f<d.length;f++)d[f]=c[f]*i[f]+r[f];s.set.apply(s,[u.get.apply(u,d)].concat(c))}return s.toTensor()},t.prototype.diag=function(n){for(var r=this.readSync(n.dataId),o=ve([n.size,n.size],n.dtype),i=o.values,a=0;a<r.length;a++)i[a*n.size+a]=r[a];return o.toTensor()},t.prototype.unstack=function(n,r){for(var o=n.shape[r],i=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(i[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(o);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(i);return c},t.prototype.reverse=function(n,r){X(n,"reverse");for(var o=ve(n.shape,n.dtype),i=this.bufferSync(n),a=function(u){var l=o.indexToLoc(u),c=l.slice();r.forEach(function(d){return c[d]=n.shape[d]-1-c[d]}),o.set.apply(o,[i.get.apply(i,c)].concat(l))},s=0;s<o.size;s++)a(s);return o.toTensor()},t.prototype.concat=function(n,r){var o=this;if(n[0].dtype==="complex64"){var i=n.map(function(h){return Bn(h)}),a=n.map(function(h){return Sr(h)});return Rt(this.concat(i,r),this.concat(a,r))}var s=n.map(function(h){var p=ae(h.shape.slice(r));return h.as2D(-1,p)}),u=ts(s.map(function(h){return h.shape}),1),l=ve(u,n[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(h){l.set(o.readSync(h.dataId),c),c+=h.size})}else{var d=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),v=0,g=0;g<h.shape[0];++g)for(var m=g*u[1]+d,y=0;y<h.shape[1];++y)l[m+y]=p[v++];d+=h.shape[1]})}var f=ts(n.map(function(h){return h.shape}),r);return It(l,f,n[0].dtype)},t.prototype.neg=function(n){return X(n,"neg"),this.multiply(Z(-1),n)},t.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(n,r,Nt(n.dtype,r.dtype),function(o,i){return o+i})},t.prototype.addN=function(n){var r=this;X(n,"addN");for(var o=n.map(function(c){return r.readSync(c.dataId)}),i=ve(n[0].shape,n[0].dtype),a=i.values,s=0;s<n.length;s++)for(var u=o[s],l=0;l<a.length;l++)a[l]+=u[l];return i.toTensor()},t.prototype.softmax=function(n,r){var o=wt([r],n.shape),i=this.max(n,o),a=cn(i.shape,o),s=this.subtract(n,i.reshape(a)),u=this.exp(s),l=this.sum(u,o).reshape(a);return this.realDivide(u,l)},t.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(n,r,Nt(n.dtype,r.dtype),function(o,i){return o-i})},t.prototype.pow=function(n,r){return X([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.pow(o,i)})},t.prototype.batchMatMul=function(n,r,o,i){X([n,r],"matMul");for(var a=o?n.shape[1]:n.shape[2],s=o?n.shape[2]:n.shape[1],u=i?r.shape[1]:r.shape[2],l=n.shape[0],c=this.readSync(n.dataId),d=this.readSync(r.dataId),f=o?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],h=f[0],p=f[1],v=f[2],g=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],m=g[0],y=g[1],x=g[2],w=s*u,b=ve([l,s,u],n.dtype),E=b.values,k=this.blockSize,_=0;_<l;_++)for(var R=0;R<s;R+=k)for(var N=0;N<u;N+=k)for(var D=0;D<a;D+=k)for(var A=Math.min(R+k,s),j=Math.min(N+k,u),F=Math.min(D+k,a),z=R;z<A;z++)for(var B=N;B<j;B++){for(var $=0,P=D;P<F;P++)$+=c[_*h+z*p+P*v]*d[P*m+B*y+_*x];E[_*w+(z*u+B)]+=$}return b.toTensor()},t.prototype.fusedBatchMatMul=function(n){var r=n.a,o=n.b,i=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=this.batchMatMul(r,o,i,a);return s&&(c=this.add(c,s)),u&&(c=ch(this,c,u,l)),c},t.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(n,r,Nt(n.dtype,r.dtype),function(o,i){return o*i})},t.prototype.realDivide=function(n,r){return X([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(o,i){return o/i})},t.prototype.floorDiv=function(n,r){return X([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(o,i){return Math.floor(o/i)})},t.prototype.sum=function(n,r){X(n,"sum"),yn("sum",r,n.rank);for(var o=Ot(n.shape,r),i=o[0],a=o[1],s=Ke(i,Nt(n.dtype,"int32")),u=ae(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=c[f+p];l[d]=h}return s},t.prototype.prod=function(n,r){X(n,"sum");for(var o=Ot(n.shape,r),i=o[0],a=o[1],s=Ke(i,Nt(n.dtype,"int32")),u=ae(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=c[f+p];l[d]=h}return s},t.prototype.unsortedSegmentSum=function(n,r,o){X(n,"unsortedSegmentSum");for(var i=[],a=n.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=Z(s,"int32"),l=LE(u,r).asType("float32").mul(n).sum(0);i.push(l)}return Rn(i)},t.prototype.argMin=function(n,r){X(n,"argMin");var o=[r];yn("argMin",o,n.rank);for(var i=Ot(n.shape,o),a=i[0],s=i[1],u=Ke(a,"int32"),l=ae(s),c=this.readSync(u.dataId),d=this.readSync(n.dataId),f=0;f<c.length;++f){for(var h=f*l,p=d[h],v=0,g=0;g<l;++g){var m=d[h+g];m<p&&(p=m,v=g)}c[f]=v}return u},t.prototype.argMax=function(n,r){X(n,"argMax");var o=[r];yn("argMax",o,n.rank);for(var i=Ot(n.shape,o),a=i[0],s=i[1],u=Ke(a,"int32"),l=ae(s),c=this.readSync(u.dataId),d=this.readSync(n.dataId),f=0;f<c.length;++f){for(var h=f*l,p=d[h],v=0,g=0;g<l;++g){var m=d[h+g];m>p&&(p=m,v=g)}c[f]=v}return u},t.prototype.cumsum=function(n,r,o,i){if(X(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var a=Nt(n.dtype,"int32"),s=Ke(n.shape,a),u=this.readSync(s.dataId),l=this.readSync(n.dataId),c=n.shape[n.rank-1],d=i?function(g,m){return g+c-m-1}:function(g,m){return g+m},f=0;f<l.length;f+=c)for(var h=0;h<c;h++){var p=d(f,h);if(h===0)u[p]=o?0:l[p];else{var v=d(f,h-1);u[p]=o?l[v]+u[v]:l[p]+u[v]}}return s},t.prototype.equal=function(n,r){return X([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o===i?1:0})},t.prototype.notEqual=function(n,r){return X([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o!==i?1:0})},t.prototype.less=function(n,r){return X([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o<i?1:0})},t.prototype.lessEqual=function(n,r){return X([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o<=i?1:0})},t.prototype.greater=function(n,r){return X([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o>i?1:0})},t.prototype.greaterEqual=function(n,r){return X([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o>=i?1:0})},t.prototype.logicalNot=function(n){X(n,"logicalNot");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,n.shape,"bool")},t.prototype.logicalAnd=function(n,r){return X([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o&&i})},t.prototype.logicalOr=function(n,r){return X([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(o,i){return o||i})},t.prototype.select=function(n,r,o){X([n,r,o],"select");for(var i=this.readSync(n.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Ke(r.shape,Nt(r.dtype,o.dtype)),l=this.readSync(u.dataId),c=0,d=n.rank===0||n.rank>1||r.rank===1?1:ae(r.shape.slice(1)),f=0;f<i.length;f++)for(var h=0;h<d;h++)i[f]===1?l[c++]=a[f]:l[c++]=s[f];return u},t.prototype.where=function(n){X([n],"where");var r=this.readSync(n.dataId);return Am(n.shape,r)},t.prototype.topk=function(n,r,o){return X(n,"topk"),pE(this.readSync(n.dataId),n.shape,n.dtype,r)},t.prototype.min=function(n,r){X(n,"min"),yn("min",r,n.rank);for(var o=Ot(n.shape,r),i=o[0],a=o[1],s=Ke(i,n.dtype),u=ae(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var v=c[f+p];v<h&&(h=v)}l[d]=h}return s},t.prototype.minimum=function(n,r){return X([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.min(o,i)})},t.prototype.mod=function(n,r){return X([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},t.prototype.max=function(n,r){X(n,"max"),yn("max",r,n.rank);for(var o=Ot(n.shape,r),i=o[0],a=o[1],s=Ke(i,n.dtype),u=ae(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var v=c[f+p];v>h&&(h=v)}l[d]=h}return s},t.prototype.maximum=function(n,r){return X([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.max(o,i)})},t.prototype.all=function(n,r){X(n,"all"),yn("all",r,n.rank);for(var o=Ot(n.shape,r),i=o[0],a=o[1],s=Ke(i,n.dtype),u=ae(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var v=c[f+p];h=h&&v}l[d]=h}return s},t.prototype.any=function(n,r){X(n,"any"),yn("any",r,n.rank);for(var o=Ot(n.shape,r),i=o[0],a=o[1],s=Ke(i,n.dtype),u=ae(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var f=d*u,h=c[f],p=0;p<u;++p){var v=c[f+p];h=h||v}l[d]=h}return s},t.prototype.squaredDifference=function(n,r){return X([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){var a=o-i;return a*a})},t.prototype.ceil=function(n){X(n,"ceil");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.floor=function(n){X(n,"floor");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.sign=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?o[i]=-1:r[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,n.shape,"float32")},t.prototype.isNaN=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isInf=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.isFinite=function(n){X(n,"x");for(var r=this.readSync(n.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,n.shape,"bool")},t.prototype.round=function(n){X(n,"round");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);r[i]-a<.5?o[i]=Math.floor(r[i]):r[i]-a>.5?o[i]=Math.ceil(r[i]):o[i]=a%2==0?a:a+1}return this.makeOutput(o,n.shape,"float32")},t.prototype.exp=function(n){X(n,"exp");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.expm1=function(n){X(n,"expm1");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,n.shape,"float32")},t.prototype.log=function(n){X(n,"log");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.log1p=function(n){X(n,"log1p");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log1p(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.sqrt=function(n){X(n,"sqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.sqrt(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.rsqrt=function(n){X(n,"rsqrt");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=1/Math.sqrt(a)}return this.makeOutput(o,n.shape,"float32")},t.prototype.reciprocal=function(n){X(n,"reciprocal");for(var r=this.readSync(n.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,n.shape,"float32")},t.prototype.linear=function(n){return n},t.prototype.relu=function(n){X(n,"relu");for(var r=Ke(n.shape,n.dtype),o=this.readSync(r.dataId),i=this.readSync(n.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},t.prototype.relu6=function(n){X(n,"relu");for(var r=Ke(n.shape,n.dtype),o=this.readSync(r.dataId),i=this.readSync(n.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},t.prototype.prelu=function(n,r){return X([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return o<0?i*o:o})},t.prototype.elu=function(n){X(n,"elu");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,n.shape,"float32")},t.prototype.eluDer=function(n,r){X([n,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(n.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},t.prototype.selu=function(n){X(n,"selu");for(var r=Dm,o=Mm,i=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(i,n.shape,"float32")},t.prototype.clip=function(n,r,o){X(n,"clip");for(var i=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,n.shape,"float32")},t.prototype.abs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<n.size;++i){var a=o[2*i],s=o[2*i+1];r[i]=Math.hypot(a,s)}return this.makeOutput(r,n.shape,"float32")},t.prototype.int=function(n){X(n,"int");for(var r=new Int32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,n.shape,"int32")},t.prototype.sigmoid=function(n){X(n,"sigmoid");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,n.shape,"float32")},t.prototype.softplus=function(n){X(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(n.size),i=this.readSync(n.dataId),a=0;a<i.length;++a){var s=i[a]>-r,u=i[a]<r,l=Math.exp(i[a]),c=void 0;c=u?l:s?i[a]:Math.log(1+l),o[a]=c}return this.makeOutput(o,n.shape,"float32")},t.prototype.sin=function(n){X(n,"sin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cos=function(n){X(n,"cos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tan=function(n){X(n,"tan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asin=function(n){X(n,"asin");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acos=function(n){X(n,"acos");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan=function(n){X(n,"atan");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atan2=function(n,r){return X([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(o,i){return Math.atan2(o,i)})},t.prototype.sinh=function(n){X(n,"sinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.cosh=function(n){X(n,"cosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.tanh=function(n){X(n,"tanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Q3(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.asinh=function(n){X(n,"asinh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.acosh=function(n){X(n,"acosh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.atanh=function(n){X(n,"atanh");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,n.shape,"float32")},t.prototype.erf=function(n){X(n,"erf");for(var r=new Float32Array(n.size),o=this.readSync(n.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,n.shape,"float32")},t.prototype.step=function(n,r){r===void 0&&(r=0),X(n,"step");for(var o=new Float32Array(n.size),i=this.readSync(n.dataId),a=0;a<i.length;++a){var s=i[a];isNaN(s)?o[a]=NaN:o[a]=s>0?1:r}return this.makeOutput(o,n.shape,"float32")},t.prototype.fusedConv2d=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.conv2d(r,o,i);return a&&(l=this.add(l,a)),s&&(l=ch(this,l,s,u)),l},t.prototype.conv2d=function(n,r,o){X([n,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,d=o.dataFormat==="channelsLast",f=ve(o.outShape,n.dtype),h=n.strides[0],p=d?n.strides[1]:n.strides[2],v=d?n.strides[2]:1,g=d?1:n.strides[1],m=f.strides[0],y=d?f.strides[1]:f.strides[2],x=d?f.strides[2]:1,w=d?1:f.strides[1],b=this.readSync(n.dataId),E=this.readSync(r.dataId),k=f.values,_=0;_<o.batchSize;++_)for(var R=_*h,N=_*m,D=0;D<o.outHeight;++D)for(var A=N+D*y,j=D*o.strideHeight-c,F=0;F<i;F++){var z=j+F*s;if(!(z<0||z>=o.inHeight))for(var B=F*r.strides[0],$=R+z*p,P=0;P<o.outWidth;++P)for(var L=A+P*x,W=P*o.strideWidth-l,H=0;H<a;H++){var q=W+H*u;if(!(q<0||q>=o.inWidth))for(var Q=$+q*v,re=B+H*r.strides[1],ce=0;ce<o.inChannels;++ce){for(var ee=b[Q+ce*g],de=0;de<o.outChannels;++de)k[L+de*w]+=ee*E[re+de];re+=o.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(n,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,l=o.dilationHeight,c=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,h=o.padInfo.top,p=ve(o.outShape,n.dtype),v=this.readSync(n.dataId),g=this.readSync(r.dataId),m=p.values,y=0;y<o.batchSize;++y)for(var x=y*n.strides[0],w=y*p.strides[0],b=0;b<o.outDepth;++b)for(var E=w+b*p.strides[1],k=b*o.strideDepth-d,_=0;_<i;_++){var R=k+_*u;if(!(R<0||R>=o.inDepth))for(var N=_*r.strides[0],D=x+R*n.strides[1],A=0;A<o.outHeight;++A)for(var j=E+A*p.strides[2],F=A*o.strideHeight-h,z=0;z<a;z++){var B=F+z*l;if(!(B<0||B>=o.inHeight))for(var $=N+z*r.strides[1],P=D+B*n.strides[2],L=0;L<o.outWidth;++L)for(var W=j+L*o.outChannels,H=L*o.strideWidth-f,q=0;q<s;q++){var Q=H+q*c;if(!(Q<0||Q>=o.inWidth))for(var re=$+q*r.strides[2],ce=P+Q*o.inChannels,ee=re,de=0;de<o.inChannels;++de){for(var pe=v[ce+de],me=0;me<o.outChannels;++me)m[W+me]+=pe*g[ee+me];ee+=o.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(n,r,o){X([n,r],"conv2dDerInput");for(var i=ve(o.inShape,"float32"),a=i.values,s=this.readSync(n.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],d=l[1],f=l[2],h=o.batchSize,p=o.filterHeight,v=o.filterWidth,g=o.inChannels,m=o.inHeight,y=o.inWidth,x=o.outChannels,w=o.outHeight,b=o.outWidth,E=o.strideHeight,k=o.strideWidth,_=o.dataFormat,R=p-1-o.padInfo.top,N=v-1-o.padInfo.left,D=_==="channelsLast",A=i.strides[0],j=D?i.strides[1]:i.strides[2],F=D?i.strides[2]:1,z=D?1:i.strides[1],B=n.strides[0],$=D?n.strides[1]:n.strides[2],P=D?n.strides[2]:1,L=D?1:n.strides[1],W=0;W<h;++W)for(var H=0;H<g;++H)for(var q=0;q<m;++q)for(var Q=q-R,re=Math.max(0,Math.ceil(Q/E)),ce=Math.min(w,(p+Q)/E),ee=0;ee<y;++ee){for(var de=ee-N,pe=Math.max(0,Math.ceil(de/k)),me=Math.min(b,(v+de)/k),De=0,we=re;we<ce;++we)for(var _e=we*E-Q,Ce=pe;Ce<me;++Ce)for(var Le=B*W+$*we+P*Ce,Be=c*(p-1-_e)+d*(v-1-(Ce*k-de))+f*H,Ie=0;Ie<x;++Ie)De+=s[Le+L*Ie]*u[Be+Ie];a[A*W+j*q+F*ee+z*H]=De}return i.toTensor()},t.prototype.conv3dDerInput=function(n,r,o){for(var i=ve(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],l=s[1],c=s[2],d=s[3],f=this.readSync(n.dataId),h=n.strides,p=h[0],v=h[1],g=h[2],m=h[3],y=this.readSync(r.dataId),x=r.strides,w=x[0],b=x[1],E=x[2],k=x[3],_=o.batchSize,R=o.filterDepth,N=o.filterHeight,D=o.filterWidth,A=o.inChannels,j=o.inDepth,F=o.inHeight,z=o.inWidth,B=o.outChannels,$=o.outDepth,P=o.outHeight,L=o.outWidth,W=o.strideDepth,H=o.strideHeight,q=o.strideWidth,Q=R-1-o.padInfo.front,re=N-1-o.padInfo.top,ce=D-1-o.padInfo.left,ee=0;ee<_;++ee)for(var de=0;de<A;++de)for(var pe=0;pe<j;++pe)for(var me=pe-Q,De=Math.max(0,Math.ceil(me/W)),we=Math.min($,(R+me)/W),_e=0;_e<F;++_e)for(var Ce=_e-re,Le=Math.max(0,Math.ceil(Ce/H)),Be=Math.min(P,(N+Ce)/H),Ie=0;Ie<z;++Ie){for(var Qt=Ie-ce,Jt=Math.max(0,Math.ceil(Qt/q)),Ae=Math.min(L,(D+Qt)/q),fn=0,Hn=De;Hn<we;++Hn)for(var lr=Hn*W-me,Zt=Le;Zt<Be;++Zt)for(var lo=Zt*H-Ce,Dn=Jt;Dn<Ae;++Dn)for(var ai=p*ee+v*Hn+g*Zt+m*Dn,hn=w*(R-1-lr)+b*(N-1-lo)+E*(D-1-(Dn*q-Qt))+k*de,pn=0;pn<B;++pn)fn+=f[ai+pn]*y[hn+pn];a[u*ee+l*pe+c*_e+d*Ie+de]=fn}return i.toTensor()},t.prototype.conv2dDerFilter=function(n,r,o){X([n,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dataFormat==="channelsLast",c=ve(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,h=this.bufferSync(n),p=this.bufferSync(r),v=0;v<s;++v)for(var g=Math.max(0,Math.ceil((f-v)/i)),m=Math.min(o.outHeight,(o.inHeight+f-v)/i),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((d-y)/a)),w=Math.min(o.outWidth,(o.inWidth+d-y)/a),b=0;b<o.inChannels;++b)for(var E=0;E<o.outChannels;++E){for(var k=0,_=0;_<o.batchSize;++_)for(var R=g;R<m;++R)for(var N=v+R*i-f,D=x;D<w;++D){var A=y+D*a-d;k+=l?h.get(_,N,A,b)*p.get(_,R,D,E):h.get(_,b,N,A)*p.get(_,E,R,D)}c.set(k,v,y,b,E)}return c.toTensor()},t.prototype.conv3dDerFilter=function(n,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,d=ve(o.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],v=h[1],g=h[2],m=h[3],y=this.readSync(r.dataId),x=r.strides,w=x[0],b=x[1],E=x[2],k=x[3],_=this.readSync(n.dataId),R=n.strides,N=R[0],D=R[1],A=R[2],j=R[3],F=o.padInfo.front,z=o.padInfo.left,B=o.padInfo.top,$=0;$<u;++$)for(var P=Math.max(0,Math.ceil((F-$)/i)),L=Math.min(o.outDepth,(o.inDepth+F-$)/i),W=$*p,H=0;H<l;++H)for(var q=Math.max(0,Math.ceil((B-H)/a)),Q=Math.min(o.outHeight,(o.inHeight+B-H)/a),re=H*v+W,ce=0;ce<c;++ce)for(var ee=Math.max(0,Math.ceil((z-ce)/s)),de=Math.min(o.outWidth,(o.inWidth+z-ce)/s),pe=ce*g+re,me=0;me<o.inChannels;++me)for(var De=me*m+pe,we=0;we<o.outChannels;++we){for(var _e=0,Ce=0;Ce<o.batchSize;++Ce)for(var Le=Ce*N,Be=Ce*w,Ie=P;Ie<L;++Ie)for(var Qt=($+Ie*i-F)*D+Le,Jt=Ie*b+Be,Ae=q;Ae<Q;++Ae)for(var fn=(H+Ae*a-B)*A+Qt,Hn=Ae*E+Jt,lr=ee;lr<de;++lr){var Zt=lr*k+Hn;_e+=_[(ce+lr*s-z)*j+fn+me]*y[Zt+we]}f[De+we]=_e}return d.toTensor()},t.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,o=n.filter,i=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.depthwiseConv2D(r,o,i);return a&&(l=this.add(l,a)),s&&(l=ch(this,l,s,u)),l},t.prototype.depthwiseConv2D=function(n,r,o){X([n,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,l=o.padInfo.left,c=o.padInfo.top,d=o.outChannels/o.inChannels,f=ve(o.outShape,n.dtype),h=this.readSync(n.dataId),p=this.readSync(r.dataId),v=f.values,g=0;g<o.batchSize;++g)for(var m=g*n.strides[0],y=g*f.strides[0],x=0;x<o.outHeight;++x)for(var w=y+x*f.strides[1],b=x*o.strideHeight-l,E=0;E<i;++E){var k=b+E*s;if(!(k<0||k>=o.inHeight))for(var _=E*r.strides[0],R=m+k*n.strides[1],N=0;N<o.outWidth;++N)for(var D=w+N*f.strides[2],A=N*o.strideWidth-c,j=0;j<a;++j){var F=A+j*u;if(!(F<0||F>=o.inWidth))for(var z=_+j*r.strides[1],B=R+F*o.inChannels,$=D,P=z,L=0;L<o.inChannels;++L){for(var W=h[B+L],H=0;H<d;++H)v[$+H]+=W*p[P+H];$+=d,P+=d}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(n,r,o){X([n,r],"depthwiseConv2DDerInput");for(var i=ve(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],l=s[1],c=s[2],d=this.readSync(n.dataId),f=n.strides,h=f[0],p=f[1],v=f[2],g=this.readSync(r.dataId),m=r.strides,y=m[0],x=m[1],w=m[2],b=o.batchSize,E=o.filterHeight,k=o.filterWidth,_=o.inChannels,R=o.inHeight,N=o.inWidth,D=o.outChannels,A=o.outHeight,j=o.outWidth,F=o.strideHeight,z=o.strideWidth,B=E-1-o.padInfo.top,$=k-1-o.padInfo.left,P=D/_,L=0;L<b;++L)for(var W=0;W<_;++W)for(var H=0;H<R;++H)for(var q=H-B,Q=Math.max(0,Math.ceil(q/F)),re=Math.min(A,(E+q)/F),ce=0;ce<N;++ce){for(var ee=ce-$,de=Math.max(0,Math.ceil(ee/z)),pe=Math.min(j,(k+ee)/z),me=0,De=Q;De<re;++De)for(var we=De*F-q,_e=de;_e<pe;++_e)for(var Ce=h*L+p*De+v*_e,Le=y*(E-1-we)+x*(k-1-(_e*z-ee))+w*W,Be=0;Be<P;++Be)me+=d[Ce+(W*P+Be)]*g[Le+Be];a[u*L+l*H+c*ce+W]=me}return i.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(n,r,o){X([n,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=ve(o.filterShape,"float32"),c=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,h=this.bufferSync(n),p=this.bufferSync(r),v=0;v<s;++v)for(var g=Math.max(0,Math.ceil((d-v)/i)),m=Math.min(o.outHeight,(o.inHeight+d-v)/i),y=0;y<u;++y)for(var x=Math.max(0,Math.ceil((c-y)/a)),w=Math.min(o.outWidth,(o.inWidth+c-y)/a),b=0;b<o.outChannels;++b){for(var E=Math.trunc(b/f),k=b%f,_=0,R=0;R<o.batchSize;++R)for(var N=g;N<m;++N)for(var D=v+N*i-d,A=x;A<w;++A){var j=y+A*a-c;_+=h.get(R,D,j,E)*p.get(R,N,A,b)}l.set(_,v,y,E,k)}return l.toTensor()},t.prototype.tile=function(n,r){return X(n,"tile"),hE(this.bufferSync(n),r)},t.prototype.pad=function(n,r,o){X(n,"pad");var i=r.map(function(f,h){return f[0]+n.shape[h]+f[1]}),a=r.map(function(f){return f[0]}),s=this.bufferSync(n),u=ve(i,n.dtype);o!==0&&u.values.fill(o);for(var l=0;l<n.size;l++){var c=s.indexToLoc(l),d=c.map(function(f,h){return f+a[h]});u.set.apply(u,[s.get.apply(s,c)].concat(d))}return u.toTensor()},t.prototype.transpose=function(n,r){X(n,"transpose");for(var o=new Array(n.rank),i=0;i<o.length;i++)o[i]=n.shape[r[i]];var a=this.readSync(n.dataId),s=ve(o,n.dtype),u=this.bufferSync(n);for(i=0;i<n.size;++i){for(var l=u.indexToLoc(i),c=new Array(l.length),d=0;d<c.length;d++)c[d]=l[r[d]];var f=s.locToIndex(c);s.values[f]=a[i]}return s.toTensor()},t.prototype.gather=function(n,r,o){X([n,r],"gather");var i=n.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=ve(i,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l),d=c.slice();d[o]=a[c[o]];var f=u.locToIndex(d);s.values[l]=u.values[f]}return s.toTensor()},t.prototype.batchToSpaceND=function(n,r,o){X([n],"batchToSpaceND");var i=r.reduce(function(d,f){return d*f}),a=$c(n.shape,r,i),s=Uc(a.length,r.length),u=Vc(n.shape,r,i),l=eE(o,r.length),c=tE(u,o,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(n,r,o){X([n],"spaceToBatchND");var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=$c(u.shape,r,i,!1),c=Uc(l.length,r.length,!1),d=Vc(u.shape,r,i,!1);return u.reshape(l).transpose(c).reshape(d)},t.prototype.pool=function(n,r,o){X(n,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(n.dataId),v=ve(r.outShape,n.dtype),g=v.values,m=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],x=r.outShape[3],w=0;w<r.batchSize;++w)for(var b=w*m,E=w*n.strides[0],k=0;k<r.inChannels;++k)for(var _=0;_<r.outHeight;++_)for(var R=_*i-d,N=Math.max(0,R),D=Math.min(r.inHeight,l+R),A=b+_*y,j=0;j<r.outWidth;++j){for(var F=j*a-f,z=Math.max(0,F),B=Math.min(r.inWidth,c+F),$=h,P=0,L=0,W=N;W<D;W+=s){for(var H=E+W*n.strides[1],q=z;q<B;q+=u){var Q=p[H+q*n.strides[2]+k];o==="max"&&Q>$?$=Q:o==="avg"&&(P+=Q,L++)}if(isNaN($))break}g[A+j*x+k]=o==="avg"?P/L:$}return v.toTensor()},t.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},t.prototype.maxPoolPositions=function(n,r){for(var o=ve(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(n),p=0;p<r.batchSize;++p)for(var v=0;v<r.inChannels;++v)for(var g=0;g<r.outHeight;++g){for(var m=g*i-d,y=m;y<0;)y+=s;for(var x=Math.min(r.inHeight,l+m),w=0;w<r.outWidth;++w){for(var b=w*a-f,E=b;E<0;)E+=u;for(var k=Math.min(r.inWidth,c+b),_=Number.NEGATIVE_INFINITY,R=-1,N=y;N<x;N+=s)for(var D=N-m,A=E;A<k;A+=u){var j=A-b,F=h.get(p,N,A,v);F>_&&(_=F,R=D*c+j)}o.set(R,p,g,w,v)}}return o.toTensor()},t.prototype.maxPoolBackprop=function(n,r,o,i){X([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,l=i.dilationHeight,c=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,v=ve(r.shape,"float32"),g=this.bufferSync(a),m=this.bufferSync(n),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var w=0;w<i.inHeight;++w)for(var b=0;b<i.inWidth;++b){for(var E=w-p,k=b-h,_=0,R=0;R<d;R+=l){var N=(E+R)/s;if(!(N<0||N>=i.outHeight||Math.floor(N)!==N))for(var D=0;D<f;D+=c){var A=(k+D)/u;if(!(A<0||A>=i.outWidth||Math.floor(A)!==A)){var j=d*f-1-g.get(y,N,A,x)===R*f+D?1:0;j!==0&&(_+=m.get(y,N,A,x)*j)}}}v.set(_,y,w,b,x)}return v.toTensor()},t.prototype.avgPoolBackprop=function(n,r,o){X([n,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,l=o.dilationHeight,c=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,v=ve(r.shape,"float32"),g=1/(s*u),m=this.bufferSync(n),y=0;y<o.batchSize;++y)for(var x=0;x<o.inChannels;++x)for(var w=0;w<o.inHeight;++w)for(var b=0;b<o.inWidth;++b){for(var E=w-p,k=b-h,_=0,R=0;R<d;R+=l){var N=(E+R)/i;if(!(N<0||N>=o.outHeight||Math.floor(N)!==N))for(var D=0;D<f;D+=c){var A=(k+D)/a;A<0||A>=o.outWidth||Math.floor(A)!==A||(_+=m.get(y,N,A,x))}}v.set(_*g,y,w,b,x)}return v.toTensor()},t.prototype.pool3d=function(n,r,o){X(n,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,y=this.readSync(n.dataId),x=ve(r.outShape,n.dtype),w=x.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],E=r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[3]*r.outShape[4],_=r.outShape[4],R=0;R<r.batchSize;++R)for(var N=R*b,D=R*n.strides[0],A=0;A<r.inChannels;++A)for(var j=0;j<r.outDepth;++j){for(var F=j*i-p,z=F;z<0;)z+=u;for(var B=Math.min(r.inDepth,d+F),$=N+j*E,P=0;P<r.outHeight;++P){for(var L=P*a-v,W=L;W<0;)W+=l;for(var H=Math.min(r.inHeight,f+L),q=$+P*k,Q=0;Q<r.outWidth;++Q){for(var re=Q*s-g,ce=re;ce<0;)ce+=c;for(var ee=Math.min(r.inWidth,h+re),de=q+Q*_,pe=m,me=0,De=0,we=z;we<B;we+=u){for(var _e=D+we*n.strides[1],Ce=W;Ce<H;Ce+=l){for(var Le=_e+Ce*n.strides[2],Be=ce;Be<ee;Be+=c){var Ie=y[Le+Be*n.strides[3]+A];if(o==="max"&&Ie>pe?pe=Ie:o==="avg"&&(me+=Ie,De++),isNaN(pe))break}if(isNaN(pe))break}if(isNaN(pe))break}w[de+A]=o==="avg"?me/De:pe}}}return x.toTensor()},t.prototype.avgPool3d=function(n,r){return X(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(n,r,o){X([n,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,l=o.filterHeight,c=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,v=o.effectiveFilterHeight,g=o.effectiveFilterWidth,m=p-1-o.padInfo.front,y=g-1-o.padInfo.left,x=v-1-o.padInfo.top,w=ve(r.shape,"float32"),b=1/(u*l*c),E=this.bufferSync(n),k=0;k<o.batchSize;++k)for(var _=0;_<o.inChannels;++_)for(var R=0;R<o.inDepth;++R)for(var N=0;N<o.inHeight;++N)for(var D=0;D<o.inWidth;++D){for(var A=R-m,j=N-x,F=D-y,z=0,B=0;B<p;B+=d){var $=(A+B)/i;if(!($<0||$>=o.outDepth||Math.floor($)!==$))for(var P=0;P<v;P+=f){var L=(j+P)/a;if(!(L<0||L>=o.outHeight||Math.floor(L)!==L))for(var W=0;W<g;W+=h){var H=(F+W)/s;H<0||H>=o.outWidth||Math.floor(H)!==H||(z+=E.get(k,$,L,H,_))}}}w.set(z*b,k,R,N,D,_)}return w.toTensor()},t.prototype.maxPool3d=function(n,r){return X(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(n,r){for(var o=ve(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m=this.bufferSync(n),y=0;y<r.batchSize;++y)for(var x=0;x<r.inChannels;++x)for(var w=0;w<r.outDepth;++w){for(var b=w*i-p,E=b;E<0;)E+=u;for(var k=Math.min(r.inDepth,d+b),_=0;_<r.outHeight;++_){for(var R=_*a-v,N=R;N<0;)N+=l;for(var D=Math.min(r.inHeight,f+R),A=0;A<r.outWidth;++A){for(var j=A*s-g,F=j;F<0;)F+=c;for(var z=Math.min(r.inWidth,h+j),B=Number.NEGATIVE_INFINITY,$=-1,P=E;P<k;P+=u)for(var L=P-b,W=N;W<D;W+=l)for(var H=W-R,q=F;q<z;q+=c){var Q=q-j,re=m.get(y,P,W,q,x);re>=B&&(B=re,$=L*f*h+H*f+Q)}o.set($,y,w,_,A,x)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(n,r,o,i){X([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,l=i.strideWidth,c=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,v=i.effectiveFilterWidth,g=h-1-i.padInfo.front,m=v-1-i.padInfo.left,y=p-1-i.padInfo.top,x=ve(r.shape,"float32"),w=this.bufferSync(a),b=this.bufferSync(n),E=0;E<i.batchSize;++E)for(var k=0;k<i.inChannels;++k)for(var _=0;_<i.inDepth;++_)for(var R=0;R<i.inHeight;++R)for(var N=0;N<i.inWidth;++N){for(var D=_-g,A=R-y,j=N-m,F=0,z=0;z<h;z+=c){var B=(D+z)/s;if(!(B<0||B>=i.outDepth||Math.floor(B)!==B))for(var $=0;$<p;$+=d){var P=(A+$)/u;if(!(P<0||P>=i.outHeight||Math.floor(P)!==P))for(var L=0;L<v;L+=f){var W=(j+L)/l;if(!(W<0||W>=i.outWidth||Math.floor(W)!==W)){var H=h*p*v-1-w.get(E,B,P,W,k)===z*p*v+$*v+L?1:0;H!==0&&(F+=b.get(E,B,P,W,k)*H)}}}}x.set(F,E,_,R,N,k)}return x.toTensor()},t.prototype.cast=function(n,r){return lE(n,r,this)},t.prototype.reshape=function(n,r){return $p(n,r)},t.prototype.avgPool=function(n,r){return X(n,"avgPool"),this.pool(n,r,"avg").toFloat()},t.prototype.resizeBilinear=function(n,r,o,i){X(n,"resizeBilinear");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],d=this.readSync(n.dataId),f=new Float32Array(ae([s,r,o,c])),h=[i&&r>1?u-1:u,i&&o>1?l-1:l],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=0,g=h[0]/p[0],m=h[1]/p[1],y=0;y<s;y++)for(var x=0;x<r;x++)for(var w=g*x,b=Math.floor(w),E=w-b,k=Math.min(u-1,Math.ceil(w)),_=y*n.strides[0]+b*n.strides[1],R=y*n.strides[0]+k*n.strides[1],N=0;N<o;N++)for(var D=m*N,A=Math.floor(D),j=D-A,F=Math.min(l-1,Math.ceil(D)),z=_+A*n.strides[2],B=R+A*n.strides[2],$=_+F*n.strides[2],P=R+F*n.strides[2],L=0;L<c;L++){var W=d[z+L],H=d[B+L],q=W+(d[$+L]-W)*j,Q=q+(H+(d[P+L]-H)*j-q)*E;f[v++]=Q}return It(f,[s,r,o,c])},t.prototype.resizeBilinearBackprop=function(n,r,o){X([n,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],l=i[3],c=n.shape,d=c[1],f=c[2],h=new Float32Array(a*s*u*l),p=[o&&d>1?s-1:s,o&&f>1?u-1:u],v=[o&&d>1?d-1:d,o&&f>1?f-1:f],g=p[0]/v[0],m=p[1]/v[1],y=this.readSync(n.dataId),x=0,w=0;w<a;w++)for(var b=w*r.strides[0],E=0;E<d;E++)for(var k=E*g,_=Math.floor(k),R=Math.min(Math.ceil(k),s-1),N=b+_*r.strides[1],D=b+R*r.strides[1],A=k-_,j=1-A,F=0;F<f;F++)for(var z=F*m,B=Math.floor(z),$=Math.min(Math.ceil(z),u-1),P=z-B,L=1-P,W=N+B*r.strides[2],H=N+$*r.strides[2],q=D+B*r.strides[2],Q=D+$*r.strides[2],re=j*L,ce=j*P,ee=A*L,de=A*P,pe=0;pe<l;pe++){var me=y[x++];h[W+pe]+=me*re,h[H+pe]+=me*ce,h[q+pe]+=me*ee,h[Q+pe]+=me*de}return nn(h,[a,u,s,l],r.dtype)},t.prototype.resizeNearestNeighbor=function(n,r,o,i){X(n,"resizeNearestNeighbor");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],d=this.readSync(n.dataId),f=new Float32Array(s*r*o*c),h=[i&&r>1?u-1:u,i&&o>1?l-1:l],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=h[0]/p[0],g=h[1]/p[1],m=0,y=0;y<s;y++)for(var x=y*n.strides[0],w=0;w<r;w++)for(var b=v*w,E=x+Math.min(u-1,i?Math.round(b):Math.floor(b))*n.strides[1],k=0;k<o;k++)for(var _=g*k,R=E+Math.min(l-1,i?Math.round(_):Math.floor(_))*n.strides[2],N=0;N<c;N++){var D=d[R+N];f[m++]=D}return It(f,[s,r,o,c],n.dtype)},t.prototype.resizeNearestNeighborBackprop=function(n,r,o){X([n,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],l=i[3],c=n.shape,d=c[1],f=c[2],h=new Float32Array(a*s*u*l),p=this.readSync(n.dataId),v=[o&&d>1?s-1:s,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],m=v[0]/g[0],y=v[1]/g[1],x=1/m,w=1/y,b=2*Math.ceil(x)+2,E=2*Math.ceil(w)+2,k=0;k<a;k++)for(var _=k*r.strides[0],R=0;R<s;R++)for(var N=_+R*r.strides[1],D=Math.floor(R*x),A=Math.floor(D-b/2),j=0;j<u;j++)for(var F=N+j*r.strides[2],z=Math.floor(j*w),B=Math.floor(z-E/2),$=0;$<l;$++){for(var P=0,L=0;L<b;L++){var W=L+A;if(!(W<0||W>=d)){var H=_+W*n.strides[1],q=W*m;if(R===Math.min(s-1,o?Math.round(q):Math.floor(q)))for(var Q=0;Q<E;Q++){var re=Q+B;if(!(re<0||re>=f)){var ce=H+re*n.strides[2],ee=re*y;j===Math.min(u-1,o?Math.round(ee):Math.floor(ee))&&(P+=p[ce+$])}}}}h[F+$]=P}return nn(h,r.shape,r.dtype)},t.prototype.batchNormalization=function(n,r,o,i,a,s){X([n,r,o,a,s],"batchNorm");for(var u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=this.readSync(o.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,v=d.length,g=c.length,m=l.length,y=0,x=0,w=0,b=0,E=0;E<u.length;++E)h[E]=f[y++]+(u[E]-l[x++])*d[w++]/Math.sqrt(c[b++]+i),y>=p&&(y=0),x>=m&&(x=0),w>=v&&(w=0),b>=g&&(b=0);return nn(h,n.shape)},t.prototype.localResponseNormalization4D=function(n,r,o,i,a){X(n,"localResponseNormalization4D");var s=n.shape[3],u=s-1,l=this.readSync(n.dataId),c=n.size,d=new Float32Array(c);function f(g){for(var m=g%s,y=g-m+Math.max(0,m-r),x=g-m+Math.min(m+r,u),w=0;y<=x;y++){var b=l[y];w+=b*b}return w}for(var h=0;h<c;h++){var p=f(h),v=l[h]*Math.pow(o+i*p,-a);d[h]=v}return nn(d,n.shape)},t.prototype.LRNGrad=function(n,r,o,i,a,s,u){X(n,"LRNGrad");for(var l=n.shape[3],c=this.readSync(n.dataId),d=this.readSync(r.dataId),f=this.readSync(o.dataId),h=new Float32Array(n.size),p=n.size,v=0;v<p;v++){for(var g=v%l,m=v-g+Math.max(0,g-i),y=v-g+Math.min(l,g+i+1),x=0,w=m;w<y;w++)x+=Math.pow(d[w],2);for(x=s*x+a,w=m;w<y;w++){var b=-2*s*u*d[w]*f[v]/x;v===w&&(b+=Math.pow(x,-u)),b*=c[v],h[w]+=b}}return nn(h,n.shape)},t.prototype.multinomial=function(n,r,o,i){X(n,"multinomial");for(var a=r?n:oo(n),s=a.shape[0],u=a.shape[1],l=Ke([s,o],"int32"),c=this.readSync(l.dataId),d=this.readSync(a.dataId),f=0;f<s;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var v=1;v<p.length;++v)p[v]=p[v-1]+d[h+v];for(var g=Ld(i.toString()),m=f*o,y=0;y<o;++y){var x=g();c[m+y]=p.length;for(var w=0;w<p.length;w++)if(x<p[w]){c[m+y]=w;break}}}return l},t.prototype.oneHot=function(n,r,o,i){X(n,"oneHot");var a=new Float32Array(n.size*r);a.fill(i);for(var s=this.readSync(n.dataId),u=0;u<n.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return Vo(a,[n.size,r],"int32")},t.prototype.nonMaxSuppression=function(n,r,o,i,a){return X(n,"nonMaxSuppression"),Im(this.readSync(n.dataId),this.readSync(r.dataId),o,i,a)},t.prototype.fft=function(n){return this.fftBatch(n,!1)},t.prototype.ifft=function(n){return this.fftBatch(n,!0)},t.prototype.fftBatch=function(n,r){for(var o=n.shape[0],i=n.shape[1],a=ve(n.shape,"float32"),s=ve(n.shape,"float32"),u=Bn(n).as2D(o,i),l=Sr(n).as2D(o,i),c=0;c<o;c++)for(var d=u.slice([c,0],[1,i]),f=l.slice([c,0],[1,i]),h=Rt(d,f),p=this.readSync(this.fftImpl(h,r).dataId),v=0;v<i;v++){var g=Gy(p,v);a.values[c*i+v]=g.real,s.values[c*i+v]=g.imag}return Rt(a.toTensor(),s.toTensor()).as2D(o,i)},t.prototype.fftImpl=function(n,r){var o=n.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(n.shape[0],n.shape[1]);return r&&(a=Rt(Bn(a).div(Z(i)),Sr(a).div(Z(i)))),a}var s=this.readSync(n.dataId),u=function(l){for(var c=new Float32Array(l.length/2),d=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],d[f/2]=l[f+1];return{real:c,imag:d}}(this.fourierTransformByMatmul(s,i,r));return Rt(u.real,u.imag).as2D(n.shape[0],n.shape[1])},t.prototype.isExponentOf2=function(n){return(n&n-1)==0},t.prototype.fftRadix2=function(n,r,o){if(r===1)return n;var i=this.readSync(n.dataId),a=r/2,s=function(m){for(var y=Math.ceil(m.length/4),x=new Float32Array(y),w=new Float32Array(y),b=0;b<m.length;b+=4)x[Math.floor(b/4)]=m[b],w[Math.floor(b/4)]=m[b+1];return{real:x,imag:w}}(i),u=Rt(s.real,s.imag).as1D(),l=function(m){for(var y=Math.floor(m.length/4),x=new Float32Array(y),w=new Float32Array(y),b=2;b<m.length;b+=4)x[Math.floor(b/4)]=m[b],w[Math.floor(b/4)]=m[b+1];return{real:x,imag:w}}(i),c=Rt(l.real,l.imag).as1D();u=this.fftRadix2(u,a,o),c=this.fftRadix2(c,a,o);var d=function(m,y){for(var x=new Float32Array(m/2),w=new Float32Array(m/2),b=0;b<Math.ceil(m/2);b++){var E=(y?2:-2)*Math.PI*(b/m);x[b]=Math.cos(E),w[b]=Math.sin(E)}return{real:x,imag:w}}(r,o),f=Rt(d.real,d.imag).mul(c),h=u.add(f),p=u.sub(f),v=Bn(h).concat(Bn(p)),g=Sr(h).concat(Sr(p));return Rt(v,g).as1D()},t.prototype.fourierTransformByMatmul=function(n,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,l=0;l<r;l++){var c=T4(a*l,r,o),d=Gy(n,l);s+=d.real*c.real-d.imag*c.imag,u+=d.real*c.imag+d.imag*c.real}o&&(s/=r,u/=r),I4(i,s,u,a)}return i},t.prototype.depthToSpace=function(n,r,o){T(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=n.shape[0],a=n.shape[1],s=n.shape[2],u=n.shape[3],l=a*r,c=s*r,d=u/(r*r),f=this.readSync(n.dataId),h=new Float32Array(i*l*c*d),p=0,v=0;v<i;++v)for(var g=0;g<l;++g)for(var m=Math.floor(g/r),y=g%r,x=0;x<c;++x)for(var w=Math.floor(x/r),b=(y*r+x%r)*d,E=0;E<d;++E){var k=E+b+u*(w+s*(m+a*v));h[p++]=f[k]}return nn(h,[i,l,c,d])},t.prototype.broadcastedBinaryOp=function(n,r,o,i){var a=Se(n.shape,r.shape),s=ve(a,o),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Po(n.shape,a),d=Po(r.shape,a),f=s.values;if(c.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=i(u[h%u.length],l[h%l.length]);else{var p=this.bufferSync(n),v=this.bufferSync(r),g=function(m){var y=s.indexToLoc(m),x=y.slice(-n.rank);c.forEach(function(k){return x[k]=0});var w=p.locToIndex(x),b=y.slice(-r.rank);d.forEach(function(k){return b[k]=0});var E=v.locToIndex(b);f[m]=i(u[w],l[E])};for(h=0;h<f.length;++h)g(h)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(n,r,o){var i=Se(n.shape,r.shape),a=ve(i,"float32"),s=ve(i,"float32"),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Po(n.shape,i),d=Po(r.shape,i),f=a.values,h=s.values;if(c.length+d.length===0)for(var p=0;p<f.length;p++){var v=p%u.length,g=p%l.length,m=o(u[2*v],u[2*v+1],l[2*g],l[2*g+1]);f[p]=m.real,h[p]=m.imag}else{var y=this.bufferSync(this.data.get(n.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(b){var E=a.indexToLoc(b),k=E.slice(-n.rank);c.forEach(function(A){return k[A]=0});var _=y.locToIndex(k),R=E.slice(-r.rank);d.forEach(function(A){return R[A]=0});var N=x.locToIndex(R),D=o(u[2*_],u[2*_+1],l[2*N],l[2*N+1]);f[b]=D.real,h[b]=D.imag};for(p=0;p<f.length;p++)w(p)}return this.complex(a.toTensor(),s.toTensor())},t.prototype.split=function(n,r,o){return fE(n,r,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(n,r,o,i,a,s){for(var u=n.shape,l=u[0],c=u[1],d=u[2],f=u[3],h=r.shape[0],p=i[0],v=i[1],g=ve([h,p,v,f],"float32"),m=this.readSync(r.dataId),y=this.readSync(o.dataId),x=this.readSync(n.dataId),w=n.strides,b=g.strides,E=0;E<h;E++){var k=4*E,_=m[k],R=m[k+1],N=m[k+2],D=m[k+3],A=y[E];if(!(A>=l))for(var j=p>1?(N-_)*(c-1)/(p-1):0,F=v>1?(D-R)*(d-1)/(v-1):0,z=0;z<p;z++){var B=p>1?_*(c-1)+z*j:.5*(_+N)*(c-1);if(B<0||B>c-1)for(var $=0;$<v;$++)for(var P=0;P<f;P++){var L=P+$*b[2]+z*b[1]+E*b[0];g.values[L]=s}else if(a==="bilinear"){var W=Math.floor(B),H=Math.ceil(B),q=B-W;for($=0;$<v;$++)if((we=v>1?R*(d-1)+$*F:.5*(R+D)*(d-1))<0||we>d-1)for(P=0;P<f;P++)L=P+$*b[2]+z*b[1]+E*b[0],g.values[L]=s;else{var Q=Math.floor(we),re=Math.ceil(we),ce=we-Q;for(P=0;P<f;P++){var ee=x[L=P+Q*w[2]+W*w[1]+A*w[0]],de=x[L=P+re*w[2]+W*w[1]+A*w[0]],pe=x[L=P+Q*w[2]+H*w[1]+A*w[0]],me=ee+(de-ee)*ce,De=pe+(x[L=P+re*w[2]+H*w[1]+A*w[0]]-pe)*ce;L=P+$*b[2]+z*b[1]+E*b[0],g.values[L]=me+(De-me)*q}}}else for($=0;$<v;++$){var we;if((we=v>1?R*(d-1)+$*F:.5*(R+D)*(d-1))<0||we>d-1)for(P=0;P<f;P++)L=P+$*b[2]+z*b[1]+E*b[0],g.values[L]=s;else{var _e=Math.round(we),Ce=Math.round(B);for(P=0;P<f;P++){var Le=P+_e*w[2]+Ce*w[1]+A*w[0],Be=P+$*b[2]+z*b[1]+E*b[0];g.values[Be]=x[Le]}}}}}return g.toTensor()},t.prototype.sparseToDense=function(n,r,o,i){var a=Hc(0,n,o),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,d=a.outputSize;return this.scatter(n,r,o,d,l,u,s,c,i,!1)},t.prototype.gatherND=function(n,r){var o=r.shape,i=o[o.length-1],a=nE(n,r),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return It([],s,n.dtype);for(var d=new gu([u,l],n.dtype),f=this.readSync(r.dataId),h=this.readSync(n.dataId),p=0;p<u;p++){for(var v=[],g=0,m=0;m<i;m++){var y=f[p*i+m];g+=y*c[m],v.push(y)}if(g<0||g>=n.size/l)throw new Error("Invalid indices: "+v+" does not index into "+n.shape);for(var x=0;x<l;x++)d.values[p*l+x]=h[g*l+x]}return d.toTensor().reshape(s)},t.prototype.scatterND=function(n,r,o){var i=Hc(0,n,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,l=i.strides,c=i.outputSize,d=Z(0);return this.scatter(n,r,o,c,u,s,a,l,d,!0)},t.prototype.fill=function(n,r,o){var i=Fc(o=o||zu(r),ae(n));return i.fill(r),O.makeTensor(i,n,o,this)},t.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},t.prototype.zerosLike=function(n){var r=Fc(n.dtype,ae(n.shape));return this.makeOutput(r,n.shape,n.dtype)},t.prototype.linspace=function(n,r,o){return cE(n,r,o)},t.prototype.scatter=function(n,r,o,i,a,s,u,l,c,d){var f=[i/a,a],h=this.readSync(n.dataId),p=this.readSync(r.dataId);if(i===0)return It([],o,r.dtype);var v=new gu(f,r.dtype);v.values.fill(this.readSync(c.dataId)[0]);for(var g=0;g<s;g++){for(var m=[],y=0,x=0;x<u;x++){var w=h[g*u+x];m.push(w),y+=w*l[x]}if(y<0||y>=i/a)throw new Error("Invalid indices: "+m+" does not index into "+o);for(var b=0;b<a;b++)d?v.values[y*a+b]+=p[g*a+b]:v.values[y*a+b]=r.rank===0?p[0]:p[g*a+b]}return v.toTensor().reshape(o)},t}(sE);O.registerBackend("cpu",function(){return new YB},1);for(var dh=0,p1=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,f=n;X(i,"NonMaxSuppressionWithScore");var h=Tm(f.data.get(i.dataId).values,f.data.get(a.dataId).values,u,l,c,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n;X(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:wu,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n;X([o,i],wu);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,l=function(f,h,p,v,g,m){var y=Se(f,h),x=y.length,w=Ir(y),b=mu(g,ae(y)),E=f.length,k=h.length,_=Ir(f),R=Ir(h),N=Po(f,y),D=Po(h,y);if(N.length+D.length===0)for(var A=0;A<b.length;++A)b[A]=m(p[A%p.length],v[A%v.length]);else{var j=function(F){var z=aM(F,x,w),B=z.slice(-E);N.forEach(function(W){return B[W]=0});var $=Ly(B,E,_),P=z.slice(-k);D.forEach(function(W){return P[W]=0});var L=Ly(P,k,R);b[F]=m(p[$],v[L])};for(A=0;A<b.length;++A)j(A)}return[b,y]}(o.shape,i.shape,s,u,o.dtype,function(f,h){var p=f-h;return p*p}),c=l[0],d=l[1];return{dataId:a.write(c,d,o.dtype),shape:d,dtype:o.dtype}}}];dh<p1.length;dh++)FC(p1[dh]);var Zi,QB=function(e){this.variableNames=["A"];var t=zt(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},JB=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=zt(),n=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(var fh=0,v1=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,o=t.pixels,i=r.numChannels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=u[0],c=u[1],d=[c,l],f=[c,l,i];(s||a)&&(Zi==null&&(Zi=document.createElement("canvas").getContext("2d")),Zi.canvas.width=l,Zi.canvas.height=c,Zi.drawImage(o,0,0,l,c),o=Zi.canvas);var h=n.makeTensorInfo(d,"int32");n.texData.get(h.dataId).usage=Cn.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),o);var p=G().getBool("WEBGL_PACK")?new JB(f):new QB(f),v=n.runWebGLProgram(p,[h],"int32");return n.disposeData(h.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;jc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,f=n,h=Tm(f.readSync(i.dataId),f.readSync(a.dataId),u,l,c,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,o=n,i=new xe(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:wu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,o=r.a,i=r.b,a=n,s=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new $r("return (a - b) * (a - b);",o.shape,i.shape):new rt("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];fh<v1.length;fh++)FC(v1[fh]);for(var hh=0,m1=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:wu,gradFunc:function(e,t){var n=t[0],r=t[1],o=Z(2);return{a:function(){return $t(e,$t(o,xt(n,r)))},b:function(){return $t(e,$t(o,xt(r,n)))}}}}];hh<m1.length;hh++)X3(m1[hh]);var ZB=function(){function e(){}return e.prototype.fetch=function(t,n){return fetch(t,n)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return new TextDecoder(n).decode(t)},e}();G().get("IS_BROWSER")&&G().setPlatform("browser",new ZB);var ph,ej=function(){return require("node-fetch")},tj=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(t,n){return G().global.fetch!=null?G().global.fetch(t,n):(ph==null&&(ph=ej()),ph(t,n))},e.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},e.prototype.encode=function(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(t)},e.prototype.decode=function(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)},e}();G().get("IS_NODE")&&G().setPlatform("node",new tj);var Hp={float32:4,int32:4,uint16:2,uint8:1,bool:1},Jc=4;function oS(e,t){for(var n={},r=0,o=function(s){var u=s.name,l=s.dtype,c=s.shape,d=ae(c),f=void 0;if("quantization"in s){var h=s.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Hp[h.dtype],v=e.slice(r,r+d*p),g=h.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(l==="float32")f=Float32Array.from(g,function(E){return E*h.scale+h.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(g,function(E){return Math.round(E*h.scale+h.min)})}r+=d*p}else if(l==="string"){var m=ae(s.shape);f=[];for(var y=0;y<m;y++){var x=new Uint32Array(e.slice(r,r+Jc))[0];r+=Jc;var w=new Uint8Array(e.slice(r,r+x));f.push(w),r+=x}}else{var b=Hp[l];if(v=e.slice(r,r+d*b),l==="float32")f=new Float32Array(v);else if(l==="int32")f=new Int32Array(v);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(v)}r+=d*b}n[u]=It(f,c,l)},i=0,a=t;i<a.length;i++)o(a[i]);return n}function nj(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(i){if(t+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(t),o=0;return n.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var Gp=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function g1(e){return Gp?Buffer.byteLength(e):new Blob([e]).size}function Xm(e){var t=0;e.forEach(function(o){t+=o.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(o){n.set(new Uint8Array(o),r),r+=o.byteLength}),n.buffer}function y1(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function qu(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:g1(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:g1(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var En=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var o=[];return(n==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(i){var a=i(t,r);a!==null&&o.push(a)}),o},e}(),Ta="://",Ho=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(t,n){T(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(Ta)&&(t=t.slice(0,t.indexOf(Ta))),T(t.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();T(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=n},e.getManager=function(t){var n=this.getInstance().managers[t];if(n==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return n},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function tc(e){if(e.indexOf(Ta)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ho.getSchemes().join(","));return{scheme:e.split(Ta)[0],path:e.split(Ta)[1]}}function x1(e,t,n){return n===void 0&&(n=!1),oe(this,void 0,void 0,function(){var r,o,i,a,s,u,l,c,d;return ie(this,function(f){switch(f.label){case 0:return T(e!==t,function(){return"Old path and new path are the same: '"+e+"'"}),T((r=En.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),T(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),o=r[0],T((i=En.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),T(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),a=i[0],s=tc(e).scheme,u=tc(e).path,l=s===tc(e).scheme,[4,o.load()];case 1:return c=f.sent(),n&&l?[4,Ho.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(c)];case 4:return d=f.sent(),!n||l?[3,6]:[4,Ho.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var bi="models_store",Do="model_info_store";function iS(){if(!G().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function qp(e){var t=e.result;t.createObjectStore(bi,{keyPath:"modelPath"}),t.createObjectStore(Do,{keyPath:"modelPath"})}var Aa=function(){function e(t){if(this.indexedDB=iS(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return e.prototype.save=function(t){return oe(this,void 0,void 0,function(){return ie(this,function(n){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return oe(this,void 0,void 0,function(){return ie(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(t,n){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return qp(a)},a.onsuccess=function(){var s=a.result;if(n==null){var u=s.transaction(bi,"readonly"),l=u.objectStore(bi).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var c,d=qu(n),f=s.transaction(Do,"readwrite"),h=f.objectStore(Do),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var v=(c=s.transaction(bi,"readwrite")).objectStore(bi).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:d});v.onsuccess=function(){return o({modelArtifactsInfo:d})},v.onerror=function(g){var m=(h=f.objectStore(Do)).delete(r.modelPath);m.onsuccess=function(){return s.close(),i(v.error)},m.onerror=function(y){return s.close(),i(v.error)}}},p.onerror=function(v){return s.close(),i(p.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},e.URL_SCHEME="indexeddb://",e}(),w1=function(e){return G().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Aa.URL_SCHEME)?(t=e.slice(Aa.URL_SCHEME.length),new Aa(t)):null;var t};En.registerSaveRouter(w1),En.registerLoadRouter(w1);var rj=function(){function e(){this.indexedDB=iS()}return e.prototype.listModels=function(){return oe(this,void 0,void 0,function(){var t=this;return ie(this,function(n){return[2,new Promise(function(r,o){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return qp(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Do,"readonly"),u=s.objectStore(Do).getAll();u.onsuccess=function(){for(var l={},c=0,d=u.result;c<d.length;c++){var f=d[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},e.prototype.removeModel=function(t){return oe(this,void 0,void 0,function(){var n=this;return ie(this,function(r){var o;return t=(o=t).startsWith(Aa.URL_SCHEME)?o.slice(Aa.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=n.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return qp(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(Do,"readwrite"),d=c.objectStore(Do),f=d.get(t);f.onsuccess=function(){if(f.result==null)return l.close(),a(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var h=d.delete(t),p=function(){var v=(u=l.transaction(bi,"readwrite")).objectStore(bi).delete(t);v.onsuccess=function(){return i(f.result.modelArtifactsInfo)},v.onerror=function(g){return a(f.error)}};h.onsuccess=p,h.onerror=function(v){return p(),l.close(),a(f.error)}},f.onerror=function(h){return l.close(),a(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},e}();if(G().getBool("IS_BROWSER"))try{Ho.registerManager(Aa.URL_SCHEME,new rj)}catch{}var Hr="/",ia="tensorflowjs_models",aS="info",oj="model_topology",ij="weight_specs",aj="weight_data",sj="model_metadata";function sS(e){return{info:[ia,e,aS].join(Hr),topology:[ia,e,oj].join(Hr),weightSpecs:[ia,e,ij].join(Hr),weightData:[ia,e,aj].join(Hr),modelMetadata:[ia,e,sj].join(Hr)}}function uj(e){var t=e.split(Hr);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(Hr)}var Pa=function(){function e(t){if(!G().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=sS(this.modelPath)}return e.prototype.save=function(t){return oe(this,void 0,void 0,function(){var n,r,o;return ie(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=qu(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(Gp)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return oe(this,void 0,void 0,function(){var t,n,r,o,i,a,s;return ie(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(i),n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,n.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(l){if(Gp){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var d=atob(l),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(s),[2,n]})})},e.URL_SCHEME="localstorage://",e}(),b1=function(e){return G().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Pa.URL_SCHEME)?(t=e.slice(Pa.URL_SCHEME.length),new Pa(t)):null;var t};En.registerSaveRouter(b1),En.registerLoadRouter(b1);var lj=function(){function e(){T(G().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),T(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return oe(this,void 0,void 0,function(){var t,n,r,o,i,a;return ie(this,function(s){for(t={},n=ia+Hr,r=Hr+aS,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(n)&&i.endsWith(r)&&(a=uj(i),t[a]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},e.prototype.removeModel=function(t){return oe(this,void 0,void 0,function(){var n,r;return ie(this,function(o){var i;if(t=(i=t).startsWith(Pa.URL_SCHEME)?i.slice(Pa.URL_SCHEME.length):i,n=sS(t),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(G().getBool("IS_BROWSER"))try{Ho.registerManager(Pa.URL_SCHEME,new lj)}catch{}var cj="model",dj=".json",fj=".weights.bin";function C1(e){return new Promise(function(t){return setTimeout(t)}).then(e)}var vh=function(){function e(t){if(!G().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),t!=null&&t.length!==0||(t=cj),this.modelTopologyFileName=t+dj,this.weightDataFileName=t+fj}return e.prototype.save=function(t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s;return ie(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,C1(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),t.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,[4,C1(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:qu(t)}]}})})},e.URL_SCHEME="downloads://",e}(),hj=function(){function e(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return e.prototype.load=function(){return oe(this,void 0,void 0,function(){var t,n,r=this;return ie(this,function(o){return t=this.files[0],n=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){n.length===0&&i({modelTopology:c});var d=l.weightsManifest;if(d!=null){var f;try{f=r.checkManifestAndWeightFiles(d,n)}catch(g){return void a(g)}var h=[],p=[],v=[];d.forEach(function(g){g.paths.forEach(function(m){p.push(m),v.push(null)}),h.push.apply(h,g.weights)}),d.forEach(function(g){g.paths.forEach(function(m){var y=new FileReader;y.onload=function(x){var w=x.target.result,b=p.indexOf(m);v[b]=w,v.indexOf(null)===-1&&i({modelTopology:c,weightSpecs:h,weightData:Xm(v),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},y.onerror=function(x){return a("Failed to weights data from file of path '"+m+"'.")},y.readAsArrayBuffer(f[m])})})}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},e.prototype.checkManifestAndWeightFiles=function(t,n){for(var r=[],o=n.map(function(u){return y1(u.name)}),i={},a=0,s=t;a<s.length;a++)s[a].paths.forEach(function(u){var l=y1(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),o.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");i[u]=n[o.indexOf(l)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return i},e}();function E1(e,t,n,r){(function(i){T(i!=null&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"})})(e),function(i,a){T(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),T(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),T(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(n=n??0,r=r??1);var o=0;return Promise.all(e.map(function(i){return i.then(function(a){var s=n+ ++o/e.length*(r-n);return t(s),a}),i}))}function uS(e,t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c;return ie(this,function(d){switch(d.label){case 0:return t==null&&(t={}),n=t.fetchFunc==null?G().platform.fetch:t.fetchFunc,r=e.map(function(f){return n(f,t.requestInit,{isBinary:!0})}),o=0,i=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,E1(r,t.onProgress,o,i)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=d.sent(),[3,8];case 6:return[4,E1(s,t.onProgress,u,l)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}})})}function S1(e){var t=this;return function(n,r,o){return r===void 0&&(r=""),oe(t,void 0,void 0,function(){var i,a,s,u,l,c,d,f,h,p;return ie(this,function(v){switch(v.label){case 0:if(i=n.map(function(){return!1}),a={},s=o!=null?o.map(function(){return!1}):[],u=[],n.forEach(function(g,m){var y=0;g.weights.forEach(function(x){var w="quantization"in x?x.quantization.dtype:x.dtype,b=Hp[w]*ae(x.shape),E=function(){i[m]=!0,a[m]==null&&(a[m]=[]),a[m].push({manifestEntry:x,groupOffset:y,sizeBytes:b})};o!=null?o.forEach(function(k,_){k===x.name&&(E(),s[_]=!0)}):E(),u.push(x.name),y+=b})}),!s.every(function(g){return g}))throw l=o.filter(function(g,m){return!s[m]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=i.reduce(function(g,m,y){return m&&g.push(y),g},[]),d=[],c.forEach(function(g){n[g].paths.forEach(function(m){var y=r+(r.endsWith("/")?"":"/")+m;d.push(y)})}),[4,e(d)];case 1:return f=v.sent(),h={},p=0,c.forEach(function(g){for(var m=n[g].paths.length,y=0,x=0;x<m;x++)y+=f[p+x].byteLength;for(var w=new ArrayBuffer(y),b=new Uint8Array(w),E=0,k=0;k<m;k++){var _=new Uint8Array(f[p+k]);b.set(_,E),E+=_.byteLength}a[g].forEach(function(R){var N=oS(w.slice(R.groupOffset,R.groupOffset+R.sizeBytes),[R.manifestEntry]);for(var D in N)h[D]=N[D]}),p+=m}),[2,h]}})})}}En.registerSaveRouter(function(e){return G().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(vh.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new vh(t)}(e.slice(vh.URL_SCHEME.length)):null});var lS=function(){function e(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(T(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=G().platform.fetch,T(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&T(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return e.prototype.save=function(t){return oe(this,void 0,void 0,function(){var n,r,o,i;return ie(this,function(a){switch(a.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],o={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),t.weightData!=null&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:qu(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},e.prototype.load=function(){return oe(this,void 0,void 0,function(){var t,n,r,o,i,a,s,u,l,c,d,f;return ie(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,t.json()];case 3:return n=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=n.modelTopology,i=n.weightsManifest,a=n.generatedBy,s=n.convertedBy,u=n.format,l=n.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:f=h.sent(),c=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:c,weightData:d,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}})})},e.prototype.loadWeights=function(t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,d,f;return ie(this,function(h){switch(h.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var v=p.lastIndexOf("/"),g=p.lastIndexOf("?"),m=p.substring(0,v),y=g>v?p.substring(g):"";return[m+"/",y]}(n),o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,l=t;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return d=[],t.forEach(function(p){p.paths.forEach(function(v){d.push(a+v+i)})}),[4,uS(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[s,Xm(f)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function Kp(e){return e.match(lS.URL_SCHEME_REGEX)!=null}var k1=function(e,t){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(n){return Kp(n)}):Kp(e))?Xp(e,{onProgress:t}):null};function Xp(e,t){return new lS(e,t)}En.registerSaveRouter(k1),En.registerLoadRouter(k1);var mh=function(){function e(t){this.modelArtifacts=t}return e.prototype.load=function(){return oe(this,void 0,void 0,function(){return ie(this,function(t){return[2,this.modelArtifacts]})})},e}(),pj=function(){function e(t){this.saveHandler=t}return e.prototype.save=function(t){return oe(this,void 0,void 0,function(){return ie(this,function(n){return[2,this.saveHandler(t)]})})},e}(),cS=Object.freeze({browserFiles:function(e){return new hj(e)},browserHTTPRequest:function(e,t){return Xp(e,t)},concatenateArrayBuffers:Xm,decodeWeights:oS,encodeWeights:function(e,t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return ie(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(e)?e.map(function(l){return l.name}):Object.keys(e),i=function(l){var c=o[l],d=Array.isArray(e)?e[l].tensor:e[c];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+d.dtype);var f={name:c,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var h=new Promise(function(p){return oe(s,void 0,void 0,function(){var v,g,m,y,x,w,b;return ie(this,function(E){switch(E.label){case 0:return[4,d.bytes()];case 1:for(v=E.sent(),g=v.reduce(function(k,_){return k+_.length},0)+Jc*v.length,m=new Uint8Array(g),y=0,x=0;x<v.length;x++)w=v[x],b=new Uint8Array(new Uint32Array([w.length]).buffer),m.set(b,y),y+=Jc,m.set(w,y),y+=w.length;return p(m),[2]}})})});r.push(h)}else r.push(d.data());t!=null&&(f.group=t),n.push(f)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:nj(u.sent()),specs:n}]}})})},fromMemory:function(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new mh(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new mh({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new mh({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return En.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:qu,getSaveHandlers:function(e){return En.getSaveHandlers(e)},http:Xp,isHTTPScheme:Kp,loadWeights:function(e,t,n,r){return t===void 0&&(t=""),oe(this,void 0,void 0,function(){return ie(this,function(o){return[2,S1(function(i){return uS(i,{requestInit:r})})(e,t,n)]})})},registerLoadRouter:function(e){return En.registerLoadRouter(e)},registerSaveRouter:function(e){return En.registerSaveRouter(e)},weightsLoaderFactory:S1,withSaveHandler:function(e){return new pj(e)},copyModel:function(e,t){return oe(this,void 0,void 0,function(){return ie(this,function(n){return[2,x1(e,t,!1)]})})},listModels:function(){return oe(this,void 0,void 0,function(){var e,t,n,r,o,i,a;return ie(this,function(s){switch(s.label){case 0:e=Ho.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?(o=r[n],[4,Ho.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())t[o+Ta+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}})})},moveModel:function(e,t){return oe(this,void 0,void 0,function(){return ie(this,function(n){return[2,x1(e,t,!0)]})})},removeModel:function(e){return oe(this,void 0,void 0,function(){var t;return ie(this,function(n){return t=tc(e),[2,Ho.getManager(t.scheme).removeModel(t.path)]})})}}),ea;M({confusionMatrix_:function(e,t,n){var r=I(e,"labels","confusionMatrix"),o=I(t,"predictions","confusionMatrix");T(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),T(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),T(o.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),T(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),T(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=zp(r.asType("int32"),n),a=zp(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}});var vj=M({fromPixels_:function(e,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,i=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)i=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(MC("FromPixels",O.backendName)!=null)return O.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,l=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],c=l[0],d=l[1];if(a?s=e.getContext("2d").getImageData(0,0,c,d).data:r||n?s=e.data:(i||o)&&(ea==null&&(ea=document.createElement("canvas").getContext("2d")),ea.canvas.width=c,ea.canvas.height=d,ea.drawImage(e,0,0,c,d),s=ea.getImageData(0,0,c,d).data),t===4)u=new Int32Array(s);else{var f=c*d;u=new Int32Array(f*t);for(var h=0;h<f;h++)for(var p=0;p<t;++p)u[h*t+p]=s[4*h+p]}return Sm(u,[d,c,t],"int32")}}),Ym=Object.freeze({toPixels:function(e,t){return oe(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,d,f,h,p,v,g,m,y,x,w,b,E,k,_;return ie(this,function(R){switch(R.label){case 0:if(n=I(e,"img","toPixels"),e instanceof Je||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=n.rank===2?1:n.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=R.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=R.sent(),d=c[0],f=c[1],h=d[0],p=f[0],u.dispose(),l.dispose(),n.dtype==="float32"){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(v=n.dtype==="float32"?255:1,g=new Uint8ClampedArray(i*o*4),m=0;m<o*i;++m)y=void 0,x=void 0,w=void 0,b=void 0,a===1?(y=s[m]*v,x=s[m]*v,w=s[m]*v,b=255):a===3?(y=s[3*m]*v,x=s[3*m+1]*v,w=s[3*m+2]*v,b=255):a===4&&(y=s[4*m]*v,x=s[4*m+1]*v,w=s[4*m+2]*v,b=s[4*m+3]*v),g[(E=4*m)+0]=Math.round(y),g[E+1]=Math.round(x),g[E+2]=Math.round(w),g[E+3]=Math.round(b);return t!=null&&(t.width=i,t.height=o,k=t.getContext("2d"),_=new ImageData(g,i,o),k.putImageData(_,0,0)),n!==e&&n.dispose(),[2,g]}})})},fromPixels:vj}),mj=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(t,n){return new t(n)},e}(),gj=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function Hi(e){T(e.className!=null,function(){return"Class being registered does not have the static className property defined."}),T(typeof e.className=="string",function(){return"className is required to be a string, but got type "+typeof e.className}),T(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),gj.register(e)}var Gi=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return sr(t,e),t.prototype.minimize=function(n,r,o){r===void 0&&(r=!1);var i=this.computeGradients(n,o),a=i.value,s=i.grads;if(o!=null){var u=o.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return ln(s),r?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(n,r){return R4(n,r)},t.prototype.dispose=function(){this.iterations_!=null&&ln(this.iterations_)},t.prototype.saveIterations=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Z(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,n.slice(1)]}})})},t}(mj);Object.defineProperty(Gi,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var yj=function(e){function t(n,r,o){o===void 0&&(o=null);var i=e.call(this)||this;return i.learningRate=n,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=O.backend.epsilon()),i}return sr(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=O.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:te(function(){return Re(a).variable(!1)})}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:te(function(){return Re(a).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[i].variable,l=r.accumulatedUpdates[i].variable;te(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=l.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(c),l.assign(f);var h=d.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ln(this.accumulatedGrads.map(function(n){return n.variable})),ln(this.accumulatedUpdates.map(function(n){return n.variable})))},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(Gi);Hi(yj);var xj=function(e){function t(n,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=n,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return sr(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=O.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:te(function(){return Tr(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedGrads[i].variable;te(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(O.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&ln(this.accumulatedGrads.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(Gi);Hi(xj);var wj=function(e){function t(n,r,o,i){i===void 0&&(i=null);var a=e.call(this)||this;return a.learningRate=n,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],te(function(){a.accBeta1=Z(r).variable(),a.accBeta2=Z(o).variable()}),i==null&&(a.epsilon=O.backend.epsilon()),a}return sr(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n);te(function(){var i=xt(1,r.accBeta1),a=xt(1,r.accBeta2);o.forEach(function(s,u){var l=O.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:te(function(){return Re(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:te(function(){return Re(l).variable(!1)})});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),v=h.div(i),g=p.div(a);d.assign(h),f.assign(p);var m=v.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ln(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&ln(this.accumulatedSecondMoment.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){var r,o=this;return ie(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),te(function(){o.accBeta1.assign(Yc(o.beta1,o.iterations_+1)),o.accBeta2.assign(Yc(o.beta2,o.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(Gi);Hi(wj);var bj=function(e){function t(n,r,o,i,a){i===void 0&&(i=null),a===void 0&&(a=0);var s=e.call(this)||this;return s.learningRate=n,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],te(function(){s.iteration=Z(0).variable(),s.accBeta1=Z(r).variable()}),i==null&&(s.epsilon=O.backend.epsilon()),s}return sr(t,e),t.prototype.applyGradients=function(n){var r=this,o=Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n);te(function(){var i=xt(1,r.accBeta1),a=Jn(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var l=O.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Re(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Re(l).variable(!1)});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2),v=c.abs(),g=p.maximum(v);d.assign(h),f.assign(g);var m=a.div(i).mul(h.div(g.add(r.epsilon))).add(l);l.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ln(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&ln(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(Gi);Hi(bj);var dS=function(e){function t(n){var r=e.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return sr(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=Array.isArray(n)?n[i].tensor:n[o];if(a!=null){var s=O.registeredVariables[o];te(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=WM(Z(-n))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(n,r){return new n(r.learningRate)},t.className="SGD",t}(Gi);Hi(dS);var Cj=function(e){function t(n,r,o){o===void 0&&(o=!1);var i=e.call(this,n)||this;return i.learningRate=n,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=Z(i.momentum),i}return sr(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=O.registeredVariables[o];r.accumulations[i]==null&&(r.accumulations[i]={originalName:o+"/momentum",variable:te(function(){return Re(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(n)?n[i].tensor:n[o];u!=null&&te(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ln(this.accumulations.map(function(n){return n.variable}))},t.prototype.setMomentum=function(n){this.momentum=n},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){return ie(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){return ie(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(dS);Hi(Cj);var Ej=function(e){function t(n,r,o,i,a){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),a===void 0&&(a=!1);var s=e.call(this)||this;if(s.learningRate=n,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,i==null&&(s.epsilon=O.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return sr(t,e),t.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n)).forEach(function(o,i){var a=O.registeredVariables[o];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:te(function(){return Re(a).variable(!1)})}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:te(function(){return Re(a).variable(!1)})}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:te(function(){return Re(a).variable(!1)})});var s=Array.isArray(n)?n[i].tensor:n[o];if(s!=null){var u=r.accumulatedMeanSquares[i].variable,l=r.accumulatedMoments[i].variable;te(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[i].variable,f=d.mul(r.decay).add(s.mul(1-r.decay)),h=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),d.assign(f),l.assign(h);var p=a.sub(h);a.assign(p)}else{var v=u.mul(r.decay).add(s.square().mul(1-r.decay));h=l.mul(r.momentum).add(s.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),l.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ln(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ln(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&ln(this.accumulatedMoments.map(function(n){return n.variable}))},t.prototype.getWeights=function(){return oe(this,void 0,void 0,function(){var n;return ie(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(n){return oe(this,void 0,void 0,function(){var r;return ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(Gi);Hi(Ej);Je.prototype.squaredDifference=function(e){return _E(this,e)},V=XB;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Yp=function(e,t){return Yp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])},Yp(e,t)};function he(e,t){Yp(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var jt=function(){return jt=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},jt.apply(this,arguments)};function ue(e,t,n,r){function o(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function s(c){try{l(r.next(c))}catch(d){a(d)}}function u(c){try{l(r.throw(c))}catch(d){a(d)}}function l(c){c.done?i(c.value):o(c.value).then(s,u)}l((r=r.apply(e,[])).next())})}function le(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,o=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1],i=l;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(l);break}i[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(c){l=[6,c],o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Vs(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),o=0,t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var Ni=function(){function e(t,n){if(!Ii(t)||!Ii(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:n}));this._width=t,this._height=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function Hd(e,t){return e instanceof Je&&e.shape.length===t}function Sj(e){return Hd(e,2)}function Gd(e){return Hd(e,3)}function Go(e){return Hd(e,4)}function kj(e){return e%1!==0}function _1(e){return e%2===0}function Qm(e,t){t===void 0&&(t=2);var n=Math.pow(10,t);return Math.floor(e*n)/n}function R1(e){return e&&e.width&&e.height}function _j(e,t){var n=e.width,r=e.height,o=t/Math.max(r,n);return new Ni(Math.round(n*o),Math.round(r*o))}function Jm(e){return e.reduce(function(t,n){return t.add(n)},new Te(0,0)).div(new Te(e.length,e.length))}function bu(e,t,n){return Array(e).fill(0).map(function(r,o){return t+o*n})}function Ii(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function N1(e){return Ii(e)&&0<=e&&e<=1}var Te=function(){function e(t,n){this._x=t,this._y=n}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),Mr=function(){function e(t,n){n===void 0&&(n=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(Ii),i=[r.x,r.y,r.width,r.height].every(Ii);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],l=a[2],c=a[3];e.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return e.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Ii)},e.assertIsValidBox=function(t,n,r){if(r===void 0&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Te(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Te(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Te(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Te(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),n=t[0],r=t[1],o=t[2],i=t[3];return new e({x:n,y:r,width:o,height:i})},e.prototype.toSquare=function(){var t=this,n=t.x,r=t.y,o=t.width,i=t.height,a=Math.abs(o-i);return o<i&&(n-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new e({x:n,y:r,width:o,height:i})},e.prototype.rescale=function(t){var n=R1(t)?t.width:t,r=R1(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n],o=r[0],i=r[1],a=r[2],s=r[3];return new e({x:o,y:i,width:a,height:s})},e.prototype.clipAtImageBorders=function(t,n){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),l=Math.max(i,0),c=a-u,d=s-l,f=Math.min(c,t-u),h=Math.min(d,n-l);return new e({x:u,y:l,width:f,height:h}).floor()},e.prototype.shift=function(t,n){var r=this,o=r.width,i=r.height,a=this.x+t,s=this.y+n;return new e({x:a,y:s,width:o,height:i})},e.prototype.padAtBorders=function(t,n){var r=this.width+1,o=this.height+1,i=1,a=1,s=r,u=o,l=this.left,c=this.top,d=this.right,f=this.bottom;return d>n&&(s=-d+n+r,d=n),f>t&&(u=-f+t+o,f=t),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:i,edx:s,y:c,ey:f,x:l,ex:d,w:r,h:o}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),qd=function(e){he(t,e);function t(n,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{left:n,top:r,right:o,bottom:i},a)||this}return t}(Mr),fS=function(){function e(t,n,r,o,i){this._imageDims=new Ni(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new Mr(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new Mr(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),Tn=function(e){he(t,e);function t(n,r,o){return e.call(this,n,n,"",r,o)||this}return t.prototype.forSize=function(n,r){var o=e.prototype.forSize.call(this,n,r),i=o.score,a=o.relativeBox,s=o.imageDims;return new t(i,a,s)},t}(fS);function Rj(e,t,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),i=r*o;return n?i/(e.area+t.area-i):i/Math.min(e.area,t.area)}function Nj(e){var t=e.map(function(s){return s.x}),n=e.map(function(s){return s.y}),r=t.reduce(function(s,u){return u<s?u:s},1/0),o=n.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return s<u?u:s},0),a=n.reduce(function(s,u){return s<u?u:s},0);return new qd(r,o,i,a)}function Cu(e,t,n,r){r===void 0&&(r=!0);for(var o=t.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,l=[],c=0;c<u.length;c++){var d=u[c],f=e[s],h=e[d];l.push(Rj(f,h,r))}o=o.filter(function(p,v){return l[v]<=n})};o.length>0;)a();return i}function Ku(e,t){return te(function(){var n=t[0],r=t[1],o=t[2],i=Tr(Vs(e.shape.slice(0,3),[1]),n),a=Tr(Vs(e.shape.slice(0,3),[1]),r),s=Tr(Vs(e.shape.slice(0,3),[1]),o),u=mt([i,a,s],3);return xt(e,u)})}function Ij(e,t){return t===void 0&&(t=!1),te(function(){var n=e.shape.slice(1),r=n[0],o=n[1];if(r===o)return e;var i=Math.abs(r-o),a=Math.round(i*(t?.5:1)),s=r>o?2:1,u=function(h){var p=e.shape.slice();return p[s]=h,Tr(p,0)},l=u(a),c=i-l.shape[s],d=t&&c?u(c):null,f=[d,e,l].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return mt(f,s)})}function gh(e){return 1/(1+Math.exp(-e))}var Zm=function(e){he(t,e);function t(n,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{x:n,y:r,width:o,height:i},a)||this}return t}(Mr),Tj=.5,Aj=.43,Pj=.45,Eu=function(){function e(t,n,r){r===void 0&&(r=new Te(0,0));var o=n.width,i=n.height;this._imgDims=new Ni(o,i),this._shift=r,this._positions=t.map(function(a){return a.mul(new Te(o,i)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Te(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(n){return n.sub(t._shift).div(new Te(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new this.constructor(this.relativePositions,{width:t,height:n})},e.prototype.shiftBy=function(t,n){return new this.constructor(this.relativePositions,this._imgDims,new Te(t,n))},e.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},e.prototype.align=function(t,n){if(n===void 0&&(n={}),t){var r=t instanceof Tn?t.box.floor():new Mr(t);return this.shiftBy(r.x,r.y).align(null,n)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),i=o.useDlibAlignment,a=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),n=t[0],r=t[1],o=t[2],i=function(d){return o.sub(d).magnitude()},a=(i(n)+i(r))/2,s=Math.floor(a/Pj),u=Jm(t),l=Math.floor(Math.max(0,u.x-Tj*s)),c=Math.floor(Math.max(0,u.y-Aj*s));return new Zm(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},e.prototype.alignMinBbox=function(t){var n=Nj(this.positions);return n.pad(n.width*t,n.height*t)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),Dj=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],Jm([n[3],n[4]])]},t}(Eu),Mj=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Jm)},t}(Eu),I1=function(){function e(t,n){this._label=t,this._distance=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+Qm(this.distance)+")":"")},e}(),T1=function(e){he(t,e);function t(n,r){var o=e.call(this,n)||this;return o._label=r,o}return t.assertIsValidLabeledBox=function(n,r){if(Mr.assertIsValidBox(n,r),!Ii(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Mr),Fl=function(){function e(t,n){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},e.fromJSON=function(t){var n=t.descriptors.map(function(r){return new Float32Array(r)});return new e(t.label,n)},e}();(function(e){he(t,e);function t(n,r,o,i){var a=e.call(this,n,r)||this;return a._score=o,a._classScore=i,a}return t.assertIsValidPredictedBox=function(n,r){if(T1.assertIsValidLabeledBox(n,r),!N1(n.score)||!N1(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(T1);function Su(e){return e.detection instanceof Tn}function ku(e,t){var n={detection:t};return Object.assign({},e,n)}function hS(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:t}}function pS(e){var t="";if(!e)try{e=require("fs")}catch(r){t=r.toString()}var n=e?function(r){return new Promise(function(o,i){e.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:n}}function vS(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=pS();return jt({Canvas:e||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:t||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:n,createImageElement:r,fetch:o},i)}function mS(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function gS(){return typeof global=="object"&&typeof require=="function"&&typeof vk<"u"&&typeof process<"u"&&!!process.version}var ht;function Fj(){if(!ht)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ht}function Qp(e){ht=e}function eg(){mS()&&Qp(hS()),gS()&&Qp(vS())}function Oj(e){if(ht||eg(),!ht)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=t===void 0?ht.Canvas:t,r=e.Image,o=r===void 0?ht.Image:r;ht.Canvas=n,ht.Image=o,ht.createCanvasElement=e.createCanvasElement||function(){return new n},ht.createImageElement=e.createImageElement||function(){return new o},ht.ImageData=e.ImageData||ht.ImageData,ht.Video=e.Video||ht.Video,ht.fetch=e.fetch||ht.fetch,ht.readFile=e.readFile||ht.readFile}var Vt={getEnv:Fj,setEnv:Qp,initialize:eg,createBrowserEnv:hS,createFileSystem:pS,createNodejsEnv:vS,monkeyPatch:Oj,isBrowser:mS,isNodejs:gS};eg();function tg(e){return!Vt.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function to(e){var t=Vt.getEnv(),n=t.Canvas,r=t.CanvasRenderingContext2D;if(e instanceof r)return e;var o=tg(e);if(!(o instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var Mo;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Mo||(Mo={}));var yS=function(){function e(t){t===void 0&&(t={});var n=t.anchorPosition,r=t.backgroundColor,o=t.fontColor,i=t.fontSize,a=t.fontStyle,s=t.padding;this.anchorPosition=n||Mo.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4}return e}(),xS=function(){function e(t,n,r){r===void 0&&(r={}),this.text=typeof t=="string"?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new yS(r)}return e.prototype.measureWidth=function(t){var n=this.options.padding;return this.text.map(function(r){return t.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*n},e.prototype.measureHeight=function(){var t=this.options,n=t.fontSize,r=t.padding;return this.text.length*n+2*r},e.prototype.getUpperLeft=function(t,n){var r=this.options.anchorPosition,o=r===Mo.BOTTOM_RIGHT||r===Mo.TOP_RIGHT,i=r===Mo.BOTTOM_LEFT||r===Mo.BOTTOM_RIGHT,a=this.measureWidth(t),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,l=i?this.anchor.y-s:this.anchor.y;if(n){var c=n.width,d=n.height,f=Math.max(Math.min(u,c-a),0),h=Math.max(Math.min(l,d-s),0);return{x:f,y:h}}return{x:u,y:l}},e.prototype.draw=function(t){var n=tg(t),r=to(n),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,u=o.fontStyle,l=o.padding;r.font=s+"px "+u;var c=this.measureWidth(r),d=this.measureHeight();r.fillStyle=i;var f=this.getUpperLeft(r,n);r.fillRect(f.x,f.y,c,d),r.fillStyle=a,this.text.forEach(function(h,p){var v=l+f.x,g=l+f.y+(p+1)*s;r.fillText(h,v,g)})},e}(),Lj=function(){function e(t){t===void 0&&(t={});var n=t.boxColor,r=t.lineWidth,o=t.label,i=t.drawLabelOptions;this.boxColor=n||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=o;var a={anchorPosition:Mo.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new yS(Object.assign({},a,i))}return e}(),Bj=function(){function e(t,n){n===void 0&&(n={}),this.box=new Mr(t),this.options=new Lj(n)}return e.prototype.draw=function(t){var n=to(t),r=this.options,o=r.boxColor,i=r.lineWidth,a=this.box,s=a.x,u=a.y,l=a.width,c=a.height;n.strokeStyle=o,n.lineWidth=i,n.strokeRect(s,u,l,c);var d=this.options.label;d&&new xS([d],{x:s-i/2,y:u},this.options.drawLabelOptions).draw(t)},e}();function jj(e,t){var n=Array.isArray(t)?t:[t];n.forEach(function(r){var o=r instanceof Tn?r.score:Su(r)?r.detection.score:void 0,i=r instanceof Tn?r.box:Su(r)?r.detection.box:new Mr(r),a=o?""+Qm(o):void 0;new Bj(i,{label:a}).draw(e)})}function wS(e){var t=Vt.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function zj(e){return new Promise(function(t,n){if(e instanceof Vt.getEnv().Canvas||wS(e))return t();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}e.addEventListener("load",r),e.addEventListener("error",o)})}function ng(e){var t=Vt.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new Ni(e.naturalWidth,e.naturalHeight):e instanceof r?new Ni(e.videoWidth,e.videoHeight):new Ni(e.width,e.height)}function Kd(e){var t=e.width,n=e.height,r=Vt.getEnv().createCanvasElement,o=r();return o.width=t,o.height=n,o}function rg(e,t){var n=Vt.getEnv().ImageData;if(!(e instanceof n)&&!wS(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=ng(e),o=r.width,i=r.height,a=Kd({width:o,height:i});return e instanceof n?to(a).putImageData(e,0,0):to(a).drawImage(e,0,0,o,i),a}function Wj(e,t){return ue(this,void 0,void 0,function(){var n,r,o,i,a,s;return le(this,function(u){switch(u.label){case 0:return n=Vt.getEnv().createCanvasElement(),r=e.shape.slice(Go(e)?1:0),o=r[0],i=r[1],a=r[2],s=te(function(){return e.as3D(o,i,a).toInt()}),[4,Ym.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function A1(e){var t=Vt.getEnv(),n=t.Image,r=t.Canvas,o=t.Video;return e instanceof n||e instanceof r||e instanceof o}function $j(e,t,n){n===void 0&&(n=!1);var r=Vt.getEnv(),o=r.Image,i=r.Canvas;if(!(e instanceof o||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=ng(e),s=t/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=Kd({width:t,height:t}),d=e instanceof i?e:rg(e),f=Math.abs(u-l)/2,h=n&&u<l?f:0,p=n&&l<u?f:0;return to(c).drawImage(d,h,p,u,l),c}var Zc=function(){function e(t,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=n,this._batchSize=t.length,t.forEach(function(o,i){if(Gd(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(Go(o)){var a=o.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var s=o instanceof Vt.getEnv().Canvas?o:rg(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var t=this;return bu(this.batchSize,0,1).map(function(n,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},e.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},e.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},e.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},e.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(t),r=this.getInputHeight(t);return _j({width:n,height:r},this.inputSize)},e.prototype.toBatchTensor=function(t,n){var r=this;return n===void 0&&(n=!0),this._inputSize=t,te(function(){var o=bu(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Je){var u=Go(s)?s:s.expandDims();return u=Ij(u,n),(u.shape[1]!==t||u.shape[2]!==t)&&(u=Vm.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(s instanceof Vt.getEnv().Canvas)return Ym.fromPixels($j(s,t,n));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=Rn(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,t,t,3);return i})},e}();function kt(e){return ue(this,void 0,void 0,function(){var t,n,r;return le(this,function(o){switch(o.label){case 0:if(e instanceof Zc)return[2,e];if(t=Array.isArray(e)?e:[e],!t.length)throw new Error("toNetInput - empty array passed as input");return n=function(i){return Array.isArray(e)?" at input index "+i+":":""},r=t.map(tg),r.forEach(function(i,a){if(!A1(i)&&!Gd(i)&&!Go(i))throw typeof t[a]=="string"?new Error("toNetInput -"+n(a)+" string passed, but could not resolve HTMLElement for element id "+t[a]):new Error("toNetInput -"+n(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Go(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+n(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return A1(i)&&zj(i)}))];case 1:return o.sent(),[2,new Zc(r,Array.isArray(e))]}})})}function og(e,t){return ue(this,void 0,void 0,function(){var n,r,o,i,a,s,u;return le(this,function(l){switch(l.label){case 0:return n=Vt.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,kt(e)];case 1:if(o=l.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,Wj(i)];case 3:a=l.sent(),l.label=4;case 4:r=a,l.label=5;case 5:return s=to(r),u=t.map(function(c){return c instanceof Tn?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var d=c.x,f=c.y,h=c.width,p=c.height,v=Kd({width:h,height:p});return to(v).putImageData(s.getImageData(d,f,h,p),0,0),v})]}})})}function ig(e,t){return ue(this,void 0,void 0,function(){return le(this,function(n){if(!Gd(e)&&!Go(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Go(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,te(function(){var r=e.shape.slice(Go(e)?1:0),o=r[0],i=r[1],a=r[2],s=t.map(function(l){return l instanceof Tn?l.forSize(i,o).box:l}).map(function(l){return l.clipAtImageBorders(i,o)}),u=s.map(function(l){var c=l.x,d=l.y,f=l.width,h=l.height;return qE(e.as3D(o,i,a),[d,c,0],[h,f,a])});return u})]})})}function Uj(e,t){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(o){switch(o.label){case 0:return n=Vt.getEnv().fetch,[4,n(e,t)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function Vj(e){return ue(this,void 0,void 0,function(){return le(this,function(t){switch(t.label){case 0:return[4,Uj(e)];case 1:return[2,t.sent().json()]}})})}function bS(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var o=e.split("/").filter(function(s){return s}),i=e.endsWith(".json")?o[o.length-1]:n,a=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return a=e.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+i:a+"/"+i}}function Hj(e,t){return ue(this,void 0,void 0,function(){var n,r,o,i;return le(this,function(a){switch(a.label){case 0:return n=bS(e,t),r=n.manifestUri,o=n.modelBaseUri,[4,Vj(r)];case 1:return i=a.sent(),[2,cS.loadWeights(i,o)]}})})}function Gj(e,t,n){n===void 0&&(n=!1);var r=n?ng(t):t,o=r.width,i=r.height;return e.width=o,e.height=i,{width:o,height:i}}var ao=function(){function e(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(t){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;return r[o]},e.prototype.reassignParamFromPath=function(t,n){var r=this.traversePropertyPath(t),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=n},e.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof es})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof es)})},e.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(n){var r=n.path,o=n.tensor;t.reassignParamFromPath(r,o.variable())})},e.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(n){var r=n.path,o=n.tensor,i=It(o.dataSync());o.dispose(),t.reassignParamFromPath(r,i)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(n){if(t&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var n=t.tensor;return Array.from(n.dataSync())}).reduce(function(t,n){return t.concat(n)}))},e.prototype.load=function(t){return ue(this,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return n.sent(),[2]}})})},e.prototype.loadFromUri=function(t){return ue(this,void 0,void 0,function(){var n;return le(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Hj(t,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},e.prototype.loadFromDisk=function(t){return ue(this,void 0,void 0,function(){var n,r,o,i,a,s,u,l,c,d;return le(this,function(f){switch(f.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=Vt.getEnv().readFile,r=bS(t,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,a=function(h){return Promise.all(h.map(function(p){return n(p).then(function(v){return v.buffer})}))},s=cS.weightsLoaderFactory(a),c=(l=JSON).parse,[4,n(o)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,s(u,i)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},e.prototype.loadFromWeightMap=function(t){var n=this.extractParamsFromWeigthMap(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.extractWeights=function(t){var n=this.extractParams(t),r=n.paramMappings,o=n.params;this._paramMappings=r,this._params=o},e.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=t.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+t);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=n.obj,o=n.objProp;if(!r||!o||!(r[o]instanceof Je))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},e}();function Sn(e,t,n){return te(function(){var r=jm(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Ee(r,t.bias),r})}function yh(e,t,n){return n===void 0&&(n=!1),te(function(){var r=Ze(n?Ee(Vn(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Sn(e,t.conv0,[2,2])),o=Sn(r,t.conv1,[1,1]),i=Ze(Ee(r,o)),a=Sn(i,t.conv2,[1,1]);return Ze(Ee(r,Ee(o,a)))})}function Ol(e,t,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),te(function(){var o=Ze(n?Ee(Vn(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Sn(e,t.conv0,r?[2,2]:[1,1])),i=Sn(o,t.conv1,[1,1]),a=Ze(Ee(o,i)),s=Sn(a,t.conv2,[1,1]),u=Ze(Ee(o,Ee(i,s))),l=Sn(u,t.conv3,[1,1]);return Ze(Ee(o,Ee(i,Ee(s,l))))})}function nr(e,t,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),te(function(){var o=Ee(Vn(e,t.filters,[1,1],n),t.bias);return r?Ze(o):o})}function so(e,t){Object.keys(e).forEach(function(n){t.some(function(r){return r.originalPath===n})||e[n].dispose()})}function Xd(e,t){return function(n,r,o,i){var a=nn(e(n*r*o*o),[o,o,n,r]),s=ct(e(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function ag(e,t){return function(n,r,o){var i=Vo(e(n*r),[n,r]),a=ct(e(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var CS=function(){function e(t,n,r){this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}return e}();function sg(e,t){return function(n,r,o){var i=nn(e(9*n),[3,3,n,1]),a=nn(e(n*r),[1,1,n,r]),s=ct(e(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new CS(i,a,s)}}function ug(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),o=e(t+"/bias",1);return new CS(n,r,o)}}function ii(e,t){return function(n,r,o){var i=e[n];if(!Hd(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:n,paramPath:o||n}),i}}function uo(e){var t=e;function n(o){var i=t.slice(0,o);return t=t.slice(o),i}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function ES(e,t){var n=Xd(e,t),r=sg(e,t);function o(a,s,u,l){l===void 0&&(l=!1);var c=l?n(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),d=r(s,s,u+"/conv1"),f=r(s,s,u+"/conv2");return{conv0:c,conv1:d,conv2:f}}function i(a,s,u,l){l===void 0&&(l=!1);var c=o(a,s,u,l),d=c.conv0,f=c.conv1,h=c.conv2,p=r(s,s,u+"/conv3");return{conv0:d,conv1:f,conv2:h,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function qj(e){var t=[],n=uo(e),r=n.extractWeights,o=n.getRemainingWeights,i=ES(r,t).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),l=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function SS(e){return function(t){var n=e(t+"/filters",4),r=e(t+"/bias",1);return{filters:n,bias:r}}}function kS(e,t){var n=ii(e,t),r=SS(n),o=ug(n);function i(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),d=o(s+"/conv2");return{conv0:l,conv1:c,conv2:d}}function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):o(s+"/conv0"),c=o(s+"/conv1"),d=o(s+"/conv2"),f=o(s+"/conv3");return{conv0:l,conv1:c,conv2:d,conv3:f}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function Kj(e){var t=[],n=kS(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return so(e,t),{params:r,paramMappings:t}}var _S=function(e){he(t,e);function t(){return e.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return te(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=Ku(o,i).div(Z(255)),s=Ol(a,r.dense0,!0);return s=Ol(s,r.dense1),s=Ol(s,r.dense2),s=Ol(s,r.dense3),s=Gu(s,[7,7],[2,2],"valid"),s})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(n){return Kj(n)},t.prototype.extractParams=function(n){return qj(n)},t}(ao);function kr(e,t){return te(function(){return Ee($d(e,t.weights),t.bias)})}function Xj(e,t,n){var r=[],o=uo(e),i=o.extractWeights,a=o.getRemainingWeights,s=ag(i,r),u=s(t,n,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function Yj(e){var t=[],n=ii(e,t);function r(i){var a=n(i+"/weights",2),s=n(i+"/bias",1);return{weights:a,bias:s}}var o={fc:r("fc")};return so(e,t),{params:o,paramMappings:t}}function RS(e){var t={},n={};return Object.keys(e).forEach(function(r){var o=r.startsWith("fc")?n:t;o[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var NS=function(e){he(t,e);function t(n,r){var o=e.call(this,n)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return te(function(){var i=n instanceof Zc?r.faceFeatureExtractor.forwardInput(n):n;return kr(i.as2D(i.shape[0],-1),o.fc)})},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(n){return Xj(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(n){var r=RS(n),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),Yj(i)},t.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=n.slice(0,n.length-i),s=n.slice(n.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},t}(ao),P1=["neutral","happy","sad","angry","fearful","disgusted","surprised"],lg=function(){function e(t){var n=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);P1.forEach(function(r,o){n[r]=t[o]})}return e.prototype.asSortedArray=function(){var t=this;return P1.map(function(n){return{expression:n,probability:t[n]}}).sort(function(n,r){return r.probability-n.probability})},e}(),Qj=function(e){he(t,e);function t(n){return n===void 0&&(n=new _S),e.call(this,"FaceExpressionNet",n)||this}return t.prototype.forwardInput=function(n){var r=this;return te(function(){return oo(r.runNet(n))})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(n){return ue(this,void 0,void 0,function(){var r,o,i,a,s=this;return le(this,function(u){switch(u.label){case 0:return[4,kt(n)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(gt(o).map(function(l){return ue(s,void 0,void 0,function(){var c;return le(this,function(d){switch(d.label){case 0:return[4,l.data()];case 1:return c=d.sent(),l.dispose(),[2,c]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(l){return new lg(l)}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(NS);function Jj(e){return e.expressions instanceof lg}function IS(e,t){var n={expressions:t};return Object.assign({},e,n)}function Zj(e,t,n,r){var o=Array.isArray(t)?t:[t];o.forEach(function(i){var a=i instanceof lg?i:Jj(i)?i.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var s=a.asSortedArray(),u=s.filter(function(d){return d.probability>n}),l=Su(i)?i.detection.box.bottomLeft:new Te(0,0),c=new xS(u.map(function(d){return d.expression+" ("+Qm(d.probability)+")"}),l);c.draw(e)})}function TS(e){return Su(e)&&e.landmarks instanceof Eu&&e.unshiftedLandmarks instanceof Eu&&e.alignedRect instanceof Tn}function Yd(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),o=r.align(),i=e.detection.imageDims,a=new Tn(e.detection.score,o.rescale(i.reverse()),i),s={landmarks:r,unshiftedLandmarks:t,alignedRect:a};return Object.assign({},e,s)}function e5(e,t){var n=Xd(e,t),r=sg(e,t);function o(a,s,u){var l=r(a,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),d=n(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:d}}function i(a,s){var u=r(a,a,s+"/separable_conv0"),l=r(a,a,s+"/separable_conv1"),c=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:i}}function t5(e,t){var n=[],r=uo(e),o=r.extractWeights,i=r.getRemainingWeights,a=e5(o,n),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,d=s(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),h=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:f,reduction_block_1:h},v={};bu(t,0,1).forEach(function(x){v["main_block_"+x]=c(128,"middle_flow/main_block_"+x)});var g=l(128,256,"exit_flow/reduction_block"),m=u(256,512,"exit_flow/separable_conv"),y={reduction_block:g,separable_conv:m};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:p,middle_flow:v,exit_flow:y}}}function n5(e,t){var n=ii(e,t),r=SS(n),o=ug(n);function i(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=o(s+"/separable_conv0"),l=o(s+"/separable_conv1"),c=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:a}}function r5(e,t){var n=[],r=n5(e,n),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};bu(t,0,1).forEach(function(g){f["main_block_"+g]=s("middle_flow/main_block_"+g)});var h=a("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),v={reduction_block:h,separable_conv:p};return so(e,n),{params:{entry_flow:d,middle_flow:f,exit_flow:v},paramMappings:n}}function AS(e,t,n){return Ee(Vn(e,t.filters,n,"same"),t.bias)}function xh(e,t,n){n===void 0&&(n=!0);var r=n?Ze(e):e;return r=Sn(r,t.separable_conv0,[1,1]),r=Sn(Ze(r),t.separable_conv1,[1,1]),r=bt(r,[3,3],[2,2],"same"),r=Ee(r,AS(e,t.expansion_conv,[2,2])),r}function o5(e,t){var n=Sn(Ze(e),t.separable_conv0,[1,1]);return n=Sn(Ze(n),t.separable_conv1,[1,1]),n=Sn(Ze(n),t.separable_conv2,[1,1]),n=Ee(n,e),n}var i5=function(e){he(t,e);function t(n){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return t.prototype.forwardInput=function(n){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return te(function(){var i=n.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=Ku(i,a).div(Z(256)),u=Ze(AS(s,o.entry_flow.conv_in,[2,2]));return u=xh(u,o.entry_flow.reduction_block_0,!1),u=xh(u,o.entry_flow.reduction_block_1),bu(r._numMainBlocks,0,1).forEach(function(l){u=o5(u,o.middle_flow["main_block_"+l])}),u=xh(u,o.exit_flow.reduction_block),u=Ze(Sn(u,o.exit_flow.separable_conv,[1,1])),u})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(n){return r5(n,this._numMainBlocks)},t.prototype.extractParams=function(n){return t5(n,this._numMainBlocks)},t}(ao);function a5(e){var t=[],n=uo(e),r=n.extractWeights,o=n.getRemainingWeights,i=ag(r,t),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:a,gender:s}}}}function s5(e){var t=[],n=ii(e,t);function r(i){var a=n(i+"/weights",2),s=n(i+"/bias",1);return{weights:a,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return so(e,t),{params:o,paramMappings:t}}var ed;(function(e){e.FEMALE="female",e.MALE="male"})(ed||(ed={}));var u5=function(e){he(t,e);function t(n){n===void 0&&(n=new i5(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(n){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return te(function(){var i=n instanceof Zc?r.faceFeatureExtractor.forwardInput(n):n,a=Gu(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=kr(a,o.fc.age).as1D(),u=kr(a,o.fc.gender);return{age:s,gender:u}})},t.prototype.forwardInput=function(n){var r=this;return te(function(){var o=r.runNet(n),i=o.age,a=o.gender;return{age:i,gender:oo(a)}})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(n){return ue(this,void 0,void 0,function(){var r,o,i,a,s,u,l=this;return le(this,function(c){switch(c.label){case 0:return[4,kt(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return o=c.sent(),i=gt(o.age),a=gt(o.gender),s=i.map(function(d,f){return{ageTensor:d,genderTensor:a[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,h=d.genderTensor;return ue(l,void 0,void 0,function(){var p,v,g,m,y;return le(this,function(x){switch(x.label){case 0:return[4,f.data()];case 1:return p=x.sent()[0],[4,h.data()];case 2:return v=x.sent()[0],g=v>.5,m=g?ed.MALE:ed.FEMALE,y=g?v:1-v,f.dispose(),h.dispose(),[2,{age:p,gender:m,genderProbability:y}]}})})}))];case 3:return u=c.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),e.prototype.dispose.call(this,n)},t.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},t.prototype.extractClassifierParams=function(n){return a5(n)},t.prototype.extractParamsFromWeigthMap=function(n){var r=RS(n),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),s5(i)},t.prototype.extractParams=function(n){var r=1539,o=n.slice(0,n.length-r),i=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},t}(ao),PS=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.postProcess=function(n,r,o){var i=o.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),a=i.length;return te(function(){var s=function(f,h){return Rn([Tr([68],f),Tr([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=i[f],v=p.width,g=p.height;return h(v,g)?Math.abs(v-g)/2:0},l=function(f){return u(f,function(h,p){return h<p})},c=function(f){return u(f,function(h,p){return p<h})},d=n.mul(Tr([a,136],r)).sub(Rn(Array.from(Array(a),function(f,h){return s(l(h),c(h))}))).div(Rn(Array.from(Array(a),function(f,h){return s(i[h].width,i[h].height)})));return d})},t.prototype.forwardInput=function(n){var r=this;return te(function(){var o=r.runNet(n);return r.postProcess(o,n.inputSize,n.inputDimensions.map(function(i){var a=i[0],s=i[1];return{height:a,width:s}}))})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(n){return ue(this,void 0,void 0,function(){var r,o,i,a=this;return le(this,function(s){switch(s.label){case 0:return[4,kt(n)];case 1:return r=s.sent(),o=te(function(){return gt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,l){return ue(a,void 0,void 0,function(){var c,d,f,h,p;return le(this,function(v){switch(v.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return c=f.apply(d,[v.sent()]),h=c.filter(function(g,m){return _1(m)}),p=c.filter(function(g,m){return!_1(m)}),[2,new Mj(Array(68).fill(0).map(function(g,m){return new Te(h[m],p[m])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(NS),DS=function(e){he(t,e);function t(n){return n===void 0&&(n=new _S),e.call(this,"FaceLandmark68Net",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(PS);function l5(e){var t=[],n=kS(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return so(e,t),{params:r,paramMappings:t}}function c5(e){var t=[],n=uo(e),r=n.extractWeights,o=n.getRemainingWeights,i=ES(r,t).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u}}}var d5=function(e){he(t,e);function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return te(function(){var o=n.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=Ku(o,i).div(Z(255)),s=yh(a,r.dense0,!0);return s=yh(s,r.dense1),s=yh(s,r.dense2),s=Gu(s,[14,14],[2,2],"valid"),s})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(n){return l5(n)},t.prototype.extractParams=function(n){return c5(n)},t}(ao),f5=function(e){he(t,e);function t(n){return n===void 0&&(n=new d5),e.call(this,"FaceLandmark68TinyNet",n)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(PS);(function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(DS);function h5(e,t){return Ee($t(e,t.weights),t.biases)}function cg(e,t,n,r,o){o===void 0&&(o="same");var i=t.conv,a=i.filters,s=i.bias,u=Vn(e,a,n,o);return u=Ee(u,s),u=h5(u,t.scale),r?Ze(u):u}function p5(e,t){return cg(e,t,[1,1],!0)}function MS(e,t){return cg(e,t,[1,1],!1)}function FS(e,t){return cg(e,t,[2,2],!0,"valid")}function v5(e,t){function n(s,u,l){var c=e(s),d=c.length/(u*l*l);if(kj(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return te(function(){return Zo(nn(c,[u,d,l,l]),[2,3,1,0])})}function r(s,u,l,c){var d=n(s,u,l),f=ct(e(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:d,bias:f}}function o(s,u){var l=ct(e(s)),c=ct(e(s));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function i(s,u,l,c){var d=r(s,u,l,c+"/conv"),f=o(u,c+"/scale");return{conv:d,scale:f}}function a(s,u,l,c,d){d===void 0&&(d=!1);var f=i((d?.5:1)*s,u,l,c+"/conv1"),h=i(s,u,l,c+"/conv2");return{conv1:f,conv2:h}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function m5(e){var t=uo(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=v5(n,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),m=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),b=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),k=te(function(){return Zo(Vo(n(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var _={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:v,conv128_down:g,conv128_1:m,conv128_2:y,conv256_down:x,conv256_1:w,conv256_2:b,conv256_down_out:E,fc:k};return{params:_,paramMappings:o}}function g5(e,t){var n=ii(e,t);function r(a){var s=n(a+"/scale/weights",1),u=n(a+"/scale/biases",1);return{weights:s,biases:u}}function o(a){var s=n(a+"/conv/filters",4),u=n(a+"/conv/bias",1),l=r(a);return{conv:{filters:s,bias:u},scale:l}}function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function y5(e){var t=[],n=g5(e,t),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),l=o("conv64_down"),c=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),g=o("conv256_down"),m=o("conv256_1"),y=o("conv256_2"),x=o("conv256_down_out"),w=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!Sj(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var b={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:v,conv256_down:g,conv256_1:m,conv256_2:y,conv256_down_out:x,fc:w};return so(e,t),{params:b,paramMappings:t}}function pr(e,t){var n=p5(e,t.conv1);return n=MS(n,t.conv2),n=Ee(n,e),n=Ze(n),n}function Ll(e,t){var n=FS(e,t.conv1);n=MS(n,t.conv2);var r=Gu(e,2,2,"valid"),o=Ke(r.shape),i=r.shape[3]!==n.shape[3],a=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(a){var s=Vs(n.shape);s[1]=1;var u=Ke(s);n=mt([n,u],1);var l=Vs(n.shape);l[2]=1;var c=Ke(l);n=mt([n,c],2)}return r=i?mt([r,o],3):r,n=Ee(r,n),n=Ze(n),n}var x5=function(e){he(t,e);function t(){return e.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return te(function(){var o=n.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],a=Ku(o,i).div(Z(256)),s=FS(a,r.conv32_down);s=bt(s,3,2,"valid"),s=pr(s,r.conv32_1),s=pr(s,r.conv32_2),s=pr(s,r.conv32_3),s=Ll(s,r.conv64_down),s=pr(s,r.conv64_1),s=pr(s,r.conv64_2),s=pr(s,r.conv64_3),s=Ll(s,r.conv128_down),s=pr(s,r.conv128_1),s=pr(s,r.conv128_2),s=Ll(s,r.conv256_down),s=pr(s,r.conv256_1),s=pr(s,r.conv256_2),s=Ll(s,r.conv256_down_out);var u=s.mean([1,2]),l=$d(u,r.fc);return l})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(n){return ue(this,void 0,void 0,function(){var r,o,i,a=this;return le(this,function(s){switch(s.label){case 0:return[4,kt(n)];case 1:return r=s.sent(),o=te(function(){return gt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(n){return y5(n)},t.prototype.extractParams=function(n){return m5(n)},t}(ao);function OS(e,t){var n={descriptor:t};return Object.assign({},e,n)}function LS(e,t){var n={age:t};return Object.assign({},e,n)}function BS(e,t,n){var r={gender:t,genderProbability:n};return Object.assign({},e,r)}var jS=function(){function e(t){var n=t===void 0?{}:t,r=n.minFaceSize,o=n.scaleFactor,i=n.maxNumScales,a=n.scoreThresholds,s=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function w5(e,t){function n(u,l){var c=nn(e(9*u),[3,3,u,1]),d=ct(e(u)),f=ct(e(u)),h=ct(e(u)),p=ct(e(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}function r(u,l,c,d,f){var h=nn(e(u*l*c*c),[c,c,u,l]),p=ct(e(l));return t.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,l,c,d){var f=r(u,l,c,d,!0),h=f.filters,p=f.bias;return{filters:h,batch_norm_offset:p}}function i(u,l,c){var d=n(u,c+"/depthwise_conv"),f=o(u,l,1,c+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:f}}function a(){var u=o(3,32,3,"mobilenetv1/conv_0"),l=i(32,64,"mobilenetv1/conv_1"),c=i(64,128,"mobilenetv1/conv_2"),d=i(128,128,"mobilenetv1/conv_3"),f=i(128,256,"mobilenetv1/conv_4"),h=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),v=i(512,512,"mobilenetv1/conv_7"),g=i(512,512,"mobilenetv1/conv_8"),m=i(512,512,"mobilenetv1/conv_9"),y=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),w=i(512,1024,"mobilenetv1/conv_12"),b=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:v,conv_8:g,conv_9:m,conv_10:y,conv_11:x,conv_12:w,conv_13:b}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),l=o(256,512,3,"prediction_layer/conv_1"),c=o(512,128,1,"prediction_layer/conv_2"),d=o(128,256,3,"prediction_layer/conv_3"),f=o(256,128,1,"prediction_layer/conv_4"),h=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),v=o(64,128,3,"prediction_layer/conv_7"),g=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),m=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),y=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),w=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),b=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),k=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),R=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),N=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),D=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),A={box_encoding_predictor:g,class_predictor:m},j={box_encoding_predictor:y,class_predictor:x},F={box_encoding_predictor:w,class_predictor:b},z={box_encoding_predictor:E,class_predictor:k},B={box_encoding_predictor:_,class_predictor:R},$={box_encoding_predictor:N,class_predictor:D};return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:f,conv_5:h,conv_6:p,conv_7:v,box_predictor_0:A,box_predictor_1:j,box_predictor_2:F,box_predictor_3:z,box_predictor_4:B,box_predictor_5:$}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function b5(e){var t=[],n=uo(e),r=n.extractWeights,o=n.getRemainingWeights,i=w5(r,t),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),l=s(),c=Sm(r(5118*4),[1,5118,4]),d={extra_dim:c};if(t.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:d},paramMappings:t}}function C5(e,t){var n=ii(e,t);function r(l,c,d){var f=n(l+"/Conv2d_"+c+"_pointwise/weights",4,d+"/filters"),h=n(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:f,batch_norm_offset:h}}function o(l){var c="mobilenetv1/conv_"+l,d="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",h=c+"/pointwise_conv",p=n(d+"/depthwise_weights",4,f+"/filters"),v=n(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),g=n(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),m=n(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),y=n(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:v,batch_norm_offset:g,batch_norm_mean:m,batch_norm_variance:y},pointwise_conv:r("MobilenetV1",l,h)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function a(l,c){var d=n(l+"/weights",4,c+"/filters"),f=n(l+"/biases",1,c+"/bias");return{filters:d,bias:f}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),d=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:d}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function E5(e){var t=[],n=C5(e,t),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Gd(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return so(e,t),{params:a,paramMappings:t}}function mr(e,t,n){return te(function(){var r=Vn(e,t.filters,n,"same");return r=Ee(r,t.batch_norm_offset),Fm(r,0,6)})}var S5=.0010000000474974513;function k5(e,t,n){return te(function(){var r=Wd(e,t.filters,n,"same");return r=PE(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,S5),Fm(r,0,6)})}function _5(e){return[2,4,6,12].some(function(t){return t===e})?[2,2]:[1,1]}function R5(e,t){return te(function(){var n=null,r=mr(e,t.conv_0,[2,2]),o=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(o.forEach(function(i,a){var s=a+1,u=_5(s);r=k5(r,i.depthwise_conv,u),r=mr(r,i.pointwise_conv,[1,1]),s===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function N5(e,t,n,r,o){var i=e.shape[0],a=Math.min(n,i),s=t.map(function(c,d){return{score:c,boxIndex:d}}).filter(function(c){return c.score>o}).sort(function(c,d){return d.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var d=c.score,f=l.length-1;f>=0;--f){var h=I5(e,c.boxIndex,l[f]);if(h!==0&&(c.score*=u(h),c.score<=o))break}d===c.score&&l.push(c.boxIndex)}}),l}function I5(e,t,n){var r=e.arraySync(),o=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),a=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),f=(a-o)*(s-i),h=(c-u)*(d-l);if(f<=0||h<=0)return 0;var p=Math.max(o,u),v=Math.max(i,l),g=Math.min(a,c),m=Math.min(s,d),y=Math.max(g-p,0)*Math.max(m-v,0);return y/(f+h-y)}function T5(e){var t=gt(Zo(e,[1,0])),n=[xt(t[2],t[0]),xt(t[3],t[1])],r=[Ee(t[0],Jn(n[0],Z(2))),Ee(t[1],Jn(n[1],Z(2)))];return{sizes:n,centers:r}}function A5(e,t){var n=T5(e),r=n.sizes,o=n.centers,i=gt(Zo(t,[1,0])),a=Jn($t(Vp(Jn(i[2],Z(5))),r[0]),Z(2)),s=Ee($t(Jn(i[0],Z(10)),r[0]),o[0]),u=Jn($t(Vp(Jn(i[3],Z(5))),r[1]),Z(2)),l=Ee($t(Jn(i[1],Z(10)),r[1]),o[1]);return Zo(Rn([xt(s,a),xt(l,u),Ee(s,a),Ee(l,u)]),[1,0])}function P5(e,t,n){return te(function(){var r=e.shape[0],o=A5(Zn(Na(n.extra_dim,[r,1,1]),[-1,4]),Zn(e,[-1,4]));o=Zn(o,[r,o.shape[0]/r,4]);var i=NE(Dr(t,[0,0,1],[-1,-1,-1])),a=Dr(i,[0,0,0],[-1,-1,1]);a=Zn(a,[r,a.shape[1]]);var s=gt(o),u=gt(a);return{boxes:s,scores:u}})}function ta(e,t){return te(function(){var n=e.shape[0],r=Zn(nr(e,t.box_encoding_predictor),[n,-1,1,4]),o=Zn(nr(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function D5(e,t,n){return te(function(){var r=mr(e,n.conv_0,[1,1]),o=mr(r,n.conv_1,[2,2]),i=mr(o,n.conv_2,[1,1]),a=mr(i,n.conv_3,[2,2]),s=mr(a,n.conv_4,[1,1]),u=mr(s,n.conv_5,[2,2]),l=mr(u,n.conv_6,[1,1]),c=mr(l,n.conv_7,[2,2]),d=ta(t,n.box_predictor_0),f=ta(e,n.box_predictor_1),h=ta(o,n.box_predictor_2),p=ta(a,n.box_predictor_3),v=ta(u,n.box_predictor_4),g=ta(c,n.box_predictor_5),m=mt([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,g.boxPredictionEncoding],1),y=mt([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,v.classPrediction,g.classPrediction],1);return{boxPredictions:m,classPredictions:y}})}var Qd=function(){function e(t){var n=t===void 0?{}:t,r=n.minConfidence,o=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),zS=function(e){he(t,e);function t(){return e.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return te(function(){var o=n.toBatchTensor(512,!1).toFloat(),i=xt($t(o,Z(.007843137718737125)),Z(1)),a=R5(i,r.mobilenetv1),s=D5(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return P5(u,l,r.output_layer)})},t.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(n)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var o,i,a,s,u,l,c,d,f,h,p,v,g,m,y,x,w,b,E,k,_;return le(this,function(R){switch(R.label){case 0:return o=new Qd(r),i=o.maxResults,a=o.minConfidence,[4,kt(n)];case 1:for(s=R.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,d=l[0],f=c[0],h=1;h<l.length;h++)l[h].dispose(),c[h].dispose();return g=(v=Array).from,[4,f.data()];case 2:return p=g.apply(v,[R.sent()]),m=.5,y=N5(d,p,i,m,a),x=s.getReshapedInputDimensions(0),w=s.inputSize,b=w/x.width,E=w/x.height,k=d.arraySync(),_=y.map(function(N){var D=[Math.max(0,k[N][0]),Math.min(1,k[N][2])].map(function($){return $*E}),A=D[0],j=D[1],F=[Math.max(0,k[N][1]),Math.min(1,k[N][3])].map(function($){return $*b}),z=F[0],B=F[1];return new Tn(p[N],new Zm(z,A,B-z,j-A),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,_]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(n){return E5(n)},t.prototype.extractParams=function(n){return b5(n)},t}(ao);(function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t})(zS);var M5=.4,F5=[new Te(.738768,.874946),new Te(2.42204,2.65704),new Te(4.30971,7.04493),new Te(10.246,4.59428),new Te(12.6868,11.8741)],O5=[new Te(1.603231,2.094468),new Te(6.041143,7.080126),new Te(2.882459,3.518061),new Te(4.266906,5.178857),new Te(9.041765,10.66308)],L5=[117.001,114.697,97.404],B5="tiny_yolov2_model",j5="tiny_yolov2_separable_conv_model",Bl=function(e){return typeof e=="number"};function z5(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Bl(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return Bl(t.x)&&Bl(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(Bl)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function dg(e){return te(function(){var t=$t(e,Z(.10000000149011612));return Ee(Ze(xt(e,t)),t)})}function mo(e,t){return te(function(){var n=Ui(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Vn(n,t.conv.filters,[1,1],"valid"),n=xt(n,t.bn.sub),n=$t(n,t.bn.truediv),n=Ee(n,t.conv.bias),dg(n)})}function go(e,t){return te(function(){var n=Ui(e,[[0,0],[1,1],[1,1],[0,0]]);return n=jm(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=Ee(n,t.bias),dg(n)})}function W5(e,t){var n=Xd(e,t);function r(a,s){var u=ct(e(a)),l=ct(e(a));return t.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function o(a,s,u){var l=n(a,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var i=sg(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function $5(e,t,n,r){var o=uo(e),i=o.extractWeights,a=o.getRemainingWeights,s=[],u=W5(i,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,f;if(t.withSeparableConvs){var h=r[0],p=r[1],v=r[2],g=r[3],m=r[4],y=r[5],x=r[6],w=r[7],b=r[8],E=t.isFirstLayerConv2d?l(h,p,3,"conv0"):d(h,p,"conv0"),k=d(p,v,"conv1"),_=d(v,g,"conv2"),R=d(g,m,"conv3"),N=d(m,y,"conv4"),D=d(y,x,"conv5"),A=w?d(x,w,"conv6"):void 0,j=b?d(w,b,"conv7"):void 0,F=l(b||w||x,5*n,1,"conv8");f={conv0:E,conv1:k,conv2:_,conv3:R,conv4:N,conv5:D,conv6:A,conv7:j,conv8:F}}else{var h=r[0],p=r[1],v=r[2],g=r[3],m=r[4],y=r[5],x=r[6],w=r[7],b=r[8],E=c(h,p,"conv0"),k=c(p,v,"conv1"),_=c(v,g,"conv2"),R=c(g,m,"conv3"),N=c(m,y,"conv4"),D=c(y,x,"conv5"),A=c(x,w,"conv6"),j=c(w,b,"conv7"),F=l(b,5*n,1,"conv8");f={conv0:E,conv1:k,conv2:_,conv3:R,conv4:N,conv5:D,conv6:A,conv7:j,conv8:F}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}function U5(e,t){var n=ii(e,t);function r(s){var u=n(s+"/sub",1),l=n(s+"/truediv",1);return{sub:u,truediv:l}}function o(s){var u=n(s+"/filters",4),l=n(s+"/bias",1);return{filters:u,bias:l}}function i(s){var u=o(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var a=ug(n);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function V5(e,t){var n=[],r=U5(e,n),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return so(e,n),{params:s,paramMappings:n}}var D1;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(D1||(D1={}));var fg=function(){function e(t){var n=t===void 0?{}:t,r=n.inputSize,o=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),WS=function(e){he(t,e);function t(n){var r=e.call(this,"TinyYolov2")||this;return z5(n),r._config=n,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(n,r){var o=mo(n,r.conv0);return o=bt(o,[2,2],[2,2],"same"),o=mo(o,r.conv1),o=bt(o,[2,2],[2,2],"same"),o=mo(o,r.conv2),o=bt(o,[2,2],[2,2],"same"),o=mo(o,r.conv3),o=bt(o,[2,2],[2,2],"same"),o=mo(o,r.conv4),o=bt(o,[2,2],[2,2],"same"),o=mo(o,r.conv5),o=bt(o,[2,2],[1,1],"same"),o=mo(o,r.conv6),o=mo(o,r.conv7),nr(o,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(n,r){var o=this.config.isFirstLayerConv2d?dg(nr(n,r.conv0,"valid",!1)):go(n,r.conv0);return o=bt(o,[2,2],[2,2],"same"),o=go(o,r.conv1),o=bt(o,[2,2],[2,2],"same"),o=go(o,r.conv2),o=bt(o,[2,2],[2,2],"same"),o=go(o,r.conv3),o=bt(o,[2,2],[2,2],"same"),o=go(o,r.conv4),o=bt(o,[2,2],[2,2],"same"),o=go(o,r.conv5),o=bt(o,[2,2],[1,1],"same"),o=r.conv6?go(o,r.conv6):o,o=r.conv7?go(o,r.conv7):o,nr(o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(n,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return te(function(){var a=n.toBatchTensor(r,!1).toFloat();return a=o.config.meanRgb?Ku(a,o.config.meanRgb):a,a=a.div(Z(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},t.prototype.forward=function(n,r){return ue(this,void 0,void 0,function(){var o;return le(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,kt(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},t.prototype.detect=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var o,i,a,s,u,l,c,d,f,h,p,v,g,m,y=this;return le(this,function(x){switch(x.label){case 0:return o=new fg(r),i=o.inputSize,a=o.scoreThreshold,[4,kt(n)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),l=te(function(){return gt(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return d=x.sent(),u.dispose(),l.dispose(),f=d.map(function(w){return w.box}),h=d.map(function(w){return w.score}),p=d.map(function(w){return w.classScore}),v=d.map(function(w){return y.config.classes[w.label]}),g=Cu(f.map(function(w){return w.rescale(i)}),h,this.config.iouThreshold,!0),m=g.map(function(w){return new fS(h[w],p[w],v[w],f[w],c)}),[2,m]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(n){return V5(n,this.config)},t.prototype.extractParams=function(n){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return $5(n,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(n,r,o){return ue(this,void 0,void 0,function(){var i,a,s,u,l,c,d,f,h,p,v,g,m,y,x,w,b,E,k,_,R,N,D,A,j,F,z,B,$,P=this;return le(this,function(L){switch(L.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,l=s/a,c=n.shape[1],d=this.config.anchors.length,f=te(function(){var W=n.reshape([c,c,d,P.boxEncodingSize]),H=W.slice([0,0,0,0],[c,c,d,4]),q=W.slice([0,0,0,4],[c,c,d,1]),Q=P.withClassScores?oo(W.slice([0,0,0,5],[c,c,d,P.config.classes.length]),3):Z(0);return[H,q,Q]}),h=f[0],p=f[1],v=f[2],g=[],[4,p.array()];case 1:return m=L.sent(),[4,h.array()];case 2:y=L.sent(),x=0,L.label=3;case 3:if(!(x<c))return[3,12];w=0,L.label=4;case 4:if(!(w<c))return[3,11];b=0,L.label=5;case 5:return b<d?(E=gh(m[x][w][b][0]),!o||E>o?(k=(w+gh(y[x][w][b][0]))/c*u,_=(x+gh(y[x][w][b][1]))/c*l,R=Math.exp(y[x][w][b][2])*this.config.anchors[b].x/c*u,N=Math.exp(y[x][w][b][3])*this.config.anchors[b].y/c*l,D=k-R/2,A=_-N/2,j={row:x,col:w,anchor:b},this.withClassScores?[4,this.extractPredictedClass(v,j)]:[3,7]):[3,9]):[3,10];case 6:return $=L.sent(),[3,8];case 7:$={classScore:1,label:0},L.label=8;case 8:F=$,z=F.classScore,B=F.label,g.push(jt({box:new qd(D,A,D+R,A+N),score:E,classScore:E*z,label:B},j)),L.label=9;case 9:return b++,[3,5];case 10:return w++,[3,4];case 11:return x++,[3,3];case 12:return h.dispose(),p.dispose(),v.dispose(),[2,g]}})})},t.prototype.extractPredictedClass=function(n,r){return ue(this,void 0,void 0,function(){var o,i,a,s;return le(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,n.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[o][i][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(ao),H5=function(e){he(t,e);function t(n){n===void 0&&(n=!0);var r=this,o=Object.assign({},{withSeparableConvs:n,iouThreshold:M5,classes:["face"]},n?{anchors:O5,meanRgb:L5}:{anchors:F5,withClassScores:!0});return r=e.call(this,o)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return ue(this,void 0,void 0,function(){var o;return le(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Tn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?j5:B5},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(WS),$S=function(e){he(t,e);function t(){var n=e!==null&&e.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return t}(fg),Xu=function(){function e(){}return e.prototype.then=function(t){return ue(this,void 0,void 0,function(){var n;return le(this,function(r){switch(r.label){case 0:return n=t,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return ue(this,void 0,void 0,function(){return le(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},e}();function Jd(e,t,n,r,o){return o===void 0&&(o=function(i){var a=i.alignedRect;return a}),ue(this,void 0,void 0,function(){var i,a,s,u,l;return le(this,function(c){switch(c.label){case 0:return i=e.map(function(d){return TS(d)?o(d):d.detection}),s=r,s?[3,5]:t instanceof Je?[4,ig(t,i)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,og(t,i)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,n(a)];case 6:return l=c.sent(),a.forEach(function(d){return d instanceof Je&&d.dispose()}),[2,l]}})})}function hg(e,t,n,r,o){return ue(this,void 0,void 0,function(){var i=this;return le(this,function(a){return[2,Jd([e],t,function(s){return ue(i,void 0,void 0,function(){return le(this,function(u){return[2,n(s[0])]})})},r,o)]})})}function G5(e){return te(function(){return Rn(gt(e,3).reverse(),3)})}var jl=2,td=12;function q5(e,t){var n=Xd(e,t),r=ag(e,t);function o(l,c){var d=ct(e(l));return t.push({paramPath:c}),d}function i(l,c,d){d===void 0&&(d=!1);var f=n(l[0],l[1],3,c+"/conv1"),h=o(l[1],c+"/prelu1_alpha"),p=n(l[1],l[2],3,c+"/conv2"),v=o(l[2],c+"/prelu2_alpha"),g=n(l[2],l[3],d?2:3,c+"/conv3"),m=o(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:h,conv2:p,prelu2_alpha:v,conv3:g,prelu3_alpha:m}}function a(){var l=i([3,10,16,32],"pnet"),c=n(32,2,1,"pnet/conv4_1"),d=n(32,4,1,"pnet/conv4_2");return jt(jt({},l),{conv4_1:c,conv4_2:d})}function s(){var l=i([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return jt(jt({},l),{fc1:c,prelu4_alpha:d,fc2_1:f,fc2_2:h})}function u(){var l=i([3,32,64,64],"onet"),c=n(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return jt(jt({},l),{conv4:c,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:v,fc2_3:g})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function K5(e){var t=uo(e),n=t.extractWeights,r=t.getRemainingWeights,o=[],i=q5(n,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,l=a(),c=s(),d=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:d},paramMappings:o}}function X5(e,t){var n=ii(e,t);function r(c){var d=n(c+"/weights",4,c+"/filters"),f=n(c+"/bias",1);return{filters:d,bias:f}}function o(c){var d=n(c+"/weights",2),f=n(c+"/bias",1);return{weights:d,bias:f}}function i(c){return n(c,1)}function a(c){var d=r(c+"/conv1"),f=i(c+"/prelu1_alpha"),h=r(c+"/conv2"),p=i(c+"/prelu2_alpha"),v=r(c+"/conv3"),g=i(c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:f,conv2:h,prelu2_alpha:p,conv3:v,prelu3_alpha:g}}function s(){var c=a("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return jt(jt({},c),{conv4_1:d,conv4_2:f})}function u(){var c=a("rnet"),d=o("rnet/fc1"),f=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return jt(jt({},c),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})}function l(){var c=a("onet"),d=r("onet/conv4"),f=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),v=o("onet/fc2_1"),g=o("onet/fc2_2"),m=o("onet/fc2_3");return jt(jt({},c),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:v,fc2_2:g,fc2_3:m})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function Y5(e){var t=[],n=X5(e,t),r=n.extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,a=r(),s=o(),u=i();return so(e,t),{params:{pnet:a,rnet:s,onet:u},paramMappings:t}}function Jp(e,t){var n=t[0],r=t[1];return{height:Math.floor(n*e),width:Math.floor(r*e)}}function Q5(e,t,n){for(var r=n[0],o=n[1],i=td/e,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(t,u)),s=s*t,u+=1;return a}var pg=function(e){he(t,e);function t(n,r,o,i){return e.call(this,{left:n,top:r,right:o,bottom:i},!0)||this}return t}(Mr);function US(e){return te(function(){return $t(xt(e,Z(127.5)),Z(.0078125))})}function Da(e,t){return te(function(){return Ee(Ze(e),$t(t,Xc(Ze(Xc(e)))))})}function vg(e,t,n){return n===void 0&&(n=!1),te(function(){var r=nr(e,t.conv1,"valid");return r=Da(r,t.prelu1_alpha),r=bt(r,n?[2,2]:[3,3],[2,2],"same"),r=nr(r,t.conv2,"valid"),r=Da(r,t.prelu2_alpha),r=n?r:bt(r,[3,3],[2,2],"valid"),r=nr(r,t.conv3,"valid"),r=Da(r,t.prelu3_alpha),r})}function J5(e,t){return te(function(){var n=vg(e,t,!0),r=nr(n,t.conv4_1,"valid"),o=Ln(Ud(r,3),3),i=oo(xt(r,o),3),a=nr(n,t.conv4_2,"valid");return{prob:i,regions:a}})}function Z5(e,t){return te(function(){var n=Jp(t,e.shape.slice(1)),r=n.height,o=n.width,i=Vm.resizeBilinear(e,[r,o]),a=US(i);return Zo(a,[0,2,1,3])})}function ez(e,t,n,r){for(var o=[],i=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)i[a][s]>=r&&o.push(new Te(s,a));var u=o.map(function(l){var c=new qd(Math.round((l.y*jl+1)/n),Math.round((l.x*jl+1)/n),Math.round((l.y*jl+td)/n),Math.round((l.x*jl+td)/n)),d=i[l.y][l.x],f=t.arraySync(),h=new pg(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:d,region:h}});return u}function tz(e,t,n,r,o){o.stage1=[];var i=t.map(function(f){return te(function(){var h={scale:f},p=Z5(e,f),v=Date.now(),g=J5(p,r),m=g.prob,y=g.regions;h.pnet=Date.now()-v;var x=gt(gt(m,3)[1])[0],w=gt(y)[0];return{scoresTensor:x,regionsTensor:w,scale:f,statsForScale:h}})}),a=i.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,v=f.scale,g=f.statsForScale,m=ez(h,p,v,n);if(h.dispose(),p.dispose(),!m.length)return o.stage1.push(g),[];var y=Date.now(),x=Cu(m.map(function(w){return w.cell}),m.map(function(w){return w.score}),.5);return g.nms=Date.now()-y,g.numBoxes=x.length,o.stage1.push(g),x.map(function(w){return m[w]})}),s=a.reduce(function(f,h){return f.concat(h)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),d=Cu(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-c,l=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var h=f.cell,p=f.region;return new qd(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:l}}function VS(e,t,n){var r=n.width,o=n.height;return ue(this,void 0,void 0,function(){var i,a,s,u=this;return le(this,function(l){switch(l.label){case 0:return i=to(e),[4,Promise.all(t.map(function(c){return ue(u,void 0,void 0,function(){var d,f,h,p,v,g,m,y;return le(this,function(x){return d=c.padAtBorders(e.height,e.width),f=d.y,h=d.ey,p=d.x,v=d.ex,g=p-1,m=f-1,y=i.getImageData(g,m,v-g,h-m),[2,Vt.isNodejs()?rg(y):createImageBitmap(y)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var d=Kd({width:r,height:o}),f=to(d);f.drawImage(c,0,0,r,o);for(var h=f.getImageData(0,0,r,o).data,p=[],v=0;v<h.length;v+=4)p.push(h[v+2]),p.push(h[v+1]),p.push(h[v]);s.push(p)}),[2,s.map(function(c){var d=te(function(){var f=Zo(nn(c,[1,r,o,3]),[0,2,1,3]).toFloat();return US(f)});return d})]}})})}function nz(e,t){return te(function(){var n=vg(e,t),r=Zn(n,[n.shape[0],t.fc1.weights.shape[0]]),o=kr(r,t.fc1),i=Da(o,t.prelu4_alpha),a=kr(i,t.fc2_1),s=Ln(Ud(a,1),1),u=oo(xt(a,s),1),l=kr(i,t.fc2_2),c=gt(u,1)[1];return{scores:c,regions:l}})}function rz(e,t,n,r,o){return ue(this,void 0,void 0,function(){var i,a,s,u,l,c,d,f,h,p,v,g,m,y;return le(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,VS(e,t,{width:24,height:24})];case 1:return a=x.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var b=nz(w,r);return w.dispose(),b}),o.stage2_rnet=Date.now()-i,u=s.length>1?mt(s.map(function(w){return w.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[x.sent()]),u.dispose(),f=l.map(function(w,b){return{score:w,idx:b}}).filter(function(w){return w.score>n}).map(function(w){var b=w.idx;return b}),h=f.map(function(w){return t[w]}),p=f.map(function(w){return l[w]}),v=[],g=[],h.length>0&&(i=Date.now(),m=Cu(h,p,.7),o.stage2_nms=Date.now()-i,y=m.map(function(w){var b=s[f[w]].regions.arraySync();return new pg(b[0][0],b[0][1],b[0][2],b[0][3])}),g=m.map(function(w){return p[w]}),v=m.map(function(w,b){return h[w].calibrate(y[b])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:v,scores:g}]}})})}function oz(e,t){return te(function(){var n=vg(e,t);n=bt(n,[2,2],[2,2],"same"),n=nr(n,t.conv4,"valid"),n=Da(n,t.prelu4_alpha);var r=Zn(n,[n.shape[0],t.fc1.weights.shape[0]]),o=kr(r,t.fc1),i=Da(o,t.prelu5_alpha),a=kr(i,t.fc2_1),s=Ln(Ud(a,1),1),u=oo(xt(a,s),1),l=kr(i,t.fc2_2),c=kr(i,t.fc2_3),d=gt(u,1)[1];return{scores:d,regions:l,points:c}})}function iz(e,t,n,r,o){return ue(this,void 0,void 0,function(){var i,a,s,u,l,c,d,f,h,p,v,g,m,y,x;return le(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,VS(e,t,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(b){var E=oz(b,r);return b.dispose(),E}),o.stage3_onet=Date.now()-i,u=s.length>1?mt(s.map(function(b){return b.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[w.sent()]),u.dispose(),f=l.map(function(b,E){return{score:b,idx:E}}).filter(function(b){return b.score>n}).map(function(b){var E=b.idx;return E}),h=f.map(function(b){var E=s[b].regions.arraySync();return new pg(E[0][0],E[0][1],E[0][2],E[0][3])}),p=f.map(function(b,E){return t[b].calibrate(h[E])}),v=f.map(function(b){return l[b]}),g=[],m=[],y=[],p.length>0&&(i=Date.now(),x=Cu(p,v,.7,!1),o.stage3_nms=Date.now()-i,g=x.map(function(b){return p[b]}),m=x.map(function(b){return v[b]}),y=x.map(function(b,E){return Array(5).fill(0).map(function(k,_){var R=s[b].points.arraySync();return new Te(R[0][_]*(g[E].width+1)+g[E].left,R[0][_+5]*(g[E].height+1)+g[E].top)})})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose(),b.points.dispose()}),[2,{boxes:g,scores:m,points:y}]}})})}var az=function(e){he(t,e);function t(){return e.call(this,"Mtcnn")||this}return t.prototype.load=function(n){return ue(this,void 0,void 0,function(){return le(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,n)]})})},t.prototype.loadFromDisk=function(n){return ue(this,void 0,void 0,function(){return le(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,n)]})})},t.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var o,i,a,s,u,l,c,d,f,h,p,v,g,m,y,x,w,b,E,k,_;return le(this,function(R){switch(R.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=n.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=te(function(){return G5(Ln(Ym.fromPixels(i)).toFloat())}),l=function(N){return u.dispose(),a.total=Date.now()-s,N},c=u.shape.slice(1),d=c[0],f=c[1],h=new jS(r),p=h.minFaceSize,v=h.scaleFactor,g=h.maxNumScales,m=h.scoreThresholds,y=h.scaleSteps,x=(y||Q5(p,v,[d,f])).filter(function(N){var D=Jp(N,[d,f]);return Math.min(D.width,D.height)>td}).slice(0,g),a.scales=x,a.pyramid=x.map(function(N){return Jp(N,[d,f])}),w=Date.now(),[4,tz(u,x,m[0],o.pnet,a)];case 1:return b=R.sent(),a.total_stage1=Date.now()-w,b.boxes.length?(a.stage2_numInputBoxes=b.boxes.length,w=Date.now(),[4,rz(i,b.boxes,m[1],o.rnet,a)]):[2,l({results:[],stats:a})];case 2:return E=R.sent(),a.total_stage2=Date.now()-w,E.boxes.length?(a.stage3_numInputBoxes=E.boxes.length,w=Date.now(),[4,iz(i,E.boxes,m[2],o.onet,a)]):[2,l({results:[],stats:a})];case 3:return k=R.sent(),a.total_stage3=Date.now()-w,_=k.boxes.map(function(N,D){return Yd(ku({},new Tn(k.scores[D],new Zm(N.left/f,N.top/d,N.width/f,N.height/d),{height:d,width:f})),new Dj(k.points[D].map(function(A){return A.sub(new Te(N.left,N.top)).div(new Te(N.width,N.height))}),{width:N.width,height:N.height}))}),[2,l({results:_,stats:a})]}})})},t.prototype.forward=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var o;return le(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,kt(n)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},t.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var o;return le(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,kt(n)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(n){return Y5(n)},t.prototype.extractParams=function(n){return K5(n)},t}(ao),sz=.4,uz=[new Te(1.603231,2.094468),new Te(6.041143,7.080126),new Te(2.882459,3.518061),new Te(4.266906,5.178857),new Te(9.041765,10.66308)],lz=[117.001,114.697,97.404],cz=function(e){he(t,e);function t(){var n=this,r={withSeparableConvs:!0,iouThreshold:sz,classes:["face"],anchors:uz,meanRgb:lz,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=e.call(this,r)||this,n}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(n,r){return ue(this,void 0,void 0,function(){var o;return le(this,function(i){switch(i.label){case 0:return[4,this.detect(n,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new Tn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(n){return e.prototype.extractParamsFromWeigthMap.call(this,n)},t}(WS),ze={ssdMobilenetv1:new zS,tinyFaceDetector:new cz,tinyYolov2:new H5,mtcnn:new az,faceLandmark68Net:new DS,faceLandmark68TinyNet:new f5,faceRecognitionNet:new x5,faceExpressionNet:new Qj,ageGenderNet:new u5},HS=function(e){he(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.extractedFaces=o,i}return t}(Xu),mg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,o=this;return le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,Jd(n,this.input,function(a){return ue(o,void 0,void 0,function(){return le(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return ze.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,n.map(function(a,s){return IS(a,r[s])})]}})})},t.prototype.withAgeAndGender=function(){return new wg(this,this.input)},t}(HS),gg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,hg(n,this.input,function(i){return ze.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,IS(n,r)]}})})},t.prototype.withAgeAndGender=function(){return new bg(this,this.input)},t}(HS),yg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Cg(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Sg(this,this.input)},t}(mg),xg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Eg(this,this.input)},t.prototype.withFaceDescriptor=function(){return new kg(this,this.input)},t}(gg),GS=function(e){he(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.extractedFaces=o,i}return t}(Xu),wg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,o=this;return le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,Jd(n,this.input,function(a){return ue(o,void 0,void 0,function(){return le(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return ze.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,n.map(function(a,s){var u=r[s],l=u.age,c=u.gender,d=u.genderProbability;return LS(BS(a,c,d),l)})]}})})},t.prototype.withFaceExpressions=function(){return new mg(this,this.input)},t}(GS),bg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,o,i,a;return le(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?[4,hg(n,this.input,function(u){return ze.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,i=r.gender,a=r.genderProbability,[2,LS(BS(n,i,a),o)]}})})},t.prototype.withFaceExpressions=function(){return new gg(this,this.input)},t}(GS),Cg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new yg(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Sg(this,this.input)},t}(wg),Eg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new xg(this,this.input)},t.prototype.withFaceDescriptor=function(){return new kg(this,this.input)},t}(bg),qS=function(e){he(t,e);function t(n,r){var o=e.call(this)||this;return o.parentTask=n,o.input=r,o}return t}(Xu),Sg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,Jd(n,this.input,function(i){return Promise.all(i.map(function(a){return ze.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(i,a){return OS(n[a],i)})]}})})},t.prototype.withFaceExpressions=function(){return new yg(this,this.input)},t.prototype.withAgeAndGender=function(){return new Cg(this,this.input)},t}(qS),kg=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),n?[4,hg(n,this.input,function(i){return ze.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,OS(n,r)]}})})},t.prototype.withFaceExpressions=function(){return new xg(this,this.input)},t.prototype.withAgeAndGender=function(){return new Eg(this,this.input)},t}(qS),KS=function(e){he(t,e);function t(n,r,o){var i=e.call(this)||this;return i.parentTask=n,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ze.faceLandmark68TinyNet:ze.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(Xu),dz=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return le(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return n=u.sent(),r=n.map(function(l){return l.detection}),this.input instanceof Je?[4,ig(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,og(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),o.forEach(function(l){return l instanceof Je&&l.dispose()}),[2,n.map(function(l,c){return Yd(l,a[c])})]}})})},t.prototype.withFaceExpressions=function(){return new yg(this,this.input)},t.prototype.withAgeAndGender=function(){return new Cg(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Sg(this,this.input)},t}(KS),fz=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,o,i,a;return le(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?(r=n.detection,this.input instanceof Je?[4,ig(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,og(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof Je&&u.dispose()}),[2,Yd(n,a)]}})})},t.prototype.withFaceExpressions=function(){return new xg(this,this.input)},t.prototype.withAgeAndGender=function(){return new Eg(this,this.input)},t.prototype.withFaceDescriptor=function(){return new kg(this,this.input)},t}(KS),XS=function(e){he(t,e);function t(n,r){r===void 0&&(r=new Qd);var o=e.call(this)||this;return o.input=n,o.options=r,o}return t}(Xu),hz=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,o,i;return le(this,function(a){switch(a.label){case 0:return n=this,r=n.input,o=n.options,o instanceof jS?[4,ze.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(i=o instanceof $S?function(s){return ze.tinyFaceDetector.locateFaces(s,o)}:o instanceof Qd?function(s){return ze.ssdMobilenetv1.locateFaces(s,o)}:o instanceof fg?function(s){return ze.tinyYolov2.locateFaces(s,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return ue(n,void 0,void 0,function(){var o;return le(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return ku({},a)}))]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new dz(this.runAndExtendWithFaceDetections(),this.input,n)},t.prototype.withFaceExpressions=function(){return new mg(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new wg(this.runAndExtendWithFaceDetections(),this.input)},t}(XS),pz=function(e){he(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(o){switch(o.label){case 0:return[4,new hz(this.input,this.options)];case 1:return n=o.sent(),r=n[0],n.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return ue(n,void 0,void 0,function(){var o;return le(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?ku({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new fz(this.runAndExtendWithFaceDetection(),this.input,n)},t.prototype.withFaceExpressions=function(){return new gg(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new bg(this.runAndExtendWithFaceDetection(),this.input)},t}(XS);function vz(e,t){return t===void 0&&(t=new Qd),new pz(e,t)}function mz(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(function(){function e(t,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof Fl)return a;if(a instanceof Float32Array)return new Fl(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Fl(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(t,n){return n.map(function(r){return mz(r,t)}).reduce(function(r,o){return r+o},0)/(n.length||1)},e.prototype.matchDescriptor=function(t){var n=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new I1(i,n.computeMeanDistance(t,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},e.prototype.findBestMatch=function(t){var n=this.matchDescriptor(t);return n.distance<this.distanceThreshold?n:new I1("unknown",n.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){var n=t.labeledDescriptors.map(function(r){return Fl.fromJSON(r)});return new e(n,t.distanceThreshold)},e})();function YS(e,t){var n=new Ni(t.width,t.height),r=n.width,o=n.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(e))return e.map(function(s){return YS(s,{width:r,height:o})});if(TS(e)){var i=e.detection.forSize(r,o),a=e.unshiftedLandmarks.forSize(i.box.width,i.box.height);return Yd(ku(e,i),a)}return Su(e)?ku(e,e.detection.forSize(r,o)):e instanceof Eu||e instanceof Tn?e.forSize(r,o):e}function gz(){const[e,t]=C.useState(!1);return C.useEffect(()=>{async function n(){try{console.log("Loading face detection models...");const r="https://justadudewhohacks.github.io/face-api.js/models";await Promise.all([ze.tinyFaceDetector.loadFromUri(r),ze.faceExpressionNet.loadFromUri(r)]),console.log("Face detection models loaded successfully"),t(!0)}catch(r){console.error("Failed to load face detection models:",r),t(!1)}}n()},[]),{modelsLoaded:e}}function yz(){return{happy:"happy",sad:"sad",neutral:"neutral",angry:"angry",fearful:"fearful",surprised:"surprised",disgusted:"disgusted",contemptuous:"contempt"}}function xz(e,t){switch(e){case"neutral":return t*3.5;case"happy":return t*3.2;case"sad":return t*3;case"angry":return t*2.9;case"surprised":return t*3;case"fearful":return t*3.8;case"disgusted":return t*3;case"contemptuous":return t*3.4;default:return t*2.5}}function Hs(e,t){const n=e[62].y,o=(e[66].y-n)*1.15,i=t.height,a=o/i,s=e[48],u=e[54],l=((s.y+u.y)/2-e[33].y)/i,c=e[33].y,f=(e[51].y-c)/i,h=e[29].y-e[2].y,p=e[29].y-e[14].y,v=Math.abs(h-p)/i,g=Math.abs(e[48].x-e[54].x)/t.width,m=Math.abs(e[51].y-e[57].y)/t.height,y=g/Math.max(.001,m),x=Math.abs(e[7].y-e[8].y)/t.height,w=(s.y-e[33].y)/i,b=(u.y-e[33].y)/i;let E=Math.abs(w-b);const k=Math.atan2(e[48].y-e[31].y,e[48].x-e[31].x),_=Math.atan2(e[54].y-e[35].y,e[54].x-e[35].x);Math.abs(k-_)>.2&&(E+=.01);const N=a>.01&&a<.08,D=Math.abs(e[0].y-e[16].y)/t.height,A=g*m,j=.018,B=e[8].y/t.height<.9-.05,L=Math.abs(e[57].y-e[8].y)/i<.15*.6,W=(e[27].y-e[0].y)/i,H=(e[8].y-e[27].y)/i,q=W/Math.max(.001,H),Q=q>1.2||q<.7,re=g>0&&m>0&&(g/m>8||m/g>3),ce=f/Math.max(.001,A),ee=ce>6||ce<.5,de=A<j*.6||m<.012&&f<.027||m<.01&&g>.13||x<.025&&m<.015||m>0&&g/m>8||B||L||Q||re||ee;return{mouthOpenRatio:a,mouthCornerHeight:l,noseLipDistance:f,mouthAsymmetry:E,mouthWidth:g,mouthHeight:m,mouthAspectRatio:y,jawTension:x,partialMouthOpening:N,headTilt:D,asymmetryRatio:v,mouthArea:A,isMouthCovered:de}}function _g(e,t){const n=t.height,r=(e[22].y-e[27].y)*1.15,o=(e[17].y-e[27].y)*1.15,i=(r+o)/2/n,a=(e[21].y-e[17].y)/n,s=Math.abs(e[21].x-e[17].x)/t.width,u=Math.abs(e[21].y-e[22].y-(e[17].y-e[18].y))/n;return{browSlant:a,browPositionRatio:i,browFurrow:s,browAsymmetry:u}}function Rg(e,t){const n=t.height,r=e[43].y,o=e[47].y,i=e[37].y,a=e[41].y,s=(o-r)/n*1.15,u=(a-i)/n*1.15,l=(s+u)/2,c={x:(e[37].x+e[40].x)/2,y:(e[37].y+e[40].y)/2},d={x:(e[43].x+e[46].x)/2,y:(e[43].y+e[46].y)/2},f={x:e[30].x,y:e[30].y},h=Math.sqrt(Math.pow(c.x-f.x,2)+Math.pow(c.y-f.y,2))/t.width,p=Math.sqrt(Math.pow(d.x-f.x,2)+Math.pow(d.y-f.y,2))/t.width;return{eyeOpenness:l,leftEyeOpenness:s,rightEyeOpenness:u,leftEyeDeviation:h,rightEyeDeviation:p}}function wz(e,t){const r=e.landmarks.positions,o=e.detection.box,i=Hs(r,o),a=_g(r,o),s=Rg(r,o);switch(console.log(`Analyzing landmarks for ${t}`,{mouth:i,eyebrows:a,eyes:s}),t){case"happy":return i.mouthOpenRatio>.03?1.5:1.3;case"sad":return a.browSlant>0?1.5:1.3;case"angry":return a.browPositionRatio<-.03&&a.browFurrow<.5?1.6:1.4;case"surprised":return s.eyeOpenness>.08&&i.mouthOpenRatio>.1?1.7:1.5;case"fearful":return s.eyeOpenness>.07&&a.browPositionRatio>.03?1.6:1.4;case"disgusted":return i.noseLipDistance<.03&&i.mouthCornerHeight<-.01?1.7:1.5;case"contemptuous":return i.asymmetryRatio>.03||i.mouthAsymmetry>.02?1.8:1.6;case"anxious":return s.eyeOpenness>.07&&(s.leftEyeDeviation>.12||s.rightEyeDeviation>.12)||s.eyeOpenness>.06&&i.mouthArea<.01?1.9:1.5;case"stressed":return i.jawTension<.03&&i.mouthAspectRatio>3&&a.browPositionRatio<-.01?1.7:1.5;case"confused":return a.browAsymmetry>.03&&i.partialMouthOpening&&i.headTilt>.04?1.4:1.2;case"neutral":return 1.6;default:return 1.3}}function bz(e,t,n){const o=e.landmarks.positions,i=e.detection.box,a=_g(o,i),s=Hs(o,i),u=Rg(o,i);let l=t,c=n;if(t==="sad"&&n>.5)a.browSlant>0&&s.mouthCornerHeight<-.02&&(l="depressed",c*=1.3);else if(t==="fearful"&&n>.3){if(s.isMouthCovered&&u.eyeOpenness>.01&&(u.leftEyeDeviation>.05||u.rightEyeDeviation>.05))return l="anxious",c*=2,{emotion:l,adjustedScore:c};u.eyeOpenness>.13&&a.browPositionRatio<0||u.eyeOpenness>.13&&s.mouthArea<.015?(l="anxious",c*=1.8):u.eyeOpenness>.13&&u.eyeOpenness<.28&&s.mouthHeight<.02&&a.browPositionRatio>-.03&&(l="stressed",c*=1.3)}else t==="neutral"&&n>.5?(a.browAsymmetry>.04||a.browPositionRatio<-.08)&&s.mouthOpenRatio>.02&&s.mouthOpenRatio<.07&&Math.abs(s.mouthAsymmetry)>.03?(l="confused",c*=1.25):c*=1.4:t==="disgusted"&&n>.5?s.noseLipDistance<.03&&(c*=1.2):(t==="contemptuous"||t==="angry")&&(s.mouthAsymmetry>.02?(l="contempt",c*=1.4):t==="angry"&&s.mouthAsymmetry>.015?Math.abs(u.leftEyeOpenness-u.rightEyeOpenness)>.01?(l="contempt",c*=1.3):a.browFurrow<.4&&a.browPositionRatio<-.01&&(l="angry",c*=1.4):t==="angry"&&a.browFurrow<.4&&a.browPositionRatio<-.01&&s.jawTension<.04&&(l="angry",c*=1.5));return l==="confused"&&c<.65&&(l="neutral",c=.7),{emotion:l,adjustedScore:c}}function Cz(e){if(!e||e.length===0)return null;const t=yz();let n="neutral",r=.3;for(const o of e){if(!o.expressions){console.log("No expressions detected in this face");continue}const i=o.expressions,a={};let s=0;for(const[p,v]of Object.entries(i))v>.08&&(a[p]=v,s+=v);if(s===0)continue;const u=a.contemptuous||0,l=a.angry||0;if(u>.15&&l>.15)try{const p=Hs(o.landmarks.positions,o.detection.box);p&&p.mouthAsymmetry>.02?a.contemptuous=u*1.8:a.angry=l*1.6,s=Object.values(a).reduce((v,g)=>v+g,0)}catch(p){console.error("Error in contempt/anger disambiguation:",p)}for(const[p,v]of Object.entries(a)){const g=v/s;let m=xz(p,g)*1.7;try{const y=wz(o,p);m*=y*1.3,["happy","sad","angry","disgusted","surprised"].includes(p)&&(m*=1.5)}catch(y){console.error("Error in landmark analysis:",y)}if(m>r){r=m,n=p in t?t[p]:"neutral";try{const y=bz(o,p,m);y.emotion!==p&&y.adjustedScore>m*1.2&&(n=y.emotion,r=y.adjustedScore)}catch(y){console.error("Error in advanced emotion analysis:",y)}}}const c=a.surprised||0,d=a.neutral||0,f=a.fearful||0;if(c>.18&&d>.2&&f>.12)try{if(_g(o.landmarks.positions,o.detection.box).browAsymmetry>.04){const v=(c*.5+d*.3+f*.2)*2.5;v>r&&(n="confused",r=v)}}catch(p){console.error("Error analyzing eyebrows for confusion:",p);const v=(c*.4+d*.3+f*.3)*2;v>r&&(n="confused",r=v)}const h=a.sad||0;if(l>.15&&f>.15&&h>.1)try{const p=Hs(o.landmarks.positions,o.detection.box);if(p&&p.jawTension<.035){const v=(l*.5+f*.3+h*.2)*2.2;v>r&&(n="stressed",r=v)}}catch(p){console.error("Error in mouth analysis for stress:",p);const v=(l*.4+f*.3+h*.3)*2;v>r&&(n="stressed",r=v)}try{const p=Rg(o.landmarks.positions,o.detection.box);if(p&&p.eyeOpenness>.07&&(p.leftEyeDeviation>.1||p.rightEyeDeviation>.1)){const v=((f||0)*.7+(c||0)*.3)*3;v>r&&(n="anxious",r=v)}else if(f>.18){const v=Hs(o.landmarks.positions,o.detection.box);if(v&&v.mouthTension>.02){const g=f*2.8;g>r&&(n="anxious",r=g)}}}catch(p){if(console.error("Error in eye/mouth analysis for anxiety:",p),f>.2||f>.15&&c>.15){const v=(f*.7+(c||0)*.3)*2.2;v>r&&(n="anxious",r=v)}}}return{emotion:n,confidence:Math.min(.98,r*1.5)}}async function Ez(e,t,n=!0,r=!1){try{if(!e.videoWidth||!e.videoHeight)return null;t.style.display=n?"block":"none";const o={width:e.videoWidth,height:e.videoHeight};Gj(t,o);const i=new $S({inputSize:r?128:160,scoreThreshold:.25}),a=await vz(e,i).withFaceLandmarks().withFaceExpressions();if(!a)return null;if(n){const s=t.getContext("2d");if(s){s.clearRect(0,0,t.width,t.height);const u=YS(a,o);if(r){const l=u.detection.box;s.strokeStyle="#43a047",s.lineWidth=2,s.strokeRect(l.x,l.y,l.width,l.height)}else jj(t,[u]),Zj(t,[u],.05)}}return Cz([a])}catch(o){return console.error("Error in face detection:",o),null}}function Sz({videoRef:e,canvasRef:t,showDetectionVisuals:n=!0}){const r=ju(),o=C.useRef(0),i=r?400:300,a=C.useRef(!1);return{detectEmotion:C.useCallback(async()=>{if(!e.current||!t.current||a.current)return null;if(e.current.paused||e.current.ended||e.current.readyState<2)return console.log("Video not ready for emotion detection",e.current.readyState),null;a.current=!0;try{console.log("Attempting emotion detection...");const u=await Ez(e.current,t.current,n,r);return a.current=!1,u?(console.log(`Emotion detected: ${u.emotion} (${u.confidence.toFixed(2)}) at ${new Date().toISOString()}`),u):(console.log("No emotion detected in this frame"),null)}catch(u){return console.error("Error in emotion detection:",u),a.current=!1,null}},[e,t,n,r]),lastProcessTimeRef:o,PROCESS_INTERVAL_MS:i}}function kz(){const e=C.useRef([]),t=5,n=7e3,r="neutral",o="confused",i=["confused","stressed","anxious"],a=C.useCallback((u,l)=>{const c=Date.now();e.current.push({emotion:u,confidence:l,timestamp:c}),e.current=e.current.filter(d=>c-d.timestamp<=n).slice(-t)},[]);return{getStabilizedEmotion:C.useCallback((u,l,c)=>{a(u,l);const d=Date.now();e.current=e.current.filter(m=>d-m.timestamp<=n).slice(-t);const f={happy:{count:0,totalConfidence:0,weightedCount:0},sad:{count:0,totalConfidence:0,weightedCount:0},neutral:{count:0,totalConfidence:0,weightedCount:0},angry:{count:0,totalConfidence:0,weightedCount:0},surprised:{count:0,totalConfidence:0,weightedCount:0},fearful:{count:0,totalConfidence:0,weightedCount:0},stressed:{count:0,totalConfidence:0,weightedCount:0},anxious:{count:0,totalConfidence:0,weightedCount:0},depressed:{count:0,totalConfidence:0,weightedCount:0},disgusted:{count:0,totalConfidence:0,weightedCount:0},contempt:{count:0,totalConfidence:0,weightedCount:0},confused:{count:0,totalConfidence:0,weightedCount:0}};e.current.forEach((m,y)=>{const x=1+y/Math.max(1,e.current.length-1),w=1+m.confidence*.5,b=x*w;f[m.emotion].count++,f[m.emotion].totalConfidence+=m.confidence,f[m.emotion].weightedCount+=b});let h=r,p=0,v=0;f[r].weightedCount+=.3,f[o].weightedCount*=.8,Object.entries(f).forEach(([m,y])=>{(y.weightedCount>p||y.weightedCount===p&&y.totalConfidence>v)&&(p=y.weightedCount,v=y.totalConfidence,h=m)});const g=p>0?v/f[h].count:0;if(c){if(h===c.emotion)return{emotion:h,confidence:Math.min(.98,g*1.35)};if(c.emotion===r){const y=c.confidence*.45;return g>y||h==="happy"?{emotion:h,confidence:Math.min(.95,g*1.2)}:c}const m=c.confidence*.65;return g>m?{emotion:h,confidence:Math.min(.95,g*1.2)}:h==="happy"&&f.happy.count>=2?{emotion:"happy",confidence:Math.min(.95,g*1.3)}:h===o&&g<.7?c:i.includes(h)&&h!==o&&g>.5?{emotion:h,confidence:Math.min(.9,g*1.2)}:c}return{emotion:h,confidence:Math.min(.9,g*1.4)}},[a]),resetHistory:C.useCallback(()=>{e.current=[]},[])}}function _z({isActive:e,permission:t,modelsLoaded:n,detectEmotion:r,lastProcessTimeRef:o,processingInterval:i,onEmotionDetected:a,sessionId:s=""}){const[u,l]=C.useState(null),c=C.useRef(null),d=C.useRef(!0),f=C.useRef(null),{getStabilizedEmotion:h,resetHistory:p}=kz(),v=C.useRef(0),g=3e3,m=C.useRef(0),y=2,x=C.useRef(.35),w=C.useRef(0),b=C.useRef(0),E=1500,k=5e3,_=C.useRef("");C.useEffect(()=>()=>{d.current=!1,c.current&&(cancelAnimationFrame(c.current),c.current=null),f.current&&(clearTimeout(f.current),f.current=null)},[]),C.useEffect(()=>{s&&s!==_.current&&(console.log("Session ID changed, resetting emotion history. New session:",s),p(),l(null),w.current=0,b.current=0,v.current=0,m.current=0,x.current=.35,_.current=s)},[s,p]);const R=C.useCallback(async N=>{if(d.current){if(e&&t&&n){const D=N-o.current,A=Date.now();if(D>=i)try{const j=r(),F=new Promise(B=>{f.current=setTimeout(()=>{console.log("Emotion detection timed out, continuing..."),B(null)},800)}),z=await Promise.race([j,F]);if(f.current&&(clearTimeout(f.current),f.current=null),z&&d.current){console.log("Got emotion detection result:",z),v.current=A,m.current=0;const B=h(z.emotion,z.confidence,u);console.log("Stabilized result:",B);const $=A-w.current,P=A-b.current,L=!u||$>=E&&(B.confidence>x.current||B.emotion!==u.emotion&&B.confidence>.4),W=P>=k;(L||W)&&(console.log(`Updating emotion to: ${B.emotion} (${B.confidence.toFixed(2)})${W?" [FORCED UPDATE]":""}`),l(B),w.current=A,a&&(a(B.emotion,B.confidence),b.current=A))}else m.current++,(A-v.current>g||m.current>=y)&&(console.log("No successful emotion detection for too long, resetting history"),p(),v.current=A,m.current=0,u&&l(null),x.current=.3),u&&A-b.current>=k&&(console.log("Forcing emotion output due to timeout"),a&&(a(u.emotion,u.confidence),b.current=A));o.current=N}catch(j){console.error("Error during emotion detection:",j),m.current++}}d.current&&(c.current=requestAnimationFrame(R))}},[e,t,n,r,o,i,a,h,u,p]);return C.useEffect(()=>(e&&t&&n&&d.current&&(console.log("Starting emotion processing loop"),p(),v.current=Date.now(),w.current=0,b.current=0,m.current=0,x.current=.35,c.current=requestAnimationFrame(R)),()=>{c.current&&(cancelAnimationFrame(c.current),c.current=null),f.current&&(clearTimeout(f.current),f.current=null)}),[e,t,n,R,p]),{lastDetectedEmotion:u}}function QS(e={}){const{externalConnectionIssue:t,checkConnectionQuality:n=!0,pollingInterval:r=15e3}=e,[o,i]=C.useState(!1),[a,s]=C.useState("good"),[u,l]=C.useState(navigator.onLine),c=C.useRef(0),d=2;C.useEffect(()=>{const h=()=>{l(!0),c.current=0},p=()=>{l(!1)};return window.addEventListener("online",h),window.addEventListener("offline",p),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",p)}},[]);const f=C.useCallback(async()=>{if(!navigator.onLine){l(!1),s("poor");return}try{const h=Date.now(),p=new Image;let v=!1,g=!1;const m=new Promise((w,b)=>{setTimeout(()=>{g=!0,b(new Error("Connection test timed out"))},8e3)}),y=new Promise(w=>{p.onload=()=>{v=!0,w()},p.onerror=()=>{v=!0,w()},p.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"});await Promise.race([y,m]);const x=Date.now()-h;g||x>3e3?(c.current++,c.current>=d&&s("poor")):(s("good"),c.current=0)}catch{c.current++,c.current>=d&&s("poor")}},[]);return C.useEffect(()=>{if(!n)return;f();const h=setInterval(()=>{f()},r);return()=>clearInterval(h)},[n,r,f]),C.useEffect(()=>{const h=!u||a==="poor"&&c.current>=d||!!t,p=setTimeout(()=>{i(h)},2e3);return()=>clearTimeout(p)},[u,a,t]),{connectionIssue:o,isOnline:u,connectionQuality:a}}function Rz({videoRef:e,canvasRef:t,isActive:n,cameraRequested:r=!1,onEmotionDetected:o,connectionIssue:i,showDetectionVisuals:a=!1,sessionId:s=""}){const[u,l]=C.useState(null),c=C.useRef(!0),d=C.useRef(0),f=2e3,h=C.useRef("");C.useEffect(()=>{s&&(h.current=s,console.log("Updated session ID in hook:",s))},[s]),C.useEffect(()=>()=>{c.current=!1},[]);const{permission:p,error:v,initializeWebcam:g,stopWebcam:m}=H3({videoRef:e}),{modelsLoaded:y}=gz(),{detectEmotion:x,lastProcessTimeRef:w,PROCESS_INTERVAL_MS:b}=Sz({videoRef:e,canvasRef:t,showDetectionVisuals:a}),{connectionIssue:E}=QS({externalConnectionIssue:i,checkConnectionQuality:n&&p}),k=i!==void 0?i:E;_z({isActive:n&&p&&r,permission:p,modelsLoaded:y,detectEmotion:x,lastProcessTimeRef:w,processingInterval:b,onEmotionDetected:o,sessionId:h.current}),C.useEffect(()=>{v&&c.current&&l(v)},[v]),C.useEffect(()=>{if(console.log("FacialRecognition status - isActive:",n,"cameraRequested:",r,"sessionId:",h.current),n&&r&&c.current){const R=Date.now();R-d.current>f?(console.log("Initializing webcam - user interaction detected"),d.current=R,g().catch(N=>{console.error("Failed to initialize webcam:",N),c.current&&l(`Camera initialization failed: ${N.message||"Unknown error"}`)})):console.log("Skipping camera initialization due to debounce:",R-d.current,"ms since last request")}else!n&&c.current&&(console.log("Stopping webcam - session inactive"),m());return()=>{(!n||!c.current)&&(console.log("Cleanup function called in useFacialRecognition"),m())}},[n,r,g,m]);const _=C.useCallback(()=>{if(console.log("Camera access explicitly requested by user"),!n){console.log("Cannot request camera when session is inactive");return}if(!c.current){console.log("Component unmounted, skipping camera request");return}const R=Date.now();R-d.current>f?(console.log("Initializing webcam after explicit user request"),d.current=R,c.current&&l(null),g().catch(N=>{console.error("Failed to initialize webcam after user interaction:",N),c.current&&l(`Camera initialization failed: ${N.message||"Unknown error"}`)})):console.log("Skipping camera initialization due to debounce:",R-d.current,"ms since last request")},[n,g]);return{permission:p,error:u,modelsLoaded:y,connectionIssue:k,requestCameraAccess:_}}function Nz(){const[e,t]=C.useState(""),[n,r]=C.useState(!1),[o,i]=C.useState(!1),a=C.useCallback(async s=>{if(s.trim()){i(!0);try{await new Promise(l=>setTimeout(l,1e3+Math.random()*1e3));let u="";s.toLowerCase().includes("hello")||s.toLowerCase().includes("hi")?u="Hello! How are you feeling today?":s.toLowerCase().includes("how are you")?u="I'm here to listen and support you. What's on your mind?":s.toLowerCase().includes("sad")||s.toLowerCase().includes("upset")?u="I'm sorry to hear you're feeling down. Remember that your feelings are valid, and it's okay to take time for yourself.":s.toLowerCase().includes("happy")||s.toLowerCase().includes("great")?u="I'm glad to hear you're doing well! It's wonderful to acknowledge positive moments.":s.toLowerCase().includes("anxious")||s.toLowerCase().includes("worry")?u="Try taking a few deep breaths. Focus on the present moment and remember that you have overcome challenges before.":u="I'm here to listen and support you. Please tell me more about how you're feeling.",t(u),r(!0)}catch(u){console.error("Error generating AI response:",u),t("I'm sorry, I couldn't process that right now. Please try again later.")}finally{i(!1)}}},[]);return{aiResponse:e,shouldPlayVoice:n,processingInput:o,generateAIResponse:a,setAiResponse:t,setShouldPlayVoice:r}}async function Iz(){try{const e="https://justadudewhohacks.github.io/face-api.js/models";console.log("Beginning to load face detection models..."),await Promise.all([ze.tinyFaceDetector.loadFromUri(e),ze.faceLandmark68Net.loadFromUri(e),ze.faceExpressionNet.loadFromUri(e),ze.faceRecognitionNet.loadFromUri(e),ze.ssdMobilenetv1.loadFromUri(e)]),console.log("All models requested to load");const t=M1();if(console.log("Model load status:",t),!t.tinyFaceDetector||!t.faceExpressionNet||!t.faceLandmark68Net){console.error("Critical models failed to load! Status:",t),t.tinyFaceDetector||(console.log("Retrying tinyFaceDetector model load..."),await ze.tinyFaceDetector.loadFromUri(e)),t.faceExpressionNet||(console.log("Retrying faceExpressionNet model load..."),await ze.faceExpressionNet.loadFromUri(e)),t.faceLandmark68Net||(console.log("Retrying faceLandmark68Net model load..."),await ze.faceLandmark68Net.loadFromUri(e));const n=M1();if(console.log("Model status after retry:",n),!n.tinyFaceDetector||!n.faceExpressionNet||!n.faceLandmark68Net)return console.error("Critical models still failed to load after retry!"),!1}return console.log("All facial recognition models loaded successfully!"),!0}catch(e){return console.error("Error loading face detection models:",e),!1}}function M1(){return{tinyFaceDetector:ze.tinyFaceDetector.isLoaded,faceExpressionNet:ze.faceExpressionNet.isLoaded,faceLandmark68Net:ze.faceLandmark68Net.isLoaded,faceRecognitionNet:ze.faceRecognitionNet.isLoaded,ssdMobilenetv1:ze.ssdMobilenetv1.isLoaded}}class Tz{constructor(){fo(this,"recognition",null);fo(this,"isListening",!1);fo(this,"audioContext",null);fo(this,"analyzer",null);fo(this,"audioData",null);fo(this,"resultCallback",null);fo(this,"endCallback",null);this.initialize()}initialize(){if(typeof window<"u"){const t=window.SpeechRecognition||window.webkitSpeechRecognition;t&&(this.recognition=new t,this.configureRecognition());try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=256;const n=this.analyzer.frequencyBinCount;this.audioData=new Uint8Array(n)}catch(n){console.error("Audio context initialization failed:",n)}}}configureRecognition(){this.recognition&&(this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.onresult=t=>{let n="",r="";for(let a=t.resultIndex;a<t.results.length;++a){const s=t.results[a][0].transcript;t.results[a].isFinal?r+=s:n+=s}const o=r||n,i=!!r;this.resultCallback&&this.resultCallback(o,i)},this.recognition.onend=()=>{this.isListening=!1,this.endCallback&&this.endCallback()})}configure(t){this.recognition&&(t.continuous!==void 0&&(this.recognition.continuous=t.continuous),t.interimResults!==void 0&&(this.recognition.interimResults=t.interimResults),t.language&&(this.recognition.lang=t.language))}async start(){if(!this.recognition)throw new Error("Speech recognition not supported");this.isListening&&(this.stop(),await new Promise(t=>setTimeout(t,100)));try{await navigator.mediaDevices.getUserMedia({audio:!0}),this.recognition.start(),this.isListening=!0}catch(t){throw console.error("Failed to start speech recognition:",t),t}}stop(){this.recognition&&this.isListening&&(this.recognition.stop(),this.isListening=!1)}onResult(t){this.resultCallback=t}onEnd(t){this.endCallback=t}getAudioData(){return this.analyzer&&this.audioData?(this.analyzer.getByteFrequencyData(this.audioData),this.audioData):null}}const mi=new Tz;function Az({sessionActive:e,onTranscriptionComplete:t}){const[n,r]=C.useState(!1),[o,i]=C.useState(""),[a,s]=C.useState(""),u=typeof window<"u"&&(typeof window.SpeechRecognition<"u"||typeof window.webkitSpeechRecognition<"u");C.useEffect(()=>{if(!u){vu({title:"Speech Recognition Not Supported",description:"Your browser doesn't support speech recognition. Please use Chrome, Edge, or Safari.",variant:"destructive"});return}mi.configure({continuous:!0,interimResults:!0,language:"en-US"}),mi.onResult((f,h)=>{h?(i(f),s(""),n&&(d(),t&&t(f))):s(f)}),mi.onEnd(()=>{r(!1)})},[n,u,t]);const l=async()=>{n?d():await c()},c=async()=>{if(!(!e||!u))try{await mi.start(),r(!0)}catch(f){console.error("Error starting speech recognition:",f),vu({title:"Microphone Error",description:"Could not access microphone. Please check permissions.",variant:"destructive"})}},d=()=>{mi.stop(),r(!1)};return{isListening:n,transcription:o,interimTranscript:a,speechRecognitionSupported:u,toggleListening:l,startListening:c,stopListening:d}}function Pz(e){const[t,n]=C.useState(null);return C.useEffect(()=>{let r=null;return e?r=setInterval(()=>{const o=mi.getAudioData();o&&n(o)},100):n(null),()=>{r&&clearInterval(r)}},[e]),t}function Dz(){const e=["happy","sad","neutral","surprised","fearful","angry","stressed","anxious","depressed","disgusted","contempt","confused"],t=e[Math.floor(Math.random()*e.length)],n=.6+Math.random()*.3;return{emotion:t,confidence:n}}function Mz({sessionActive:e,onVoiceEmotionDetected:t}){const[n,r]=C.useState([]),o=C.useCallback(()=>{if(!e||!t)return;const s=Dz();return t(s.emotion,s.confidence),s},[e,t]),i=C.useCallback(s=>{r(u=>[...u,s].slice(-5))},[]),a=C.useCallback(()=>{if(n.length===0)return null;const s=n.reduce((l,c)=>(l[c]=(l[c]||0)+1,l),{});return Object.entries(s).sort((l,c)=>c[1]-l[1])[0][0]},[n]);return{detectVoiceEmotion:o,recordEmotion:i,getStableEmotion:a,recentEmotions:n}}function Fz({onSessionStart:e,onSessionEnd:t}){const[n,r]=C.useState(!1),o=C.useRef(0),i=C.useRef(!1),a=()=>i.current?null:(i.current=!0,r(!0),o.current=Date.now(),e&&e(),vu({title:"Session started",description:"Click the microphone and speak when you're ready."}),i.current=!1,"Hello, I'm Cybella, your AI therapy assistant. I'm here to listen and help you with whatever you're going through. How are you feeling today?"),s=()=>{if(!i.current){i.current=!0,r(!1);try{mi.stop()}catch(l){console.error("Error stopping speech recognition:",l)}if(vu({title:"Session ended",description:"Thank you for using Cybella."}),t)try{t()}catch(l){console.error("Error in onSessionEnd callback:",l)}i.current=!1}};return{sessionActive:n,toggleSession:()=>n?(s(),null):a(),startSession:a,endSession:s,sessionStartTime:o.current}}function Oz({sessionActive:e,onVoiceEmotionDetected:t}){const[n,r]=C.useState(""),{aiResponse:o,shouldPlayVoice:i,processingInput:a,generateAIResponse:s,setAiResponse:u,setShouldPlayVoice:l}=Nz(),{detectVoiceEmotion:c}=Mz({sessionActive:e,onVoiceEmotionDetected:t}),f=Az({sessionActive:e,onTranscriptionComplete:p=>{p.trim()&&(r(p),c(),s(p))}}),h=Pz(f.isListening);return{isListening:f.isListening,transcription:n,interimTranscript:f.interimTranscript,aiResponse:o,shouldPlayVoice:i,audioData:h,processingInput:a,sessionActive:e,speechRecognitionSupported:f.speechRecognitionSupported,toggleListening:f.toggleListening,setAiResponse:u,setShouldPlayVoice:l}}const Lz=({isPlaying:e,onClick:t})=>S.jsx(Bt,{variant:"outline",size:"icon",onClick:t,className:`${e?"bg-primary text-primary-foreground":""}`,children:e?S.jsx(Lb,{size:16}):S.jsx(Ob,{size:16})}),Bz=({isMuted:e,onClick:t})=>S.jsx(Bt,{variant:"outline",size:"icon",onClick:t,children:e?S.jsx(jb,{size:16}):S.jsx(Bb,{size:16})});function JS(e,[t,n]){return Math.min(n,Math.max(t,e))}var jz=C.createContext(void 0);function zz(e){const t=C.useContext(jz);return e||t||"ltr"}function Wz(e){const t=C.useRef({value:e,previous:e});return C.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var ZS=["PageUp","PageDown"],ek=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],tk={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},hs="Slider",[Zp,$z,Uz]=lb(hs),[nk,BW]=Mu(hs,[Uz]),[Vz,Zd]=nk(hs),rk=C.forwardRef((e,t)=>{const{name:n,min:r=0,max:o=100,step:i=1,orientation:a="horizontal",disabled:s=!1,minStepsBetweenThumbs:u=0,defaultValue:l=[r],value:c,onValueChange:d=()=>{},onValueCommit:f=()=>{},inverted:h=!1,form:p,...v}=e,g=C.useRef(new Set),m=C.useRef(0),x=a==="horizontal"?Hz:Gz,[w=[],b]=xd({prop:c,defaultProp:l,onChange:D=>{var j;(j=[...g.current][m.current])==null||j.focus(),d(D)}}),E=C.useRef(w);function k(D){const A=Qz(w,D);N(D,A)}function _(D){N(D,m.current)}function R(){const D=E.current[m.current];w[m.current]!==D&&f(w)}function N(D,A,{commit:j}={commit:!1}){const F=tW(i),z=nW(Math.round((D-r)/i)*i+r,F),B=JS(z,[r,o]);b(($=[])=>{const P=Xz($,B,A);if(eW(P,u*i)){m.current=P.indexOf(B);const L=String(P)!==String($);return L&&j&&f(P),L?P:$}else return $})}return S.jsx(Vz,{scope:e.__scopeSlider,name:n,disabled:s,min:r,max:o,valueIndexToChangeRef:m,thumbs:g.current,values:w,orientation:a,form:p,children:S.jsx(Zp.Provider,{scope:e.__scopeSlider,children:S.jsx(Zp.Slot,{scope:e.__scopeSlider,children:S.jsx(x,{"aria-disabled":s,"data-disabled":s?"":void 0,...v,ref:t,onPointerDown:Pe(v.onPointerDown,()=>{s||(E.current=w)}),min:r,max:o,inverted:h,onSlideStart:s?void 0:k,onSlideMove:s?void 0:_,onSlideEnd:s?void 0:R,onHomeKeyDown:()=>!s&&N(r,0,{commit:!0}),onEndKeyDown:()=>!s&&N(o,w.length-1,{commit:!0}),onStepKeyDown:({event:D,direction:A})=>{if(!s){const z=ZS.includes(D.key)||D.shiftKey&&ek.includes(D.key)?10:1,B=m.current,$=w[B],P=i*z*A;N($+P,B,{commit:!0})}}})})})})});rk.displayName=hs;var[ok,ik]=nk(hs,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Hz=C.forwardRef((e,t)=>{const{min:n,max:r,dir:o,inverted:i,onSlideStart:a,onSlideMove:s,onSlideEnd:u,onStepKeyDown:l,...c}=e,[d,f]=C.useState(null),h=ft(t,x=>f(x)),p=C.useRef(),v=zz(o),g=v==="ltr",m=g&&!i||!g&&i;function y(x){const w=p.current||d.getBoundingClientRect(),b=[0,w.width],k=Ng(b,m?[n,r]:[r,n]);return p.current=w,k(x-w.left)}return S.jsx(ok,{scope:e.__scopeSlider,startEdge:m?"left":"right",endEdge:m?"right":"left",direction:m?1:-1,size:"width",children:S.jsx(ak,{dir:v,"data-orientation":"horizontal",...c,ref:h,style:{...c.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:x=>{const w=y(x.clientX);a==null||a(w)},onSlideMove:x=>{const w=y(x.clientX);s==null||s(w)},onSlideEnd:()=>{p.current=void 0,u==null||u()},onStepKeyDown:x=>{const b=tk[m?"from-left":"from-right"].includes(x.key);l==null||l({event:x,direction:b?-1:1})}})})}),Gz=C.forwardRef((e,t)=>{const{min:n,max:r,inverted:o,onSlideStart:i,onSlideMove:a,onSlideEnd:s,onStepKeyDown:u,...l}=e,c=C.useRef(null),d=ft(t,c),f=C.useRef(),h=!o;function p(v){const g=f.current||c.current.getBoundingClientRect(),m=[0,g.height],x=Ng(m,h?[r,n]:[n,r]);return f.current=g,x(v-g.top)}return S.jsx(ok,{scope:e.__scopeSlider,startEdge:h?"bottom":"top",endEdge:h?"top":"bottom",size:"height",direction:h?1:-1,children:S.jsx(ak,{"data-orientation":"vertical",...l,ref:d,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const g=p(v.clientY);i==null||i(g)},onSlideMove:v=>{const g=p(v.clientY);a==null||a(g)},onSlideEnd:()=>{f.current=void 0,s==null||s()},onStepKeyDown:v=>{const m=tk[h?"from-bottom":"from-top"].includes(v.key);u==null||u({event:v,direction:m?-1:1})}})})}),ak=C.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:o,onSlideEnd:i,onHomeKeyDown:a,onEndKeyDown:s,onStepKeyDown:u,...l}=e,c=Zd(hs,n);return S.jsx(je.span,{...l,ref:t,onKeyDown:Pe(e.onKeyDown,d=>{d.key==="Home"?(a(d),d.preventDefault()):d.key==="End"?(s(d),d.preventDefault()):ZS.concat(ek).includes(d.key)&&(u(d),d.preventDefault())}),onPointerDown:Pe(e.onPointerDown,d=>{const f=d.target;f.setPointerCapture(d.pointerId),d.preventDefault(),c.thumbs.has(f)?f.focus():r(d)}),onPointerMove:Pe(e.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&o(d)}),onPointerUp:Pe(e.onPointerUp,d=>{const f=d.target;f.hasPointerCapture(d.pointerId)&&(f.releasePointerCapture(d.pointerId),i(d))})})}),sk="SliderTrack",uk=C.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,o=Zd(sk,n);return S.jsx(je.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...r,ref:t})});uk.displayName=sk;var ev="SliderRange",lk=C.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,o=Zd(ev,n),i=ik(ev,n),a=C.useRef(null),s=ft(t,a),u=o.values.length,l=o.values.map(f=>dk(f,o.min,o.max)),c=u>1?Math.min(...l):0,d=100-Math.max(...l);return S.jsx(je.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...r,ref:s,style:{...e.style,[i.startEdge]:c+"%",[i.endEdge]:d+"%"}})});lk.displayName=ev;var tv="SliderThumb",ck=C.forwardRef((e,t)=>{const n=$z(e.__scopeSlider),[r,o]=C.useState(null),i=ft(t,s=>o(s)),a=C.useMemo(()=>r?n().findIndex(s=>s.ref.current===r):-1,[n,r]);return S.jsx(qz,{...e,ref:i,index:a})}),qz=C.forwardRef((e,t)=>{const{__scopeSlider:n,index:r,name:o,...i}=e,a=Zd(tv,n),s=ik(tv,n),[u,l]=C.useState(null),c=ft(t,y=>l(y)),d=u?a.form||!!u.closest("form"):!0,f=e2(u),h=a.values[r],p=h===void 0?0:dk(h,a.min,a.max),v=Yz(r,a.values.length),g=f==null?void 0:f[s.size],m=g?Jz(g,p,s.direction):0;return C.useEffect(()=>{if(u)return a.thumbs.add(u),()=>{a.thumbs.delete(u)}},[u,a.thumbs]),S.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[s.startEdge]:`calc(${p}% + ${m}px)`},children:[S.jsx(Zp.ItemSlot,{scope:e.__scopeSlider,children:S.jsx(je.span,{role:"slider","aria-label":e["aria-label"]||v,"aria-valuemin":a.min,"aria-valuenow":h,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...i,ref:c,style:h===void 0?{display:"none"}:e.style,onFocus:Pe(e.onFocus,()=>{a.valueIndexToChangeRef.current=r})})}),d&&S.jsx(Kz,{name:o??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:h},r)]})});ck.displayName=tv;var Kz=e=>{const{value:t,...n}=e,r=C.useRef(null),o=Wz(t);return C.useEffect(()=>{const i=r.current,a=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(a,"value").set;if(o!==t&&u){const l=new Event("input",{bubbles:!0});u.call(i,t),i.dispatchEvent(l)}},[o,t]),S.jsx("input",{style:{display:"none"},...n,ref:r,defaultValue:t})};function Xz(e=[],t,n){const r=[...e];return r[n]=t,r.sort((o,i)=>o-i)}function dk(e,t,n){const i=100/(n-t)*(e-t);return JS(i,[0,100])}function Yz(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Qz(e,t){if(e.length===1)return 0;const n=e.map(o=>Math.abs(o-t)),r=Math.min(...n);return n.indexOf(r)}function Jz(e,t,n){const r=e/2,i=Ng([0,50],[0,r]);return(r-i(t)*n)*n}function Zz(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function eW(e,t){if(t>0){const n=Zz(e);return Math.min(...n)>=t}return!0}function Ng(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function tW(e){return(String(e).split(".")[1]||"").length}function nW(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var fk=rk,rW=uk,oW=lk,iW=ck;const hk=C.forwardRef(({className:e,...t},n)=>S.jsxs(fk,{ref:n,className:Ve("relative flex w-full touch-none select-none items-center",e),...t,children:[S.jsx(rW,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:S.jsx(oW,{className:"absolute h-full bg-primary"})}),S.jsx(iW,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));hk.displayName=fk.displayName;const aW=({value:e,onValueChange:t})=>{const n=o=>{t(o[0])},r=()=>e===0?S.jsx(jb,{size:16}):e<.33?S.jsx(XN,{size:16}):e<.66?S.jsx(KN,{size:16}):S.jsx(Bb,{size:16});return S.jsxs("div",{className:"flex items-center gap-2 w-32",children:[S.jsx(r,{}),S.jsx(hk,{defaultValue:[e],value:[e],max:1,step:.01,onValueChange:n,className:"flex-1"})]})},sW=({text:e,autoplay:t=!1})=>{const{isPlaying:n,isMuted:r,volume:o,handlePlay:i,toggleMute:a,handleVolumeChange:s}=$3({text:e,autoplay:t});return e?S.jsxs("div",{className:"flex items-center gap-2",children:[S.jsx(Lz,{isPlaying:n,onClick:i}),S.jsx(Bz,{isMuted:r,onClick:a}),S.jsx(aW,{value:o,onValueChange:s})]}):null},uW=({processingInput:e,aiResponse:t,shouldPlayVoice:n,sessionActive:r})=>S.jsxs("div",{className:"flex flex-col space-y-3",children:[(e||t)&&S.jsxs("div",{className:"flex items-start gap-2",children:[S.jsx(Md,{className:"border border-primary bg-primary/10 h-8 w-8",children:S.jsx(Fd,{className:"text-primary text-xs",children:"AI"})}),S.jsx("div",{className:"bg-muted/30 rounded-lg rounded-tl-none p-2 max-w-[90%]",children:e&&!t?S.jsxs("p",{className:"text-sm text-muted-foreground",children:[S.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-pulse mr-1"}),S.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-pulse mx-1"}),S.jsx("span",{className:"inline-block w-2 h-2 bg-gray-400 rounded-full animate-pulse ml-1"})]}):t?S.jsxs("div",{children:[S.jsx("p",{className:"text-sm",children:t}),n&&S.jsx("div",{className:"mt-2 flex justify-end",children:S.jsx(sW,{text:t,autoplay:n})})]}):null})]}),!e&&!t&&r&&S.jsx("div",{className:"text-center py-2",children:S.jsx("p",{className:"text-sm text-muted-foreground",children:"Say something to start the conversation"})}),!r&&S.jsx("div",{className:"text-center py-2",children:S.jsx("p",{className:"text-sm text-muted-foreground",children:"Start a session to chat with Cybella"})})]}),lW=({isListening:e,audioData:t})=>{const[n,r]=C.useState(Array(10).fill(3));return C.useEffect(()=>{if(!e){r(Array(10).fill(3));return}if(t){const o=Array(10).fill(0).map((i,a)=>{const s=Math.floor(a*(t.length/10));return Math.max(3,Math.min(20,3+t[s]/255*17))});r(o)}else{const o=setInterval(()=>{r(Array(10).fill(0).map(()=>e?Math.max(3,Math.floor(Math.random()*20)):3))},100);return()=>clearInterval(o)}},[e,t]),S.jsxs("div",{className:"audio-wave",children:[n.map((o,i)=>S.jsx("div",{className:"audio-wave-bar",style:{height:`${o}px`,opacity:e?1:.5,backgroundColor:e?"#4f46e5":"#a8a8a8",transition:"height 0.2s ease-in-out, background-color 0.3s ease"}},i)),S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .audio-wave {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 3px;
          height: 30px;
        }
        .audio-wave-bar {
          width: 4px;
          border-radius: 2px;
          transform-origin: bottom;
        }
      `}})]})},cW=({isListening:e,audioData:t,sessionActive:n,processingInput:r,connectionIssue:o=!1,toggleListening:i})=>S.jsxs("div",{className:"flex items-center",children:[S.jsxs("div",{className:"flex-1",children:[e&&t&&S.jsx(lW,{isListening:e,audioData:t}),o&&S.jsxs("div",{className:"flex items-center text-amber-500 mb-1",children:[S.jsx(Ed,{className:"inline mr-1",size:12}),S.jsx("p",{className:"text-xs",children:"Network connection issues detected. Voice recognition quality may be affected."})]})]}),S.jsx(Bt,{variant:"default",size:"icon",className:`w-12 h-12 rounded-full shadow-md ${e?"bg-red-500 hover:bg-red-600":"bg-primary hover:bg-primary/90"}`,disabled:!n||r||o,onClick:i,"aria-label":e?"Stop listening":"Start listening",children:e?S.jsx(HN,{size:20}):S.jsx(GN,{size:20})})]}),dW=({onVoiceEmotionDetected:e,onSessionStart:t,onSessionEnd:n,isOnline:r=!0,sessionActive:o})=>{const i=ju(),{connectionQuality:a}=hm(),{connectionIssue:s}=QS({externalConnectionIssue:!r||a==="poor"}),u=o!==void 0,l=Fz({onSessionStart:t,onSessionEnd:n}),c=u?o:l.sessionActive,d=Oz({sessionActive:c,onVoiceEmotionDetected:e}),f=C.useRef(null),h=()=>{var v;(v=f.current)==null||v.scrollIntoView({behavior:"smooth"})};C.useEffect(()=>{!r&&l.sessionActive&&!u&&l.endSession()},[r,l,u]),C.useEffect(()=>{c&&(d.setAiResponse("Hi there! I'm Cybella. How are you feeling today? I'm here to chat and support you through whatever's on your mind."),d.setShouldPlayVoice(!0))},[c,d]),C.useEffect(()=>{h()},[d.aiResponse,d.transcription]);const p=i?"h-[250px]":"h-[300px]";return S.jsxs(tn,{className:"p-3 md:p-4",children:[S.jsx(j3,{sessionActive:c,toggleSession:u?t||(()=>{}):l.toggleSession,disabled:!r,isOnline:r}),S.jsx("div",{className:`overflow-y-auto ${p} pr-2`,children:S.jsxs("div",{className:"space-y-4",children:[S.jsx(uW,{processingInput:d.processingInput,aiResponse:d.aiResponse,shouldPlayVoice:d.shouldPlayVoice,sessionActive:c}),S.jsx(z3,{transcription:d.transcription,interimTranscript:d.interimTranscript,isListening:d.isListening,sessionActive:c}),S.jsx("div",{ref:f})]})}),S.jsx("div",{className:"mt-3 pt-3 border-t",children:S.jsx(cW,{isListening:d.isListening,audioData:d.audioData,sessionActive:c,processingInput:d.processingInput,toggleListening:d.toggleListening,connectionIssue:s})})]})};function fW(e,t,n,r){const[o,i]=C.useState(!1),[a,s]=C.useState(null);C.useEffect(()=>{i(!1),s(null)},[t,n,r]),C.useEffect(()=>{const l=e.current;if(!l)return;const c=v=>{i(!1),s("Camera error encountered. Please refresh the page and try again.")},d=()=>{i(!0),s(null)},f=()=>{i(!0),s(null)},h=()=>{i(!1),s("Video stream stalled. Please wait...")},p=()=>{o&&s("Video stream suspended. Attempting to reconnect...")};return l.addEventListener("error",c),l.addEventListener("loadeddata",d),l.addEventListener("play",f),l.addEventListener("stalled",h),l.addEventListener("suspend",p),()=>{l.removeEventListener("error",c),l.removeEventListener("loadeddata",d),l.removeEventListener("play",f),l.removeEventListener("stalled",h),l.removeEventListener("suspend",p)}},[e,o,r]),C.useEffect(()=>{if(t&&n&&e.current&&!o){const l=setTimeout(()=>{const c=e.current;if(c&&!o){const d=c.srcObject;c.srcObject=null,setTimeout(()=>{c&&(c.srcObject=d,c.play().catch(()=>{s("Failed to start camera stream. Please reload the page.")}))},200)}},1500);return()=>clearTimeout(l)}},[t,n,e,o,r]);const u=C.useCallback(()=>{i(!1),s(null)},[]);return{videoLoaded:o,videoErrorMessage:a,resetVideoState:u}}const hW=({videoRef:e,canvasRef:t,mirrored:n=!0,showDetectionVisuals:r=!0,highQuality:o=!1,permissionGranted:i,isActive:a})=>{const s={width:o?1280:640,height:o?720:480};return S.jsxs("div",{className:"relative w-full h-full",children:[S.jsx("video",{ref:e,autoPlay:!0,playsInline:!0,muted:!0,width:s.width,height:s.height,style:{width:"100%",height:"100%",objectFit:"cover",transform:n?"scaleX(-1)":"none",opacity:!i||!a?.5:1,transition:"all 300ms ease"},className:"w-full h-full object-cover rounded-md"}),S.jsx("canvas",{ref:t,width:s.width,height:s.height,className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{transform:n?"scaleX(-1)":"none",opacity:r?1:0,transition:"opacity 300ms ease",zIndex:10}})]})},pW=({loading:e,errorMessage:t})=>!e&&!t?null:S.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 z-20",children:S.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e&&S.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"}),t&&S.jsx("p",{className:"text-sm text-center text-amber-500 bg-black/20 px-2 py-1 rounded",children:t})]})}),vW=({videoRef:e,canvasRef:t,permissionGranted:n,isActive:r,highQuality:o=!1,mirrored:i=!0,showDetectionVisuals:a=!0,sessionKey:s=""})=>{const{videoLoaded:u,videoErrorMessage:l}=fW(e,r,n,s);return C.useEffect(()=>{if(t.current){const c=t.current.getContext("2d");c&&t.current.width>0&&t.current.height>0&&c.clearRect(0,0,t.current.width,t.current.height)}},[t,r,n,s]),S.jsxs("div",{className:"relative w-full h-full",children:[S.jsx(hW,{videoRef:e,canvasRef:t,mirrored:i,showDetectionVisuals:a,highQuality:o,permissionGranted:n,isActive:r}),S.jsx(pW,{loading:!u&&n&&r,errorMessage:l})]})},mW=({error:e,isActive:t,modelsLoaded:n,connectionIssue:r=!1,cameraRequested:o=!1,permissionGranted:i=!1,onRequestCamera:a})=>e?S.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 text-center bg-black/10 backdrop-blur-sm z-20",children:S.jsxs("div",{className:"max-w-xs space-y-3",children:[S.jsx("p",{className:"text-sm text-red-500 font-medium",children:e}),a&&t&&S.jsxs(Bt,{onClick:a,size:"sm",variant:"outline",className:"flex items-center gap-2",children:[S.jsx(G0,{size:16}),"Try Again"]})]})}):r&&t?S.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm z-10",children:S.jsxs("div",{className:"text-center px-4",children:[S.jsx(Ed,{className:"mx-auto h-8 w-8 text-amber-500 mb-2"}),S.jsx("p",{className:"text-sm text-amber-500 font-medium mb-1",children:"Connection Issues Detected"}),S.jsx("p",{className:"text-xs text-muted-foreground",children:"Facial recognition models may struggle with your current connection."}),a&&S.jsxs(Bt,{onClick:a,size:"sm",variant:"outline",className:"mt-2 flex items-center gap-2",children:[S.jsx(G0,{size:16}),"Retry Connection"]})]})}):t?t&&!o&&a?S.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm z-10",children:S.jsxs("div",{className:"text-center",children:[S.jsxs(Bt,{onClick:a,size:"lg",className:"flex items-center gap-2 mb-2",children:[S.jsx($N,{size:20}),"Enable Camera"]}),S.jsx("p",{className:"text-xs text-muted-foreground max-w-[260px]",children:"Browser security requires user interaction before enabling camera access"})]})}):!n&&o&&t?S.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm z-10",children:S.jsxs("div",{className:"text-center",children:[S.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mb-2"}),S.jsx("p",{className:"text-sm text-center px-4 text-muted-foreground",children:"Loading face detection models..."})]})}):null:S.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 backdrop-blur-sm z-10",children:S.jsx("p",{className:"text-sm text-center px-4 text-muted-foreground",children:'Click "Start Session" to enable facial analysis'})}),gW=({videoRef:e,canvasRef:t,permission:n,error:r,modelsLoaded:o,connectionIssue:i,isActive:a,emotion:s,requestCameraAccess:u,cameraRequested:l,highAccuracyMode:c=!1,mirrored:d=!0})=>{const f=()=>{u()};return S.jsx(tn,{className:"overflow-hidden relative",children:S.jsxs("div",{className:"aspect-video bg-muted relative overflow-hidden rounded-md",children:[S.jsx(mW,{error:r,isActive:a,modelsLoaded:o,connectionIssue:i,cameraRequested:l,onRequestCamera:f,permissionGranted:n}),S.jsx(vW,{videoRef:e,canvasRef:t,permissionGranted:n,isActive:a,highQuality:c,mirrored:d})]})})},pk=C.createContext(void 0);function yW({children:e}){const[t,n]=C.useState(null),[r,o]=C.useState(0),i=(a,s)=>{n(a),o(s)};return S.jsx(pk.Provider,{value:{stableEmotion:t,stableConfidence:r,setEmotionData:i},children:e})}function xW(){const e=C.useContext(pk);if(e===void 0)throw new Error("useEmotion must be used within an EmotionProvider");return e}const wW=({onEmotionDetected:e,isActive:t,connectionIssue:n=!1})=>{const r=C.useRef(null),o=C.useRef(null),{stableEmotion:i,setEmotionData:a}=xW(),[s,u]=C.useState(!1),{toast:l}=W3(),[c,d]=C.useState(!0),f=C.useRef(!1),h=C.useRef(t),p=C.useRef(!1),v=ju(),g=C.useRef("");C.useEffect(()=>{t&&!h.current&&(g.current=`session-${Date.now()}`,console.log("New face detection session ID:",g.current)),h.current=t},[t]),C.useEffect(()=>{p.current||(p.current=!0,Iz().then(()=>{f.current||(l({title:"Facial Recognition Ready",description:v?"Emotion detection optimized for mobile device.":"Emotion detection is ready."}),f.current=!0)}).catch(()=>{l({title:"Detection Models Issue",description:"There was a problem loading emotion detection models. Please refresh the page.",variant:"destructive"})}))},[l,v]);const m=R=>{a(R,0),e&&e(R)},{permission:y,error:x,modelsLoaded:w,connectionIssue:b,requestCameraAccess:E}=Rz({videoRef:r,canvasRef:o,isActive:t,cameraRequested:s,onEmotionDetected:R=>m(R),sessionId:g.current}),k=()=>{u(!0),E()},_=n||b;return C.useEffect(()=>{t&&!y&&!s&&(u(!0),setTimeout(()=>{E()},500))},[t,y,s,E]),C.useEffect(()=>{!t&&h.current&&u(!1),h.current=t},[t]),S.jsx(gW,{videoRef:r,canvasRef:o,permission:y,error:x,modelsLoaded:w,connectionIssue:_,isActive:t,emotion:i,requestCameraAccess:k,cameraRequested:s,highAccuracyMode:c,mirrored:!0})},bW=e=>S.jsx(yW,{children:S.jsx(wW,{...e})}),F1={happy:"bg-therapeutic-calm",sad:"bg-therapeutic-tranquil",neutral:"bg-therapeutic-serene",angry:"bg-red-400",surprised:"bg-therapeutic-relaxed",fearful:"bg-therapeutic-peaceful",stressed:"bg-amber-500",anxious:"bg-purple-400",depressed:"bg-indigo-600",disgusted:"bg-green-600",contempt:"bg-amber-700",confused:"bg-blue-400"},O1={happy:"😊",sad:"😔",neutral:"😐",angry:"😠",surprised:"😮",fearful:"😨",stressed:"😫",anxious:"😰",depressed:"😞",disgusted:"🤢",contempt:"😏",confused:"😕"},CW=({faceEmotion:e,voiceEmotion:t,confidence:n={face:0,voice:0}})=>!e&&!t?null:S.jsxs(tn,{className:"p-4 md:p-6 shadow-sm bg-white/60 dark:bg-gray-800/60 backdrop-blur-sm",children:[S.jsx("h3",{className:"text-lg font-medium mb-3",children:"Current Emotional State"}),S.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e&&S.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-gradient-to-br from-white/80 to-gray-100/80 dark:from-gray-700/80 dark:to-gray-800/80",children:[S.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${F1[e]||"bg-gray-200"}`,children:S.jsx("span",{className:"text-xl",role:"img","aria-label":e,children:O1[e]||"🙂"})}),S.jsxs("div",{className:"flex-1",children:[S.jsx("p",{className:"text-sm font-medium",children:"Facial Expression"}),S.jsxs("div",{className:"flex justify-between items-center",children:[S.jsx("span",{className:"capitalize text-sm",children:e}),n.face!==void 0&&S.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(n.face*100),"%"]})]})]})]}),t&&S.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg bg-gradient-to-br from-white/80 to-gray-100/80 dark:from-gray-700/80 dark:to-gray-800/80",children:[S.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${F1[t]||"bg-gray-200"}`,children:S.jsx("span",{className:"text-xl",role:"img","aria-label":t,children:O1[t]||"🙂"})}),S.jsxs("div",{className:"flex-1",children:[S.jsx("p",{className:"text-sm font-medium",children:"Voice Tone"}),S.jsxs("div",{className:"flex justify-between items-center",children:[S.jsx("span",{className:"capitalize text-sm",children:t}),n.voice!==void 0&&S.jsxs("span",{className:"text-xs text-muted-foreground",children:[Math.round(n.voice*100),"%"]})]})]})]})]})]}),EW=()=>{const[e,t]=J.useState(null),[n,r]=J.useState(null),[o,i]=J.useState(!1),[a,s]=J.useState(0),u=ju(),{isOnline:l,connectionQuality:c}=hm(),d=p=>{t(p)},f=p=>{r(p)},h=()=>{i(p=>!p),o||s(p=>p+1)};return S.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-[#1E90FF] to-[#87CEEB]",children:[S.jsx(ym,{}),S.jsx("main",{className:"flex-1 container py-8 px-3 mx-auto mt-16 md:mt-28",children:S.jsxs("div",{className:"space-y-8 max-w-[1200px] mx-auto",children:[S.jsxs("div",{className:`grid ${u?"grid-cols-1 gap-6":"grid-cols-2 gap-8"}`,children:[S.jsxs("div",{className:"space-y-6",children:[S.jsx(dW,{onVoiceEmotionDetected:f,onSessionStart:h,onSessionEnd:()=>i(!1),isOnline:l,sessionActive:o},`voice-${a}`),!u&&null]}),S.jsxs("div",{className:`space-y-6 ${u?"order-first":""}`,children:[S.jsx(bW,{onEmotionDetected:d,isActive:o,connectionIssue:!l||c==="poor"},`face-${a}`),!u&&null]})]}),S.jsx("div",{className:"pt-2 md:pt-6",children:S.jsx(CW,{faceEmotion:e,voiceEmotion:n})})]})}),S.jsx(xm,{})]})},SW=()=>{const e=Bu();return C.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),S.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:S.jsxs("div",{className:"text-center",children:[S.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),S.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),S.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},kW=new uP,_W=()=>S.jsx(cP,{client:kW,children:S.jsx(dD,{children:S.jsxs(jA,{children:[S.jsx(rT,{}),S.jsx(dT,{}),S.jsx(pD,{}),S.jsx(iD,{basename:"/Test-CybellaAI/",children:S.jsxs(JP,{children:[S.jsx(di,{path:"/",element:S.jsx(Hf,{})}),S.jsx(di,{path:"/chat",element:S.jsx(EW,{})}),S.jsx(di,{path:"/about",element:S.jsx(B3,{})}),S.jsx(di,{path:"/face",element:S.jsx(Hf,{})}),S.jsx(di,{path:"/emotions",element:S.jsx(Hf,{})}),S.jsx(di,{path:"*",element:S.jsx(SW,{})})]})})]})})});ab(document.getElementById("root")).render(S.jsx(_W,{}))});export default RW();
